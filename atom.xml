<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Liangçš„ä¸ªäººåšå®¢</title>
  
  
  <link href="https://liang5757.github.io/atom.xml" rel="self"/>
  
  <link href="https://liang5757.github.io/"/>
  <updated>2025-12-13T14:32:27.284Z</updated>
  <id>https://liang5757.github.io/</id>
  
  <author>
    <name>Liang</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æµ…å†™ä¸€ä¸‹è„šæ‰‹æ¶</title>
    <link href="https://liang5757.github.io/2025/12/11/node.js/%E6%B5%85%E5%86%99%E4%B8%80%E4%B8%8B%E8%84%9A%E6%89%8B%E6%9E%B6/"/>
    <id>https://liang5757.github.io/2025/12/11/node.js/%E6%B5%85%E5%86%99%E4%B8%80%E4%B8%8B%E8%84%9A%E6%89%8B%E6%9E%B6/</id>
    <published>2025-12-11T14:48:03.000Z</published>
    <updated>2025-12-13T14:32:27.284Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œè„šæ‰‹æ¶ï¼ˆCLI å·¥å…·ï¼‰å·²ç»æˆä¸ºä¸å¯æˆ–ç¼ºçš„å¼€å‘å·¥å…·ã€‚æ— è®ºæ˜¯ Vue CLIã€Create React App è¿˜æ˜¯ Angular CLIï¼Œå®ƒä»¬éƒ½èƒ½å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»ºé¡¹ç›®ç»“æ„ã€ç»Ÿä¸€å›¢é˜Ÿè§„èŒƒã€æé«˜å¼€å‘æ•ˆç‡ã€‚</p><p>æœ¬æ–‡å°†å¸¦ä½ ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Node.js è„šæ‰‹æ¶ï¼Œæ¶µç›–å‘½ä»¤è¡Œè§£æã€ç”¨æˆ·äº¤äº’ã€æ¨¡æ¿ä¸‹è½½ã€æ–‡ä»¶æ“ä½œç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•å¼€å‘ä¸€ä¸ªç±»ä¼¼ Vue CLI çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¹¶èƒ½å°†å…¶å‘å¸ƒåˆ° npm ä¾›ä»–äººä½¿ç”¨ã€‚</p><p>è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p><span id="more"></span><h2 id="å¤„ç†ç”¨æˆ·å‘½ä»¤"><a href="#å¤„ç†ç”¨æˆ·å‘½ä»¤" class="headerlink" title="å¤„ç†ç”¨æˆ·å‘½ä»¤"></a>å¤„ç†ç”¨æˆ·å‘½ä»¤</h2><p>æˆ‘ä»¬æœŸæœ›èƒ½åƒ Vue CLI ä¸€æ ·ï¼Œç”¨ <code>vue create xxx</code> å‘½ä»¤å°±èƒ½åˆ›å»ºä¸€ä¸ª Vue é¡¹ç›®</p><p>ä¸ºäº†èƒ½å¤Ÿè§£æç”¨æˆ·å‘½ä»¤ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <a href="https://github.com/tj/commander.js">commander.js</a> åº“ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè·¯å¾„ä¸º <code>./bin/index.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /usr/bin/env node</span></span><br><span class="line"><span class="keyword">const</span> &#123; program &#125; = <span class="built_in">require</span>(<span class="string">&#x27;commander&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> create = <span class="built_in">require</span>(<span class="string">&#x27;../script/create.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line">program</span><br><span class="line">  .<span class="title function_">command</span>(<span class="string">&#x27;create &lt;name&gt;&#x27;</span>)</span><br><span class="line">  .<span class="title function_">description</span>(<span class="string">&#x27;åˆ›å»ºé¡¹ç›®&#x27;</span>)</span><br><span class="line">  .<span class="title function_">action</span>(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">create</span>(name);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">program.<span class="title function_">parse</span>();</span><br></pre></td></tr></table></figure><p>å¿…é¡»è¦åŠ ç¬¬ä¸€è¡Œ <code>#! /usr/bin/env node</code>ï¼Œå°†æ‰§è¡Œç¯å¢ƒè®¾ç½®ä¸º nodeï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š<a href="https://stackoverflow.com/questions/39585342/node-when-i-run-package-json-bin-command-give-me-syntax-error-near-unexp">ç›¸å…³ StackOverflow è®¨è®º</a></p><p>ç„¶ååœ¨ package.json ä¸­å¢åŠ å¦‚ä¸‹é…ç½®</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;bin&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;op&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./bin/index.js&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>æœ€åæ‰§è¡Œ <code>npm link</code>ï¼Œå°† bin ä¸­çš„ op å‘½ä»¤æ³¨å†Œæˆå…¨å±€å‘½ä»¤ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>op create</code> å‘½ä»¤å•¦</p><h2 id="æ”¯æŒæŸ¥çœ‹ç‰ˆæœ¬"><a href="#æ”¯æŒæŸ¥çœ‹ç‰ˆæœ¬" class="headerlink" title="æ”¯æŒæŸ¥çœ‹ç‰ˆæœ¬"></a>æ”¯æŒæŸ¥çœ‹ç‰ˆæœ¬</h2><p>è¯»å–æœ¬åœ° package.json ä¸­çš„ version å­—æ®µ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> packageJson = <span class="built_in">require</span>(<span class="string">&#x27;../package.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line">program.<span class="title function_">version</span>(packageJson.<span class="property">version</span>, <span class="string">&#x27;-v, --version&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="äº¤äº’å¼å‘½ä»¤è¡Œï¼ˆinquirerï¼‰"><a href="#äº¤äº’å¼å‘½ä»¤è¡Œï¼ˆinquirerï¼‰" class="headerlink" title="äº¤äº’å¼å‘½ä»¤è¡Œï¼ˆinquirerï¼‰"></a>äº¤äº’å¼å‘½ä»¤è¡Œï¼ˆinquirerï¼‰</h2><p>å¦‚æœä¸æ»¡è¶³äº commander.js åœ¨ä¸€è¡Œå†…æ‹¼æ¥å¤§é‡å‚æ•°çš„å½¢å¼ï¼ˆå¼€å‘è€…ä¹Ÿéš¾ä»¥è®°ä½å¤æ‚çš„å‚æ•°ç”¨æ³•ï¼‰ï¼Œå¯ä»¥ç”¨ <a href="https://github.com/SBoudrias/Inquirer.js">Inquirer.js</a> æ¥åšåˆ°äº¤äº’å¼çš„å‘½ä»¤è¡Œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">&#x27;inquirer&#x27;</span>);</span><br><span class="line"></span><br><span class="line">inquirer.<span class="title function_">prompt</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;vue&#x27;</span>,</span><br><span class="line">    <span class="comment">// å¤šé€‰äº¤äº’åŠŸèƒ½</span></span><br><span class="line">    <span class="comment">// å•é€‰å°†è¿™é‡Œä¿®æ”¹ä¸º list å³å¯</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;checkbox&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Check the features needed for your project:&#x27;</span>,</span><br><span class="line">    <span class="attr">choices</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Babel&#x27;</span>,</span><br><span class="line">        <span class="attr">checked</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;TypeScript&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Progressive Web App (PWA) Support&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Router&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>æ•ˆæœå±•ç¤ºï¼š</strong></p><p><img src="/2025/12/11/node.js/%E6%B5%85%E5%86%99%E4%B8%80%E4%B8%8B%E8%84%9A%E6%89%8B%E6%9E%B6/inquirer-demo.png" alt="äº¤äº’å¼å‘½ä»¤è¡Œæ•ˆæœ"></p><h2 id="å‘½ä»¤è¡Œ-loading-æ•ˆæœï¼ˆoraï¼‰"><a href="#å‘½ä»¤è¡Œ-loading-æ•ˆæœï¼ˆoraï¼‰" class="headerlink" title="å‘½ä»¤è¡Œ loading æ•ˆæœï¼ˆoraï¼‰"></a>å‘½ä»¤è¡Œ loading æ•ˆæœï¼ˆoraï¼‰</h2><p>åœ¨è„šæ‰‹æ¶æ‰§è¡Œè€—æ—¶æ“ä½œï¼ˆå¦‚ä¸‹è½½æ¨¡æ¿ã€å®‰è£…ä¾èµ–ï¼‰æ—¶ï¼Œä¸ºäº†æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬éœ€è¦æ˜¾ç¤ºä¸€ä¸ª loading åŠ¨ç”»ï¼Œè®©ç”¨æˆ·çŸ¥é“ç¨‹åºæ­£åœ¨è¿è¡Œä¸­ã€‚<a href="https://github.com/sindresorhus/ora">ora</a> å°±æ˜¯ä¸“é—¨ç”¨æ¥å®ç°è¿™ä¸ªåŠŸèƒ½çš„åº“ã€‚</p><p>å®‰è£… oraï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install ora</span><br></pre></td></tr></table></figure><p>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ora = <span class="built_in">require</span>(<span class="string">&#x27;ora&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> download = <span class="built_in">require</span>(<span class="string">&#x27;download-git-repo&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">downloadTemplate</span>(<span class="params">repo, dest</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> spinner = <span class="title function_">ora</span>(<span class="string">&#x27;æ­£åœ¨ä¸‹è½½é¡¹ç›®æ¨¡æ¿...&#x27;</span>).<span class="title function_">start</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">download</span>(repo, dest, &#123; <span class="attr">clone</span>: <span class="literal">false</span> &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        spinner.<span class="title function_">fail</span>(<span class="string">&#x27;æ¨¡æ¿ä¸‹è½½å¤±è´¥&#x27;</span>);  <span class="comment">// å¤±è´¥çŠ¶æ€ï¼ˆçº¢è‰² âœ–ï¼‰</span></span><br><span class="line">        <span class="title function_">reject</span>(err);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        spinner.<span class="title function_">succeed</span>(<span class="string">&#x27;æ¨¡æ¿ä¸‹è½½æˆåŠŸ&#x27;</span>);  <span class="comment">// æˆåŠŸçŠ¶æ€ï¼ˆç»¿è‰² âœ”ï¼‰</span></span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ora è¿˜æ”¯æŒå…¶ä»–çŠ¶æ€ï¼š<code>warn()</code> è­¦å‘Šï¼ˆé»„è‰² âš ï¼‰ã€<code>info()</code> ä¿¡æ¯ï¼ˆè“è‰² â„¹ï¼‰</p><p><strong>æ•ˆæœå±•ç¤ºï¼š</strong></p><p><img src="/2025/12/11/node.js/%E6%B5%85%E5%86%99%E4%B8%80%E4%B8%8B%E8%84%9A%E6%89%8B%E6%9E%B6/ora-demo.png" alt="loading æ•ˆæœ"></p><h2 id="æ‰§è¡Œå‘½ä»¤"><a href="#æ‰§è¡Œå‘½ä»¤" class="headerlink" title="æ‰§è¡Œå‘½ä»¤"></a>æ‰§è¡Œå‘½ä»¤</h2><p>åœ¨è„šæ‰‹æ¶ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æ‰§è¡Œä¸€äº› shell å‘½ä»¤ï¼Œæ¯”å¦‚ <code>git clone</code> ä¸‹è½½æ¨¡æ¿ã€<code>npm install</code> å®‰è£…ä¾èµ–ç­‰ã€‚Node.js æä¾›äº† <code>child_process</code> æ¨¡å—æ¥æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ï¼Œä½†æˆ‘ä»¬æ›´æ¨èä½¿ç”¨ <a href="https://github.com/sindresorhus/execa">execa</a>ï¼Œå®ƒæ˜¯ <code>child_process</code> çš„å¢å¼ºç‰ˆæœ¬ï¼Œæä¾›äº†æ›´å¥½çš„ API å’Œé”™è¯¯å¤„ç†ã€‚</p><p>å®‰è£… execaï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install execa</span><br></pre></td></tr></table></figure><p>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> execa = <span class="built_in">require</span>(<span class="string">&#x27;execa&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ora = <span class="built_in">require</span>(<span class="string">&#x27;ora&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®‰è£…ä¾èµ–</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">installDependencies</span>(<span class="params">projectName</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> spinner = <span class="title function_">ora</span>(<span class="string">&#x27;æ­£åœ¨å®‰è£…ä¾èµ–...&#x27;</span>).<span class="title function_">start</span>();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">execa</span>(<span class="string">&#x27;npm&#x27;</span>, [<span class="string">&#x27;install&#x27;</span>], &#123; <span class="attr">cwd</span>: projectName &#125;);</span><br><span class="line">    spinner.<span class="title function_">succeed</span>(<span class="string">&#x27;ä¾èµ–å®‰è£…æˆåŠŸ&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    spinner.<span class="title function_">fail</span>(<span class="string">&#x27;ä¾èµ–å®‰è£…å¤±è´¥&#x27;</span>);</span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœä½¿ç”¨ CommonJS (<code>require</code>)ï¼Œéœ€è¦å®‰è£… execa v5 ç‰ˆæœ¬ï¼š<code>npm install execa@5</code>ã€‚execa v6+ ä»…æ”¯æŒ ESM æ¨¡å—ã€‚</p><h3 id="execa-ä¸å…¶ä»–å·¥å…·å¯¹æ¯”"><a href="#execa-ä¸å…¶ä»–å·¥å…·å¯¹æ¯”" class="headerlink" title="execa ä¸å…¶ä»–å·¥å…·å¯¹æ¯”"></a>execa ä¸å…¶ä»–å·¥å…·å¯¹æ¯”</h3><table><thead><tr><th>ç‰¹æ€§</th><th>child_process</th><th>shelljs</th><th>execa</th></tr></thead><tbody><tr><td><strong>API é£æ ¼</strong></td><td>å›è°ƒ&#x2F;äº‹ä»¶</td><td>åŒæ­¥</td><td>Promise&#x2F;Async</td></tr><tr><td><strong>é”™è¯¯å¤„ç†</strong></td><td>éœ€æ‰‹åŠ¨å¤„ç†</td><td>ç®€å•</td><td>å®Œå–„ï¼ŒåŒ…å« stdout&#x2F;stderr</td></tr><tr><td><strong>è·¨å¹³å°æ”¯æŒ</strong></td><td>éœ€æ‰‹åŠ¨å¤„ç†</td><td>è‰¯å¥½</td><td>ä¼˜ç§€</td></tr><tr><td><strong>è¾“å‡ºå¤„ç†</strong></td><td>éœ€æ‰‹åŠ¨æ‹¼æ¥</td><td>ç›´æ¥è¿”å›</td><td>è‡ªåŠ¨æ¸…ç†å’Œæ ¼å¼åŒ–</td></tr><tr><td><strong>è¶…æ—¶æ§åˆ¶</strong></td><td>éœ€æ‰‹åŠ¨å®ç°</td><td>ä¸æ”¯æŒ</td><td>åŸç”Ÿæ”¯æŒ</td></tr><tr><td><strong>å­¦ä¹ æ›²çº¿</strong></td><td>é™¡å³­</td><td>å¹³ç¼“</td><td>å¹³ç¼“</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>é«˜</td><td>ä¸­ç­‰</td><td>é«˜</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å¤æ‚åœºæ™¯</td><td>ç®€å•è„šæœ¬</td><td>ç°ä»£ Node.js é¡¹ç›®</td></tr></tbody></table><p>æ¨èä½¿ç”¨ execa çš„ç†ç”±ï¼š</p><ul><li>ç°ä»£åŒ–çš„ Promise APIï¼Œé…åˆ async&#x2F;await ä½¿ç”¨æ›´ä¼˜é›…</li><li>æ›´å¥½çš„é”™è¯¯ä¿¡æ¯ï¼ŒåŒ…å«å®Œæ•´çš„å‘½ä»¤ã€é€€å‡ºç å’Œè¾“å‡º</li><li>å¼€ç®±å³ç”¨çš„è·¨å¹³å°æ”¯æŒï¼Œæ— éœ€æ‹…å¿ƒ Windows å…¼å®¹æ€§</li><li>æ´»è·ƒç»´æŠ¤ï¼Œç¤¾åŒºæ”¯æŒè‰¯å¥½</li></ul><h2 id="äº”é¢œå…­è‰²çš„å‘½ä»¤è¡Œ"><a href="#äº”é¢œå…­è‰²çš„å‘½ä»¤è¡Œ" class="headerlink" title="äº”é¢œå…­è‰²çš„å‘½ä»¤è¡Œ"></a>äº”é¢œå…­è‰²çš„å‘½ä»¤è¡Œ</h2><p>ä¸ºäº†è®©å‘½ä»¤è¡Œè¾“å‡ºæ›´åŠ ç›´è§‚å’Œç¾è§‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://github.com/chalk/chalk">chalk</a> åº“ä¸ºæ–‡æœ¬æ·»åŠ é¢œè‰²å’Œæ ·å¼ã€‚ä¸åŒçš„é¢œè‰²å¯ä»¥è¡¨ç¤ºä¸åŒçš„çŠ¶æ€ï¼šæˆåŠŸç”¨ç»¿è‰²ã€å¤±è´¥ç”¨çº¢è‰²ã€è­¦å‘Šç”¨é»„è‰²ç­‰ã€‚</p><p>å®‰è£… chalkï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install chalk</span><br></pre></td></tr></table></figure><p>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸åŒçŠ¶æ€çš„è¾“å‡º</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">green</span>(<span class="string">&#x27;âœ” æ“ä½œæˆåŠŸ&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">red</span>(<span class="string">&#x27;âœ– æ“ä½œå¤±è´¥&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">yellow</span>(<span class="string">&#x27;âš  è­¦å‘Šä¿¡æ¯&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">blue</span>(<span class="string">&#x27;â„¹ æç¤ºä¿¡æ¯&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»„åˆæ ·å¼</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="property">bold</span>.<span class="title function_">blue</span>(<span class="string">&#x27;ğŸš€ å¼€å§‹åˆ›å»ºé¡¹ç›®&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="property">bold</span>.<span class="title function_">green</span>(<span class="string">&#x27;âœ¨ é¡¹ç›®åˆ›å»ºæˆåŠŸï¼&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// èƒŒæ™¯è‰²</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="property">bgGreen</span>.<span class="title function_">black</span>(<span class="string">&#x27; SUCCESS &#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="property">bgRed</span>.<span class="title function_">white</span>(<span class="string">&#x27; ERROR &#x27;</span>));</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨é¢œè‰²ï¼š<code>green</code> æˆåŠŸã€<code>red</code> å¤±è´¥ã€<code>yellow</code> è­¦å‘Šã€<code>blue</code> æç¤ºã€<code>gray</code> æ¬¡è¦ä¿¡æ¯ã€‚å¯ä»¥ç»„åˆä½¿ç”¨ï¼š<code>chalk.bold.green()</code> åŠ ç²—ç»¿è‰²ã€<code>chalk.bgGreen.black()</code> ç»¿è‰²èƒŒæ™¯é»‘è‰²æ–‡å­—ã€‚</p><p><strong>æ•ˆæœå±•ç¤ºï¼š</strong></p><p><img src="/2025/12/11/node.js/%E6%B5%85%E5%86%99%E4%B8%80%E4%B8%8B%E8%84%9A%E6%89%8B%E6%9E%B6/chalk-demo.png" alt="å½©è‰²å‘½ä»¤è¡Œæ•ˆæœ"></p><h2 id="ä¸‹è½½æ¨¡æ¿"><a href="#ä¸‹è½½æ¨¡æ¿" class="headerlink" title="ä¸‹è½½æ¨¡æ¿"></a>ä¸‹è½½æ¨¡æ¿</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»æŒæ¡äº†å‘½ä»¤è¡Œçš„åŸºç¡€èƒ½åŠ›ï¼Œæ¥ä¸‹æ¥å®ç°è„šæ‰‹æ¶çš„æ ¸å¿ƒåŠŸèƒ½ â€”â€” ä» Git ä»“åº“ä¸‹è½½é¡¹ç›®æ¨¡æ¿ã€‚<a href="https://github.com/flipxfx/download-git-repo">download-git-repo</a> æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºä¸‹è½½ Git ä»“åº“çš„åº“ã€‚</p><p>å®‰è£…ä¾èµ–ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install download-git-repo</span><br></pre></td></tr></table></figure><p>å®é™…åº”ç”¨ç¤ºä¾‹ï¼ˆè®©ç”¨æˆ·é€‰æ‹©æ¨¡æ¿ï¼‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">&#x27;inquirer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> download = <span class="built_in">require</span>(<span class="string">&#x27;download-git-repo&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ora = <span class="built_in">require</span>(<span class="string">&#x27;ora&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ¿åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">const</span> templates = &#123;</span><br><span class="line">  <span class="string">&#x27;Vue 3&#x27;</span>: <span class="string">&#x27;github:vuejs/create-vue&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;React&#x27;</span>: <span class="string">&#x27;github:facebook/create-react-app&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Vue 2&#x27;</span>: <span class="string">&#x27;github:vuejs/vue&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">projectName</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. è®©ç”¨æˆ·é€‰æ‹©æ¨¡æ¿</span></span><br><span class="line">  <span class="keyword">const</span> &#123; template &#125; = <span class="keyword">await</span> inquirer.<span class="title function_">prompt</span>([</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;template&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;è¯·é€‰æ‹©é¡¹ç›®æ¨¡æ¿:&#x27;</span>,</span><br><span class="line">      <span class="attr">choices</span>: [<span class="string">&#x27;Vue 3&#x27;</span>, <span class="string">&#x27;React&#x27;</span>, <span class="string">&#x27;Vue 2&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. ä¸‹è½½æ¨¡æ¿</span></span><br><span class="line">  <span class="keyword">const</span> spinner = <span class="title function_">ora</span>(<span class="string">&#x27;æ­£åœ¨ä¸‹è½½æ¨¡æ¿...&#x27;</span>).<span class="title function_">start</span>();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">download</span>(templates[template], projectName, &#123; <span class="attr">clone</span>: <span class="literal">false</span> &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="title function_">reject</span>(err);</span><br><span class="line">        <span class="keyword">else</span> <span class="title function_">resolve</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    spinner.<span class="title function_">succeed</span>(chalk.<span class="title function_">green</span>(<span class="string">&#x27;æ¨¡æ¿ä¸‹è½½æˆåŠŸ&#x27;</span>));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    spinner.<span class="title function_">fail</span>(chalk.<span class="title function_">red</span>(<span class="string">&#x27;æ¨¡æ¿ä¸‹è½½å¤±è´¥&#x27;</span>));</span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ”¯æŒçš„ Git å¹³å°æ ¼å¼ï¼š</strong></p><ul><li>GitHub: <code>github:user/repo</code></li><li>GitLab: <code>gitlab:user/repo</code></li><li>Gitee: <code>gitee:user/repo</code></li><li>æŒ‡å®šåˆ†æ”¯: <code>github:user/repo#branch-name</code></li></ul><h2 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h2><p>ä¸‹è½½å®Œæ¨¡æ¿åï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å¯¹æ–‡ä»¶è¿›è¡Œä¸€äº›æ“ä½œï¼šå¤åˆ¶æ–‡ä»¶ã€åˆ é™¤æ–‡ä»¶ã€åˆ›å»ºç›®å½•ç­‰ã€‚Node.js åŸç”Ÿçš„ <code>fs</code> æ¨¡å—è™½ç„¶åŠŸèƒ½å¼ºå¤§ï¼Œä½† API æ¯”è¾ƒåŸå§‹ã€‚<a href="https://github.com/jprichardson/node-fs-extra">fs-extra</a> æ˜¯ <code>fs</code> çš„å¢å¼ºç‰ˆæœ¬ï¼Œæä¾›äº†æ›´å¤šå®ç”¨çš„æ–¹æ³•ã€‚</p><p>å®‰è£… fs-extraï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install fs-extra</span><br></pre></td></tr></table></figure><p><strong>å¸¸ç”¨ APIï¼š</strong></p><ul><li><code>fs.copy(src, dest)</code> - å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•</li><li><code>fs.remove(path)</code> - åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•</li><li><code>fs.ensureDir(path)</code> - ç¡®ä¿ç›®å½•å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º</li><li><code>fs.readJson(file)</code> &#x2F; <code>fs.writeJson(file, obj)</code> - è¯»å†™ JSON æ–‡ä»¶</li><li><code>fs.pathExists(path)</code> - æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨</li></ul><p>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs-extra&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">setupProject</span>(<span class="params">projectName</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. æ‰¹é‡åˆ›å»ºç›®å½•ç»“æ„</span></span><br><span class="line">  <span class="keyword">const</span> dirs = [<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;src/components&#x27;</span>, <span class="string">&#x27;src/utils&#x27;</span>, <span class="string">&#x27;public&#x27;</span>, <span class="string">&#x27;tests&#x27;</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> dir <span class="keyword">of</span> dirs) &#123;</span><br><span class="line">    <span class="keyword">await</span> fs.<span class="title function_">ensureDir</span>(path.<span class="title function_">join</span>(projectName, dir));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. åˆ é™¤æ¨¡æ¿ä¸­çš„ .git ç›®å½•</span></span><br><span class="line">  <span class="keyword">const</span> gitDir = path.<span class="title function_">join</span>(projectName, <span class="string">&#x27;.git&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">await</span> fs.<span class="title function_">pathExists</span>(gitDir)) &#123;</span><br><span class="line">    <span class="keyword">await</span> fs.<span class="title function_">remove</span>(gitDir);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. å¤åˆ¶é…ç½®æ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">await</span> fs.<span class="title function_">copy</span>(<span class="string">&#x27;template/config&#x27;</span>, path.<span class="title function_">join</span>(projectName, <span class="string">&#x27;config&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">green</span>(<span class="string">&#x27;âœ” é¡¹ç›®ç»“æ„åˆ›å»ºå®Œæˆ&#x27;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶"><a href="#åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶" class="headerlink" title="åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶"></a>åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶</h2><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦æ ¹æ®ç”¨æˆ·çš„é€‰æ‹©åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ <code>package.json</code>ã€<code>.eslintrc</code> ç­‰ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“æ¥å®ç°ã€‚<a href="https://github.com/mde/ejs">ejs</a> æ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨çš„æ¨¡æ¿å¼•æ“ã€‚</p><p>å®‰è£… ejsï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install ejs</span><br></pre></td></tr></table></figure><p>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</p><p><strong>1. åˆ›å»ºæ¨¡æ¿æ–‡ä»¶ <code>package.json.ejs</code>ï¼š</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;%= projectName %&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;%= description %&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;%= author %&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.3.0&quot;</span></span><br><span class="line">    &lt;% if (useRouter) <span class="punctuation">&#123;</span> %&gt;<span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vue-router&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.2.0&quot;</span></span><br><span class="line">    &lt;% <span class="punctuation">&#125;</span> %&gt;</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>2. ä½¿ç”¨ ejs æ¸²æŸ“æ¨¡æ¿ï¼š</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">&#x27;inquirer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs-extra&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">projectName</span>) &#123;</span><br><span class="line">  <span class="comment">// æ”¶é›†ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">const</span> answers = <span class="keyword">await</span> inquirer.<span class="title function_">prompt</span>([</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;description&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;è¯·è¾“å…¥é¡¹ç›®æè¿°:&#x27;</span>, <span class="attr">default</span>: <span class="string">&#x27;A new project&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;author&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;è¯·è¾“å…¥ä½œè€…åç§°:&#x27;</span>, <span class="attr">default</span>: <span class="string">&#x27;Your Name&#x27;</span> &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;features&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;checkbox&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;è¯·é€‰æ‹©é¡¹ç›®ç‰¹æ€§:&#x27;</span>,</span><br><span class="line">      <span class="attr">choices</span>: [</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&#x27;TypeScript&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;typescript&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&#x27;Vue Router&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;router&#x27;</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç”Ÿæˆ package.json</span></span><br><span class="line">  <span class="keyword">const</span> template = <span class="keyword">await</span> fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./templates/package.json.ejs&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> content = ejs.<span class="title function_">render</span>(template, &#123;</span><br><span class="line">    projectName,</span><br><span class="line">    <span class="attr">description</span>: answers.<span class="property">description</span>,</span><br><span class="line">    <span class="attr">author</span>: answers.<span class="property">author</span>,</span><br><span class="line">    <span class="attr">useRouter</span>: answers.<span class="property">features</span>.<span class="title function_">includes</span>(<span class="string">&#x27;router&#x27;</span>)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> fs.<span class="title function_">writeFile</span>(path.<span class="title function_">join</span>(projectName, <span class="string">&#x27;package.json&#x27;</span>), content);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">green</span>(<span class="string">&#x27;âœ” é…ç½®æ–‡ä»¶ç”ŸæˆæˆåŠŸ&#x27;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è‡ªåŠ¨å®‰è£…ä¾èµ–"><a href="#è‡ªåŠ¨å®‰è£…ä¾èµ–" class="headerlink" title="è‡ªåŠ¨å®‰è£…ä¾èµ–"></a>è‡ªåŠ¨å®‰è£…ä¾èµ–</h2><p>é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œè‡ªåŠ¨å®‰è£…ä¾èµ–å¯ä»¥å¤§å¤§æå‡ç”¨æˆ·ä½“éªŒã€‚æˆ‘ä»¬éœ€è¦æ£€æµ‹ç”¨æˆ·ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨ï¼ˆnpm&#x2F;yarn&#x2F;pnpmï¼‰ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å®‰è£…å‘½ä»¤ã€‚</p><p>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">&#x27;inquirer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> execa = <span class="built_in">require</span>(<span class="string">&#x27;execa&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ora = <span class="built_in">require</span>(<span class="string">&#x27;ora&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> download = <span class="built_in">require</span>(<span class="string">&#x27;download-git-repo&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ¿æ˜ å°„</span></span><br><span class="line"><span class="keyword">const</span> templates = &#123;</span><br><span class="line">  <span class="string">&#x27;Vue 3&#x27;</span>: <span class="string">&#x27;github:vuejs/create-vue&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;React&#x27;</span>: <span class="string">&#x27;github:facebook/create-react-app&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Vue 2&#x27;</span>: <span class="string">&#x27;github:vuejs/vue&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹è½½æ¨¡æ¿å‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">downloadTemplate</span>(<span class="params">template, projectName</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">download</span>(templates[template], projectName, &#123; <span class="attr">clone</span>: <span class="literal">false</span> &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="title function_">reject</span>(err);</span><br><span class="line">      <span class="keyword">else</span> <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æµ‹åŒ…ç®¡ç†å™¨</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getPackageManager</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">execa</span>(<span class="string">&#x27;pnpm&#x27;</span>, [<span class="string">&#x27;--version&#x27;</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;pnpm&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">execa</span>(<span class="string">&#x27;yarn&#x27;</span>, [<span class="string">&#x27;--version&#x27;</span>]);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;yarn&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;npm&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®Œæ•´çš„åˆ›å»ºæµç¨‹</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">projectName</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="property">bold</span>.<span class="title function_">blue</span>(<span class="string">`\nğŸš€ å¼€å§‹åˆ›å»ºé¡¹ç›®: <span class="subst">$&#123;projectName&#125;</span>\n`</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 1. ç”¨æˆ·é€‰æ‹©</span></span><br><span class="line">    <span class="keyword">const</span> answers = <span class="keyword">await</span> inquirer.<span class="title function_">prompt</span>([</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;template&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;è¯·é€‰æ‹©é¡¹ç›®æ¨¡æ¿:&#x27;</span>,</span><br><span class="line">        <span class="attr">choices</span>: [<span class="string">&#x27;Vue 3&#x27;</span>, <span class="string">&#x27;React&#x27;</span>, <span class="string">&#x27;Vue 2&#x27;</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;installDeps&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;confirm&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;æ˜¯å¦è‡ªåŠ¨å®‰è£…ä¾èµ–?&#x27;</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ä¸‹è½½æ¨¡æ¿</span></span><br><span class="line">    <span class="keyword">const</span> spinner = <span class="title function_">ora</span>(<span class="string">&#x27;æ­£åœ¨ä¸‹è½½æ¨¡æ¿...&#x27;</span>).<span class="title function_">start</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">downloadTemplate</span>(answers.<span class="property">template</span>, projectName);</span><br><span class="line">    spinner.<span class="title function_">succeed</span>(chalk.<span class="title function_">green</span>(<span class="string">&#x27;æ¨¡æ¿ä¸‹è½½æˆåŠŸ&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœç”¨æˆ·é€‰æ‹©ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (answers.<span class="property">installDeps</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> pm = <span class="keyword">await</span> <span class="title function_">getPackageManager</span>();</span><br><span class="line">      <span class="keyword">const</span> installSpinner = <span class="title function_">ora</span>(<span class="string">&#x27;æ­£åœ¨å®‰è£…ä¾èµ–...&#x27;</span>).<span class="title function_">start</span>();</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">execa</span>(pm, [<span class="string">&#x27;install&#x27;</span>], &#123; <span class="attr">cwd</span>: projectName, <span class="attr">stdio</span>: <span class="string">&#x27;inherit&#x27;</span> &#125;);</span><br><span class="line">        installSpinner.<span class="title function_">succeed</span>(chalk.<span class="title function_">green</span>(<span class="string">&#x27;ä¾èµ–å®‰è£…æˆåŠŸ&#x27;</span>));</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        installSpinner.<span class="title function_">fail</span>(chalk.<span class="title function_">red</span>(<span class="string">&#x27;ä¾èµ–å®‰è£…å¤±è´¥&#x27;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. å®Œæˆæç¤º</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="property">bold</span>.<span class="title function_">green</span>(<span class="string">`\nâœ¨ é¡¹ç›® <span class="subst">$&#123;projectName&#125;</span> åˆ›å»ºæˆåŠŸï¼\n`</span>));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">cyan</span>(<span class="string">&#x27;å¼€å§‹å¼€å‘:&#x27;</span>));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">gray</span>(<span class="string">`  cd <span class="subst">$&#123;projectName&#125;</span>`</span>));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">gray</span>(<span class="string">`  npm run dev\n`</span>));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">red</span>(<span class="string">`\nåˆ›å»ºå¤±è´¥: <span class="subst">$&#123;error.message&#125;</span>\n`</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®Œæ•´æµç¨‹æ•ˆæœå±•ç¤ºï¼š</strong></p><p><img src="/2025/12/11/node.js/%E6%B5%85%E5%86%99%E4%B8%80%E4%B8%8B%E8%84%9A%E6%89%8B%E6%9E%B6/complete-flow-demo.png" alt="è„šæ‰‹æ¶å®Œæ•´åˆ›å»ºæµç¨‹"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬ä»é›¶å¼€å§‹å®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Node.js è„šæ‰‹æ¶å·¥å…·ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æ¶‰åŠçš„æ ¸å¿ƒæŠ€æœ¯æ ˆï¼š</p><p><strong>æ ¸å¿ƒä¾èµ–åº“ï¼š</strong></p><ul><li><strong>commander.js</strong> - å‘½ä»¤è¡Œå‚æ•°è§£æ</li><li><strong>inquirer.js</strong> - äº¤äº’å¼å‘½ä»¤è¡Œ</li><li><strong>ora</strong> - å‘½ä»¤è¡Œ loading æ•ˆæœ</li><li><strong>chalk</strong> - å‘½ä»¤è¡Œæ–‡å­—é¢œè‰²</li><li><strong>execa</strong> - æ‰§è¡Œ shell å‘½ä»¤</li><li><strong>download-git-repo</strong> - ä¸‹è½½ Git ä»“åº“</li><li><strong>fs-extra</strong> - å¢å¼ºçš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œ</li><li><strong>ejs</strong> - æ¨¡æ¿å¼•æ“</li></ul><p><strong>é‡è¦æç¤º</strong>ï¼šæœ¬æ–‡æ‰€æœ‰ç¤ºä¾‹ä½¿ç”¨ CommonJS æ¨¡å—ç³»ç»Ÿï¼ˆ<code>require</code>&#x2F;<code>module.exports</code>ï¼‰ã€‚éƒ¨åˆ†åº“çš„è¾ƒæ–°ç‰ˆæœ¬ï¼ˆv6+ï¼‰ä»…æ”¯æŒ ESMï¼Œå¦‚éœ€ä½¿ç”¨è¯·å®‰è£…æŒ‡å®šç‰ˆæœ¬æˆ–æ”¹ç”¨ ESM æ¨¡å—ç³»ç»Ÿã€‚</p><p><strong>å®Œæ•´å¼€å‘æµç¨‹ï¼š</strong></p><ol><li>ä½¿ç”¨ commander å¤„ç†ç”¨æˆ·å‘½ä»¤</li><li>ä½¿ç”¨ inquirer å®ç°äº¤äº’å¼é€‰é¡¹</li><li>ä½¿ç”¨ ora å’Œ chalk ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</li><li>ä½¿ç”¨ download-git-repo ä¸‹è½½é¡¹ç›®æ¨¡æ¿</li><li>ä½¿ç”¨ fs-extra è¿›è¡Œæ–‡ä»¶æ“ä½œ</li><li>ä½¿ç”¨ ejs åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶</li><li>ä½¿ç”¨ execa è‡ªåŠ¨å®‰è£…ä¾èµ–</li><li>å‘å¸ƒåˆ° npm ä¾›ä»–äººä½¿ç”¨</li></ol><p><strong>è¿›é˜¶æ–¹å‘ï¼š</strong></p><ul><li><strong>æ’ä»¶ç³»ç»Ÿ</strong> - æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶æ‰©å±•åŠŸèƒ½</li><li><strong>é…ç½®æ–‡ä»¶</strong> - æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶è‡ªå®šä¹‰è„šæ‰‹æ¶è¡Œä¸º</li><li><strong>æ›´æ–°æ£€æŸ¥</strong> - æ£€æµ‹è„šæ‰‹æ¶æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬</li><li><strong>æ¨¡æ¿ç®¡ç†</strong> - æ”¯æŒæ·»åŠ ã€åˆ é™¤ã€åˆ‡æ¢å¤šä¸ªæ¨¡æ¿</li><li><strong>å•å…ƒæµ‹è¯•</strong> - ä½¿ç”¨ Jest ç­‰å·¥å…·ç¼–å†™æµ‹è¯•ç”¨ä¾‹</li><li><strong>CI&#x2F;CD</strong> - é…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•å’Œå‘å¸ƒæµç¨‹</li></ul><p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ ç†è§£è„šæ‰‹æ¶çš„å®ç°åŸç†ï¼Œå¹¶åŠ¨æ‰‹å¼€å‘å‡ºå±äºè‡ªå·±çš„å‘½ä»¤è¡Œå·¥å…·ï¼</p><h2 id="å¸¸è§é—®é¢˜è§£ç­”"><a href="#å¸¸è§é—®é¢˜è§£ç­”" class="headerlink" title="å¸¸è§é—®é¢˜è§£ç­”"></a>å¸¸è§é—®é¢˜è§£ç­”</h2><h3 id="1-ä¸ºä»€ä¹ˆè¿è¡Œ-npm-link-åå‘½ä»¤æ‰¾ä¸åˆ°ï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆè¿è¡Œ-npm-link-åå‘½ä»¤æ‰¾ä¸åˆ°ï¼Ÿ" class="headerlink" title="1. ä¸ºä»€ä¹ˆè¿è¡Œ npm link åå‘½ä»¤æ‰¾ä¸åˆ°ï¼Ÿ"></a>1. ä¸ºä»€ä¹ˆè¿è¡Œ <code>npm link</code> åå‘½ä»¤æ‰¾ä¸åˆ°ï¼Ÿ</h3><p><strong>é—®é¢˜</strong>ï¼šæ‰§è¡Œ <code>npm link</code> åï¼Œåœ¨ç»ˆç«¯è¾“å…¥å‘½ä»¤æç¤º â€œcommand not foundâ€ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>æ£€æŸ¥ <code>package.json</code> ä¸­ <code>bin</code> å­—æ®µé…ç½®æ˜¯å¦æ­£ç¡®</li><li>ç¡®è®¤ <code>bin</code> æŒ‡å‘çš„æ–‡ä»¶ç¬¬ä¸€è¡Œæœ‰ <code>#! /usr/bin/env node</code></li><li>Windows ç”¨æˆ·å¯èƒ½éœ€è¦ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ <code>npm link</code></li><li>å°è¯•é‡æ–°æ‰“å¼€ç»ˆç«¯æˆ–æ‰§è¡Œ <code>npm unlink</code> åå†æ¬¡ <code>npm link</code></li></ul><h3 id="2-ä½¿ç”¨-require-execa-æŠ¥é”™æ€ä¹ˆåŠï¼Ÿ"><a href="#2-ä½¿ç”¨-require-execa-æŠ¥é”™æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="2. ä½¿ç”¨ require(&#39;execa&#39;) æŠ¥é”™æ€ä¹ˆåŠï¼Ÿ"></a>2. ä½¿ç”¨ <code>require(&#39;execa&#39;)</code> æŠ¥é”™æ€ä¹ˆåŠï¼Ÿ</h3><p><strong>é—®é¢˜</strong>ï¼šæç¤º â€œCannot find module â€˜execaâ€™â€ æˆ– â€œrequire() of ES Module not supportedâ€ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ¡ˆ1ï¼šå®‰è£…æ”¯æŒ CommonJS çš„ç‰ˆæœ¬</span></span><br><span class="line">npm install execa@5</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ¡ˆ2ï¼šæ”¹ç”¨ ESM æ¨¡å—ç³»ç»Ÿ</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹ package.json æ·»åŠ  &quot;type&quot;: &quot;module&quot;</span></span><br><span class="line"><span class="comment"># å°†æ‰€æœ‰ require æ”¹ä¸º import</span></span><br></pre></td></tr></table></figure><h3 id="3-ä¸‹è½½æ¨¡æ¿æ—¶ä¸€ç›´å¡ä½æˆ–å¤±è´¥ï¼Ÿ"><a href="#3-ä¸‹è½½æ¨¡æ¿æ—¶ä¸€ç›´å¡ä½æˆ–å¤±è´¥ï¼Ÿ" class="headerlink" title="3. ä¸‹è½½æ¨¡æ¿æ—¶ä¸€ç›´å¡ä½æˆ–å¤±è´¥ï¼Ÿ"></a>3. ä¸‹è½½æ¨¡æ¿æ—¶ä¸€ç›´å¡ä½æˆ–å¤±è´¥ï¼Ÿ</h3><p><strong>é—®é¢˜</strong>ï¼šæ‰§è¡Œ <code>download-git-repo</code> ä¸‹è½½æ¨¡æ¿æ—¶é•¿æ—¶é—´æ— å“åº”æˆ–æŠ¥ç½‘ç»œé”™è¯¯ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼ŒGitHub è®¿é—®å¯èƒ½éœ€è¦ä»£ç†</li><li>ä½¿ç”¨å›½å†…é•œåƒæˆ– Gitee ä»“åº“ï¼š<code>gitee:user/repo</code></li><li>æ·»åŠ è¶…æ—¶å¤„ç†å’Œé‡è¯•æœºåˆ¶</li><li>è€ƒè™‘ä½¿ç”¨ <code>degit</code> æ›¿ä»£ <code>download-git-repo</code></li></ul><h3 id="4-Windows-ä¸‹è·¯å¾„åˆ†éš”ç¬¦é—®é¢˜ï¼Ÿ"><a href="#4-Windows-ä¸‹è·¯å¾„åˆ†éš”ç¬¦é—®é¢˜ï¼Ÿ" class="headerlink" title="4. Windows ä¸‹è·¯å¾„åˆ†éš”ç¬¦é—®é¢˜ï¼Ÿ"></a>4. Windows ä¸‹è·¯å¾„åˆ†éš”ç¬¦é—®é¢˜ï¼Ÿ</h3><p><strong>é—®é¢˜</strong>ï¼šåœ¨ Windows ç³»ç»Ÿä¸‹è·¯å¾„ä½¿ç”¨ <code>/</code> å¯¼è‡´é”™è¯¯ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ path.join è‡ªåŠ¨å¤„ç†ä¸åŒç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦</span></span><br><span class="line"><span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(projectName, <span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;index.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¿å…ç¡¬ç¼–ç è·¯å¾„åˆ†éš”ç¬¦</span></span><br><span class="line"><span class="comment">// âŒ const filePath = projectName + &#x27;/src/index.js&#x27;;</span></span><br><span class="line"><span class="comment">// âœ” const filePath = path.join(projectName, &#x27;src&#x27;, &#x27;index.js&#x27;);</span></span><br></pre></td></tr></table></figure><h3 id="5-å¦‚ä½•è°ƒè¯•è„šæ‰‹æ¶ä»£ç ï¼Ÿ"><a href="#5-å¦‚ä½•è°ƒè¯•è„šæ‰‹æ¶ä»£ç ï¼Ÿ" class="headerlink" title="5. å¦‚ä½•è°ƒè¯•è„šæ‰‹æ¶ä»£ç ï¼Ÿ"></a>5. å¦‚ä½•è°ƒè¯•è„šæ‰‹æ¶ä»£ç ï¼Ÿ</h3><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ³•1ï¼šä½¿ç”¨ npm link åç›´æ¥è°ƒè¯•</span></span><br><span class="line">npm <span class="built_in">link</span></span><br><span class="line">your-cli create test-project</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•2ï¼šç›´æ¥è¿è¡Œ bin æ–‡ä»¶</span></span><br><span class="line">node ./bin/index.js create test-project</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•3ï¼šä½¿ç”¨ VS Code è°ƒè¯•</span></span><br><span class="line"><span class="comment"># åœ¨ .vscode/launch.json ä¸­é…ç½®</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">  <span class="string">&quot;request&quot;</span>: <span class="string">&quot;launch&quot;</span>,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Debug CLI&quot;</span>,</span><br><span class="line">  <span class="string">&quot;program&quot;</span>: <span class="string">&quot;<span class="variable">$&#123;workspaceFolder&#125;</span>/bin/index.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;args&quot;</span>: [<span class="string">&quot;create&quot;</span>, <span class="string">&quot;test-project&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-è„šæ‰‹æ¶å¦‚ä½•æ”¯æŒ-TypeScriptï¼Ÿ"><a href="#6-è„šæ‰‹æ¶å¦‚ä½•æ”¯æŒ-TypeScriptï¼Ÿ" class="headerlink" title="6. è„šæ‰‹æ¶å¦‚ä½•æ”¯æŒ TypeScriptï¼Ÿ"></a>6. è„šæ‰‹æ¶å¦‚ä½•æ”¯æŒ TypeScriptï¼Ÿ</h3><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. å®‰è£… TypeScript å’Œç›¸å…³ä¾èµ–</span></span><br><span class="line">npm install -D typescript @types/node ts-node</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. é…ç½® tsconfig.json</span></span><br><span class="line"><span class="comment"># 3. ä¿®æ”¹ package.json çš„ bin å­—æ®µ</span></span><br><span class="line"><span class="string">&quot;bin&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;my-cli&quot;</span>: <span class="string">&quot;./bin/index.js&quot;</span>  <span class="comment"># ä»æŒ‡å‘ç¼–è¯‘åçš„ .js æ–‡ä»¶</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. æ·»åŠ æ„å»ºè„šæœ¬</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;tsc&quot;</span>,</span><br><span class="line">  <span class="string">&quot;prepublishOnly&quot;</span>: <span class="string">&quot;npm run build&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-å¦‚ä½•è®©è„šæ‰‹æ¶æ”¯æŒæ›´æ–°æç¤ºï¼Ÿ"><a href="#7-å¦‚ä½•è®©è„šæ‰‹æ¶æ”¯æŒæ›´æ–°æç¤ºï¼Ÿ" class="headerlink" title="7. å¦‚ä½•è®©è„šæ‰‹æ¶æ”¯æŒæ›´æ–°æç¤ºï¼Ÿ"></a>7. å¦‚ä½•è®©è„šæ‰‹æ¶æ”¯æŒæ›´æ–°æç¤ºï¼Ÿ</h3><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<br>ä½¿ç”¨ <code>update-notifier</code> åº“ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> updateNotifier = <span class="built_in">require</span>(<span class="string">&#x27;update-notifier&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> pkg = <span class="built_in">require</span>(<span class="string">&#x27;../package.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ›´æ–°</span></span><br><span class="line"><span class="keyword">const</span> notifier = <span class="title function_">updateNotifier</span>(&#123; pkg &#125;);</span><br><span class="line">notifier.<span class="title function_">notify</span>();</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://juejin.cn/post/7077717940941881358">ã€å‰ç«¯æ¶æ„å¿…å¤‡ã€‘æ‰‹æ‘¸æ‰‹å¸¦ä½ æ­å»ºä¸€ä¸ªå±äºè‡ªå·±çš„è„šæ‰‹æ¶</a></p><hr>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œè„šæ‰‹æ¶ï¼ˆCLI å·¥å…·ï¼‰å·²ç»æˆä¸ºä¸å¯æˆ–ç¼ºçš„å¼€å‘å·¥å…·ã€‚æ— è®ºæ˜¯ Vue CLIã€Create React App è¿˜æ˜¯ Angular CLIï¼Œå®ƒä»¬éƒ½èƒ½å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»ºé¡¹ç›®ç»“æ„ã€ç»Ÿä¸€å›¢é˜Ÿè§„èŒƒã€æé«˜å¼€å‘æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†å¸¦ä½ ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Node.js è„šæ‰‹æ¶ï¼Œæ¶µç›–å‘½ä»¤è¡Œè§£æã€ç”¨æˆ·äº¤äº’ã€æ¨¡æ¿ä¸‹è½½ã€æ–‡ä»¶æ“ä½œç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•å¼€å‘ä¸€ä¸ªç±»ä¼¼ Vue CLI çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¹¶èƒ½å°†å…¶å‘å¸ƒåˆ° npm ä¾›ä»–äººä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬å¼€å§‹å§ï¼&lt;/p&gt;</summary>
    
    
    
    <category term="å‰ç«¯å·¥ç¨‹åŒ–" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/"/>
    
    
    <category term="node.js" scheme="https://liang5757.github.io/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title>ä¸ºä»€ä¹ˆMP4è§†é¢‘è¶Šé•¿èµ·æ’­è¶Šæ…¢</title>
    <link href="https://liang5757.github.io/2025/03/20/%E8%A7%86%E9%A2%91/%E4%B8%BA%E4%BB%80%E4%B9%88MP4%E8%A7%86%E9%A2%91%E8%B6%8A%E9%95%BF%E8%B6%8A%E6%85%A2/"/>
    <id>https://liang5757.github.io/2025/03/20/%E8%A7%86%E9%A2%91/%E4%B8%BA%E4%BB%80%E4%B9%88MP4%E8%A7%86%E9%A2%91%E8%B6%8A%E9%95%BF%E8%B6%8A%E6%85%A2/</id>
    <published>2025-03-19T17:04:57.000Z</published>
    <updated>2025-12-07T10:16:59.290Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ©ç”¨åœ¨çº¿ç½‘ç«™è§£æåˆ†æ"><a href="#åˆ©ç”¨åœ¨çº¿ç½‘ç«™è§£æåˆ†æ" class="headerlink" title="åˆ©ç”¨åœ¨çº¿ç½‘ç«™è§£æåˆ†æ"></a>åˆ©ç”¨åœ¨çº¿ç½‘ç«™è§£æåˆ†æ</h2><blockquote><p>åœ¨çº¿è§£æmp4ï¼š<a href="https://www.onlinemp4parser.com/">https://www.onlinemp4parser.com/</a></p></blockquote><span id="more"></span><h3 id="ç”¨ä¾‹ä¿¡æ¯"><a href="#ç”¨ä¾‹ä¿¡æ¯" class="headerlink" title="ç”¨ä¾‹ä¿¡æ¯"></a>ç”¨ä¾‹ä¿¡æ¯</h3><table><thead><tr><th align="left">Fields</th><th align="left">Value</th></tr></thead><tbody><tr><td align="left">Movie duration</td><td align="left">3:08:22</td></tr><tr><td align="left">Video duration</td><td align="left">3:08:22</td></tr><tr><td align="left">Audio duration</td><td align="left">3:08:22</td></tr><tr><td align="left">Video resolution</td><td align="left">1024x576</td></tr><tr><td align="left">Frame rate (fps)</td><td align="left">30.00</td></tr><tr><td align="left">Video bitrate (kbps)</td><td align="left">462.71</td></tr></tbody></table><p>å…¨å±•å¼€åå‘ç°æ˜¯ä¸‹å›¾çº¢æ¡†æ•°æ®éå¸¸é•¿</p><p><img src="/2025/03/20/%E8%A7%86%E9%A2%91/%E4%B8%BA%E4%BB%80%E4%B9%88MP4%E8%A7%86%E9%A2%91%E8%B6%8A%E9%95%BF%E8%B6%8A%E6%85%A2/image-20241029174327954.png" alt="image-20241029174327954"></p><h2 id="stblï¼ˆSample-Table-Boxï¼‰"><a href="#stblï¼ˆSample-Table-Boxï¼‰" class="headerlink" title="stblï¼ˆSample Table Boxï¼‰"></a>stblï¼ˆSample Table Boxï¼‰</h2><ul><li>stsdï¼ˆSample Description Boxï¼‰ï¼šç»™å‡ºè§†é¢‘ã€éŸ³é¢‘çš„ç¼–ç ã€å®½é«˜ã€éŸ³é‡ç­‰ä¿¡æ¯ï¼Œä»¥åŠæ¯ä¸ªsampleä¸­åŒ…å«å¤šå°‘ä¸ªframeï¼›</li><li>sttsï¼ˆDecoding Time to Sample Boxï¼‰ï¼šæ¯ä¸ªsampleçš„æ—¶é•¿ï¼›</li><li><strong>stss</strong>ï¼ˆSync Sample Boxï¼‰ï¼šå“ªäº›sampleæ˜¯å…³é”®å¸§ï¼›</li><li><strong>ctts</strong>ï¼ˆComposition Time to Sample Boxï¼‰ï¼šå¸§è§£ç åˆ°æ¸²æŸ“çš„æ—¶é—´å·®å€¼ï¼Œé€šå¸¸ç”¨åœ¨Bå¸§çš„åœºæ™¯ï¼›</li><li><strong>stsc</strong>ï¼ˆSample To Chunk Boxï¼‰ï¼šæ¯ä¸ªthunkä¸­åŒ…å«å‡ ä¸ªsampleï¼›</li><li><strong>stsz</strong>ï¼ˆSample Size Boxesï¼‰ï¼šæ¯ä¸ªsampleçš„sizeï¼ˆå•ä½æ˜¯å­—èŠ‚ï¼‰ï¼›</li><li><strong>stco</strong>ï¼ˆChunk Offset Boxï¼‰ï¼šthunkåœ¨æ–‡ä»¶ä¸­çš„åç§»ï¼›</li></ul><p>è¿™è¾¹å°±åªè¯¦ç»†è§£é‡Šé•¿æ•°æ®çš„éƒ¨åˆ†</p><h3 id="stssï¼ˆSync-Sample-Boxï¼‰"><a href="#stssï¼ˆSync-Sample-Boxï¼‰" class="headerlink" title="stssï¼ˆSync Sample Boxï¼‰"></a>stssï¼ˆSync Sample Boxï¼‰</h3><p>åŒ…å«äº†æ¯ä¸ªå…³é”®å¸§åœ¨æ‰€æœ‰å¸§ä¸­çš„æ•°ç»„ä¸‹æ ‡+1ï¼Œå³å…³é”®å¸§é˜Ÿåˆ—ä»1å¼€å§‹ç®—èµ·ï¼Œä¸»è¦ç”¨æ¥æ¨å¯¼æ¯ä¸ªå¸§çš„æ—¶é•¿ã€‚åœ¨éŸ³é¢‘trackä¸­ä¸å­˜åœ¨è¿™ä¸ªboxã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">aligned</span>(<span class="number">8</span>) <span class="function"><span class="keyword">class</span> TimeToSampleBox extends <span class="title">FullBox</span><span class="params">(â€™sttsâ€™, version = <span class="number">0</span>, <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span>  entry_count</span>;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; entry_count; i++) &#123;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span>  sample_count</span>;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span>  sample_delta</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>entry_countï¼šentryçš„æ¡ç›®æ•°ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å…³é”®å¸§çš„æ•°ç›®ï¼›</li><li>sample_numberï¼šå…³é”®å¸§å¯¹åº”çš„sampleçš„åºå·ï¼›ï¼ˆä»1å¼€å§‹è®¡ç®—ï¼‰</li></ul><p>å¯ä»¥çœ‹åˆ°ä¸‹è¿°ä¾‹å­ï¼Œæœ‰1796ä¸ªå…³é”®å¸§<code>ï¼Œéšç€è§†é¢‘å˜é•¿ï¼Œ</code>stss&#96;æ•°æ®å˜å¤§</p><p><img src="/2025/03/20/%E8%A7%86%E9%A2%91/%E4%B8%BA%E4%BB%80%E4%B9%88MP4%E8%A7%86%E9%A2%91%E8%B6%8A%E9%95%BF%E8%B6%8A%E6%85%A2/image-20241030115838585.png" alt="image-20241030115838585"></p><h3 id="cttsï¼ˆComposition-Time-to-Sample-Boxï¼‰"><a href="#cttsï¼ˆComposition-Time-to-Sample-Boxï¼‰" class="headerlink" title="cttsï¼ˆComposition Time to Sample Boxï¼‰"></a>cttsï¼ˆComposition Time to Sample Boxï¼‰</h3><p>ç”¨äºå­˜å‚¨æ¯ä¸ªé‡‡æ ·çš„æ„å»ºæ—¶é—´æˆ³ï¼ˆCTSï¼ŒComposition Time Stampï¼‰ï¼Œå³ä»è§£ç ï¼ˆdtsï¼‰åˆ°æ¸²æŸ“ï¼ˆptsï¼‰ä¹‹é—´çš„å·®å€¼ï¼Œptsï¼ˆnï¼‰ &#x3D; dtsï¼ˆnï¼‰+ offsetï¼ˆnï¼‰ ã€‚</p><p>å¯¹äºåªæœ‰Iå¸§ã€På¸§çš„è§†é¢‘æ¥è¯´ï¼Œè§£ç é¡ºåºã€æ¸²æŸ“é¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œæ­¤æ—¶ï¼Œcttsæ²¡å¿…è¦å­˜åœ¨ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">aligned</span>(<span class="number">8</span>) <span class="function"><span class="keyword">class</span> CompositionOffsetBox extends <span class="title">FullBox</span><span class="params">(â€˜cttsâ€™, version = <span class="number">0</span>, <span class="number">0</span>)</span> </span>&#123; <span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span> entry_count</span>;</span><br><span class="line">   <span class="type">int</span> i;</span><br><span class="line">   <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; entry_count; i++) &#123;</span><br><span class="line">      <span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span>  sample_count</span>;</span><br><span class="line">      <span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span>  sample_offset</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>entry_countï¼šè¡¨ç¤º <code>ctts</code> ç›’å­ä¸­<code>entry</code>çš„æ•°é‡ã€‚</li><li>entries<ul><li>sample_countï¼šè¡¨ç¤ºè¿™ä¸ªæ¡ç›®ä¸­è¿ç»­çš„æ ·æœ¬æ•°é‡ï¼Œé€šå¸¸æ˜¯æŒ‡å…·æœ‰ç›¸åŒæ˜¾ç¤ºæ—¶é—´çš„å¸§çš„æ•°é‡ã€‚</li><li>sample_offsetï¼šè¡¨ç¤ºè¿™äº›æ ·æœ¬çš„æ„å»ºæ—¶é—´æˆ³çš„åç§»é‡ï¼Œé€šå¸¸æŒ‡ç¤ºç›¸å¯¹äºè¯¥æ ·æœ¬çš„è§£ç æ—¶é—´æˆ³çš„æ—¶é—´å·®ã€‚å®ƒå¯ä»¥æ˜¯æ­£å€¼æˆ–è´Ÿå€¼ï¼Œè¡¨ç¤ºæ ·æœ¬éœ€è¦æå‰æˆ–å»¶åæ˜¾ç¤ºã€‚</li></ul></li></ul><p>ä¸‹å›¾å¯ä»¥çœ‹åˆ°æœ‰338443ä¸ª<code>entry</code>ï¼Œéšç€è§†é¢‘å˜é•¿ï¼Œcttså˜å¤§</p><p><img src="/2025/03/20/%E8%A7%86%E9%A2%91/%E4%B8%BA%E4%BB%80%E4%B9%88MP4%E8%A7%86%E9%A2%91%E8%B6%8A%E9%95%BF%E8%B6%8A%E6%85%A2/image-20241030152427905.png" alt="image-20241030152427905"></p><h3 id="stscï¼ˆSample-To-Chunk-Boxï¼‰"><a href="#stscï¼ˆSample-To-Chunk-Boxï¼‰" class="headerlink" title="stscï¼ˆSample To Chunk Boxï¼‰"></a>stscï¼ˆSample To Chunk Boxï¼‰</h3><p>Trunkå’ŒSampleçš„æ˜ å°„å…³ç³»ï¼Œè¿™ä¸ªBoxå°±æ˜¯è¯´æ˜å“ªäº›sampleå¯ä»¥åˆ’åˆ†ä¸ºä¸€ä¸ªTrunk</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">aligned</span>(<span class="number">8</span>) <span class="function"><span class="keyword">class</span> SampleToChunkBox</span></span><br><span class="line"><span class="function">extends <span class="title">FullBox</span><span class="params">(â€˜stscâ€™, version = <span class="number">0</span>, <span class="number">0</span>)</span> </span>&#123; </span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span> entry_count</span>;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">1</span>; i u entry_count; i++) &#123;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span> first_chunk</span>;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span> samples_per_chunk</span>; </span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span> sample_description_index</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>entry_countï¼šæè¿°æ ·æœ¬åˆ°å—çš„æ˜ å°„å…³ç³»çš„æ¡ç›®æ•°é‡</li><li>first_chunkï¼šè¡¨ç¤ºå—ä¸­ç¬¬ä¸€ä¸ªæ ·æœ¬çš„ç´¢å¼•ï¼ˆä» 1 å¼€å§‹è®¡æ•°ï¼‰</li><li>samples_per_chunkï¼šè¡¨ç¤ºæ¯ä¸ªå—ä¸­åŒ…å«çš„sampleæ•°é‡</li><li>sample_description_indexï¼šæŒ‡å‘ stsd ä¸­ sample description çš„ç´¢å¼•å€¼ï¼Œé»˜è®¤ä¸º1</li></ul><p>å¯ä»¥çœ‹åˆ°ä¸‹è¿°ä¾‹å­ï¼Œæœ‰191384ä¸ªentryï¼Œéšç€è§†é¢‘å˜é•¿ï¼Œ<code>stsc</code>æ•°æ®å˜å¤§</p><p><img src="/2025/03/20/%E8%A7%86%E9%A2%91/%E4%B8%BA%E4%BB%80%E4%B9%88MP4%E8%A7%86%E9%A2%91%E8%B6%8A%E9%95%BF%E8%B6%8A%E6%85%A2/image-20241030175323810.png" alt="image-20241030175323810"></p><h3 id="stszï¼ˆSample-Size-Boxesï¼‰"><a href="#stszï¼ˆSample-Size-Boxesï¼‰" class="headerlink" title="stszï¼ˆSample Size Boxesï¼‰"></a>stszï¼ˆSample Size Boxesï¼‰</h3><p>ç”¨äºå­˜å‚¨æ¯ä¸ªsampleçš„å¤§å°ä¿¡æ¯ï¼Œå¸®åŠ©æ’­æ”¾å™¨ç¡®å®šåœ¨è§£ç è¿‡ç¨‹ä¸­éœ€è¦è¯»å–å¤šå°‘å­—èŠ‚çš„æ•°æ®ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">aligned</span>(<span class="number">8</span>) <span class="function"><span class="keyword">class</span> SampleSizeBox extends <span class="title">FullBox</span><span class="params">(â€˜stszâ€™, version = <span class="number">0</span>, <span class="number">0</span>)</span> </span>&#123; </span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span> sample_size</span>;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span> sample_count</span>;</span><br><span class="line"><span class="keyword">if</span> (sample_size==<span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">1</span>; i u sample_count; i++) &#123;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span>  entry_size</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>sample_countï¼šå½“å‰tracké‡Œé¢çš„sampleæ•°ç›®</li><li>sample_sizeï¼šsampleçš„å¤§å°ï¼Œæ¯ä¸ªsampleçš„å¤§å°éƒ½ä¼šåˆ—å‡º</li></ul><p>å¯ä»¥çœ‹åˆ°ä¸‹è¿°ä¾‹å­ï¼Œæœ‰339059ä¸ªentryï¼Œéšç€è§†é¢‘å˜é•¿ï¼Œ<code>stsz</code>æ•°æ®å˜å¤§</p><p><img src="/2025/03/20/%E8%A7%86%E9%A2%91/%E4%B8%BA%E4%BB%80%E4%B9%88MP4%E8%A7%86%E9%A2%91%E8%B6%8A%E9%95%BF%E8%B6%8A%E6%85%A2/image-20241031105426056.png" alt="image-20241031105426056"></p><h3 id="stcoï¼ˆChunk-Offset-Boxï¼‰"><a href="#stcoï¼ˆChunk-Offset-Boxï¼‰" class="headerlink" title="stcoï¼ˆChunk Offset Boxï¼‰"></a>stcoï¼ˆChunk Offset Boxï¼‰</h3><p>ç”¨äºå­˜å‚¨æ¯ä¸ªå—ï¼ˆchunkï¼‰åœ¨æ–‡ä»¶ä¸­çš„åç§»é‡ï¼Œå¸®åŠ©æ’­æ”¾å™¨å¿«é€Ÿæ‰¾åˆ°chunkçš„å­˜å‚¨ä½ç½®</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># Box Type: â€˜stcoâ€™, â€˜co64â€™</span><br><span class="line"># Container: <span class="function">Sample Table <span class="title">Box</span> <span class="params">(â€˜stblâ€™)</span> Mandatory: Yes</span></span><br><span class="line"><span class="function"># Quantity: Exactly one variant must be present</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">aligned(<span class="number">8</span>) class ChunkOffsetBox</span></span><br><span class="line"><span class="function">extends FullBox(â€˜stcoâ€™, version =</span> <span class="number">0</span>, <span class="number">0</span>) &#123; </span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span> entry_count</span>;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">1</span>; i u entry_count; i++) &#123;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span>  chunk_offset</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">aligned</span>(<span class="number">8</span>) <span class="function"><span class="keyword">class</span> ChunkLargeOffsetBox</span></span><br><span class="line"><span class="function">extends <span class="title">FullBox</span><span class="params">(â€˜co64â€™, version = <span class="number">0</span>, <span class="number">0</span>)</span> </span>&#123; </span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">32</span>)</span> entry_count</span>;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">1</span>; i u entry_count; i++) &#123;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="title">int</span><span class="params">(<span class="number">64</span>)</span>  chunk_offset</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>entry_countï¼šchunkçš„æ•°é‡</li><li>chunk_offsetï¼šchunkåœ¨æ–‡ä»¶ä¸­çš„ä½ç½®</li></ul><p>å¯ä»¥çœ‹åˆ°ä¸‹è¿°ä¾‹å­ï¼Œæœ‰243367ä¸ªentryï¼Œéšç€è§†é¢‘å˜é•¿ï¼Œ<code>stco</code>æ•°æ®å˜å¤§</p><p><img src="/2025/03/20/%E8%A7%86%E9%A2%91/%E4%B8%BA%E4%BB%80%E4%B9%88MP4%E8%A7%86%E9%A2%91%E8%B6%8A%E9%95%BF%E8%B6%8A%E6%85%A2/image-20241031193839595.png" alt="image-20241031193839595"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>moovçš„å¤§å°æ€»å…±ï¼š9305337Bï¼ˆ8.87MBï¼‰</p><p>ç¬¬ä¸€ä¸ªtrakï¼ˆè¿™ä¸ªä¾‹å­æœ‰ä¸¤ä¸ªï¼‰ï¼š<br>stsså ï¼š7200Bï¼ˆ0.006MBï¼Œ0.077%ï¼‰<br>cttså ï¼š2707560Bï¼ˆ2.582MBï¼Œ29.09%ï¼‰<br>stscå ï¼š2296624Bï¼ˆ2.190MBï¼Œ24.68%ï¼‰<br>stszå ï¼š1356256B ï¼ˆ1.293MBï¼Œ14.58%ï¼‰<br>stcoå ï¼š973484Bï¼ˆ0.928MBï¼Œ10.46%ï¼‰</p><p>æ—¶é—´è¶Šé•¿ï¼Œä¼šå¯¼è‡´moovå˜å¤§ï¼Œä¸»è¦æ˜¯ä¼šæœ‰æ‰€æœ‰chunkå’Œsampleçš„æè¿°</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.cnblogs.com/chyingp/p/mp4-file-format.html"><a href="https://www.cnblogs.com/chyingp/p/mp4-file-format.html">5åˆ†é’Ÿå…¥é—¨MP4æ–‡ä»¶æ ¼å¼</a></a></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;åˆ©ç”¨åœ¨çº¿ç½‘ç«™è§£æåˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ©ç”¨åœ¨çº¿ç½‘ç«™è§£æåˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;åˆ©ç”¨åœ¨çº¿ç½‘ç«™è§£æåˆ†æ&quot;&gt;&lt;/a&gt;åˆ©ç”¨åœ¨çº¿ç½‘ç«™è§£æåˆ†æ&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;åœ¨çº¿è§£æmp4ï¼š&lt;a href=&quot;https://www.onlinemp4parser.com/&quot;&gt;https://www.onlinemp4parser.com/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="è§†é¢‘" scheme="https://liang5757.github.io/categories/%E8%A7%86%E9%A2%91/"/>
    
    
    <category term="è§†é¢‘" scheme="https://liang5757.github.io/tags/%E8%A7%86%E9%A2%91/"/>
    
  </entry>
  
  <entry>
    <title>ç¦æ­¢ç”¨æˆ·è°ƒè¯•ç½‘ç«™</title>
    <link href="https://liang5757.github.io/2024/10/28/%E5%89%8D%E7%AB%AF%E5%AE%9E%E6%88%98%E6%8A%80%E5%B7%A7/%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E8%B0%83%E8%AF%95%E7%BD%91%E7%AB%99/"/>
    <id>https://liang5757.github.io/2024/10/28/%E5%89%8D%E7%AB%AF%E5%AE%9E%E6%88%98%E6%8A%80%E5%B7%A7/%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E8%B0%83%E8%AF%95%E7%BD%91%E7%AB%99/</id>
    <published>2024-10-27T17:14:10.000Z</published>
    <updated>2025-12-07T10:16:59.255Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>webæƒ³ç¦æ­¢è°ƒè¯•ï¼Œæ²¡æœ‰ç»å¯¹å®‰å…¨çš„æ–¹å¼</p></blockquote><h2 id="å¦™ç”¨1-debugger"><a href="#å¦™ç”¨1-debugger" class="headerlink" title="å¦™ç”¨1 debugger"></a>å¦™ç”¨1 debugger</h2><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>ç”¨<code>setInterval</code>æ‰§è¡Œ<code>debugger</code>ï¼Œæ‰“å¼€æ§åˆ¶å°å°±ä¼šæš‚åœä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">ban</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123; </span><br><span class="line">      <span class="keyword">debugger</span>;</span><br><span class="line">    &#125;, <span class="number">50</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">ban</span>();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="å¦™ç”¨2-debugger"><a href="#å¦™ç”¨2-debugger" class="headerlink" title="å¦™ç”¨2 debugger"></a>å¦™ç”¨2 debugger</h2><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æ•ˆæœï¼šæ‰“å¼€æ§åˆ¶å°å°±è¿›å…¥debuggerï¼Œ<strong>å¦‚æœè¿˜åƒ å¦™ç”¨1 çš„ç ´è§£ä¹‹æ³•è§£å†³ï¼Œæµè§ˆå™¨ä¼šè¢«å¡æ­»</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> timeLimit = <span class="number">50</span>;</span><br><span class="line">  <span class="built_in">setInterval</span>(loop, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> startTime = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="keyword">debugger</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">Date</span>() - startTime &gt; timeLimit) &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">stop</span>();</span><br><span class="line">      <span class="keyword">let</span> total = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">        total = total + i.<span class="title function_">toString</span>();</span><br><span class="line">        history.<span class="title function_">pushState</span>(<span class="number">0</span>, <span class="number">0</span>, total);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¸‹é¢è¿™ä¸€æ®µæ˜¯å¯¼è‡´æµè§ˆå™¨å¡æ­»çš„ç½ªé­ç¥¸é¦–</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> total = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">    total = total + i.<span class="title function_">toString</span>();</span><br><span class="line">    history.<span class="title function_">pushState</span>(<span class="number">0</span>, <span class="number">0</span>, total);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯é»˜è®¤åº”è¯¥å°±ä¼šæ‰§è¡Œï¼Œä¸ºä»€ä¹ˆæ‰“å¼€æ§åˆ¶å°æ‰è¿›å…¥è¿™ä¸€æ®µå‘¢ï¼Ÿç­”æ¡ˆå°±åœ¨è¿™ä¸€æ®µ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> startTime = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="keyword">debugger</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">Date</span>() - startTime &gt; timeLimit) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªæœ‰è¿›å…¥debuggerçš„æƒ…å†µä¸‹ï¼Œ<code>new Date()</code>æ‰ä¼šæ¯”<code>startTime</code>ï¼ˆä¸Šä¸€æ¬¡çš„æ—¶é—´ï¼‰å¤§50ms</p><p>ä¹Ÿå¯ä»¥è¿™æ ·æ“ä½œï¼šè·³è½¬è‡³ç©ºé¡µé¢</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">Date</span>() - startTime &gt; timeLimit) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&#x27;about:blank&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰å¾ˆå¤šæ–¹å¼ï¼Œåªè¦é¿å…èƒ½è°ƒè¯•å½“å‰é¡µé¢å³å¯</p><h2 id="ç¬¬ä¸‰æ–¹åº“ï¼šdisable-devtool"><a href="#ç¬¬ä¸‰æ–¹åº“ï¼šdisable-devtool" class="headerlink" title="ç¬¬ä¸‰æ–¹åº“ï¼šdisable-devtool"></a>ç¬¬ä¸‰æ–¹åº“ï¼šdisable-devtool</h2><blockquote><p><a href="https://github.com/theajack/disable-devtool%EF%BC%9A**0.3.7">https://github.com/theajack/disable-devtoolï¼š**0.3.7</a>**</p></blockquote><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script</span><br><span class="line">  disable-devtool-auto</span><br><span class="line">  src=<span class="string">&#x27;https://cdn.jsdelivr.net/npm/disable-devtool&#x27;</span></span><br><span class="line">  stopIntervalTime=<span class="string">&quot;false&quot;</span></span><br><span class="line">&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®å«ä¹‰"><a href="#é…ç½®å«ä¹‰" class="headerlink" title="é…ç½®å«ä¹‰"></a>é…ç½®å«ä¹‰</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IConfig</span> &#123;</span><br><span class="line">    <span class="attr">md5</span>?: <span class="built_in">string</span>; <span class="comment">// ç»•è¿‡ç¦ç”¨çš„md5å€¼ï¼Œç”¨äºçº¿ä¸Šï¼Œé»˜è®¤ä¸å¯ç”¨ç»•è¿‡ç¦ç”¨</span></span><br><span class="line">    <span class="attr">url</span>?: <span class="built_in">string</span>; <span class="comment">// å…³é—­é¡µé¢å¤±è´¥æ—¶çš„è·³è½¬é¡µé¢ï¼Œé»˜è®¤å€¼ä¸ºlocalhost</span></span><br><span class="line">    <span class="attr">tkName</span>?: <span class="built_in">string</span>; <span class="comment">// ç»•è¿‡ç¦ç”¨æ—¶çš„urlå‚æ•°åç§°ï¼Œé»˜è®¤ä¸º ddtk</span></span><br><span class="line">    ondevtoolopen?(<span class="attr">type</span>: <span class="title class_">DetectorType</span>, <span class="attr">next</span>: <span class="title class_">Function</span>): <span class="built_in">void</span>; <span class="comment">// å¼€å‘è€…é¢æ¿æ‰“å¼€çš„å›è°ƒï¼Œå¯ç”¨æ—¶urlå‚æ•°æ— æ•ˆï¼Œtype ä¸ºç›‘æµ‹æ¨¡å¼ï¼Œè¯¦è§3.5ï¼Œ nextå‡½æ•°æ˜¯å…³é—­å½“å‰çª—å£</span></span><br><span class="line">    ondevtoolclose?(): <span class="built_in">void</span>; <span class="comment">// å¼€å‘è€…é¢æ¿å…³é—­çš„å›è°ƒ</span></span><br><span class="line">    <span class="attr">interval</span>?: <span class="built_in">number</span>; <span class="comment">// å®šæ—¶å™¨çš„æ—¶é—´é—´éš” é»˜è®¤200ms</span></span><br><span class="line">    <span class="attr">disableMenu</span>?: <span class="built_in">boolean</span>; <span class="comment">// æ˜¯å¦ç¦ç”¨å³é”®èœå• é»˜è®¤ä¸ºtrue</span></span><br><span class="line">    <span class="attr">stopIntervalTime</span>?: <span class="built_in">number</span>; <span class="comment">// åœ¨ç§»åŠ¨ç«¯æ—¶å–æ¶ˆç›‘è§†çš„ç­‰å¾…æ—¶é•¿</span></span><br><span class="line">    <span class="attr">clearIntervalWhenDevOpenTrigger</span>?: <span class="built_in">boolean</span>; <span class="comment">// æ˜¯å¦åœ¨è§¦å‘ä¹‹ååœæ­¢ç›‘æ§ é»˜è®¤ä¸ºfalseï¼Œ åœ¨ä½¿ç”¨ondevtoolcloseæ—¶è¯¥å‚æ•°æ— æ•ˆ</span></span><br><span class="line">    <span class="attr">detectors</span>?: <span class="title class_">Array</span>&lt;<span class="title class_">DetectorType</span>&gt;; <span class="comment">// å¯ç”¨çš„æ£€æµ‹å™¨ æ£€æµ‹å™¨è¯¦æƒ…è§ 3.5 é»˜è®¤ä¸ºå…¨éƒ¨ï¼Œå»ºè®®ä½¿ç”¨å…¨éƒ¨</span></span><br><span class="line">    <span class="attr">clearLog</span>?: <span class="built_in">boolean</span>; <span class="comment">// æ˜¯å¦æ¯æ¬¡éƒ½æ¸…é™¤log</span></span><br><span class="line">    <span class="attr">disableSelect</span>?: <span class="built_in">boolean</span>; <span class="comment">// æ˜¯å¦ç¦ç”¨é€‰æ‹©æ–‡æœ¬ é»˜è®¤ä¸ºfalse</span></span><br><span class="line">    <span class="attr">disableCopy</span>?: <span class="built_in">boolean</span>; <span class="comment">// æ˜¯å¦ç¦ç”¨å¤åˆ¶ é»˜è®¤ä¸ºfalse</span></span><br><span class="line">    <span class="attr">disableCut</span>?: <span class="built_in">boolean</span>; <span class="comment">// æ˜¯å¦ç¦ç”¨å‰ªåˆ‡ é»˜è®¤ä¸ºfalse</span></span><br><span class="line">    <span class="attr">disablePaste</span>: <span class="built_in">boolean</span>; <span class="comment">// æ˜¯å¦ç¦ç”¨ç²˜è´´ é»˜è®¤ä¸ºfalse</span></span><br><span class="line">    <span class="attr">ignore</span>?: (<span class="built_in">string</span>|<span class="title class_">RegExp</span>)[] | <span class="literal">null</span> | (<span class="function">()=&gt;</span><span class="built_in">boolean</span>); <span class="comment">// æŸäº›æƒ…å†µå¿½ç•¥ç¦ç”¨</span></span><br><span class="line">    <span class="attr">disableIframeParents</span>?: <span class="built_in">boolean</span>; <span class="comment">// iframeä¸­æ˜¯å¦ç¦ç”¨æ‰€æœ‰çˆ¶çª—å£</span></span><br><span class="line">    <span class="attr">timeOutUrl</span>?: <span class="built_in">string</span>; <span class="comment">// å…³é—­é¡µé¢è¶…æ—¶è·³è½¬çš„url;</span></span><br><span class="line">    <span class="attr">rewriteHTML</span>: <span class="built_in">string</span>; <span class="comment">// æ£€æµ‹åˆ°æ‰“å¼€ä¹‹åé‡å†™é¡µé¢</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">DetectorType</span> &#123;</span><br><span class="line">  <span class="title class_">Unknown</span> = -<span class="number">1</span>,</span><br><span class="line">  <span class="title class_">RegToString</span> = <span class="number">0</span>, <span class="comment">// æ ¹æ®æ­£åˆ™æ£€æµ‹</span></span><br><span class="line">  <span class="title class_">DefineId</span>, <span class="comment">// æ ¹æ®dom idæ£€æµ‹</span></span><br><span class="line">  <span class="title class_">Size</span>, <span class="comment">// æ ¹æ®çª—å£å°ºå¯¸æ£€æµ‹</span></span><br><span class="line">  <span class="title class_">DateToString</span>, <span class="comment">// æ ¹æ®Date.toString æ£€æµ‹</span></span><br><span class="line">  <span class="title class_">FuncToString</span>, <span class="comment">// æ ¹æ®Function.toString æ£€æµ‹</span></span><br><span class="line">  <span class="title class_">Debugger</span>, <span class="comment">// æ ¹æ®æ–­ç‚¹æ£€æµ‹ï¼Œä»…åœ¨ios chrome çœŸæœºæƒ…å†µä¸‹æœ‰æ•ˆ</span></span><br><span class="line">  <span class="title class_">Performance</span>, <span class="comment">// æ ¹æ®logå¤§æ•°æ®æ€§èƒ½æ£€æµ‹</span></span><br><span class="line">  <span class="title class_">DebugLib</span>, <span class="comment">// æ£€æµ‹ç¬¬ä¸‰æ–¹è°ƒè¯•å·¥å…· eruda å’Œ vconsole   </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="å…³é”®æºç "><a href="#å…³é”®æºç " class="headerlink" title="å…³é”®æºç "></a>å…³é”®æºç </h2><h3 id="ç¦ç”¨å¿«æ·é”®"><a href="#ç¦ç”¨å¿«æ·é”®" class="headerlink" title="ç¦ç”¨å¿«æ·é”®"></a>ç¦ç”¨å¿«æ·é”®</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">KEY</span> = &#123;<span class="attr">J</span>: <span class="number">74</span>, <span class="attr">I</span>: <span class="number">73</span>, <span class="attr">U</span>: <span class="number">85</span>, <span class="attr">S</span>: <span class="number">83</span>, <span class="attr">F12</span>: <span class="number">123</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¦ç”¨ ctrl + shift + i/j</span></span><br><span class="line"><span class="keyword">const</span> isOpenDevToolKey = <span class="variable constant_">IS</span>.<span class="property">macos</span> ?</span><br><span class="line">    (<span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">KeyboardEvent</span>, <span class="attr">code</span>: <span class="built_in">number</span></span>) =&gt;</span> (e.<span class="property">metaKey</span> &amp;&amp; e.<span class="property">altKey</span> &amp;&amp; (code === <span class="variable constant_">KEY</span>.<span class="property">I</span> || code === <span class="variable constant_">KEY</span>.<span class="property">J</span>))) :</span><br><span class="line">    (<span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">KeyboardEvent</span>, <span class="attr">code</span>: <span class="built_in">number</span></span>) =&gt;</span> (e.<span class="property">ctrlKey</span> &amp;&amp; e.<span class="property">shiftKey</span> &amp;&amp; (code === <span class="variable constant_">KEY</span>.<span class="property">I</span> || code === <span class="variable constant_">KEY</span>.<span class="property">J</span>)));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isViewSourceCodeKey = <span class="variable constant_">IS</span>.<span class="property">macos</span> ?</span><br><span class="line">    (<span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">KeyboardEvent</span>, <span class="attr">code</span>: <span class="built_in">number</span></span>) =&gt;</span> (e.<span class="property">metaKey</span> &amp;&amp; e.<span class="property">altKey</span> &amp;&amp; code === <span class="variable constant_">KEY</span>.<span class="property">U</span>) || (e.<span class="property">metaKey</span> &amp;&amp; code === <span class="variable constant_">KEY</span>.<span class="property">S</span>)) :</span><br><span class="line">    (<span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">KeyboardEvent</span>, <span class="attr">code</span>: <span class="built_in">number</span></span>) =&gt;</span> (e.<span class="property">ctrlKey</span> &amp;&amp; (code === <span class="variable constant_">KEY</span>.<span class="property">S</span> || code === <span class="variable constant_">KEY</span>.<span class="property">U</span>)));</span><br><span class="line"></span><br><span class="line">target.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">e = e || target.<span class="property">event</span>;</span><br><span class="line"><span class="keyword">const</span> keyCode = e.<span class="property">keyCode</span> || e.<span class="property">which</span>;</span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">  keyCode === <span class="variable constant_">KEY</span>.<span class="property">F12</span> || <span class="comment">// ç¦ç”¨f12</span></span><br><span class="line">  <span class="title function_">isOpenDevToolKey</span>(e, keyCode) || <span class="comment">// ç¦ç”¨ ctrl + shift + i</span></span><br><span class="line">  <span class="title function_">isViewSourceCodeKey</span>(e, keyCode) <span class="comment">// ç¦ç”¨ ctrl + u å’Œ ctrl + s æŸ¥çœ‹å’Œä¿å­˜æºç </span></span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">preventEvent</span>(target, e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">target.<span class="title function_">addEventListener</span>(<span class="string">&#x27;contextmenu&#x27;</span>, <span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">Event</span> &amp; &#123;pointerType: <span class="built_in">string</span>&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (e.<span class="property">pointerType</span> === <span class="string">&#x27;touch&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">preventEvent</span>(target, e);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">addPreventListener</span>(target, <span class="string">&#x27;selectstart&#x27;</span>);</span><br><span class="line"><span class="title function_">addPreventListener</span>(target, <span class="string">&#x27;copy&#x27;</span>);</span><br><span class="line"><span class="title function_">addPreventListener</span>(target, <span class="string">&#x27;cut&#x27;</span>);</span><br><span class="line"><span class="title function_">addPreventListener</span>(target, <span class="string">&#x27;paste&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addPreventListener</span> (<span class="params"><span class="attr">target</span>: <span class="title class_">Window</span>, <span class="attr">name</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  target.<span class="title function_">addEventListener</span>(name, <span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">Event</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">preventEvent</span>(target, e);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ£€æµ‹æ–¹æ³•"><a href="#æ£€æµ‹æ–¹æ³•" class="headerlink" title="æ£€æµ‹æ–¹æ³•"></a>æ£€æµ‹æ–¹æ³•</h3><h4 id="DataToString"><a href="#DataToString" class="headerlink" title="DataToString"></a>DataToString</h4><p>åˆ©ç”¨ ä¸æ‰“å¼€æ§åˆ¶ä¸ä¼šæ‰§è¡Œ<code>console.log</code>ï¼Œæ‰§è¡Œäº†ä¸¤æ¬¡<code>toString</code>åè§†ä¸ºæ‰“å¼€äº†æ§åˆ¶å°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">init</span> () &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">count</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">date</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">date</span>.<span class="property">toString</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span> ++;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">detect</span> () &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">count</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">date</span>);</span><br><span class="line">  <span class="title function_">clearLog</span>();</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">count</span> &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onDevToolOpen</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="defineProperty"><a href="#defineProperty" class="headerlink" title="defineProperty"></a>defineProperty</h4><p><code>console.log</code>è§¦å‘ <code>getter</code> çš„ç‰¹æ€§æ¥æ£€æµ‹æ˜¯å¦æ‰“å¼€äº†å¼€å‘è€…å·¥å…·ã€‚å½“æ§åˆ¶å°è¯•å›¾æ¸²æŸ“ <code>this.div</code> å¯¹è±¡æ—¶ï¼Œè§¦å‘äº† <code>id</code> å±æ€§çš„ <code>getter</code>ï¼Œä»è€Œè°ƒç”¨ <code>this.onDevToolOpen()</code> æ¥å“åº”æ£€æµ‹ç»“æœã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">init</span> () &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">div</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">  (<span class="variable language_">this</span>.<span class="property">div</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="title function_">__defineGetter__</span>(<span class="string">&#x27;id&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onDevToolOpen</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>.<span class="property">div</span>, <span class="string">&#x27;id&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onDevToolOpen</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">detect</span> () &#123;</span><br><span class="line">  <span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">div</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Detector"><a href="#Detector" class="headerlink" title="Detector"></a>Detector</h4><p>åˆ©ç”¨<code>Function</code>çš„<code>toString</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">init</span> () &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">count</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">func</span> = <span class="function">() =&gt;</span> &#123;&#125;;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">func</span>.<span class="property">toString</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span> ++;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">detect</span> () &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">count</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">func</span>);</span><br><span class="line">  <span class="title function_">clearLog</span>();</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">count</span> &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onDevToolOpen</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="performance"><a href="#performance" class="headerlink" title="performance"></a>performance</h4><p>é€šè¿‡æ§åˆ¶å°æ‰“å°å¤§å¯¹è±¡æ•°ç»„æ‰€èŠ±çš„å¤§é‡æ—¶é—´æ¥æ£€æµ‹å¼€å‘è€…å·¥å…·æ˜¯å¦è¢«æ‰“å¼€</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">init</span> () &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">maxPrintTime</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">largeObjectArray</span> = <span class="title function_">createLargeObjectArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">detect</span> () &#123;</span><br><span class="line">  <span class="keyword">const</span> tablePrintTime = <span class="title function_">calculateTime</span>(<span class="function">() =&gt;</span> &#123;<span class="title function_">table</span>(<span class="variable language_">this</span>.<span class="property">largeObjectArray</span>);&#125;);</span><br><span class="line">  <span class="keyword">const</span> logPrintTime = <span class="title function_">calculateTime</span>(<span class="function">() =&gt;</span> &#123;<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">largeObjectArray</span>);&#125;);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">maxPrintTime</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="variable language_">this</span>.<span class="property">maxPrintTime</span>, logPrintTime);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">clearLog</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (tablePrintTime === <span class="number">0</span> || <span class="variable language_">this</span>.<span class="property">maxPrintTime</span> === <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (tablePrintTime &gt; <span class="variable language_">this</span>.<span class="property">maxPrintTime</span> * <span class="number">10</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onDevToolOpen</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="debugger"><a href="#debugger" class="headerlink" title="debugger"></a>debugger</h4><p>åŸç†åŒæœ¬æ–‡å¼€å¤´æ–¹å¼</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">detect</span> () &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="title function_">now</span>();</span><br><span class="line">  (<span class="function">() =&gt;</span> &#123;<span class="keyword">debugger</span>;&#125;)();</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">now</span>() - date &gt; <span class="number">100</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onDevToolOpen</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="resize"><a href="#resize" class="headerlink" title="resize"></a>resize</h4><p>é€šè¿‡ç›‘æµ‹å†…å¤–çª—å£å°ºå¯¸ï¼ˆå¦‚<code>outerWidth</code>å’Œ<code>innerWidth</code>çš„å·®å€¼ï¼‰æ˜¯å¦å¼‚å¸¸å˜åŒ–æ¥æ£€æµ‹å¼€å‘è€…å·¥å…·çš„æ‰“å¼€çŠ¶æ€</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">init</span> () &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">checkWindowSizeUneven</span>();</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">checkWindowSizeUneven</span>();</span><br><span class="line">    &#125;, <span class="number">100</span>);</span><br><span class="line">  &#125;, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æµ‹å†…å¤–çª—å£çš„å¤§å°æ˜¯å¦å› devtoolè€Œäº§ç”Ÿå·®å€¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">checkWindowSizeUneven</span> () &#123;</span><br><span class="line">  <span class="keyword">const</span> screenRatio = <span class="title function_">countScreenZoomRatio</span>();</span><br><span class="line">  <span class="keyword">if</span> (screenRatio === <span class="literal">false</span>) &#123; <span class="comment">// å¦‚æœè·å–ä¸åˆ°å±å¹•ç¼©æ”¾å°ºå¯¸ åˆ™ä¸å¯ç”¨sizeDetector</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> widthUneven = <span class="variable language_">window</span>.<span class="property">outerWidth</span> - <span class="variable language_">window</span>.<span class="property">innerWidth</span> * screenRatio &gt; <span class="number">200</span>; <span class="comment">// è°ƒå¤§ä¸€ç‚¹é˜²æ­¢è¯¯ä¼¤</span></span><br><span class="line">  <span class="keyword">const</span> heightUneven = <span class="variable language_">window</span>.<span class="property">outerHeight</span> - <span class="variable language_">window</span>.<span class="property">innerHeight</span> * screenRatio &gt; <span class="number">300</span>; <span class="comment">// è°ƒå¤§ä¸€ç‚¹é˜²æ­¢è¯¯ä¼¤</span></span><br><span class="line">  <span class="keyword">if</span> (widthUneven || heightUneven) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onDevToolOpen</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">clearDevToolOpenState</span>(<span class="variable language_">this</span>.<span class="property">type</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–åƒç´ æ¯”</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">countScreenZoomRatio</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">checkExist</span>(<span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> screen = <span class="variable language_">window</span>.<span class="property">screen</span> <span class="keyword">as</span> <span class="built_in">any</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">checkExist</span>(screen)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (screen.<span class="property">deviceXDPI</span> &amp;&amp; screen.<span class="property">logicalXDPI</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> screen.<span class="property">deviceXDPI</span> / screen.<span class="property">logicalXDPI</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å…¶å®å°±ä¸‰ç§æ£€æµ‹ç±»å‹</p><ul><li>resize</li><li>console.log</li><li>debugger</li></ul><p>ä½†äº§ç”Ÿäº†å¤šç§æ£€æµ‹å™¨ï¼Œä»è€Œå¢å¤§ç ´è§£çš„éš¾åº¦</p><h2 id="ç ´è§£ä¹‹æ³•"><a href="#ç ´è§£ä¹‹æ³•" class="headerlink" title="ç ´è§£ä¹‹æ³•"></a>ç ´è§£ä¹‹æ³•</h2><h3 id="ç ´è§£ä¹‹æ³•1"><a href="#ç ´è§£ä¹‹æ³•1" class="headerlink" title="ç ´è§£ä¹‹æ³•1"></a>ç ´è§£ä¹‹æ³•1</h3><p>ä»…éœ€åœç”¨æ–­ç‚¹ï¼Œå³å¯ç ´è§£</p><p><img src="/2024/10/28/%E5%89%8D%E7%AB%AF%E5%AE%9E%E6%88%98%E6%8A%80%E5%B7%A7/%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E8%B0%83%E8%AF%95%E7%BD%91%E7%AB%99/image-20240805010519481.png" alt="image-20240805010519481"></p><h3 id="ç ´è§£ä¹‹æ³•2"><a href="#ç ´è§£ä¹‹æ³•2" class="headerlink" title="ç ´è§£ä¹‹æ³•2"></a>ç ´è§£ä¹‹æ³•2</h3><p>åªè¦ä¸€å¾‹ä¸åœ¨æ­¤å¤„æš‚åœï¼ˆdebuggerï¼‰ï¼Œç”šè‡³è¿˜å¯ä»¥åŠ æ–­ç‚¹è°ƒè¯•ç½‘ç«™</p><p><img src="/2024/10/28/%E5%89%8D%E7%AB%AF%E5%AE%9E%E6%88%98%E6%8A%80%E5%B7%A7/%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E8%B0%83%E8%AF%95%E7%BD%91%E7%AB%99/image-20240805223959863-1728662823017-2.png" alt="image-20240805223959863"></p><h3 id="ç ´è§£ä¹‹æ³•3"><a href="#ç ´è§£ä¹‹æ³•3" class="headerlink" title="ç ´è§£ä¹‹æ³•3"></a>ç ´è§£ä¹‹æ³•3</h3><p>å¯ä»¥æ·»åŠ æ¡ä»¶æ–­ç‚¹</p><p><img src="/2024/10/28/%E5%89%8D%E7%AB%AF%E5%AE%9E%E6%88%98%E6%8A%80%E5%B7%A7/%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E8%B0%83%E8%AF%95%E7%BD%91%E7%AB%99/image-20241028010502293.png" alt="image-20241028010502293"></p><h3 id="ç ´è§£ä¹‹æ³•4"><a href="#ç ´è§£ä¹‹æ³•4" class="headerlink" title="ç ´è§£ä¹‹æ³•4"></a>ç ´è§£ä¹‹æ³•4</h3><p>å…ˆåœ¨ä¸€ä¸ªç©ºé¡µé¢æ‰“å¼€æ§åˆ¶å°ï¼Œå†è¿›å…¥é¡µé¢ï¼Œå¯ä»¥æ”»å‡»åªæœ‰debuggerçš„ç½‘ç«™</p><h3 id="ç ´è§£ä¹‹æ³•5"><a href="#ç ´è§£ä¹‹æ³•5" class="headerlink" title="ç ´è§£ä¹‹æ³•5"></a>ç ´è§£ä¹‹æ³•5</h3><p>ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ›¿æ¢ä¿®æ”¹jsï¼ˆSourcesé¢æ¿ â€“&gt; Overridesï¼‰ï¼Œè¯¦æƒ…å¯çœ‹ï¼š<a href="https://developer.chrome.com/docs/devtools/overrides?hl=zh-cn">åœ¨æœ¬åœ°æ›¿æ¢ Web å†…å®¹å’Œ HTTP å“åº”æ ‡å¤´</a></p><p><img src="/2024/10/28/%E5%89%8D%E7%AB%AF%E5%AE%9E%E6%88%98%E6%8A%80%E5%B7%A7/%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E8%B0%83%E8%AF%95%E7%BD%91%E7%AB%99/image-20241028011025582.png" alt="image-20241028011025582"></p><h3 id="ç ´è§£ä¹‹æ³•5-1"><a href="#ç ´è§£ä¹‹æ³•5-1" class="headerlink" title="ç ´è§£ä¹‹æ³•5"></a>ç ´è§£ä¹‹æ³•5</h3><p>ç›´æ¥å®‰è£…æ²¹çŒ´è„šæœ¬å³å¯ï¼Œæˆ–è€…è‡ªå·±å†™ä¸€ä¸ª</p><p><img src="/2024/10/28/%E5%89%8D%E7%AB%AF%E5%AE%9E%E6%88%98%E6%8A%80%E5%B7%A7/%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E8%B0%83%E8%AF%95%E7%BD%91%E7%AB%99/image-20241028011201356.png" alt="image-20241028011201356"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://juejin.cn/post/7368313344712179739">ğŸ”åˆ«æƒ³è°ƒè¯•æˆ‘çš„å‰ç«¯é¡µé¢ä»£ç ğŸ”’</a><br><a href="https://juejin.cn/post/7369505226921738278">âš”ï¸ä¸è®©æˆ‘åœ¨æ§åˆ¶å°ä¸Šè°ƒè¯•ï¼Œå“¼ï¼Œä¼‘æƒ³ğŸ› ï¸</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;webæƒ³ç¦æ­¢è°ƒè¯•ï¼Œæ²¡æœ‰ç»å¯¹å®‰å…¨çš„æ–¹å¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;å¦™ç”¨1-debugger&quot;&gt;&lt;a href=&quot;#å¦™ç”¨1-debugger&quot; class=&quot;headerlink&quot; title=&quot;å¦™ç”¨1 debugger&quot;&gt;&lt;/a&gt;å¦™ç”¨1 debugger&lt;/h2&gt;&lt;h3 id=&quot;ç¤ºä¾‹&quot;&gt;&lt;a href=&quot;#ç¤ºä¾‹&quot; class=&quot;headerlink&quot; title=&quot;ç¤ºä¾‹&quot;&gt;&lt;/a&gt;ç¤ºä¾‹&lt;/h3&gt;&lt;p&gt;ç”¨&lt;code&gt;setInterval&lt;/code&gt;æ‰§è¡Œ&lt;code&gt;debugger&lt;/code&gt;ï¼Œæ‰“å¼€æ§åˆ¶å°å°±ä¼šæš‚åœä»£ç &lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;ban&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;setInterval&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;debugger&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;, &lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;title function_&quot;&gt;ban&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="æŠ€å·§" scheme="https://liang5757.github.io/tags/%E6%8A%80%E5%B7%A7/"/>
    
    <category term="æµè§ˆå™¨" scheme="https://liang5757.github.io/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>æ°´å¡˜æŠ½æ ·ç®—æ³•</title>
    <link href="https://liang5757.github.io/2024/10/12/%E7%AE%97%E6%B3%95/%E6%B0%B4%E5%A1%98%E6%8A%BD%E6%A0%B7%E7%AE%97%E6%B3%95/"/>
    <id>https://liang5757.github.io/2024/10/12/%E7%AE%97%E6%B3%95/%E6%B0%B4%E5%A1%98%E6%8A%BD%E6%A0%B7%E7%AE%97%E6%B3%95/</id>
    <published>2024-10-11T16:01:34.000Z</published>
    <updated>2025-12-07T10:16:59.285Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><p>æ°´å¡˜æŠ½æ ·çš„ç›®æ ‡æ˜¯ä»ä¸€ä¸ªå¾ˆå¤§çš„æˆ–æœªçŸ¥å¤§å°çš„æ•°æ®é›†ä¸­éšæœºé€‰å–kä¸ªæ ·æœ¬ã€‚</p><p>ç‰¹ç‚¹ï¼šä¸è¦æ±‚ä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰æ•°æ®ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“æ•°æ®æ€»é‡ï¼Œèƒ½ä¿è¯æ¯ä¸ªå…ƒç´ è¢«é€‰ä¸­çš„æ¦‚ç‡ç›¸ç­‰</p><span id="more"></span><h2 id="ç®—æ³•æ­¥éª¤"><a href="#ç®—æ³•æ­¥éª¤" class="headerlink" title="ç®—æ³•æ­¥éª¤"></a>ç®—æ³•æ­¥éª¤</h2><ol><li><p><strong>åˆå§‹åŒ–æ ·æœ¬æ± </strong>ï¼šå…ˆå°†æµä¸­çš„å‰kä¸ªå…ƒç´ æ”¾å…¥æ ·æœ¬æ± ã€‚</p></li><li><p><strong>è¿­ä»£å¤„ç†å…ƒç´ </strong>ï¼šå¯¹äºç¬¬iä¸ªæ–°å…ƒç´ ï¼Œä»¥k&#x2F;içš„æ¦‚ç‡å†³å®šæ˜¯å¦å°†å…¶æ›¿æ¢è¿›æ ·æœ¬æ± ã€‚</p></li><li><p><strong>é€‰æ‹©æ›¿æ¢çš„å…ƒç´ </strong>ï¼šå¦‚æœæ–°å…ƒç´ éœ€è¦è¢«æ›¿æ¢è¿›æ ·æœ¬æ± ï¼Œéšæœºé€‰æ‹©æ ·æœ¬æ± ä¸­çš„ä¸€ä¸ªå…ƒç´ è¿›è¡Œæ›¿æ¢ã€‚</p></li></ol><h2 id="è¯æ˜è¿‡ç¨‹"><a href="#è¯æ˜è¿‡ç¨‹" class="headerlink" title="è¯æ˜è¿‡ç¨‹"></a>è¯æ˜è¿‡ç¨‹</h2><ol><li><p>å‰kä¸ªå…ƒç´ è¢«æ”¾å…¥æ ·æœ¬æ± </p></li><li><p>ç¬¬k+1ä¸ªå…ƒç´ è¢«é€‰ä¸­æ›¿æ¢çš„æ¦‚ç‡æ˜¯k &#x2F; (k + 1)</p></li><li><p>æ­¤æ—¶æ ·æœ¬æ± ä¸­çš„1-kä¸ªå…ƒç´ ä¿ç•™çš„æ¦‚ç‡ï¼š(1 -  k &#x2F; (k + 1)) + (k &#x2F; (k + 1) * (k - 1) &#x2F; k) &#x3D; k &#x2F; (k + 1)ï¼Œå³ æ²¡ä¸­k+1çš„æ¦‚ç‡ + é€‰ä¸­k+1ä½†æ²¡è¢«æ›¿æ¢çš„æ¦‚ç‡</p></li><li><p>ä»è€Œåˆ°k+1æ—¶ï¼Œæ‰€æœ‰å…ƒç´ ä¿ç•™åœ¨æ ·æœ¬æ± ä¸­ç­‰æ¦‚ç‡</p></li></ol><p><img src="/2024/10/12/%E7%AE%97%E6%B3%95/%E6%B0%B4%E5%A1%98%E6%8A%BD%E6%A0%B7%E7%AE%97%E6%B3%95/image-20240913201256934.png" alt="image-20240913201256934"></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getRandomInt</span>(<span class="params">max</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * max);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reservoir_sampling</span>(<span class="params">data, k</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> reservoir = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">    reservoir.<span class="title function_">push</span>(data[i]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = k; i &lt; data.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> j = <span class="title function_">getRandomInt</span>(i);</span><br><span class="line">    <span class="keyword">if</span> (j &lt; k) &#123;</span><br><span class="line">      reservoir[j] = data[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> reservoir;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ç›®çš„&quot;&gt;&lt;a href=&quot;#ç›®çš„&quot; class=&quot;headerlink&quot; title=&quot;ç›®çš„&quot;&gt;&lt;/a&gt;ç›®çš„&lt;/h2&gt;&lt;p&gt;æ°´å¡˜æŠ½æ ·çš„ç›®æ ‡æ˜¯ä»ä¸€ä¸ªå¾ˆå¤§çš„æˆ–æœªçŸ¥å¤§å°çš„æ•°æ®é›†ä¸­éšæœºé€‰å–kä¸ªæ ·æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ç‰¹ç‚¹ï¼šä¸è¦æ±‚ä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰æ•°æ®ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“æ•°æ®æ€»é‡ï¼Œèƒ½ä¿è¯æ¯ä¸ªå…ƒç´ è¢«é€‰ä¸­çš„æ¦‚ç‡ç›¸ç­‰&lt;/p&gt;</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://liang5757.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="ç®—æ³•" scheme="https://liang5757.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>npm script</title>
    <link href="https://liang5757.github.io/2023/10/06/Js/npm-script/"/>
    <id>https://liang5757.github.io/2023/10/06/Js/npm-script/</id>
    <published>2023-10-06T11:27:17.000Z</published>
    <updated>2025-12-07T10:16:59.206Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸²è¡Œ-or-å¹¶è¡Œ"><a href="#ä¸²è¡Œ-or-å¹¶è¡Œ" class="headerlink" title="ä¸²è¡Œ or å¹¶è¡Œ"></a>ä¸²è¡Œ or å¹¶è¡Œ</h2><p>å¹¶è¡Œè·‘å‘½ä»¤ï¼š&amp;ï¼Œåœ¨å‘½ä»¤ç»“å°¾åŠ <code>&amp; wait</code>ï¼Œå¯ä»¥ä½¿ç”¨ctrl cå…³é—­å‘½ä»¤è¡Œæ¥ç»“æŸè¿›ç¨‹<br>ä¸²è¡Œè·‘å‘½ä»¤ï¼š&amp;&amp;</p><h2 id="æ§åˆ¶æ—¥å¿—è¾“å‡º"><a href="#æ§åˆ¶æ—¥å¿—è¾“å‡º" class="headerlink" title="æ§åˆ¶æ—¥å¿—è¾“å‡º"></a>æ§åˆ¶æ—¥å¿—è¾“å‡º</h2><ul><li>â€“silentï¼ˆ-sï¼‰ï¼šè¾“å‡ºå°½å¯èƒ½å°‘çš„æ—¥å¿—</li><li>â€“verboseï¼šæ˜¾ç¤ºå°½å¯èƒ½å¤šçš„çŠ¶æ€ï¼Œæ—¥å¿—çº§åˆ«çš„è¾“å‡ºï¼Œç”¨äºè°ƒè¯•</li></ul><span id="more"></span><h2 id="npmè‡ªåŠ¨è¡¥å…¨"><a href="#npmè‡ªåŠ¨è¡¥å…¨" class="headerlink" title="npmè‡ªåŠ¨è¡¥å…¨"></a>npmè‡ªåŠ¨è¡¥å…¨</h2><blockquote><p>ä¸æ”¯æŒworkspaceçš„ä»“åº“</p></blockquote><p>npmå®˜æ–¹æ”¯æŒè¡¥å…¨ï¼š<a href="https://docs.npmjs.com/cli/v9/commands/npm-completion">npm-completion</a></p><p>ç¬¬ 1 æ­¥ï¼ŒæŠŠ npm completion äº§ç”Ÿçš„å‘½ä»¤æ”¾åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm completion &gt;&gt; ~/.npm-completion.bash</span><br></pre></td></tr></table></figure><p>ç¬¬ 2 æ­¥ï¼Œåœ¨ .bashrc æˆ–è€… .zshrc ä¸­å¼•å…¥è¿™ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[ -f ~/.npm-completion.bash ] &amp;&amp; source ~/.npm-completion.bash;&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[ -f ~/.npm-completion.bash ] &amp;&amp; source ~/.npm-completion.bash;&quot;</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure><p>æœ€åæ‰§è¡Œ <code>source ~/.zshrc</code> æˆ–è€… <code>source ~/.bashrc</code>ï¼Œæ¥è®©è‡ªåŠ¨å®Œæˆç”Ÿæ•ˆã€‚</p><p>ä½¿ç”¨è¡¥å…¨æ–¹å¼ï¼šå°è¯•åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ npm runï¼Œ<strong>ç„¶åé”®å…¥ç©ºæ ¼ï¼ˆç©ºæ ¼å¾ˆé‡è¦ï¼‰</strong>ï¼Œç„¶åé”®å…¥ tab é”®</p><h2 id="ä¸€äº›è·¨å¹³å°çš„ç¬¬ä¸‰æ–¹åº“"><a href="#ä¸€äº›è·¨å¹³å°çš„ç¬¬ä¸‰æ–¹åº“" class="headerlink" title="ä¸€äº›è·¨å¹³å°çš„ç¬¬ä¸‰æ–¹åº“"></a>ä¸€äº›è·¨å¹³å°çš„ç¬¬ä¸‰æ–¹åº“</h2><ul><li><a href="https://github.com/isaacs/rimraf">rimraf</a> æˆ– <a href="https://www.npmjs.com/package/del-cli">del-cli</a>ï¼Œç”¨æ¥åˆ é™¤æ–‡ä»¶å’Œç›®å½•ï¼Œå®ç°ç±»ä¼¼äº <code>rm -rf</code> çš„åŠŸèƒ½ï¼›</li><li><a href="https://www.npmjs.com/package/cpr">cpr</a>ï¼Œç”¨äºæ‹·è´ã€å¤åˆ¶æ–‡ä»¶å’Œç›®å½•ï¼Œå®ç°ç±»ä¼¼äº <code>cp -r</code> çš„åŠŸèƒ½ï¼›</li><li><a href="https://www.npmjs.com/package/make-dir-cli">make-dir-cli</a>ï¼Œç”¨äºåˆ›å»ºç›®å½•ï¼Œå®ç°ç±»ä¼¼äº <code>mkdir -p</code> çš„åŠŸèƒ½ï¼›</li></ul><h3 id="è·¨å¹³å°çš„å¼•ç”¨å˜é‡"><a href="#è·¨å¹³å°çš„å¼•ç”¨å˜é‡" class="headerlink" title="è·¨å¹³å°çš„å¼•ç”¨å˜é‡"></a>è·¨å¹³å°çš„å¼•ç”¨å˜é‡</h3><p>Linux ä¸‹ç›´æ¥å¯ä»¥ç”¨ <code>$npm_package_name</code>ï¼Œè€Œ Windows ä¸‹å¿…é¡»ä½¿ç”¨ <code>%npm_package_name%</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://www.npmjs.com/package/cross-var">cross-var</a> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i cross-var -D</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">-    <span class="string">&quot;cover:open&quot;</span>: <span class="string">&quot;opn http://localhost:<span class="variable">$npm_package_config_port</span>&quot;</span>,</span><br><span class="line">+    <span class="string">&quot;cover:open&quot;</span>: <span class="string">&quot;cross-var opn http://localhost:<span class="variable">$npm_package_config_port</span>&quot;</span>,</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure><p>å¼•å…¥ cross-var ä¹‹åï¼Œå®ƒç«Ÿç„¶ç»™æˆ‘ä»¬å®‰è£…äº† babelï¼Œå¦‚æœæƒ³ä¿æŒä¾èµ–æ›´è½»é‡çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <a href="https://link.juejin.cn/?target=https://www.npmjs.com/package/cross-var-no-babel">cross-var-no-babel</a></p><h3 id="è·¨å¹³å°çš„ç¯å¢ƒå˜é‡"><a href="#è·¨å¹³å°çš„ç¯å¢ƒå˜é‡" class="headerlink" title="è·¨å¹³å°çš„ç¯å¢ƒå˜é‡"></a>è·¨å¹³å°çš„ç¯å¢ƒå˜é‡</h3><p>å› ä¸ºä¸åŒå¹³å°çš„ç¯å¢ƒå˜é‡è¯­æ³•ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://www.npmjs.com/package/cross-env">cross-env</a> æ¥å®ç° npm script çš„è·¨å¹³å°å…¼å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i cross-env -D</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨æ–¹å¼-1"><a href="#ä½¿ç”¨æ–¹å¼-1" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">-    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;NODE_ENV=test mocha tests/&quot;</span>,</span><br><span class="line">+    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;cross-env NODE_ENV=test mocha tests/&quot;</span>,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h2 id="æŠ½ç¦»scriptåˆ°å•ç‹¬æ–‡ä»¶"><a href="#æŠ½ç¦»scriptåˆ°å•ç‹¬æ–‡ä»¶" class="headerlink" title="æŠ½ç¦»scriptåˆ°å•ç‹¬æ–‡ä»¶"></a>æŠ½ç¦»scriptåˆ°å•ç‹¬æ–‡ä»¶</h2><p>å½“ npm script ä¸æ–­ç´¯ç§¯ã€è†¨èƒ€çš„æ—¶å€™ï¼Œå…¨éƒ¨æ”¾åœ¨ package.json é‡Œé¢å¯èƒ½å¹¶ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºè¿™æ ·ä¼šå¯¼è‡´ package.json ç³Ÿä¹±ï¼Œå¯è¯»æ€§é™ä½ã€‚</p><p>å€ŸåŠ© <a href="https://github.com/testdouble/scripty">scripty</a> æˆ‘ä»¬å¯ä»¥å°† npm script å‰¥ç¦»åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œä»è€ŒæŠŠå¤æ‚æ€§éš”åˆ°å•ç‹¬çš„æ¨¡å—é‡Œé¢ï¼Œè®©ä»£ç æ•´ä½“çœ‹èµ·æ¥æ›´åŠ æ¸…æ™°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i scripty -D</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ–¹å¼-2"><a href="#ä½¿ç”¨æ–¹å¼-2" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><p>æ‰§è¡Œ<code>npm run foo:bar</code>ä¼šå‘<code>scripts/foo/bar</code>å¯»æ‰¾å¯æ‰§è¡Œè„šæœ¬å¹¶æ‰§è¡Œ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;foo:bar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;scripty&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="é’©å­"><a href="#é’©å­" class="headerlink" title="é’©å­"></a>é’©å­</h2><p>npm script çš„è®¾è®¡è€…ä¸ºå‘½ä»¤çš„æ‰§è¡Œå¢åŠ äº†ç±»ä¼¼ç”Ÿå‘½å‘¨æœŸçš„æœºåˆ¶ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ <code>pre</code> å’Œ <code>post</code> é’©å­è„šæœ¬</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œè¿è¡Œ npm run test çš„æ—¶å€™ï¼Œåˆ† 3 ä¸ªé˜¶æ®µï¼š</p><ol><li>æ£€æŸ¥ scripts å¯¹è±¡ä¸­æ˜¯å¦å­˜åœ¨ pretest å‘½ä»¤ï¼Œå¦‚æœæœ‰ï¼Œå…ˆæ‰§è¡Œè¯¥å‘½ä»¤ï¼›</li><li>æ£€æŸ¥æ˜¯å¦æœ‰ test å‘½ä»¤ï¼Œæœ‰çš„è¯è¿è¡Œ test å‘½ä»¤ï¼Œæ²¡æœ‰çš„è¯æŠ¥é”™ï¼›</li><li>æ£€æŸ¥æ˜¯å¦å­˜åœ¨ posttest å‘½ä»¤ï¼Œå¦‚æœæœ‰ï¼Œæ‰§è¡Œ posttest å‘½ä»¤ï¼›</li></ol><h2 id="åœ¨-Git-Hooks-ä¸­æ‰§è¡Œ-npm-script"><a href="#åœ¨-Git-Hooks-ä¸­æ‰§è¡Œ-npm-script" class="headerlink" title="åœ¨ Git Hooks ä¸­æ‰§è¡Œ npm script"></a>åœ¨ Git Hooks ä¸­æ‰§è¡Œ npm script</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D husky</span><br></pre></td></tr></table></figure><p>åœ¨package.jsonå¢åŠ </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;precommit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eslint src/**/*.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·ä¼šæ£€æŸ¥åˆ°é¡¹ç›®ä¸­æ‰€æœ‰çš„linté”™è¯¯ï¼Œå¦‚ä½•åªæ£€æŸ¥æäº¤çš„æ–‡ä»¶å‘¢ï¼Ÿ</p><p>éœ€è¦ç”¨åˆ°<a href="https://link.juejin.cn/?target=https://github.com/okonet/lint-staged">lint-staged</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D lint-staged</span><br></pre></td></tr></table></figure><p>package.jsonæ”¹ä¸ºå¦‚ä¸‹ï¼Œå°±å¯ä»¥åªlintæäº¤çš„æ–‡ä»¶å•¦</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;precommit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lint-staged&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;lint-staged&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;src/**/*.js&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eslint&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://juejin.cn/post/6844903479283040269">ç”¨ husky å’Œ lint-staged æ„å»ºè¶…æºœçš„ä»£ç æ£€æŸ¥å·¥ä½œæµ</a></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ä¸²è¡Œ-or-å¹¶è¡Œ&quot;&gt;&lt;a href=&quot;#ä¸²è¡Œ-or-å¹¶è¡Œ&quot; class=&quot;headerlink&quot; title=&quot;ä¸²è¡Œ or å¹¶è¡Œ&quot;&gt;&lt;/a&gt;ä¸²è¡Œ or å¹¶è¡Œ&lt;/h2&gt;&lt;p&gt;å¹¶è¡Œè·‘å‘½ä»¤ï¼š&amp;amp;ï¼Œåœ¨å‘½ä»¤ç»“å°¾åŠ &lt;code&gt;&amp;amp; wait&lt;/code&gt;ï¼Œå¯ä»¥ä½¿ç”¨ctrl cå…³é—­å‘½ä»¤è¡Œæ¥ç»“æŸè¿›ç¨‹&lt;br&gt;ä¸²è¡Œè·‘å‘½ä»¤ï¼š&amp;amp;&amp;amp;&lt;/p&gt;
&lt;h2 id=&quot;æ§åˆ¶æ—¥å¿—è¾“å‡º&quot;&gt;&lt;a href=&quot;#æ§åˆ¶æ—¥å¿—è¾“å‡º&quot; class=&quot;headerlink&quot; title=&quot;æ§åˆ¶æ—¥å¿—è¾“å‡º&quot;&gt;&lt;/a&gt;æ§åˆ¶æ—¥å¿—è¾“å‡º&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;â€“silentï¼ˆ-sï¼‰ï¼šè¾“å‡ºå°½å¯èƒ½å°‘çš„æ—¥å¿—&lt;/li&gt;
&lt;li&gt;â€“verboseï¼šæ˜¾ç¤ºå°½å¯èƒ½å¤šçš„çŠ¶æ€ï¼Œæ—¥å¿—çº§åˆ«çš„è¾“å‡ºï¼Œç”¨äºè°ƒè¯•&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="js" scheme="https://liang5757.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>Vueuseæºç è§£è¯»</title>
    <link href="https://liang5757.github.io/2023/09/10/Js/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/Vueuse%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/"/>
    <id>https://liang5757.github.io/2023/09/10/Js/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/Vueuse%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/</id>
    <published>2023-09-10T08:53:55.000Z</published>
    <updated>2025-12-07T10:16:59.209Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸ä¼šæ”¾apiçš„ç”¨æ³•ï¼Œå»ºè®®å…ˆçœ‹çœ‹æ˜¯æ€ä¹ˆç”¨çš„</p><p>å†™æœ¬ç¯‡æ–‡ç« æ—¶é—´é—´éš”è¾ƒé•¿ï¼Œæ‰€ä»¥ä»£ç ç‰ˆæœ¬ä¸ä¸€</p></blockquote><h2 id="é¡¹ç›®æ¶æ„"><a href="#é¡¹ç›®æ¶æ„" class="headerlink" title="é¡¹ç›®æ¶æ„"></a>é¡¹ç›®æ¶æ„</h2><p>é‡‡ç”¨monorepoçš„å½¢å¼ï¼Œé¡¹ç›®ç›®å½•ä¸‹æœ‰å¤šä¸ªå­é¡¹ç›®ï¼Œä¸‹é¢æ”¾äº†èµ„æ–™é“¾æ¥å’Œå‡ å¤„ç”¨æ³•ï¼Œå…¶ä»–æœ¬æ–‡ä¸å¤šèµ˜è¿°ã€‚</p><p><a href="https://juejin.cn/post/6944877410827370504">ç°ä»£å‰ç«¯å·¥ç¨‹ä¸ºä»€ä¹ˆè¶Šæ¥è¶Šç¦»ä¸å¼€ Monorepo?</a><br><a href="https://www.codeleading.com/article/46915806308/">ä¸ºä»€ä¹ˆä½¿ç”¨pnpmå¯ä»¥å…‰é€Ÿå»ºç«‹å¥½ç”¨çš„monorepoï¼ˆæ¯”yarn&#x2F;lernaæ•ˆç‡é«˜ï¼‰</a><br><a href="https://pnpm.io/zh/workspaces">pnpm workspaceæ–‡æ¡£</a></p><span id="more"></span><p>ä¸ºäº†ä½¿<strong>æ‰€æœ‰å­é¡¹ç›®éƒ½ä½¿ç”¨åŒä¸€ä¸ªä¾èµ–ç‰ˆæœ¬</strong>ï¼Œä½¿ç”¨<a href="https://pnpm.io/zh/package_json#pnpmoverrides">pnpm.overrides</a>é…ç½®ï¼Œå¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;pnpm&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;vue-demi&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.12.1&quot;</span><span class="punctuation">,</span> <span class="comment">// åœ¨postinstallé’©å­ä¸­æ ¹æ®å½“å‰ç¯å¢ƒçš„vueç‰ˆæœ¬ï¼Œè·å–å…¼å®¹vue3å’Œvue2çš„api</span></span><br><span class="line">      <span class="attr">&quot;vite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.6.7&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>åœ¨æ­£å¸¸é…ç½®ä¸‹ï¼Œå¦‚æœç›´æ¥<code>pnpm install</code>å°†ä¼šåœ¨æ¯ä¸ªå­é¡¹ç›®çš„<code>node_modules</code>æœ‰åŒæ ·çš„ä¾èµ–ï¼Œä½†æ˜¯æ‰€æœ‰å­é¡¹ç›®ç›¸åŒçš„ä¾èµ–å…¶å®åªéœ€è¦æå–å‡ºæ¥æ”¾åœ¨æ ¹ç›®å½•çš„<code>node_modules</code>ä¸‹å³å¯ï¼Œå¯é…ç½®å¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;peerDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;@vue/composition-api&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.6.0 || ^3.2.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>è¯¦æƒ…è¯·çœ‹å¦‚ä¸‹é“¾æ¥</p><p><a href="https://www.cnblogs.com/wonyun/p/9692476.html">æ¢è®¨npmä¾èµ–ç®¡ç†ä¹‹peerDependencies</a><br><a href="https://blog.csdn.net/qq_21567385/article/details/121088506">pnpm monorepoä¹‹å¤šç»„ä»¶å®ä¾‹å’ŒpeerDependencieså›°å¢ƒå›æº¯</a><br><a href="https://pnpm.io/zh/how-peers-are-resolved">å¦‚ä½•å¤„ç† peers</a></p><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="unref-refçš„åæ“ä½œ"><a href="#unref-refçš„åæ“ä½œ" class="headerlink" title="unref - refçš„åæ“ä½œ"></a>unref - refçš„åæ“ä½œ</h3><ul><li>å¦‚æœä¼ å…¥ä¸€ä¸ªrefï¼Œè¿”å›å…¶å€¼</li><li>å¦åˆ™åŸæ ·æ”¾å›</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æºç å®ç°</span></span><br><span class="line"><span class="keyword">function</span> unref&lt;T&gt;(<span class="attr">ref</span>: T | <span class="title class_">Ref</span>&lt;T&gt;): T &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">isRef</span>(ref) ? ref.<span class="property">value</span> : ref</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> ä½¿ç”¨ä¾‹å­ï¼šå®ç°ä¸€ä¸ªå“åº”å¼çš„addå‡½æ•°ï¼Œå¯ä»¥ä¼ å…¥<strong>refæˆ–å€¼</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">a</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt; | <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">b</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt; | <span class="built_in">number</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">computed</span>(<span class="function">() =&gt;</span> <span class="title function_">unref</span>(a) + <span class="title function_">unref</span>(b))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="MaybeRefç±»å‹"><a href="#MaybeRefç±»å‹" class="headerlink" title="MaybeRefç±»å‹"></a>MaybeRefç±»å‹</h3><p>vueuseå¤§é‡ä½¿ç”¨<code>MaybeRef</code>æ¥æ”¯æŒ<strong>å¯é€‰æ‹©æ€§çš„å“åº”å¼å‚æ•°</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MaybeRef</span>&lt;T&gt; = <span class="title class_">Ref</span>&lt;T&gt; | T</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„åŠ æ³•å‡½æ•°å°±å¯ä»¥ç®€å†™ä¸º</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"><span class="attr">a</span>: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">number</span>&gt;, <span class="attr">b</span>: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">number</span>&gt;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">computed</span>(<span class="function">() =&gt;</span> <span class="title function_">unref</span>(a) + <span class="title function_">unref</span>(b))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Effectä½œç”¨åŸŸAPI"><a href="#Effectä½œç”¨åŸŸAPI" class="headerlink" title="Effectä½œç”¨åŸŸAPI"></a>Effectä½œç”¨åŸŸAPI</h3><p>Vueå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://v3.cn.vuejs.org/api/effect-scope.html#effectscope">Effect ä½œç”¨åŸŸ API</a></p><p><strong>åŠ¨æœº</strong></p><p>åœ¨Vueçš„setupä¸­ï¼Œå“åº”å¼effectä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™è¢«æ”¶é›†ï¼Œåœ¨å®ä¾‹è¢«å¸è½½çš„æ—¶å€™ï¼Œå“åº”å¼effectå°±ä¼šè‡ªåŠ¨è¢«å–æ¶ˆäº†ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬åœ¨ç»„ä»¶å¤–å†™ä¸€ä¸ªç‹¬ç«‹çš„åŒ…ï¼ˆå°±å¦‚vueuseï¼‰æ—¶ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å–æ¶ˆcomputed &amp; watchçš„å“åº”å¼ä¾èµ–å‘¢ï¼Ÿvue3.2æå‡ºäº†<code>effectScope</code>ï¼Œæ¥ä¸‹æ¥ä»‹ç»ç›¸å…³çš„api</p><h4 id="effectScope"><a href="#effectScope" class="headerlink" title="effectScope"></a>effectScope</h4><p>åˆ©ç”¨<code>effectScope</code>åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸå¯¹è±¡ï¼Œå¦‚ä¸‹é¢æ¥å£å®šä¹‰æ‰€ç¤ºï¼Œ<code>run</code>æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªä½œç”¨åŸŸå¯¹è±¡ä¼šè‡ªåŠ¨æ•è·å‡½æ•°å†…éƒ¨çš„å“åº”å¼effect (ä¾‹å¦‚è®¡ç®—å±æ€§æˆ–ä¾¦å¬å™¨)</p><p><strong>ç±»å‹</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">effectScope</span>(<span class="params"><span class="attr">detached</span>?: <span class="built_in">boolean</span></span>): <span class="title class_">EffectScope</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">EffectScope</span> &#123;</span><br><span class="line">  run&lt;T&gt;(<span class="attr">fn</span>: <span class="function">() =&gt;</span> T): T | <span class="literal">undefined</span> <span class="comment">// å¦‚æœè¿™ä¸ªåŸŸä¸æ´»è·ƒåˆ™ä¸º undefined</span></span><br><span class="line">  <span class="title function_">stop</span>(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scope = <span class="title function_">effectScope</span>()</span><br><span class="line"></span><br><span class="line">scope.<span class="title function_">run</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> doubled = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> counter.<span class="property">value</span> * <span class="number">2</span>)</span><br><span class="line">  <span class="title function_">watch</span>(doubled, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(doubled.<span class="property">value</span>))</span><br><span class="line">  <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Count: &#x27;</span>, doubled.<span class="property">value</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸¢å¼ƒ(dispose) è¯¥ä½œç”¨åŸŸå†…çš„æ‰€æœ‰ effect</span></span><br><span class="line">scope.<span class="title function_">stop</span>()</span><br></pre></td></tr></table></figure><h4 id="getCurrentScope"><a href="#getCurrentScope" class="headerlink" title="getCurrentScope"></a>getCurrentScope</h4><p>å¦‚æœæœ‰ï¼Œåˆ™è¿”å›å½“å‰æ´»è·ƒçš„ <a href="https://v3.cn.vuejs.org/api/effect-scope.html#effectscope">effect ä½œç”¨åŸŸ</a>ã€‚</p><p><strong>ç±»å‹</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getCurrentScope</span>(<span class="params"></span>): <span class="title class_">EffectScope</span> | <span class="literal">undefined</span> </span><br></pre></td></tr></table></figure><h4 id="onScopeDispose"><a href="#onScopeDispose" class="headerlink" title="onScopeDispose"></a>onScopeDispose</h4><p>åœ¨å½“å‰æ´»è·ƒçš„ <a href="https://v3.cn.vuejs.org/api/effect-scope.html#effectscope">effect ä½œç”¨åŸŸ</a>ä¸Šæ³¨å†Œä¸€ä¸ªå¤„ç†å›è°ƒã€‚è¯¥å›è°ƒä¼šåœ¨ç›¸å…³çš„ effect ä½œç”¨åŸŸç»“æŸä¹‹åè¢«è°ƒç”¨ï¼Œåœ¨VCAï¼ˆVue Composition APIï¼‰å‡½æ•°ä¸­å¯ç”¨ä½œ<code>onUnmounted</code>çš„éç»„ä»¶æ›¿ä»£å“ï¼ŒåŒºåˆ«åœ¨äºå…¶å·¥ä½œåœ¨scopeä¸­è€Œä¸æ˜¯ç»„ä»¶å®ä¾‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“å‰ effectScope ç»“æŸåè°ƒç”¨</span></span><br><span class="line"><span class="title function_">onScopeDispose</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, handler)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚æ­¤æŠ½è±¡çš„<code>effectScope</code>åœ¨å°¤å¤§é™ä½å¿ƒæ™ºè´Ÿæ‹…çš„ä¸»å¼ ä¸‹ä¸ºä»€ä¹ˆè¦è¢«æå‡ºå‘¢ï¼Œä¸‹é¢åˆ—äº†ä¸ªå®˜æ–¹rfcä¸­çš„ä¾‹å­</p><p><strong>ç¤ºä¾‹</strong></p><p>åœ¨vueçš„rfcä¸­<a href="https://github.com/vuejs/rfcs/blob/master/active-rfcs/0041-reactivity-effect-scope.md">reactivity-effect-scope</a>æœ‰è¿™æ ·çš„ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœæœ‰ä¸ªç›‘æ§é¼ æ ‡ä½ç½®çš„hookï¼ˆuseMouseï¼‰ï¼Œéœ€è¦ç›‘å¬<code>mousemove</code>äº‹ä»¶ï¼Œå¦‚æœåœ¨å¤šä¸ªç»„ä»¶è°ƒç”¨äº†è¿™ä¸ªhookï¼Œè€Œå†…éƒ¨æ˜¯é€šè¿‡åœ¨<code>onUnmounted</code>é’©å­æ¥ç§»é™¤<code>mousemove</code>ç›‘å¬å™¨ï¼Œ<code>onUnmounted</code>è€¦åˆåœ¨æ¯ä¸ªç»„ä»¶å®ä¾‹ï¼Œåˆ™æ— æ³•ä»¥æ›´æœ‰æ•ˆç‡çš„æ–¹å¼å…±äº«è¿™ä¸ª<code>mousemove</code>ç›‘å¬å™¨ï¼ˆå³ï¼‰</p><p>ä¸ºäº†åšåˆ°åœ¨ç»„ä»¶é—´å…±äº«<code>useMouse</code>çš„å“åº”å¼effectå’Œç›‘å¬å™¨ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥ç®¡ç†scopeå¦‚ä¸‹ï¼ˆè¿™ä¸ªhookä¹Ÿåœ¨vueuseä¸­ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createSharedComposable</span>(<span class="params">composable</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> subscribers = <span class="number">0</span> <span class="comment">// è®¢é˜…è®¡æ•°å™¨ï¼Œæ¯æ¬¡è°ƒç”¨subscribers + 1</span></span><br><span class="line">  <span class="keyword">let</span> state, scope</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">dispose</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (scope &amp;&amp; --subscribers &lt;= <span class="number">0</span>) &#123; </span><br><span class="line">      scope.<span class="title function_">stop</span>()</span><br><span class="line">      state = scope = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">    subscribers++</span><br><span class="line">    <span class="keyword">if</span> (!state) &#123; <span class="comment">// åªåœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºeffectScope</span></span><br><span class="line">      scope = <span class="title function_">effectScope</span>(<span class="literal">true</span>) <span class="comment">// trueä¸ºç‹¬ç«‹çš„scopeä½œç”¨åŸŸ</span></span><br><span class="line">      state = scope.<span class="title function_">run</span>(<span class="function">() =&gt;</span> <span class="title function_">composable</span>(...args))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onScopeDispose</span>(dispose) <span class="comment">// åœ¨å½“å‰æ´»è·ƒçš„effectä½œç”¨åŸŸä¸Šæ³¨å†Œä¸€ä¸ªå›è°ƒ</span></span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°disposeå‡½æ•°çš„å«ä¹‰æ˜¯ï¼Œå½“<strong>æ²¡æœ‰ä¸€ä¸ªç»„ä»¶åœ¨ä½¿ç”¨</strong>å®ƒçš„æ—¶å€™ä¼šæ³¨é”€(dispose)åˆ›å»ºçš„<code>effectScope</code>ï¼Œæˆ‘ä»¬åªéœ€è¦å¦‚ä¸‹æ“ä½œï¼Œå³å¯å¾—åˆ°ä¸€ä¸ª<strong>åœ¨æ‰€æœ‰ç»„ä»¶å…±äº«</strong>çš„<code>useMouse</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useSharedMouse = <span class="title function_">createSharedComposable</span>(useMouse)</span><br></pre></td></tr></table></figure><p>æ›´åŠ è¯¦ç»†çš„å…³äº<code>effectScope</code>çš„è®¨è®ºåœ¨<a href="https://github.com/vuejs/rfcs/pull/212">Reactivityâ€™s <code>effectScope</code> API #212</a></p><p>æœ¬æ¥æ˜¯æ‰“ç®—<strong>å®Œå…¨</strong>æŒ‰ç…§å®˜ç½‘çš„åˆ†ç±»è¿›è¡Œè§£è¯»ï¼Œä½†æ˜¯ç”±äºVCAï¼ˆVue Composition APIï¼‰çš„æ€æƒ³ï¼Œhookè¢«æ‹†çš„å¾ˆç¢å†ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸èƒ½å•çº¯é åˆ†ç±»è¿›è¡Œè§£è¯»ï¼Œæ‰€ä»¥åœ¨è®²æŸä¸ªåˆ†ç±»çš„hookæ—¶ä¹Ÿä¼šå¸¦ä¸Šå…¶ä»–çš„hooksï¼Œæ¥ä¸‹æ¥æ˜¯å¯¹æˆ‘è§‰å¾— å¸¸ç”¨ æˆ–è€… æœ‰å­¦ä¹ åˆ°ä¸œè¥¿ çš„hookæºç è¿›è¡Œè§£è¯» </p><h2 id="State"><a href="#State" class="headerlink" title="State"></a>State</h2><h3 id="createGlobalState"><a href="#createGlobalState" class="headerlink" title="createGlobalState"></a>createGlobalState</h3><blockquote><p>ç”¨æ¥åšæŒ‚ç»„ä»¶å…¬å…±çŠ¶æ€ç®¡ç†</p></blockquote><p>ç®€å•çš„å•ä¾‹æ¨¡å¼å®ç°ï¼Œ<code>effectScope</code>çš„å‚æ•°ä¸ºtrueæ—¶ï¼Œå…¶ä¸ä¼šè¢«çˆ¶scopeæ”¶é›†å’Œå›æ”¶ï¼Œç‹¬ç«‹å­˜åœ¨</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> createGlobalState&lt;T&gt;(</span><br><span class="line">  <span class="attr">stateFactory</span>: <span class="function">() =&gt;</span> T,</span><br><span class="line">): <span class="title class_">CreateGlobalStateReturn</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> initialized = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">state</span>: T</span><br><span class="line">  <span class="keyword">const</span> scope = <span class="title function_">effectScope</span>(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!initialized) &#123;</span><br><span class="line">      state = scope.<span class="title function_">run</span>(stateFactory)!</span><br><span class="line">      initialized = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="useLocalStorage"><a href="#useLocalStorage" class="headerlink" title="useLocalStorage"></a>useLocalStorage</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> useLocalStorage&lt;T <span class="title function_">extends</span>(<span class="built_in">string</span>|<span class="built_in">number</span>|<span class="built_in">boolean</span>|<span class="built_in">object</span>|<span class="literal">null</span>)&gt; (</span><br><span class="line">  <span class="attr">key</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">initialValue</span>: <span class="title class_">MaybeRef</span>&lt;T&gt;,</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">StorageOptions</span>&lt;T&gt; = &#123;&#125;,</span><br><span class="line">): <span class="title class_">RemovableRef</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable language_">window</span> = defaultWindow &#125; = options</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useStorage</span>(key, initialValue, <span class="variable language_">window</span>?.<span class="property">localStorage</span>, options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å°±æ˜¯ç”¨<code>useStorage</code>æ¥å®ç°çš„ï¼Œ<code>useSessionStorage</code>ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹<code>useStorage</code></p><h3 id="useStorage"><a href="#useStorage" class="headerlink" title="useStorage"></a>useStorage</h3><p>åœ¨æµè§ˆå™¨é»˜è®¤çš„Storageä¹‹ä¸Šåƒ<a href="https://github.com/marcuswestin/store.js">store.js</a>ä¸€æ ·å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼ˆåºåˆ—åŒ–ï¼‰ï¼Œå¦åˆ™å¦‚æœå­˜ä¸€ä¸ªå¯¹è±¡åœ¨æµè§ˆå™¨çš„Storageå­˜çš„ä¼šæ˜¯<code>xxx.toString()</code>ä¹‹åçš„å€¼ã€‚ä½†æ˜¯<code>useStorage</code>æ¯”èµ·<a href="https://github.com/marcuswestin/store.js">store.js</a>æ›´è¿›ä¸€æ­¥çš„å¢åŠ äº†å¯¹<code>Map</code>å’Œ<code>Set</code>ç±»å‹çš„æ•°æ®çš„å¤„ç†ï¼ˆ**<code>Map</code>å’Œ<code>Set</code>å­˜åœ¨é»˜è®¤çš„Storageå’Œstore.jséƒ½æ˜¯ç©ºå¯¹è±¡**ï¼‰</p><p>åˆ©ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œå¯¹æ¯ç§æ•°æ®ç±»å‹å®šä¹‰<code>read</code>ã€<code>write</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">StorageSerializers</span>: <span class="title class_">Record</span>&lt;<span class="string">&#x27;boolean&#x27;</span> | <span class="string">&#x27;object&#x27;</span> | <span class="string">&#x27;number&#x27;</span> | <span class="string">&#x27;any&#x27;</span> | <span class="string">&#x27;string&#x27;</span> | <span class="string">&#x27;map&#x27;</span> | <span class="string">&#x27;set&#x27;</span>, <span class="title class_">Serializer</span>&lt;<span class="built_in">any</span>&gt;&gt; = &#123;</span><br><span class="line">  <span class="attr">boolean</span>: &#123;</span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> v === <span class="string">&#x27;true&#x27;</span>,</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">String</span>(v),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">object</span>: &#123;</span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(v),</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(v),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">number</span>: &#123;</span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">Number</span>.<span class="built_in">parseFloat</span>(v),</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">String</span>(v),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">any</span>: &#123;</span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> v,</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">String</span>(v),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">string</span>: &#123;</span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> v,</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">String</span>(v),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">map</span>: &#123; <span class="comment">// mapåºåˆ—åŒ–</span></span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Map</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(v)),</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="title class_">Array</span>.<span class="title function_">from</span>((v <span class="keyword">as</span> <span class="title class_">Map</span>&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt;).<span class="title function_">entries</span>())),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">set</span>: &#123; <span class="comment">// setåºåˆ—åŒ–</span></span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Set</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(v)),</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="title class_">Array</span>.<span class="title function_">from</span>((v <span class="keyword">as</span> <span class="title class_">Set</span>&lt;<span class="built_in">any</span>&gt;).<span class="title function_">entries</span>())),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åˆ¤æ–­ç”¨æˆ·ä¼ å…¥çš„æ•°æ®ç±»å‹ï¼Œè¿›è¡Œé€‰æ‹©å¯¹åº”çš„<code>read</code>ã€<code>write</code>æ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> guessSerializerType&lt;T <span class="title function_">extends</span>(<span class="built_in">string</span> | <span class="built_in">number</span> | <span class="built_in">boolean</span> | <span class="built_in">object</span> | <span class="literal">null</span>)&gt;(<span class="attr">rawInit</span>: T) &#123;</span><br><span class="line">  <span class="keyword">return</span> rawInit == <span class="literal">null</span></span><br><span class="line">    ? <span class="string">&#x27;any&#x27;</span></span><br><span class="line">    : rawInit <span class="keyword">instanceof</span> <span class="title class_">Set</span></span><br><span class="line">      ? <span class="string">&#x27;set&#x27;</span></span><br><span class="line">      : rawInit <span class="keyword">instanceof</span> <span class="title class_">Map</span></span><br><span class="line">        ? <span class="string">&#x27;map&#x27;</span></span><br><span class="line">        : rawInit <span class="keyword">instanceof</span> <span class="title class_">Date</span></span><br><span class="line">          ? <span class="string">&#x27;date&#x27;</span></span><br><span class="line">          : <span class="keyword">typeof</span> rawInit === <span class="string">&#x27;boolean&#x27;</span></span><br><span class="line">            ? <span class="string">&#x27;boolean&#x27;</span></span><br><span class="line">            : <span class="keyword">typeof</span> rawInit === <span class="string">&#x27;string&#x27;</span></span><br><span class="line">              ? <span class="string">&#x27;string&#x27;</span></span><br><span class="line">              : <span class="keyword">typeof</span> rawInit === <span class="string">&#x27;object&#x27;</span></span><br><span class="line">                ? <span class="string">&#x27;object&#x27;</span></span><br><span class="line">                : !<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(rawInit)</span><br><span class="line">                    ? <span class="string">&#x27;number&#x27;</span></span><br><span class="line">                    : <span class="string">&#x27;any&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">type</span> = guessSerializerType&lt;T&gt;(rawInit)</span><br><span class="line"><span class="keyword">const</span> serializer = options.<span class="property">serializer</span> ?? <span class="title class_">StorageSerializers</span>[<span class="keyword">type</span>] <span class="comment">// ç”¨æˆ·è¿˜å¯ä»¥å®šä¹‰è‡ªå·±çš„åºåˆ—åŒ–æ–¹æ³•ï¼Œä½†å¿…é¡»å…·æœ‰readå’Œwriteæ–¹æ³•</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å¯¹æ•°æ®çš„åˆå§‹åŒ–</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">rawInit</span>: T = <span class="title function_">unref</span>(initialValue) <span class="comment">// ç”¨æˆ·ä¼ å…¥çš„åˆå§‹å€¼</span></span><br><span class="line"><span class="keyword">const</span> data = (shallow ? shallowRef : ref)(initialValue) <span class="keyword">as</span> <span class="title class_">Ref</span>&lt;T&gt; <span class="comment">// ç”¨æˆ·å¯ä»¥é…ç½®æ˜¯æµ…å“åº”å¼è¿˜æ˜¯æ·±ï¼Œæœ€åä¼šè¿”å›ç»™ç”¨æˆ·</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!storage)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> rawValue = storage.<span class="title function_">getItem</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (rawValue == <span class="literal">null</span>) &#123; <span class="comment">// å¦‚æœkeyå¯¹åº”çš„å€¼ä¸ºç©ºï¼Œé‚£ä¹ˆæ˜¯é¦–æ¬¡</span></span><br><span class="line">        data.<span class="property">value</span> = rawInit <span class="comment">// åˆå§‹åŒ–å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (writeDefaults &amp;&amp; rawInit !== <span class="literal">null</span>) <span class="comment">// ç”¨æˆ·å¯é…ç½®ï¼ˆwriteDefaultsï¼‰æ˜¯å¦é¦–æ¬¡å­˜å…¥Storage</span></span><br><span class="line">            storage.<span class="title function_">setItem</span>(key, serializer.<span class="title function_">write</span>(rawInit))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        data.<span class="property">value</span> = serializer.<span class="title function_">read</span>(rawValue) <span class="comment">// å¦‚æœStorageå­˜åœ¨å¯¹åº”å€¼ï¼Œåºåˆ—åŒ–è¯»å–</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">onError</span>(e) <span class="comment">// ç”¨æˆ·ä¼ å…¥çš„é”™è¯¯å¤„ç†å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯<strong>æ ¹æ®ç›‘å¬dataçš„å˜åŒ–å­˜å…¥Storage</strong>ï¼Œ<code>watchWithFilter</code>å¯ä»¥çœ‹åšæ˜¯æ–°å¢äº†<code>eventFilter</code>é€‰é¡¹çš„<code>watch</code>ï¼Œåœ¨åæ–‡ä¼šæè¿°ï¼Œä¹Ÿæ˜¯vueuseå¾ˆé‡è¦çš„ä¸€ä¸ªç‰¹æ€§</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watchWithFilter</span>(</span><br><span class="line">    data,</span><br><span class="line">    <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (data.<span class="property">value</span> == <span class="literal">null</span>)</span><br><span class="line">                storage.<span class="title function_">removeItem</span>(key)</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                storage.<span class="title function_">setItem</span>(key, serializer.<span class="title function_">write</span>(data.<span class="property">value</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="title function_">onError</span>(e)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        flush, <span class="comment">// å‡æ˜¯ç”¨æˆ·å¯é…ç½®çš„é€‰é¡¹</span></span><br><span class="line">        deep,</span><br><span class="line">        eventFilter,</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯è§‰å¾—å¾ˆOKäº†ï¼Œä½†ä»æœ‰å·¨éšè”½çš„bugï¼ˆå“ˆå“ˆå“ˆ)ï¼Œä¸ºäº†æ”¯æŒå“åº”å¼çš„å­˜å–Storageï¼Œç”¨äº†refç±»å‹çš„dataï¼Œ<strong>åœ¨åŒæºä¸‹çš„å¤šä¸ªæ ‡ç­¾çš„æƒ…å†µä¸‹ï¼Œå…¶ä¸­ä¸€ä¸ªé¡µé¢å¯¹å¦ä¸€ä¸ªé¡µé¢ç”¨<code>useStorage</code>ä¿®æ”¹äº†æ•°æ®ï¼Œä½†å¦ä¸€ä¸ªé¡µé¢useStorageå†…éƒ¨çš„dataè¿˜æ˜¯åŸæ¥çš„å€¼</strong></p><p>è§£å†³æ–¹å¼ï¼šç›‘å¬<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/StorageEvent">storage</a>äº‹ä»¶ï¼ˆå½“é¡µé¢ä½¿ç”¨çš„storageè¢«å…¶ä»–é¡µé¢ä¿®æ”¹æ—¶ä¼šè§¦å‘ï¼‰</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">read</span>(<span class="params"><span class="attr">event</span>?: <span class="title class_">StorageEvent</span></span>) &#123; <span class="comment">// å°†ä¸Šé¢åˆå§‹åŒ–å€¼çš„é€»è¾‘å°è£…ä¸ºreadå‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (!storage || (event &amp;&amp; event.<span class="property">key</span> !== key))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> rawValue = event ? event.<span class="property">newValue</span> : storage.<span class="title function_">getItem</span>(key)</span><br><span class="line"><span class="comment">// è¯»å€¼çœç•¥...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="title function_">onError</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span> &amp;&amp; listenToStorageChanges) <span class="comment">// ç”¨æˆ·ä¹Ÿå¯ä»¥é…ç½®ï¼ˆlistenToStorageChangesï¼‰ä¸ç›‘å¬</span></span><br><span class="line">    <span class="title function_">useEventListener</span>(<span class="variable language_">window</span>, <span class="string">&#x27;storage&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">read</span>(e), <span class="number">0</span>)) <span class="comment">// é‡æ–°è¯»å–å€¼ç»™data</span></span><br></pre></td></tr></table></figure><h2 id="Browser"><a href="#Browser" class="headerlink" title="Browser"></a>Browser</h2><blockquote><p>æµè§ˆå™¨ç›¸å…³çš„hookï¼ŒåŸºäºwebæš´éœ²çš„apiæ¥å®ç°</p></blockquote><h3 id="å¯é…ç½®å…¨å±€å¯¹è±¡"><a href="#å¯é…ç½®å…¨å±€å¯¹è±¡" class="headerlink" title="å¯é…ç½®å…¨å±€å¯¹è±¡"></a>å¯é…ç½®å…¨å±€å¯¹è±¡</h3><p>Browser hookçš„æºç å¼€å¤´éƒ½æœ‰æˆ–ç±»ä¼¼ä¸‹é¢è¿™ä¸€æ®µ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> defaultWindow = <span class="comment">/* #__PURE__ */</span> isClient ? <span class="variable language_">window</span> : <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> useXXX&lt;T&gt;(<span class="attr">options</span>: <span class="title class_">ConfigurableWindow</span> = &#123;&#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable language_">window</span> = defaultWindow &#125; = options</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">xxx</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨æˆ·å¯ä»¥é…ç½®å½“å‰windowå¯¹è±¡ï¼Œè¿™ç§é…ç½®æ–¹å¼å¯¹äºä½¿ç”¨<strong>iframe</strong>å’Œ<strong>æµ‹è¯•ç¯å¢ƒ</strong>ä¸åŒçš„windowå¯¹è±¡ååˆ†æœ‰ç”¨</p><h3 id="useEventListener"><a href="#useEventListener" class="headerlink" title="useEventListener"></a>useEventListener</h3><p>å…ˆä¸Šä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬çš„<code>useEventListener</code>ï¼Œåˆ©ç”¨VCAï¼Œå°†äº‹ä»¶çš„ç›‘å¬å’Œæ³¨é”€æ”¾åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å¤„ç†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useEventListener</span> (<span class="params">target, listener, options, target = <span class="variable language_">window</span></span>) &#123;</span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    target.<span class="title function_">addEventListener</span>(type, listener, options)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    target.<span class="title function_">removeEventListener</span>(type, listener, options)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œæºç è¿˜æä¾›äº†å½“<code>target</code>çš„ç±»å‹æ˜¯<code>ref</code>æ—¶çš„æƒ…å†µï¼Œä¸ºäº†å‡å°‘ç¯‡å¹…ï¼Œä¸‹é¢çš„ä»£ç åˆ å‡äº†å‚æ•°ä¸ºç©ºçš„è¾¹ç•Œæƒ…å†µ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useEventListener</span>(<span class="params">...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">target</span>: <span class="title class_">MaybeRef</span>&lt;<span class="title class_">EventTarget</span>&gt; | <span class="literal">undefined</span> = defaultWindow;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">event</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">listener</span>: <span class="built_in">any</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">options</span>: <span class="built_in">any</span></span><br><span class="line"></span><br><span class="line">  [target, event, listener, options] = args</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> cleanup = noop</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> stopWatch = <span class="title function_">watch</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">unref</span>(target),</span><br><span class="line">    <span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">cleanup</span>()</span><br><span class="line">      <span class="keyword">if</span> (!el)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      el.<span class="title function_">addEventListener</span>(event, listener, options)</span><br><span class="line"></span><br><span class="line">      cleanup = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        el.<span class="title function_">removeEventListener</span>(event, listener, options)</span><br><span class="line">        cleanup = noop</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">immediate</span>: <span class="literal">true</span>, <span class="attr">flush</span>: <span class="string">&#x27;post&#x27;</span> &#125;, <span class="comment">// ä¸ºä»€ä¹ˆflushæ˜¯postï¼Ÿä¸‹é¢ä¼šè®²è§£</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">stop</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">stopWatch</span>()</span><br><span class="line">    <span class="title function_">cleanup</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">tryOnScopeDispose</span>(stop)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿˜è®¾è®¡äº†è¿”å›stopå‡½æ•°ï¼Œå¯ä»¥è°ƒç”¨useEventListenerè¿”å›çš„å‡½æ•°ç›´æ¥å›æ”¶</span></span><br><span class="line">  <span class="keyword">return</span> stop</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸ºä»€ä¹ˆéœ€è¦æ”¯æŒref-target"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æ”¯æŒref-target" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æ”¯æŒref target"></a>ä¸ºä»€ä¹ˆéœ€è¦æ”¯æŒref target</h4><p>ç”¨<code>unref</code>å¾—åˆ°<code>ref</code>ä¸­çš„domå…ƒç´ ï¼Œç›‘å¬domå…ƒç´ çš„æ”¹å˜ä»¥é‡æ–°ç›‘å¬äº‹ä»¶ï¼Œåº”ç”¨åœºæ™¯å°±æ”¾å®˜ç½‘ä¾‹å­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;cond&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;element&quot;</span>&gt;</span>Div1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span> <span class="attr">ref</span>=<span class="string">&quot;element&quot;</span>&gt;</span>Div2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEventListener &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> element = ref&lt;<span class="title class_">HTMLDivElement</span>&gt;()</span><br><span class="line"><span class="title function_">useEventListener</span>(element, <span class="string">&#x27;keydown&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">key</span>) &#125;)</span><br></pre></td></tr></table></figure><h4 id="ä¸ºä»€ä¹ˆéœ€è¦watchè®¾ç½®flushä¸ºpost"><a href="#ä¸ºä»€ä¹ˆéœ€è¦watchè®¾ç½®flushä¸ºpost" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦watchè®¾ç½®flushä¸ºpost"></a>ä¸ºä»€ä¹ˆéœ€è¦watchè®¾ç½®flushä¸ºpost</h4><p>è¯¦æƒ…è¯·çœ‹<a href="https://github.com/vueuse/vueuse/issues/356">#356 Bug: useEventListener doesnâ€™t work correctly with v-if</a>ï¼Œæ„æ€å°±æ˜¯<a href="https://github.com/vuejs/vue-next/issues/1706#issuecomment-666258948%5C">æ–°ç‰ˆvue</a>çš„<code>watch</code>é»˜è®¤åœ¨æ‰€æœ‰ç»„ä»¶updateå‰æ‰§è¡Œï¼Œé‚£ä¹ˆrefæ²¡æœ‰æ›´æ–°å¯¼è‡´äº‹ä»¶æ²¡æœ‰æ›´æ–°ï¼Œæ‰€ä»¥éœ€è¦åœ¨ç»„ä»¶updateå®Œæ¯•åæ›´æ–°äº‹ä»¶ã€‚</p><h4 id="tryOnScopeDisposeæ˜¯å•¥"><a href="#tryOnScopeDisposeæ˜¯å•¥" class="headerlink" title="tryOnScopeDisposeæ˜¯å•¥"></a>tryOnScopeDisposeæ˜¯å•¥</h4><p>å…ˆåˆ¤æ–­æ˜¯å¦æœ‰æ´»è·ƒçš„effectScopeï¼Œæœ‰çš„è¯ç”¨<code>onScopeDispose</code>åœ¨å…¶ä¸Šæ³¨å†Œfnå›è°ƒ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">tryOnScopeDispose</span>(<span class="params"><span class="attr">fn</span>: <span class="title class_">Fn</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">getCurrentScope</span>()) &#123;</span><br><span class="line">    <span class="title function_">onScopeDispose</span>(fn)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>v10.4.1æ›´æ–°ï¼šæ”¯æŒeventä¼ é€’æ•°ç»„ï¼Œæ–¹ä¾¿æµè§ˆå™¨å…¼å®¹äº‹ä»¶</p><h3 id="useEyeDropper"><a href="#useEyeDropper" class="headerlink" title="useEyeDropper"></a>useEyeDropper</h3><p><code>new window.EyeDropper()</code>å¯ä»¥è·å–<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EyeDropper"><strong>å–è‰²å™¨</strong></a>çš„åŠŸèƒ½</p><h3 id="usePreferredReducedMotion"><a href="#usePreferredReducedMotion" class="headerlink" title="usePreferredReducedMotion"></a>usePreferredReducedMotion</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion">prefers-reduced-motion</a>ç”¨äºæ£€æµ‹ç”¨æˆ·çš„ç³»ç»Ÿæ˜¯å¦è¢«å¼€å¯äº†åŠ¨ç”»å‡å¼±åŠŸèƒ½</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useMediaQuery</span>(<span class="string">&#x27;(prefers-reduced-motion: reduce)&#x27;</span>, options)</span><br></pre></td></tr></table></figure><h3 id="usePreferredContrast"><a href="#usePreferredContrast" class="headerlink" title="usePreferredContrast"></a>usePreferredContrast</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-contrast">prefers-contrast</a>åˆ¤æ–­ç”¨æˆ·å–œæ¬¢ä½•ç§å¯¹æ¯”åº¦ï¼ˆmoreã€lessã€customï¼‰</p><h3 id="useMediaQuery"><a href="#useMediaQuery" class="headerlink" title="useMediaQuery"></a>useMediaQuery</h3><p><code>window.matchMedia(query)</code>è¿”å›<code>MediaQueryList</code>ç±»å‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MediaQueryList</span> <span class="keyword">extends</span> <span class="title class_">EventTarget</span> &#123; <span class="comment">// æµè§ˆå™¨åŸç”Ÿç±»å‹</span></span><br><span class="line">    <span class="keyword">readonly</span> <span class="attr">matches</span>: <span class="built_in">boolean</span>; <span class="comment">// æ˜¯å¦åŒ¹é…</span></span><br><span class="line">    <span class="keyword">readonly</span> <span class="attr">media</span>: <span class="built_in">string</span>;    <span class="comment">// åª’ä½“æŸ¥è¯¢å€¼</span></span><br><span class="line">    <span class="attr">onchange</span>: (<span class="function">(<span class="params"><span class="attr">this</span>: <span class="title class_">MediaQueryList</span>, <span class="attr">ev</span>: <span class="title class_">MediaQueryListEvent</span></span>) =&gt;</span> <span class="built_in">any</span>) | <span class="literal">null</span>; <span class="comment">// åª’ä½“æŸ¥è¯¢æ”¹å˜å›è°ƒ</span></span><br><span class="line"><span class="comment">// äº‹ä»¶ç»‘å®šç›¸å…³...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">mql</span>: <span class="title class_">MediaQueryList</span> = <span class="variable language_">window</span>.<span class="title function_">matchMedia</span>(<span class="string">&#x27;(max-width: 600px)&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="usePermission"><a href="#usePermission" class="headerlink" title="usePermission"></a>usePermission</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/permissions">navigator.permissions</a>å¯ä»¥è·å–ç”¨æˆ·æƒé™ï¼ˆæ‘„åƒå¤´ã€éº¦å…‹é£ç­‰ï¼‰</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isSupported = <span class="title class_">Boolean</span>(navigator &amp;&amp; <span class="string">&#x27;permissions&#x27;</span> <span class="keyword">in</span> navigator)</span><br><span class="line"><span class="keyword">const</span> state = ref&lt;<span class="title class_">PermissionState</span> | <span class="literal">undefined</span>&gt;() <span class="comment">// å­˜æƒé™çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onChange</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (permissionStatus)</span><br><span class="line">        state.<span class="property">value</span> = permissionStatus.<span class="property">state</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    permissionStatus = <span class="keyword">await</span> navigator!.<span class="property">permissions</span>.<span class="title function_">query</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;camera&#x27;</span> <span class="comment">// https://w3c.github.io/permissions/#enumdef-permissionname</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">useEventListener</span>(permissionStatus, <span class="string">&#x27;change&#x27;</span>, onChange) <span class="comment">// æœ‰ä¸‰ä¸ªçŠ¶æ€ denied&quot; | &quot;granted&quot; | &quot;prompt&quot;</span></span><br><span class="line">    <span class="title function_">onChange</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    state.<span class="property">value</span> = <span class="string">&#x27;prompt&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="usePreferredLanguages"><a href="#usePreferredLanguages" class="headerlink" title="usePreferredLanguages"></a>usePreferredLanguages</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/languages">navigator.languages</a>å¯ä»¥è·å–ç”¨æˆ·çš„åå¥½è¯­è¨€ï¼Œå¯ä»¥é€šè¿‡<code>languagechange</code>äº‹ä»¶ç›‘å¬æ”¹å˜</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = ref&lt;<span class="keyword">readonly</span> <span class="built_in">string</span>[]&gt;(navigator.<span class="property">languages</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">useEventListener</span>(<span class="variable language_">window</span>, <span class="string">&#x27;languagechange&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    value.<span class="property">value</span> = navigator.<span class="property">languages</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="useShare"><a href="#useShare" class="headerlink" title="useShare"></a>useShare</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/share">navigator.share</a>å¯ä»¥è¿›è¡Œåˆ†äº«</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isSupported = navigator &amp;&amp; <span class="string">&#x27;canShare&#x27;</span> <span class="keyword">in</span> navigator</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isSupported) &#123;</span><br><span class="line">    granted = navigator.<span class="title function_">canShare</span>(&#123; <span class="comment">// åˆ¤æ–­æ˜¯å¦èƒ½è¢«åˆ†äº«</span></span><br><span class="line">        <span class="attr">title</span>?: <span class="built_in">string</span></span><br><span class="line">        <span class="attr">files</span>?: <span class="title class_">File</span>[]</span><br><span class="line">        <span class="attr">text</span>?: <span class="built_in">string</span></span><br><span class="line">        <span class="attr">url</span>?: <span class="built_in">string</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (granted)</span><br><span class="line">        <span class="keyword">return</span> navigator.<span class="property">share</span>!(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="useWakeLock"><a href="#useWakeLock" class="headerlink" title="useWakeLock"></a>useWakeLock</h3><p> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API">Screen Wake Lock API</a>å¯ä»¥é˜»æ­¢è®¾å¤‡å˜æš—æˆ–é”å±</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isSupported = navigator &amp;&amp; <span class="string">&#x27;wakeLock&#x27;</span> <span class="keyword">in</span> navigator</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params"><span class="attr">type</span>: <span class="title class_">WakeLockType</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isSupported) <span class="keyword">return</span></span><br><span class="line">    wakeLock = <span class="keyword">await</span> navigator.<span class="property">wakeLock</span>.<span class="title function_">request</span>(<span class="keyword">type</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">release</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isSupported || !wakeLock) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">await</span> wakeLock.<span class="title function_">release</span>() <span class="comment">// é‡Šæ”¾WakeLockSentinel</span></span><br><span class="line">    wakeLock = <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="useVibrate"><a href="#useVibrate" class="headerlink" title="useVibrate"></a>useVibrate</h3><p> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Vibration_API">Vibration API</a>å¯ä»¥ä½¿è®¾å¤‡æŒ¯åŠ¨</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="title function_">vibrate</span>([<span class="number">200</span>, <span class="number">100</span>, <span class="number">200</span>]); <span class="comment">// è®¾å¤‡æŒ¯åŠ¨ 200 msï¼Œç„¶åæš‚åœ 100 msï¼Œç„¶åå†æ¬¡æŒ¯åŠ¨è®¾å¤‡ 200 ms</span></span><br><span class="line">navigator.<span class="title function_">vibrate</span>(<span class="number">0</span>); <span class="comment">// åœæ­¢æŒ¯åŠ¨</span></span><br></pre></td></tr></table></figure><h3 id="useWebNotification"><a href="#useWebNotification" class="headerlink" title="useWebNotification"></a>useWebNotification</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/notification">Notification</a>å¯ä»¥ç»™ç”¨æˆ·å‘é€æ¶ˆæ¯</p><h3 id="useFullscreen"><a href="#useFullscreen" class="headerlink" title="useFullscreen"></a>useFullscreen</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fullscreen_API">Fullscreen_API</a>ç”¨ä»¥æ§åˆ¶å…¨å±å±•ç¤ºï¼Œè™½ç„¶å¸¸è§ï¼Œä½†æ˜¯çœ‹æºç å¯¹å…¼å®¹æ€§æœ‰äº†å¤šä¸€å±‚è€ƒè™‘</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯·æ±‚å…¨å±</span></span><br><span class="line"><span class="keyword">const</span> requestMethod = computed&lt;<span class="string">&#x27;requestFullscreen&#x27;</span> | <span class="literal">undefined</span>&gt;(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="string">&#x27;requestFullscreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;webkitRequestFullscreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;webkitEnterFullscreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;webkitEnterFullScreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;webkitRequestFullScreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;mozRequestFullScreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;msRequestFullscreen&#x27;</span>,</span><br><span class="line">  ].<span class="title function_">find</span>(<span class="function"><span class="params">m</span> =&gt;</span> (<span class="variable language_">document</span> &amp;&amp; m <span class="keyword">in</span> <span class="variable language_">document</span>) || (targetRef.<span class="property">value</span> &amp;&amp; m <span class="keyword">in</span> targetRef.<span class="property">value</span>)) <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€€å‡ºå…¨å±</span></span><br><span class="line"><span class="keyword">const</span> exitMethod = computed&lt;<span class="string">&#x27;exitFullscreen&#x27;</span> | <span class="literal">undefined</span>&gt;(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="string">&#x27;exitFullscreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;webkitExitFullscreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;webkitExitFullScreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;webkitCancelFullScreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;mozCancelFullScreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;msExitFullscreen&#x27;</span>,</span><br><span class="line">  ].<span class="title function_">find</span>(<span class="function"><span class="params">m</span> =&gt;</span> (<span class="variable language_">document</span> &amp;&amp; m <span class="keyword">in</span> <span class="variable language_">document</span>) || (targetRef.<span class="property">value</span> &amp;&amp; m <span class="keyword">in</span> targetRef.<span class="property">value</span>)) <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰æ˜¯å¦å¤„äºå…¨å±çŠ¶æ€çš„åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">const</span> fullscreenEnabled = computed&lt;<span class="string">&#x27;fullscreenEnabled&#x27;</span> | <span class="literal">undefined</span>&gt;(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="string">&#x27;fullScreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;webkitIsFullScreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;webkitDisplayingFullscreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;mozFullScreen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;msFullscreenElement&#x27;</span>,</span><br><span class="line">  ].<span class="title function_">find</span>(<span class="function"><span class="params">m</span> =&gt;</span> (<span class="variable language_">document</span> &amp;&amp; m <span class="keyword">in</span> <span class="variable language_">document</span>) || (targetRef.<span class="property">value</span> &amp;&amp; m <span class="keyword">in</span> targetRef.<span class="property">value</span>)) <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å½“å‰å…¨å±å…ƒç´ çš„æ–¹æ³•å</span></span><br><span class="line"><span class="keyword">const</span> fullscreenElementMethod = [</span><br><span class="line">  <span class="string">&#x27;fullscreenElement&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;webkitFullscreenElement&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;mozFullScreenElement&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;msFullscreenElement&#x27;</span>,</span><br><span class="line">].<span class="title function_">find</span>(<span class="function"><span class="params">m</span> =&gt;</span> (<span class="variable language_">document</span> &amp;&amp; m <span class="keyword">in</span> <span class="variable language_">document</span>)) <span class="keyword">as</span> <span class="string">&#x27;fullscreenElement&#x27;</span> | <span class="literal">undefined</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨é€‚é…å™¨çš„æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼Œ<code>target[requestMethod.value]()</code></p><p>ä¸‹é¢æ˜¯ä¸åŒæµè§ˆå™¨ç›‘å¬å…¨å±€å˜åŒ–çš„äº‹ä»¶å</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> eventHandlers = [</span><br><span class="line">  <span class="string">&#x27;fullscreenchange&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;webkitfullscreenchange&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;webkitendfullscreen&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;mozfullscreenchange&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;MSFullscreenChange&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// useEventListeneræ”¯æŒä¼ æ•°ç»„</span></span><br><span class="line"><span class="title function_">useEventListener</span>(<span class="function">() =&gt;</span> <span class="title function_">unrefElement</span>(targetRef), eventHandlers, handlerCallback, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure><h2 id="Sensors"><a href="#Sensors" class="headerlink" title="Sensors"></a>Sensors</h2><h3 id="onStartTyping"><a href="#onStartTyping" class="headerlink" title="onStartTyping"></a>onStartTyping</h3><p>åœ¨å¼€å§‹è¾“å…¥çš„æ—¶å€™æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æ‹¿æ¥åšåˆ°<strong>ä¸ç®¡ç¼–è¾‘å™¨æ˜¯å¦èšç„¦ï¼Œåªè¦è¾“å…¥å°±èšç„¦åˆ°ç¼–è¾‘å™¨å¹¶è¾“å…¥</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">onStartTyping</span>(<span class="params"><span class="attr">callback</span>: (event: KeyboardEvent) =&gt; <span class="built_in">void</span>, <span class="attr">options</span>: <span class="title class_">ConfigurableDocument</span> = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable language_">document</span> = defaultDocument &#125; = options</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">keydown</span> = (<span class="params"><span class="attr">event</span>: <span class="title class_">KeyboardEvent</span></span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">isTypedCharValid</span>(event) <span class="comment">// æ£€æµ‹æ˜¯å¦æ˜¯æœ‰æ•ˆè¾“å…¥ 0...9 A...Z a...z</span></span><br><span class="line">      &amp;&amp; <span class="title function_">callback</span>(event)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>)</span><br><span class="line">    <span class="title function_">useEventListener</span>(<span class="variable language_">document</span>, <span class="string">&#x27;keydown&#x27;</span>, keydown, &#123; <span class="attr">passive</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šè¿˜éœ€è¦åšä¸€ç‚¹ï¼Œå¦‚æœå·²ç»èšç„¦åˆ°<code>non-editable elements</code>ï¼Œé‚£ä¹ˆå°±ä¸æ‰§è¡Œï¼Œå¦‚ä½•æ£€æµ‹<code>non-editable elements</code>å‘¢ï¼Œå¦‚ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isFocusedElementEditable</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; activeElement, body &#125; = <span class="variable language_">document</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!activeElement)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (activeElement === body)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (activeElement.<span class="property">tagName</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;INPUT&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;TEXTAREA&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">return</span> activeElement.<span class="title function_">hasAttribute</span>(<span class="string">&#x27;contenteditable&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="useMagicKeys"><a href="#useMagicKeys" class="headerlink" title="useMagicKeys"></a>useMagicKeys</h3><p>æ°å¦‚å…¶åï¼Œ<strong>magic</strong>ï¼Œå…ˆä¸Šç”¨æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; space, shift &#125; = <span class="title function_">useMagicKeys</span>()</span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>(space, <span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (v)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;space has been pressed&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åˆæ²¡ä¼ å‚ï¼Œä»–æ€ä¹ˆç›‘å¬åˆ°æˆ‘è¦çš„<code>space</code>å’Œ<code>shift</code>ï¼Œéš¾ä¸æˆä»–è¿”å›äº†æ‰€æœ‰é”®ï¼Ÿé‚£å½“ç„¶ä¸æ˜¯ï¼Œä¸Šæºç ï¼ˆæŠ½ç¦»äº†å…³é”®é€»è¾‘ï¼‰</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useMagicKeys</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">UseMagicKeysOptions</span>&lt;<span class="built_in">boolean</span>&gt; = &#123;&#125;</span>): <span class="built_in">any</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> current = <span class="title function_">reactive</span>(<span class="keyword">new</span> <span class="title class_">Set</span>&lt;<span class="built_in">string</span>&gt;())</span><br><span class="line">  <span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="title function_">toJSON</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> &#123;&#125; &#125;,</span><br><span class="line">    current,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">refs</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt; = useReactive ? <span class="title function_">reactive</span>(obj) : obj</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">useEventListener</span>(target, <span class="string">&#x27;keydown&#x27;</span>, <span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">KeyboardEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">updateRefs</span>(e, <span class="literal">true</span>) <span class="comment">// æ›´æ–°æŒ‰ä¸‹çš„é”®åˆ°refsï¼Œé”®ä¸ºe.key?.toLowerCase()ï¼Œå€¼ä¸ºtrue</span></span><br><span class="line">  &#125;, &#123; passive &#125;)</span><br><span class="line">    </span><br><span class="line">  <span class="title function_">useEventListener</span>(target, <span class="string">&#x27;keyup&#x27;</span>, <span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">KeyboardEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">updateRefs</span>(e, <span class="literal">false</span>) <span class="comment">// æ›´æ–°æŒ‰ä¸‹çš„é”®åˆ°refsï¼Œé”®ä¸ºe.key?.toLowerCase()ï¼Œå€¼ä¸ºfalse</span></span><br><span class="line">  &#125;, &#123; passive &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(</span><br><span class="line">    refs,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="title function_">get</span>(<span class="params">target, prop, rec</span>) &#123;</span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span> (!(prop <span class="keyword">in</span> refs)) &#123;</span><br><span class="line">          <span class="comment">// åˆå§‹å°†å¯¹åº”çš„é”®è®¾ä¸ºfalseï¼Œå¦‚&#x27;shift&#x27;</span></span><br><span class="line">          refs[prop] = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> r = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, prop, rec)</span><br><span class="line">        <span class="keyword">return</span> useReactive ? <span class="title function_">toValue</span>(r) : r</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> proxy <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™æ ·refsåªå­˜äº†å–çš„é”®çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯æ‰€æœ‰é”®çš„çŠ¶æ€</p><h3 id="usePageLeave"><a href="#usePageLeave" class="headerlink" title="usePageLeave"></a>usePageLeave</h3><p>ç”¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MouseEvent/relatedTarget">MouseEvent.relatedTarget</a>æ£€æµ‹æ˜¯å¦ç¦»å¼€å±å¹•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">usePageLeave</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">ConfigurableWindow</span> = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params"><span class="attr">event</span>: <span class="title class_">MouseEvent</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">from</span> = event.<span class="property">relatedTarget</span> || event.<span class="property">toElement</span> <span class="comment">// å¦‚æœä¸ºnullï¼Œåˆ™ç§»å‡ºå±å¹•</span></span><br><span class="line">    isLeft.<span class="property">value</span> = !<span class="keyword">from</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>) &#123;</span><br><span class="line">    <span class="title function_">useEventListener</span>(<span class="variable language_">window</span>, <span class="string">&#x27;mouseout&#x27;</span>, handler, &#123; <span class="attr">passive</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    <span class="title function_">useEventListener</span>(<span class="variable language_">window</span>.<span class="property">document</span>, <span class="string">&#x27;mouseleave&#x27;</span>, handler, &#123; <span class="attr">passive</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    <span class="title function_">useEventListener</span>(<span class="variable language_">window</span>.<span class="property">document</span>, <span class="string">&#x27;mouseenter&#x27;</span>, handler, &#123; <span class="attr">passive</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> isLeft</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="useSpeechSynthesis"><a href="#useSpeechSynthesis" class="headerlink" title="useSpeechSynthesis"></a>useSpeechSynthesis</h3><p>åˆ©ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis">SpeechSynthesis</a>æ¥åšåˆ°è¯­éŸ³é˜…è¯»</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useSpeechSynthesis</span>(<span class="params"><span class="attr">text</span>: <span class="title class_">MaybeRefOrGetter</span>&lt;<span class="built_in">string</span>&gt;, <span class="attr">options</span>: <span class="title class_">UseSpeechSynthesisOptions</span> = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> synth = <span class="variable language_">window</span> &amp;&amp; (<span class="variable language_">window</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="property">speechSynthesis</span> <span class="keyword">as</span> <span class="title class_">SpeechSynthesis</span>;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">bindEventsForUtterance</span> = (<span class="params"><span class="attr">utterance</span>: <span class="title class_">SpeechSynthesisUtterance</span></span>) =&gt; &#123;</span><br><span class="line">    utterance.<span class="property">lang</span> = <span class="title function_">toValue</span>(lang)</span><br><span class="line">    utterance.<span class="property">voice</span> = <span class="title function_">toValue</span>(options.<span class="property">voice</span>) || <span class="literal">null</span></span><br><span class="line">    utterance.<span class="property">pitch</span> = <span class="title function_">toValue</span>(pitch)</span><br><span class="line">    utterance.<span class="property">rate</span> = <span class="title function_">toValue</span>(rate)</span><br><span class="line">    utterance.<span class="property">volume</span> = volume</span><br><span class="line"></span><br><span class="line">    utterance.<span class="property">onstart</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      isPlaying.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">      status.<span class="property">value</span> = <span class="string">&#x27;play&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    utterance.<span class="property">onpause</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      isPlaying.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">      status.<span class="property">value</span> = <span class="string">&#x27;pause&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    utterance.<span class="property">onresume</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      isPlaying.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">      status.<span class="property">value</span> = <span class="string">&#x27;play&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    utterance.<span class="property">onend</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      isPlaying.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">      status.<span class="property">value</span> = <span class="string">&#x27;end&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    utterance.<span class="property">onerror</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">      error.<span class="property">value</span> = event</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> utterance = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    isPlaying.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    status.<span class="property">value</span> = <span class="string">&#x27;init&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> newUtterance = <span class="keyword">new</span> <span class="title class_">SpeechSynthesisUtterance</span>(spokenText.<span class="property">value</span>)</span><br><span class="line">    <span class="title function_">bindEventsForUtterance</span>(newUtterance)</span><br><span class="line">    <span class="keyword">return</span> newUtterance</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">speak</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    synth!.<span class="title function_">cancel</span>()</span><br><span class="line">    utterance &amp;&amp; synth!.<span class="title function_">speak</span>(utterance.<span class="property">value</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">stop</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    synth!.<span class="title function_">cancel</span>()</span><br><span class="line">    isPlaying.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">tryOnScopeDispose</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    isPlaying.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h2><h3 id="useTransition"><a href="#useTransition" class="headerlink" title="useTransition"></a>useTransition</h3><p><strong>å¯é…ç½®é¡¹</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">CubicBezierPoints</span> = [<span class="built_in">number</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, <span class="built_in">number</span>]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">EasingFunction</span> = <span class="function">(<span class="params"><span class="attr">n</span>: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useTransition</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">source</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span> | <span class="built_in">number</span>[]&gt; | <span class="title class_">MaybeRef</span>&lt;<span class="built_in">number</span>&gt;[],</span></span><br><span class="line"><span class="params">  <span class="attr">options</span>: <span class="title class_">TransitionOptions</span> = &#123;&#125;,</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">ComputedRef</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="comment">// æ—¶é—´ç›¸å…³å•ä½å‡ä¸ºms</span></span><br><span class="line">    delay = <span class="number">0</span>,           <span class="comment">// delay åæ‰§è¡Œ</span></span><br><span class="line">    disabled = <span class="literal">false</span>,    <span class="comment">// æ˜¯å¦å…³é—­</span></span><br><span class="line">    duration = <span class="number">1000</span>,     <span class="comment">// æŒç»­æ—¶é—´</span></span><br><span class="line">    onFinished = noop,   <span class="comment">// å®Œæˆåæ‰§è¡Œ</span></span><br><span class="line">    onStarted = noop,    <span class="comment">// å¼€å§‹æ—¶æ‰§è¡Œ</span></span><br><span class="line">    transition = linear, <span class="comment">// è½¬åŒ–ç®—æ³• MaybeRef&lt;EasingFunction | CubicBezierPoints&gt;ï¼Œé»˜è®¤å€¼æ˜¯ x =&gt; x</span></span><br><span class="line">  &#125; = options</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é¢„å¤„ç†</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useTransition</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">source</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span> | <span class="built_in">number</span>[]&gt; | <span class="title class_">MaybeRef</span>&lt;<span class="built_in">number</span>&gt;[],</span></span><br><span class="line"><span class="params">  <span class="attr">options</span>: <span class="title class_">TransitionOptions</span> = &#123;&#125;,</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">ComputedRef</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="comment">// å¯é…ç½®é¡¹</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºå½“å‰çš„è¿‡æ¸¡å‡½æ•°ï¼Œå¦‚æœç”¨æˆ·è‡ªå®šä¹‰äº†è¿‡æ¸¡å‡½æ•°åˆ™ä¸åšå¤„ç†ï¼Œå¦åˆ™æ ¹æ®è´èµ›å°”æ›²çº¿å€¼åˆ›å»ºè¿‡æ¸¡å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> currentTransition = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> t = <span class="title function_">unref</span>(transition)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isFunction</span>(t) ? t : <span class="title function_">createEasingFunction</span>(t)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç”¨unrefå¤„ç†sourceå‚æ•°ï¼Œå¦‚æœsourceæ˜¯æ•°ç»„åˆ™ä¾æ¬¡unref</span></span><br><span class="line">  <span class="keyword">const</span> sourceValue = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> s = unref&lt;<span class="built_in">number</span> | <span class="title class_">MaybeRef</span>&lt;<span class="built_in">number</span>&gt;[]&gt;(source)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isNumber</span>(s) ? s : s.<span class="title function_">map</span>(unref) <span class="keyword">as</span> <span class="built_in">number</span>[]</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è§„æ ¼åŒ–sourceï¼Œæ•´æˆæ•°ç»„</span></span><br><span class="line">  <span class="keyword">const</span> sourceVector = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> <span class="title function_">isNumber</span>(sourceValue.<span class="property">value</span>) ? [sourceValue.<span class="property">value</span>] : sourceValue.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè¿‡æ¸¡å‡½æ•°ï¼Œçº¯æ•°å­¦</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createEasingFunction</span>(<span class="params">[p0, p1, p2, p3]: <span class="title class_">CubicBezierPoints</span></span>): <span class="title class_">EasingFunction</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">a</span> = (<span class="params"><span class="attr">a1</span>: <span class="built_in">number</span>, <span class="attr">a2</span>: <span class="built_in">number</span></span>) =&gt; <span class="number">1</span> - <span class="number">3</span> * a2 + <span class="number">3</span> * a1</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">b</span> = (<span class="params"><span class="attr">a1</span>: <span class="built_in">number</span>, <span class="attr">a2</span>: <span class="built_in">number</span></span>) =&gt; <span class="number">3</span> * a2 - <span class="number">6</span> * a1</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">c</span> = (<span class="params"><span class="attr">a1</span>: <span class="built_in">number</span></span>) =&gt; <span class="number">3</span> * a1</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">calcBezier</span> = (<span class="params"><span class="attr">t</span>: <span class="built_in">number</span>, <span class="attr">a1</span>: <span class="built_in">number</span>, <span class="attr">a2</span>: <span class="built_in">number</span></span>) =&gt; ((<span class="title function_">a</span>(a1, a2) * t + <span class="title function_">b</span>(a1, a2)) * t + <span class="title function_">c</span>(a1)) * t</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getSlope</span> = (<span class="params"><span class="attr">t</span>: <span class="built_in">number</span>, <span class="attr">a1</span>: <span class="built_in">number</span>, <span class="attr">a2</span>: <span class="built_in">number</span></span>) =&gt; <span class="number">3</span> * <span class="title function_">a</span>(a1, a2) * t * t + <span class="number">2</span> * <span class="title function_">b</span>(a1, a2) * t + <span class="title function_">c</span>(a1)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getTforX</span> = (<span class="params"><span class="attr">x</span>: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> aGuessT = x</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">      <span class="keyword">const</span> currentSlope = <span class="title function_">getSlope</span>(aGuessT, p0, p2)</span><br><span class="line">      <span class="keyword">if</span> (currentSlope === <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> aGuessT</span><br><span class="line">      <span class="keyword">const</span> currentX = <span class="title function_">calcBezier</span>(aGuessT, p0, p2) - x</span><br><span class="line">      aGuessT -= currentX / currentSlope</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> aGuessT</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params"><span class="attr">x</span>: <span class="built_in">number</span></span>) =&gt;</span> p0 === p1 &amp;&amp; p2 === p3 ? x : <span class="title function_">calcBezier</span>(<span class="title function_">getTforX</span>(x), p1, p3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æä¾›äº†å‡ ç§è¿‡æ¸¡é¢„è®¾</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">TransitionPresets</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">CubicBezierPoints</span> | <span class="title class_">EasingFunction</span>&gt; = &#123;</span><br><span class="line">  <span class="attr">easeInSine</span>: [<span class="number">0.12</span>, <span class="number">0</span>, <span class="number">0.39</span>, <span class="number">0</span>],</span><br><span class="line">  <span class="attr">easeOutSine</span>: [<span class="number">0.61</span>, <span class="number">1</span>, <span class="number">0.88</span>, <span class="number">1</span>],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¦æƒ…å¯ä»¥çœ‹ <a href="https://easings.net/cn#">ç¼“åŠ¨å‡½æ•°</a>ã€ <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/easing-function#easing_functions">MDNï¼šç¼“åŠ¨å‡½æ•°</a></p><p><strong>å…³é”®é€»è¾‘</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> outputVector = <span class="title function_">ref</span>(sourceVector.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">0</span>)) <span class="comment">// ç”¨ä»¥å­˜å‚¨è¾“å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿‡æ¸¡ä¸»æµç¨‹ï¼Œå¯ä»¥æš‚åœ</span></span><br><span class="line"><span class="keyword">const</span> &#123; resume, pause &#125; = <span class="title function_">useRafFn</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// å¯ä»¥æš‚åœã€æ¢å¤çš„ requestAnimationFrame</span></span><br><span class="line">  <span class="keyword">const</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  <span class="keyword">const</span> progress = <span class="title function_">clamp</span>(<span class="number">1</span> - ((endAt - now) / currentDuration), <span class="number">0</span>, <span class="number">1</span>) <span class="comment">// è¿‡æ¸¡è¿›åº¦ï¼Œclampå°†å€¼é™åˆ¶åœ¨0-1ä¹‹é—´</span></span><br><span class="line"></span><br><span class="line">  outputVector.<span class="property">value</span> = startVector.<span class="title function_">map</span>(<span class="function">(<span class="params">val, i</span>) =&gt;</span> val + ((diffVector[i] ?? <span class="number">0</span>) * currentTransition.<span class="title function_">value</span>(progress))) <span class="comment">// æ›´æ–°output</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (progress &gt;= <span class="number">1</span>) &#123; <span class="comment">// å®Œæˆè¿‡æ¸¡</span></span><br><span class="line">    <span class="title function_">pause</span>() <span class="comment">// æš‚åœ requestAnimationFrame</span></span><br><span class="line">    <span class="title function_">onFinished</span>() <span class="comment">// æ‰§è¡Œoptionsä¸­çš„å®Œæˆå›è°ƒ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, &#123; <span class="attr">immediate</span>: <span class="literal">false</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> timeout = <span class="title function_">useTimeoutFn</span>(start, delay, &#123; <span class="attr">immediate</span>: <span class="literal">false</span> &#125;) <span class="comment">// delayæ¯«ç§’åæ‰§è¡Œstartå‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">start</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">pause</span>() <span class="comment">// æš‚åœ è¿‡æ¸¡</span></span><br><span class="line"></span><br><span class="line">  currentDuration = <span class="title function_">unref</span>(duration)</span><br><span class="line">  diffVector = outputVector.<span class="property">value</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">n, i</span>) =&gt;</span> (sourceVector.<span class="property">value</span>[i] ?? <span class="number">0</span>) - (outputVector.<span class="property">value</span>[i] ?? <span class="number">0</span>)) <span class="comment">// åˆå§‹å€¼å’Œå½“å‰å€¼çš„diff</span></span><br><span class="line">  startVector = outputVector.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">0</span>) <span class="comment">// æ‹·è´åˆå§‹å€¼</span></span><br><span class="line">  startAt = <span class="title class_">Date</span>.<span class="title function_">now</span>() <span class="comment">// å¼€å§‹æ—¶é—´</span></span><br><span class="line">  endAt = startAt + currentDuration <span class="comment">// ç»“æŸæ—¶é—´ï¼Œç”¨åœ¨è®¡ç®—progress</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">resume</span>() <span class="comment">// å¼€å§‹è¿‡æ¸¡</span></span><br><span class="line">  <span class="title function_">onStarted</span>() <span class="comment">// æ‰§è¡Œoptionsä¸­çš„å¼€å§‹å›è°ƒ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>(sourceVector, <span class="function">() =&gt;</span> &#123; <span class="comment">// ç›‘å¬sourceVectorçš„å˜åŒ–</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">unref</span>(disabled)) &#123; <span class="comment">// å¦‚æœæš‚åœè¿‡æ¸¡ï¼Œå°†è¾“å‡ºè¿˜åŸå›åˆå§‹å€¼</span></span><br><span class="line">    outputVector.<span class="property">value</span> = sourceVector.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">unref</span>(delay) &lt;= <span class="number">0</span>) <span class="title function_">start</span>() <span class="comment">// å¦‚æœæ²¡æœ‰å»¶è¿Ÿï¼Œåˆ™å¼€å§‹è¿‡æ¸¡</span></span><br><span class="line">    <span class="keyword">else</span> timeout.<span class="title function_">start</span>() <span class="comment">// å¦‚æœæœ‰å»¶è¿Ÿï¼Œåˆ™å¼€å§‹ä¸Šé¢åˆ›å»ºå¥½çš„timeout</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> targetVector = <span class="title function_">unref</span>(disabled) ? sourceVector : outputVector <span class="comment">// å¦‚æœæš‚åœè¿‡æ¸¡ï¼Œå°†è¾“å‡ºè¿˜åŸå›åˆå§‹å€¼</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">isNumber</span>(sourceValue.<span class="property">value</span>) ? targetVector.<span class="property">value</span>[<span class="number">0</span>] : targetVector.<span class="property">value</span> <span class="comment">// ä¸ºå€¼è§£å¼€æ•°ç»„åŒ…è£…ï¼Œæ•°ç»„åŸæ ·è¿”å›</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Sound"><a href="#Sound" class="headerlink" title="@Sound"></a>@Sound</h2><p>å¯ä»¥ç®€å•çš„è®©ä½ çš„ç½‘ç«™å¸¦ä¸Šå£°éŸ³</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> buttonSfx <span class="keyword">from</span> <span class="string">&#x27;../assets/sounds/button.mp3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; play &#125; = <span class="title function_">useSound</span>(buttonSfx)</span><br></pre></td></tr></table></figure><p>demoï¼š<a href="https://sound.vueuse.org/">https://sound.vueuse.org/</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä¸ä¼šæ”¾apiçš„ç”¨æ³•ï¼Œå»ºè®®å…ˆçœ‹çœ‹æ˜¯æ€ä¹ˆç”¨çš„&lt;/p&gt;
&lt;p&gt;å†™æœ¬ç¯‡æ–‡ç« æ—¶é—´é—´éš”è¾ƒé•¿ï¼Œæ‰€ä»¥ä»£ç ç‰ˆæœ¬ä¸ä¸€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;é¡¹ç›®æ¶æ„&quot;&gt;&lt;a href=&quot;#é¡¹ç›®æ¶æ„&quot; class=&quot;headerlink&quot; title=&quot;é¡¹ç›®æ¶æ„&quot;&gt;&lt;/a&gt;é¡¹ç›®æ¶æ„&lt;/h2&gt;&lt;p&gt;é‡‡ç”¨monorepoçš„å½¢å¼ï¼Œé¡¹ç›®ç›®å½•ä¸‹æœ‰å¤šä¸ªå­é¡¹ç›®ï¼Œä¸‹é¢æ”¾äº†èµ„æ–™é“¾æ¥å’Œå‡ å¤„ç”¨æ³•ï¼Œå…¶ä»–æœ¬æ–‡ä¸å¤šèµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://juejin.cn/post/6944877410827370504&quot;&gt;ç°ä»£å‰ç«¯å·¥ç¨‹ä¸ºä»€ä¹ˆè¶Šæ¥è¶Šç¦»ä¸å¼€ Monorepo?&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://www.codeleading.com/article/46915806308/&quot;&gt;ä¸ºä»€ä¹ˆä½¿ç”¨pnpmå¯ä»¥å…‰é€Ÿå»ºç«‹å¥½ç”¨çš„monorepoï¼ˆæ¯”yarn&amp;#x2F;lernaæ•ˆç‡é«˜ï¼‰&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pnpm.io/zh/workspaces&quot;&gt;pnpm workspaceæ–‡æ¡£&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="æºç è§£è¯»" scheme="https://liang5757.github.io/categories/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/"/>
    
    
    <category term="js" scheme="https://liang5757.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>ã€æºç è§£è¯»ã€‘p-limit é™åˆ¶å¹¶å‘æ•°</title>
    <link href="https://liang5757.github.io/2023/04/19/Js/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/p-limit-%E9%99%90%E5%88%B6%E5%B9%B6%E5%8F%91%E6%95%B0/"/>
    <id>https://liang5757.github.io/2023/04/19/Js/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/p-limit-%E9%99%90%E5%88%B6%E5%B9%B6%E5%8F%91%E6%95%B0/</id>
    <published>2023-04-18T16:53:37.000Z</published>
    <updated>2025-12-07T10:16:59.211Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>github: <a href="https://github.com/sindresorhus/p-limit">https://github.com/sindresorhus/p-limit</a></p></blockquote><h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pLimit <span class="keyword">from</span> <span class="string">&#x27;p-limit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> limit = <span class="title function_">pLimit</span>(<span class="number">1</span>); <span class="comment">// åªèƒ½æœ‰ä¸€ä¸ªpromiseåœ¨æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> input = [</span><br><span class="line"><span class="title function_">limit</span>(<span class="function">() =&gt;</span> <span class="title function_">fetchSomething</span>(<span class="string">&#x27;foo&#x27;</span>)),</span><br><span class="line"><span class="title function_">limit</span>(<span class="function">() =&gt;</span> <span class="title function_">fetchSomething</span>(<span class="string">&#x27;bar&#x27;</span>)),</span><br><span class="line"><span class="title function_">limit</span>(<span class="function">() =&gt;</span> <span class="title function_">doSomething</span>())</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(input);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="å‡½æ•°æºç "><a href="#å‡½æ•°æºç " class="headerlink" title="å‡½æ•°æºç "></a>å‡½æ•°æºç </h2><h3 id="åˆå§‹åŒ–ï¼ˆpLimitï¼‰"><a href="#åˆå§‹åŒ–ï¼ˆpLimitï¼‰" class="headerlink" title="åˆå§‹åŒ–ï¼ˆpLimitï¼‰"></a>åˆå§‹åŒ–ï¼ˆpLimitï¼‰</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Queue</span> <span class="keyword">from</span> <span class="string">&quot;yocto-queue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">pLimit</span>(<span class="params">concurrency</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> <span class="title class_">Queue</span>();</span><br><span class="line"><span class="keyword">let</span> activeCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">enqueue</span> = (<span class="params">fn, resolve, args</span>) =&gt; &#123;</span><br><span class="line">queue.<span class="title function_">enqueue</span>(run.<span class="title function_">bind</span>(<span class="literal">undefined</span>, fn, resolve, args));</span><br><span class="line"></span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">             <span class="comment">// æ€è€ƒé‡Œè®²è§£ä¸ºä»€ä¹ˆè¿™é‡Œéœ€è¦Promise.resolve()</span></span><br><span class="line"><span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (activeCount &lt; concurrency &amp;&amp; queue.<span class="property">size</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">queue.<span class="title function_">dequeue</span>()();</span><br><span class="line">&#125;</span><br><span class="line">&#125;)();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">generator</span> = (<span class="params">fn, ...args</span>) =&gt;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">enqueue</span>(fn, resolve, args);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> generator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pLimit</code>å‡½æ•°çš„å…¥å‚ concurrency æ˜¯æœ€å¤§å¹¶å‘æ•°ï¼Œè°ƒç”¨ä¸€æ¬¡ pLimit ä¼šç”Ÿæˆä¸€ä¸ªé™åˆ¶å¹¶å‘çš„å‡½æ•° generator</p><p>ä¾èµ–<code>yocto-queue</code>çš„é˜Ÿåˆ—èƒ½åŠ›ï¼Œæ¯æ¬¡è°ƒç”¨<code>generator</code>ä¼šè¿”å›ä¸ª<code>promise</code></p><ol><li>ä¼šå‘é˜Ÿåˆ—å…¥é˜Ÿä¸€ä¸ª<code>run</code>ï¼ˆæ‰§è¡Œå‡½æ•°ï¼‰</li><li>å¦‚æœå½“å‰åœ¨æ‰§è¡Œ<code>promise</code>æ•°é‡å°äº<code>concurrency</code>ï¼ˆå¹¶å‘æ•°ï¼‰ï¼Œå°±å‡ºé˜Ÿå¹¶æ‰§è¡Œ</li></ol><h3 id="æ‰§è¡Œå‡½æ•°ï¼ˆrunï¼‰"><a href="#æ‰§è¡Œå‡½æ•°ï¼ˆrunï¼‰" class="headerlink" title="æ‰§è¡Œå‡½æ•°ï¼ˆrunï¼‰"></a>æ‰§è¡Œå‡½æ•°ï¼ˆrunï¼‰</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">next</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    activeCount--;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (queue.<span class="property">size</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        queue.<span class="title function_">dequeue</span>()();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">run</span> = <span class="keyword">async</span> (<span class="params">fn, resolve, args</span>) =&gt; &#123;</span><br><span class="line">    activeCount++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> result = (<span class="title function_">async</span> () =&gt; <span class="title function_">fn</span>(...args))();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">resolve</span>(result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> result;</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>runå‡½æ•°æ‰§è¡Œ</p><ol><li><code>activeCount</code>åŠ ä¸€</li><li>æ‰§è¡Œå¼‚æ­¥å‡½æ•°<code>fn</code>ï¼Œå¹¶å°†ç»“æœä¼ é€’ç»™<code>resolve</code></li><li><code>await</code>äº†<code>result</code>ï¼Œä½¿å¾—<code>next</code>æ‰§è¡Œæœ‰åº</li><li>æ‰§è¡Œ<code>next</code>æ—¶è¡¨ç¤º<code>promise</code>ç»“æœå·²ç»è¿”å›ï¼Œ<code>activeCount</code>-1ï¼Œå¹¶å¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ª<code>promise</code></li></ol><h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨é˜Ÿåˆ—è€Œä¸æ˜¯æ•°ç»„"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨é˜Ÿåˆ—è€Œä¸æ˜¯æ•°ç»„" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨é˜Ÿåˆ—è€Œä¸æ˜¯æ•°ç»„"></a>ä¸ºä»€ä¹ˆä½¿ç”¨é˜Ÿåˆ—è€Œä¸æ˜¯æ•°ç»„</h3><p>ç›¸å…³issusï¼š<a href="https://github.com/sindresorhus/p-limit/pull/47">Improve performance</a></p><p><code>shift</code>æ–¹æ³•æ¯æ¬¡è°ƒç”¨æ—¶, éƒ½éœ€è¦éå†ä¸€æ¬¡æ•°ç»„, å°†æ•°ç»„è¿›è¡Œä¸€æ¬¡å¹³ç§», æ—¶é—´å¤æ‚åº¦æ˜¯O(n)<br>é˜Ÿåˆ—çš„<code>dequeue</code>æ—¶é—´å¤æ‚åº¦åˆ™æ˜¯O(1)</p><h3 id="ä¸ºä»€ä¹ˆåœ¨å…¥é˜Ÿå¹¶ä¸”æ‰§è¡Œçš„æ—¶å€™ï¼Œåˆ¤æ–­æ‰§è¡Œå‰éœ€è¦await-Promise-resolve"><a href="#ä¸ºä»€ä¹ˆåœ¨å…¥é˜Ÿå¹¶ä¸”æ‰§è¡Œçš„æ—¶å€™ï¼Œåˆ¤æ–­æ‰§è¡Œå‰éœ€è¦await-Promise-resolve" class="headerlink" title="ä¸ºä»€ä¹ˆåœ¨å…¥é˜Ÿå¹¶ä¸”æ‰§è¡Œçš„æ—¶å€™ï¼Œåˆ¤æ–­æ‰§è¡Œå‰éœ€è¦await Promise.resolve()"></a>ä¸ºä»€ä¹ˆåœ¨å…¥é˜Ÿå¹¶ä¸”æ‰§è¡Œçš„æ—¶å€™ï¼Œåˆ¤æ–­æ‰§è¡Œå‰éœ€è¦await Promise.resolve()</h3><p>ç›¸å…³issusï¼š<a href="https://github.com/sindresorhus/p-limit/pull/28">Always run limited functions asynchronously</a></p><p>ä¸åŠ çš„è¯ï¼Œæœ‰æ—¶å€™æ‰§è¡Œæ˜¯åŒæ­¥çš„ï¼Œæœ‰æ—¶å€™æ‰§è¡Œæ˜¯å¼‚æ­¥çš„ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´åœ¨ä¸‹ä¸€è¡Œä»£ç æ‰§è¡Œä¹‹å‰çŠ¶æ€å°±å·²ç»æ”¹å˜äº†ï¼Œè®©ç¨‹åºè¿è¡Œç»“æœä¸å¯é¢„æµ‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (activeCount &lt; concurrency &amp;&amp; queue.<span class="property">size</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        queue.<span class="title function_">dequeue</span>()();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>åŠ ä¸Šå¯ä»¥ä¿è¯æ‰€æœ‰å‡ºé˜Ÿæ‰§è¡Œéƒ½æ˜¯å¼‚æ­¥çš„</p><h3 id="å¦‚ä½•æ·»åŠ è¶…æ—¶é€»è¾‘"><a href="#å¦‚ä½•æ·»åŠ è¶…æ—¶é€»è¾‘" class="headerlink" title="å¦‚ä½•æ·»åŠ è¶…æ—¶é€»è¾‘"></a>å¦‚ä½•æ·»åŠ è¶…æ—¶é€»è¾‘</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">const</span> timerPromise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&#x27;time out&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">  timerPromise,</span><br><span class="line">  fetchPromise,</span><br><span class="line">])</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">clearTimeout</span>(timer))</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err));</span><br></pre></td></tr></table></figure><p>æ›´æ­£è§„çš„å†™æ³•å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/sindresorhus/p-timeout">p-timeout</a></p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://mp.weixin.qq.com/s/6LsPMIHdIOw3KO6F2sgRXg">Node.js å¹¶å‘èƒ½åŠ›æ€»ç»“</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;github: &lt;a href=&quot;https://github.com/sindresorhus/p-limit&quot;&gt;https://github.com/sindresorhus/p-limit&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ä½¿ç”¨æ–¹å¼&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨æ–¹å¼&quot;&gt;&lt;/a&gt;ä½¿ç”¨æ–¹å¼&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; pLimit &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;p-limit&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; limit = &lt;span class=&quot;title function_&quot;&gt;pLimit&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;// åªèƒ½æœ‰ä¸€ä¸ªpromiseåœ¨æ‰§è¡Œ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; input = [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;title function_&quot;&gt;limit&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;fetchSomething&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;foo&amp;#x27;&lt;/span&gt;)),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;title function_&quot;&gt;limit&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;fetchSomething&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;bar&amp;#x27;&lt;/span&gt;)),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;title function_&quot;&gt;limit&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;doSomething&lt;/span&gt;())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; result = &lt;span class=&quot;keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Promise&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;all&lt;/span&gt;(input);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;log&lt;/span&gt;(result);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="æºç è§£è¯»" scheme="https://liang5757.github.io/categories/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/"/>
    
    
    <category term="js" scheme="https://liang5757.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>ã€æºç è§£è¯»ã€‘arrify è½¬æ•°ç»„</title>
    <link href="https://liang5757.github.io/2022/05/21/Js/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/arrify-%E8%BD%AC%E6%95%B0%E7%BB%84/"/>
    <id>https://liang5757.github.io/2022/05/21/Js/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/arrify-%E8%BD%AC%E6%95%B0%E7%BB%84/</id>
    <published>2022-05-21T03:33:05.000Z</published>
    <updated>2025-12-07T10:16:59.210Z</updated>
    
    <content type="html"><![CDATA[<p>åŠå¹´æ²¡å†™åšå®¢ï¼Œä»ç®€å•çš„æºç å¼€å§‹å¯åŠ¨</p><span id="more"></span><blockquote><p>github: <a href="https://github.com/sindresorhus/arrify">https://github.com/sindresorhus/arrify</a></p></blockquote><h3 id="åŠŸèƒ½ä»£ç "><a href="#åŠŸèƒ½ä»£ç " class="headerlink" title="åŠŸèƒ½ä»£ç "></a>åŠŸèƒ½ä»£ç </h3><p>æ¯”è¾ƒç®€å•ï¼Œå°±å…ˆå±•ç¤ºä¸€ä¸‹å…¨éƒ¨jsä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">arrify</span>(<span class="params">value</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (value === <span class="literal">null</span> || value === <span class="literal">undefined</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(value)) &#123;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> [value];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> value[<span class="title class_">Symbol</span>.<span class="property">iterator</span>] === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> [...value];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> [value];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘çœ‹æ¥å’ŒArray.fromçš„åŒºåˆ«å¦‚ä¸‹</p><table><thead><tr><th></th><th>Array.from</th><th>arrify</th></tr></thead><tbody><tr><td>undefined</td><td>æŠ¥é”™ï¼šUncaught TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))</td><td>[]</td></tr><tr><td>Null</td><td>æŠ¥é”™ï¼šUncaught TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))</td><td>[]</td></tr><tr><td>document.querySelector(â€˜*â€™)</td><td>å¸¦æ‰€æœ‰å…ƒç´ çš„æ•°ç»„</td><td>[document.querySelector(â€˜*â€™)]</td></tr></tbody></table><p>ä½œè€…å¯¹äºarray likeå¤„ç†çš„<a href="https://github.com/sindresorhus/arrify/issues/2">å›åº”</a>ï¼Œç¿»è¯‘ä¸€ä¸‹ï¼šæ•…æ„è¿™ä¹ˆæ•´çš„ï¼Œarrifyåº”å½“åªæ˜¯æ•°ç»„åŒ–ï¼Œè€Œä¸æ˜¯å¯¹ç±»æ•°ç»„è¿›è¡Œè½¬æ¢ï¼Œå¯¹ç±»æ•°ç»„è½¬æ¢å¯ä»¥ç”¨<code>Array.from</code></p><p>psï¼šåœ¨æˆ‘å°è¯•çš„æ—¶å€™ï¼Œç”¨chromeæ§åˆ¶å°Array.from(document.querySelector(â€˜*â€™))ï¼Œä¼šå¾—åˆ°ä¸€ä¸ª<strong>ç©ºæ•°ç»„</strong>ï¼Œä½†æ˜¯æœ¬åœ°åˆ›å»ºçš„htmlæµ‹è¯•æ˜¯æ²¡é—®é¢˜çš„ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ</p><h4 id="å…³äºstringçš„å¤„ç†"><a href="#å…³äºstringçš„å¤„ç†" class="headerlink" title="å…³äºstringçš„å¤„ç†"></a>å…³äºstringçš„å¤„ç†</h4><p>ä¸ºä»€ä¹ˆä¸ç›´æ¥å»æ‰value &#x3D;&#x3D;&#x3D; â€˜stringâ€™è¿™ä¸ªifè¯­å¥å—ï¼Œè¿™æ ·åœ¨æœ€åä¹Ÿèƒ½è¿”å›[value]ï¼Ÿ</p><p>ç­”ï¼šstringæœ‰Symbol.iteratorå±æ€§ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œ[â€¦value]</p><h3 id="ç±»å‹å®šä¹‰"><a href="#ç±»å‹å®šä¹‰" class="headerlink" title="ç±»å‹å®šä¹‰"></a>ç±»å‹å®šä¹‰</h3><h4 id="é‡è½½å®šä¹‰ï¼Ÿ"><a href="#é‡è½½å®šä¹‰ï¼Ÿ" class="headerlink" title="é‡è½½å®šä¹‰ï¼Ÿ"></a>é‡è½½å®šä¹‰ï¼Ÿ</h4><p>æœ€å¼€å§‹çš„ç±»å‹å®šä¹‰æ˜¯ç”¨<strong>é‡è½½</strong>çš„æ–¹å¼ï¼Œå¯¹ä¸åŒå‚æ•°ç±»å‹è¿›è¡Œå¤„ç†ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">function</span> <span class="title function_">arrify</span>(<span class="params"><span class="attr">value</span>: <span class="literal">null</span> | <span class="literal">undefined</span></span>): [];</span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">function</span> <span class="title function_">arrify</span>(<span class="params"><span class="attr">value</span>: <span class="built_in">string</span></span>): [<span class="built_in">string</span>];</span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">function</span> arrify&lt;<span class="title class_">ValueType</span>&gt;(<span class="attr">value</span>: <span class="title class_">ValueType</span>[]): <span class="title class_">ValueType</span>[];</span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">function</span> arrify&lt;<span class="title class_">ValueType</span>&gt;(<span class="attr">value</span>: <span class="title class_">ReadonlyArray</span>&lt;<span class="title class_">ValueType</span>&gt;): <span class="title class_">ReadonlyArray</span>&lt;<span class="title class_">ValueType</span>&gt;;</span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">function</span> arrify&lt;<span class="title class_">ValueType</span>&gt;(<span class="attr">value</span>: <span class="title class_">Iterable</span>&lt;<span class="title class_">ValueType</span>&gt;): <span class="title class_">ValueType</span>[];</span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">function</span> arrify&lt;<span class="title class_">ValueType</span>&gt;(<span class="attr">value</span>: <span class="title class_">ValueType</span>): [<span class="title class_">ValueType</span>];</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨è¯¥<a href="https://github.com/sindresorhus/arrify/issues/8">issus</a>æå‡ºäº†ï¼Œå‚æ•°ä¸æ”¯æŒè”åˆç±»å‹ï¼Œcaseå¦‚ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">arrify</span>(<span class="title class_">Boolean</span>() ? [<span class="number">1</span>, <span class="number">2</span>] : <span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>å‚æ•°ä¼šè¢«tsæ¨æ–­ä¸º<code>number | number[]</code>ï¼Œå¹¶ä¸æ»¡è¶³ä¸Šé¢æ‰€æœ‰é‡è½½æ–¹æ³•çš„å®šä¹‰ï¼Œè€ƒè™‘è”åˆç±»å‹åï¼Œå„ç§ç±»å‹ç»„åˆçš„æ•°é‡å¤ªå¤šäº†ï¼Œå‡½æ•°é‡è½½çš„å®šä¹‰æ–¹å¼æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚</p><h4 id="æ”¹è¿›ç‰ˆ"><a href="#æ”¹è¿›ç‰ˆ" class="headerlink" title="æ”¹è¿›ç‰ˆ"></a>æ”¹è¿›ç‰ˆ</h4><p>ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼Œå…¶å®ä¹Ÿå’Œjsçš„åˆ¤æ–­ä¸€ä¸€å¯¹åº”</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> arrify&lt;<span class="title class_">ValueType</span>&gt;(</span><br><span class="line">   <span class="attr">value</span>: <span class="title class_">ValueType</span></span><br><span class="line">): <span class="title class_">ValueType</span> <span class="title function_">extends</span> (<span class="literal">null</span> | <span class="literal">undefined</span>)</span><br><span class="line">   ? []</span><br><span class="line">   : <span class="title class_">ValueType</span> <span class="keyword">extends</span> <span class="built_in">string</span></span><br><span class="line">      ? [<span class="built_in">string</span>]</span><br><span class="line">      : <span class="title class_">ValueType</span> <span class="keyword">extends</span> <span class="keyword">readonly</span> <span class="built_in">unknown</span>[]</span><br><span class="line">         ? <span class="title class_">ValueType</span></span><br><span class="line">         : <span class="title class_">ValueType</span> <span class="keyword">extends</span> <span class="title class_">Iterable</span>&lt;infer T&gt;</span><br><span class="line">            ? T[]</span><br><span class="line">            : [<span class="title class_">ValueType</span>];</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨extendåï¼Œä¼šå°†è”åˆç±»å‹çš„æ¯ä¸€ä¸ªå–å‡ºæ¥æ‰§è¡Œåˆ¤æ–­ï¼Œå¾—å‡ºç»“æœåå†åˆå¹¶æˆè”åˆç±»å‹ï¼Œä¾‹å­ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> value&lt;<span class="title class_">ValueType</span>&gt; = <span class="title class_">ValueType</span> <span class="title function_">extends</span> (<span class="literal">null</span> | <span class="literal">undefined</span>)</span><br><span class="line">? []</span><br><span class="line">: <span class="title class_">ValueType</span> <span class="keyword">extends</span> <span class="built_in">string</span></span><br><span class="line">? [<span class="built_in">string</span>]</span><br><span class="line">: <span class="title class_">ValueType</span> <span class="keyword">extends</span> <span class="keyword">readonly</span> <span class="built_in">unknown</span>[]</span><br><span class="line">? <span class="title class_">ValueType</span></span><br><span class="line">: <span class="title class_">ValueType</span> <span class="keyword">extends</span> <span class="title class_">Iterable</span>&lt;infer T&gt;</span><br><span class="line">? T[]</span><br><span class="line">: [<span class="title class_">ValueType</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> test = value&lt;<span class="built_in">number</span> | <span class="built_in">string</span>[]&gt; <span class="comment">// [number] | string[]</span></span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿˜æ˜¯æ¯”è¾ƒè€çš„ä»“åº“ï¼Œä»–çš„ä¸€äº›è®¾è®¡ç†å¿µæˆ‘ä¸æ˜¯å¾ˆè®¤åŒï¼Œæˆ‘è§‰å¾—ç»™äººç”¨çš„ç¬¬ä¸‰æ–¹åº“å°±åº”è¯¥èƒ½å¤Ÿå¤„ç†æ‰€æœ‰çš„æƒ…å†µï¼Œè€Œä¸æ˜¯ä¸ºäº†è®¾è®¡ç†å¿µæ¥ä¸¥æ ¼å®šä¹‰ï¼Œä¸å¯¹ä¸€äº›æƒ…å†µè¿›è¡Œå¤„ç†</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åŠå¹´æ²¡å†™åšå®¢ï¼Œä»ç®€å•çš„æºç å¼€å§‹å¯åŠ¨&lt;/p&gt;</summary>
    
    
    
    <category term="æºç è§£è¯»" scheme="https://liang5757.github.io/categories/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/"/>
    
    
    <category term="js" scheme="https://liang5757.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>Mittæºç è§£è¯»</title>
    <link href="https://liang5757.github.io/2021/12/15/Ts/Mitt%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/"/>
    <id>https://liang5757.github.io/2021/12/15/Ts/Mitt%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/</id>
    <published>2021-12-15T11:45:48.000Z</published>
    <updated>2025-12-07T10:16:59.223Z</updated>
    
    <content type="html"><![CDATA[<p>githubåœ°å€ï¼š<a href="https://github.com/developit/mitt">https://github.com/developit/mitt</a></p><blockquote><p>200bå¤§å°çš„event busåº“</p></blockquote><span id="more"></span><h2 id="ç±»å‹ç³»ç»Ÿ"><a href="#ç±»å‹ç³»ç»Ÿ" class="headerlink" title="ç±»å‹ç³»ç»Ÿ"></a>ç±»å‹ç³»ç»Ÿ</h2><p>è®©äººçœ¼å‰ä¸€äº®çš„æ˜¯ï¼Œè¯¥åº“å¯¹ç±»å‹æœ‰ç€è¾ƒå¼ºè§„èŒƒï¼Œç”¨æˆ·å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç”¨ä¸‹é¢çš„æ–¹å¼å®šä¹‰äº‹ä»¶ç±»å‹ï¼Œåœ¨è¯¥<a href="https://github.com/developit/mitt/issues/106">issus</a>è¢«æå‡º</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Events</span> = &#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="built_in">string</span>; <span class="comment">// äº‹ä»¶å: å‚æ•°ç±»å‹</span></span><br><span class="line">  <span class="attr">bar</span>?: <span class="built_in">number</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emitter = mitt&lt;<span class="title class_">Events</span>&gt;(); <span class="comment">// inferred as Emitter&lt;Events&gt;</span></span><br><span class="line"></span><br><span class="line">emitter.<span class="title function_">on</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;&#125;); <span class="comment">// &#x27;e&#x27; has inferred type &#x27;string&#x27;</span></span><br><span class="line"></span><br><span class="line">emitter.<span class="title function_">emit</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="number">42</span>); <span class="comment">// Error: Argument of type &#x27;number&#x27; is not assignable to parameter of type &#x27;string&#x27;. (2345)</span></span><br></pre></td></tr></table></figure><p>é‚£å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Œå…ˆæŠŠå®ç°ä»£ç å±•ç¤ºå‡ºæ¥å†åˆ†éƒ¨è®²è§£ï¼ˆç›´æ¥çœ‹æ‡‚çš„å¯ä»¥è·³è¿‡è®²è§£ï¼‰ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">EventType</span> = <span class="built_in">string</span> | <span class="built_in">symbol</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">Handler</span>&lt;T = <span class="built_in">unknown</span>&gt; = <span class="function">(<span class="params"><span class="attr">event</span>: T</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> mitt&lt;<span class="title class_">Events</span> <span class="keyword">extends</span> <span class="title class_">Record</span>&lt;<span class="title class_">EventType</span>, <span class="built_in">unknown</span>&gt;&gt;(</span><br><span class="line"><span class="attr">all</span>?: <span class="title class_">EventHandlerMap</span>&lt;<span class="title class_">Events</span>&gt; <span class="comment">// å¯ä»¥æš‚æ—¶å¿½ç•¥è¿™é‡Œ</span></span><br><span class="line">): <span class="title class_">Emitter</span>&lt;<span class="title class_">Events</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">GenericEventHandler</span> =</span><br><span class="line">    | <span class="title class_">Handler</span>&lt;<span class="title class_">Events</span>[keyof <span class="title class_">Events</span>]&gt;</span><br><span class="line">    | <span class="title class_">WildcardHandler</span>&lt;<span class="title class_">Events</span>&gt;; <span class="comment">// ä¸ºäº†é€‚é…ç”¨ *</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">on&lt;<span class="title class_">Key</span> <span class="keyword">extends</span> keyof <span class="title class_">Events</span>&gt; (<span class="attr">type</span>: <span class="title class_">Key</span>, <span class="attr">handler</span>: <span class="title class_">GenericEventHandler</span>) &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;,</span><br><span class="line">off&lt;<span class="title class_">Key</span> <span class="keyword">extends</span> keyof <span class="title class_">Events</span>&gt; (<span class="attr">type</span>: <span class="title class_">Key</span>, <span class="attr">handler</span>?: <span class="title class_">GenericEventHandler</span>) &#123;</span><br><span class="line"><span class="comment">// ... </span></span><br><span class="line">&#125;,</span><br><span class="line">        emit&lt;<span class="title class_">Key</span> <span class="keyword">extends</span> keyof <span class="title class_">Events</span>&gt;(<span class="attr">type</span>: <span class="title class_">Key</span>, <span class="attr">evt</span>?: <span class="title class_">Events</span>[<span class="title class_">Key</span>])  &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h3><p><code>Record&lt;K, T&gt;</code>æ˜¯typescriptå†…ç½®çš„ç±»å‹å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Construct a type with a set of properties K of type T</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Record</span>&lt;K <span class="keyword">extends</span> keyof <span class="built_in">any</span>, T&gt; = &#123;</span><br><span class="line">    [P <span class="keyword">in</span> K]: T;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä»£è¡¨çš„æ„æ€æ˜¯ä»ç¬¬ä¸€ä¸ªå‚æ•°è·å–æ‰€æœ‰é”®ï¼Œå€¼ä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œæºç ä¸­<code>Record&lt;EventType, unknown&gt;</code>å³ä¸º</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">EventType</span> = <span class="built_in">string</span> | <span class="built_in">symbol</span>;</span><br><span class="line"><span class="title class_">Record</span>&lt;<span class="title class_">EventType</span>, <span class="built_in">unknown</span>&gt; === &#123;</span><br><span class="line">    [P <span class="keyword">in</span> <span class="built_in">string</span> | <span class="built_in">symbol</span>]: <span class="built_in">unknown</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Events extends Record&lt;EventType, unknown&gt;</code>åˆ©ç”¨æ³›å‹çº¦æŸå°†ç”¨æˆ·ä¼ å…¥çš„Eventsç±»å‹çº¦æŸä¸ºä¸Šè¿°ç±»å‹</p><h3 id="ç±»å‹ç¼–ç¨‹"><a href="#ç±»å‹ç¼–ç¨‹" class="headerlink" title="ç±»å‹ç¼–ç¨‹"></a>ç±»å‹ç¼–ç¨‹</h3><p>å°±åƒä½™åè€å¸ˆç¡ä¸€è§‰é†’æ¥åæœ‰äº†è¿™ä¹ˆä¸€ä¸ªé¢˜ç›®å«ã€Šæ´»ç€ã€‹ï¼Œè§‰å¾—é¢˜ç›®éå¸¸å¥½å°±å¼€å§‹å†™äº†ï¼Œç¬¬ä¸€æ¬¡è§åˆ°<a href="https://linbudu.top/ts-type-programming">Linbuduçš„åšå®¢</a>ï¼Œè§åˆ°äº†ä¸€ä¸ªè¯â€”â€”<strong>ç±»å‹ç¼–ç¨‹</strong>ï¼Œæœ‰äº†è¿™ä¹ˆä¸€ä¸ªæ¦‚å¿µï¼ˆè™½ç„¶ä¸çŸ¥é“æ˜¯åœ¨ä½•æ—¶ä½•åœ°è¢«æå‡ºçš„ï¼‰ï¼Œçªç„¶å¾ˆå¤šçŸ¥è¯†å°±æœ‰äº†ä¸€ä¸ªç³»ç»Ÿçš„åç§°ï¼Œå¼•å¯¼äººä»¬æ¢ç´¢è¿™ä¸ªç³»ç»Ÿä¸‹çš„å„ç§åº”ç”¨ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ä¸€ä¸ªä¾‹å­ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">Handler</span>&lt;T = <span class="built_in">unknown</span>&gt; = <span class="function">(<span class="params"><span class="attr">event</span>: T</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">GenericEventHandler</span> = <span class="title class_">Handler</span>&lt;<span class="title class_">Events</span>[keyof <span class="title class_">Events</span>]&gt;</span><br></pre></td></tr></table></figure><p><code>Events[keyof Events]</code>å°±æ˜¯å°†ç”¨æˆ·å®šä¹‰çš„Eventsç±»å‹çš„å€¼ç±»å‹å…¨éƒ¨å–å‡ºï¼Œåœ¨æœ€ä¸Šé¢çš„ä½¿ç”¨æ–¹å¼çš„ä¾‹å­é‡Œï¼Œä¼šæœ‰å¦‚ä¸‹çš„è½¬åŒ–ç»“æœã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Events</span> = &#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="built_in">string</span>; <span class="comment">// äº‹ä»¶å: å‚æ•°ç±»å‹</span></span><br><span class="line">  <span class="attr">bar</span>?: <span class="built_in">number</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Events</span>[keyof <span class="title class_">Events</span>] === <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">GenericEventHandler</span> = <span class="title class_">Handler</span>&lt;<span class="title class_">Events</span>[keyof <span class="title class_">Events</span>]&gt; === <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">string</span> | <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span></span><br></pre></td></tr></table></figure><p>å†çœ‹<code>on</code>ã€<code>off</code>ã€<code>emit</code>å‡½æ•°å®šä¹‰ï¼Œå»é™¤äº† æ”¯æŒtypeä¸º<code>*</code>çš„åŠŸèƒ½</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">on&lt;<span class="title class_">Key</span> <span class="keyword">extends</span> keyof <span class="title class_">Events</span>&gt; (<span class="attr">type</span>: <span class="title class_">Key</span>, <span class="attr">handler</span>: <span class="title class_">Handler</span>&lt;<span class="title class_">Events</span>[<span class="title class_">Key</span>]&gt;) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">off&lt;<span class="title class_">Key</span> <span class="keyword">extends</span> keyof <span class="title class_">Events</span>&gt; (<span class="attr">type</span>: <span class="title class_">Key</span>, <span class="attr">handler</span>?: <span class="title class_">Handler</span>&lt;<span class="title class_">Events</span>[<span class="title class_">Key</span>]&gt;) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">emit&lt;<span class="title class_">Key</span> <span class="keyword">extends</span> keyof <span class="title class_">Events</span>&gt;(<span class="attr">type</span>: <span class="title class_">Key</span>, <span class="attr">evt</span>?: <span class="title class_">Events</span>[<span class="title class_">Key</span>])  &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬åœ¨<code>on</code>ã€<code>off</code>å’Œ<code>emit</code>åªèƒ½æ³¨å†Œæˆ–æ³¨é”€<strong>äº‹ä»¶å</strong>å’Œ<strong>handlerçš„å‚æ•°</strong>ä¸ç”¨æˆ·å®šä¹‰Eventsç±»å‹ä¸€è‡´çš„äº‹ä»¶</p><h2 id="ä»£ç é€»è¾‘"><a href="#ä»£ç é€»è¾‘" class="headerlink" title="ä»£ç é€»è¾‘"></a>ä»£ç é€»è¾‘</h2><h3 id="å¯æ›¿æ¢çš„all"><a href="#å¯æ›¿æ¢çš„all" class="headerlink" title="å¯æ›¿æ¢çš„all"></a>å¯æ›¿æ¢çš„all</h3><p>allç”¨æ¥å­˜å‚¨ç”¨æˆ·æ³¨å†Œçš„äº‹ä»¶ï¼Œmittä¼šåˆå§‹åŒ–ä¸€ä¸ªMapä½œä¸ºé»˜è®¤çš„ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥ä¼ å…¥è‡ªå·±çš„Mapã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> mitt&lt;<span class="title class_">Events</span> <span class="keyword">extends</span> <span class="title class_">Record</span>&lt;<span class="title class_">EventType</span>, <span class="built_in">unknown</span>&gt;&gt;(</span><br><span class="line"><span class="attr">all</span>?: <span class="title class_">EventHandlerMap</span>&lt;<span class="title class_">Events</span>&gt;</span><br><span class="line">): <span class="title class_">Emitter</span>&lt;<span class="title class_">Events</span>&gt; &#123;</span><br><span class="line">    all = all || <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="on"><a href="#on" class="headerlink" title="on"></a>on</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">on&lt;<span class="title class_">Key</span> <span class="keyword">extends</span> keyof <span class="title class_">Events</span>&gt;(<span class="attr">type</span>: <span class="title class_">Key</span>, <span class="attr">handler</span>: <span class="title class_">GenericEventHandler</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">handlers</span>: <span class="title class_">Array</span>&lt;<span class="title class_">GenericEventHandler</span>&gt; | <span class="literal">undefined</span> = all!.<span class="title function_">get</span>(<span class="keyword">type</span>);</span><br><span class="line">    <span class="keyword">if</span> (handlers) &#123;</span><br><span class="line">        handlers.<span class="title function_">push</span>(handler);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        all!.<span class="title function_">set</span>(<span class="keyword">type</span>, [handler] <span class="keyword">as</span> <span class="title class_">EventHandlerList</span>&lt;<span class="title class_">Events</span>[keyof <span class="title class_">Events</span>]&gt;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå·²ç»æ³¨å†ŒåŒåäº‹ä»¶åˆ™ç›´æ¥å°†handleræ¨è¿›æ•°ç»„ï¼Œå¦åˆ™åˆ›å»ºä¸ªæ–°æ•°ç»„å­˜æ”¾hanlderã€‚</p><h3 id="off"><a href="#off" class="headerlink" title="off"></a>off</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">off&lt;<span class="title class_">Key</span> <span class="keyword">extends</span> keyof <span class="title class_">Events</span>&gt;(<span class="attr">type</span>: <span class="title class_">Key</span>, <span class="attr">handler</span>?: <span class="title class_">GenericEventHandler</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">handlers</span>: <span class="title class_">Array</span>&lt;<span class="title class_">GenericEventHandler</span>&gt; | <span class="literal">undefined</span> = all!.<span class="title function_">get</span>(<span class="keyword">type</span>); <span class="comment">// å¯¹åº”äº‹ä»¶åçš„handleræ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (handlers) &#123;</span><br><span class="line">        <span class="keyword">if</span> (handler) &#123;</span><br><span class="line">            handlers.<span class="title function_">splice</span>(handlers.<span class="title function_">indexOf</span>(handler) &gt;&gt;&gt; <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            all!.<span class="title function_">set</span>(<span class="keyword">type</span>, []);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸€ä¸ªç§€æ“ä½œçš„ç‚¹ï¼Œå½“ç”¨æˆ·ä¼ å…¥handlerè¦<strong>åˆ é™¤å¯¹åº”äº‹ä»¶åä¸‹çš„å¯¹åº”handler</strong>æ—¶ï¼Œæœ‰è¿™ä¹ˆä¸€æ®µã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">handlers.<span class="title function_">splice</span>(handlers.<span class="title function_">indexOf</span>(handler) &gt;&gt;&gt; <span class="number">0</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“</p><ul><li><code>indexOf</code>æ²¡æœ‰åœ¨æ•°ç»„ä¸­æ‰¾åˆ°å¯¹åº”çš„å€¼ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›-1</li><li><code>&gt;&gt;&gt; 0</code>ï¼ˆ é›¶å¡«å……å³ä½ç§»0ä½ï¼‰ä¸æ˜¯æ²¡å˜ï¼Ÿ</li><li>è€Œ<code>splice(-1, 1)</code>è¡¨ç¤ºåˆ é™¤æœ€åä¸€ä½</li></ul><p>ç»¼åˆèµ·æ¥çœ‹ï¼Œå¦‚æœ<code>-1 &gt;&gt;&gt; 0</code>æ²¡å˜é‚£ä¹ˆå°±ä¼šè¯¯åˆ æœ€åä¸€ä¸ªhandlerã€‚</p><p>è®©æˆ‘ä»¬çœ‹çœ‹<code>&gt;&gt;&gt; 0</code>æ˜¯ä»€ä¹ˆé­”æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(-<span class="number">1</span> &gt;&gt;&gt; <span class="number">0</span>); <span class="comment">// 4294967295</span></span><br></pre></td></tr></table></figure><p>js numberé‡‡ç”¨çš„æ˜¯IEEE 754åŒç²¾åº¦æµ®ç‚¹ï¼Œ<strong>&gt;&gt;&gt;ä¼šæŠŠnumberæˆªæ–­æˆ32ä½intè¿›è¡Œä½ç§»</strong>ï¼Œæ›´å…·ä½“çš„ä¸å±•å¼€ã€‚å¦‚æœæ²¡æ‰¾åˆ°å¯¹åº”çš„handlerï¼Œä»£ç å³ä¸º<code>handlers.splice(4294967295, 1)</code>ï¼Œæˆ‘ä»¬å½“ç„¶ä¸å¯èƒ½å­˜å¦‚æ­¤å¤šçš„handlerï¼Œä¹Ÿå°±ä¸å¯èƒ½åˆ é™¤4294967295ä¸‹æ ‡å¯¹åº”çš„handlerï¼Œæ¯”èµ·æˆ‘ä»¬åˆ¤æ–­<code>indexOf</code>æ˜¯å¦ä¸º-1ç¼©çŸ­äº†ä»£ç ï¼ˆä»€ä¹ˆå«<strong>Microscopic</strong>å•Šï¼Ÿï¼‰</p><h3 id="emit"><a href="#emit" class="headerlink" title="emit"></a>emit</h3><ul><li>é€‚é…typeä¸º*çš„æƒ…å†µï¼Œä¸ºæ‰€æœ‰äº‹ä»¶éƒ½æ³¨å†Œhandlerï¼Œemitæ—¶å–å‡º*ä¸­çš„æ‰€æœ‰handleræ‰§è¡Œ</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">emit&lt;<span class="title class_">Key</span> <span class="keyword">extends</span> keyof <span class="title class_">Events</span>&gt;(<span class="attr">type</span>: <span class="title class_">Key</span>, <span class="attr">evt</span>?: <span class="title class_">Events</span>[<span class="title class_">Key</span>]) &#123;</span><br><span class="line">    <span class="keyword">let</span> handlers = all!.<span class="title function_">get</span>(<span class="keyword">type</span>);</span><br><span class="line">    <span class="keyword">if</span> (handlers) &#123;</span><br><span class="line">        (handlers <span class="keyword">as</span> <span class="title class_">EventHandlerList</span>&lt;<span class="title class_">Events</span>[keyof <span class="title class_">Events</span>]&gt;)</span><br><span class="line">            .<span class="title function_">slice</span>()</span><br><span class="line">            .<span class="title function_">map</span>(<span class="function">(<span class="params">handler</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">handler</span>(evt!);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handlers = all!.<span class="title function_">get</span>(<span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (handlers) &#123;</span><br><span class="line">        (handlers <span class="keyword">as</span> <span class="title class_">WildCardEventHandlerList</span>&lt;<span class="title class_">Events</span>&gt;)</span><br><span class="line">            .<span class="title function_">slice</span>()</span><br><span class="line">            .<span class="title function_">map</span>(<span class="function">(<span class="params">handler</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">handler</span>(<span class="keyword">type</span>, evt!);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h2><h3 id="Once"><a href="#Once" class="headerlink" title="Once"></a>Once</h3><p>è™½ç„¶æºç å¹¶æ²¡æœ‰å®ç°ï¼Œä½†æ˜¯æ—¢ç„¶æ˜¯äº‹ä»¶æ€»çº¿çš„æ–‡ç« ï¼Œè¿˜æ˜¯æä¸€æã€‚åœ¨æˆ‘ä¹‹å‰é¢è¯•çš„æ—¶å€™ç»å¸¸è¢«é—®åˆ°äº‹ä»¶æ€»çº¿æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå…¶ä¸­å°±æœ‰Onceçš„å®ç°ï¼Œæˆ‘æ²¡æœ‰æ·±å…¥æ€è€ƒï¼Œåªæƒ³ç€å®ç°å°±å®Œäº‹äº†ï¼š<strong>ç»™æ‰€æœ‰handlerç”¨å¯¹è±¡åŒ…è£¹ä¸€å±‚ï¼Œç„¶ååŠ ä¸€ä¸ªOnceå­—æ®µæ ‡è¯†ï¼Œåœ¨emitæ—¶åˆ¤æ–­Onceæ˜¯å¦ä¸ºtrueï¼Œtrueçš„è¯æ‰§è¡Œå®Œæ³¨é”€äº‹ä»¶</strong>ï¼Œä½†æ˜¯è¿™æ ·<code>on</code>å’Œ<code>emit</code>éƒ½éœ€è¦ä¿®æ”¹ï¼Œå¤šåˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡å¹¶ä¸”ä¸ä¼˜é›…ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨jsçš„çµæ´»æ€§ï¼Œç”¨ä¸€ä¸ªå‡½æ•°åŒ…è£¹ç”¨æˆ·çš„handlerï¼Œåœ¨è¯¥å‡½æ•°ä¸­offæ‰handlerã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">once</span>(<span class="params"><span class="attr">type</span>: <span class="title class_">Key</span>, <span class="attr">handler</span>: <span class="title class_">GenericEventHandler</span></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">on</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">self</span>: <span class="title class_">Emitter</span>&lt;<span class="title class_">Events</span>&gt; = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">listener</span> (<span class="params"></span>) &#123;</span><br><span class="line">            self.<span class="title function_">off</span>(<span class="keyword">type</span>, listener);</span><br><span class="line">            handler.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">on</span>(<span class="keyword">type</span>, listener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸Šé¢çš„ä»£ç æœ‰ä¸€ä¸ªå¾ˆéšè”½çš„é—®é¢˜ï¼š<strong>ç”±äºæ˜¯ç”¨ä¸€ä¸ªæ–°çš„å‡½æ•°å»åŒ…è£¹ï¼Œåœ¨offæ—¶ä¼ æ—§handlerå»æ³¨é”€onceäº‹ä»¶æ— æ³•æˆåŠŸ</strong></p><p><strong>è§£å†³æ–¹å¼</strong></p><p>åœ¨listenerå‡½æ•°ä¸­å­˜æ—§çš„handler</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">once</span>(<span class="params"><span class="attr">type</span>: <span class="title class_">Key</span>, <span class="attr">handler</span>: <span class="title class_">GenericEventHandler</span></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">on</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">self</span>: <span class="title class_">Emitter</span>&lt;<span class="title class_">Events</span>&gt; = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">listener</span> (<span class="params"></span>) &#123;</span><br><span class="line">            self.<span class="title function_">off</span>(<span class="keyword">type</span>, listener);</span><br><span class="line">            handler.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        listener.<span class="property">fn</span> = handler; <span class="comment">// å¢åŠ äº†è¿™é‡Œ</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">on</span>(<span class="keyword">type</span>, listener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ç”¨è¿™ç§æ–¹å¼çš„è¯ï¼Œæˆ‘ä»¬çš„<code>&gt;&gt;&gt;</code>é­”æ³•å°±ä¸èƒ½ä½¿ç”¨çš„ï¼ˆè¿™æ˜¯mittæ²¡æœ‰onceçš„åŸå› ï¼Ÿï¼‰</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">off&lt;<span class="title class_">Key</span> <span class="keyword">extends</span> keyof <span class="title class_">Events</span>&gt;(<span class="attr">type</span>: <span class="title class_">Key</span>, <span class="attr">handler</span>?: <span class="title class_">GenericEventHandler</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">handlers</span>: <span class="title class_">Array</span>&lt;<span class="title class_">GenericEventHandler</span>&gt; | <span class="literal">undefined</span> = all!.<span class="title function_">get</span>(<span class="keyword">type</span>);</span><br><span class="line">    <span class="keyword">if</span> (handlers) &#123;</span><br><span class="line">        <span class="keyword">if</span> (handler) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; handlers.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (handler === handlers[i] || handler === handlers[i].<span class="property">fn</span>)</span><br><span class="line">                    handlers.<span class="title function_">splice</span>(i, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            all!.<span class="title function_">set</span>(<span class="keyword">type</span>, []);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="unknown"><a href="#unknown" class="headerlink" title="unknown"></a>unknown</h3><p>åœ¨è¯¥<a href="https://github.com/developit/mitt/pull/114">Stronger typing #114</a>commitä¸­ï¼Œå¤§é‡çš„anyè¢«æ›¿æ¢ä¸ºunknown</p><p>å…³äºunknownçš„ç‰¹ç‚¹å¯çœ‹<a href="https://juejin.cn/post/6844903866073350151">[è¯‘] TypeScript 3.0: unknown ç±»å‹</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;githubåœ°å€ï¼š&lt;a href=&quot;https://github.com/developit/mitt&quot;&gt;https://github.com/developit/mitt&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;200bå¤§å°çš„event busåº“&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="æºç è§£è¯»" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/"/>
    
    
    <category term="ts" scheme="https://liang5757.github.io/tags/ts/"/>
    
  </entry>
  
  <entry>
    <title>vueuseæºç è§£æ</title>
    <link href="https://liang5757.github.io/2021/12/11/Vue/vueuse%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://liang5757.github.io/2021/12/11/Vue/vueuse%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/</id>
    <published>2021-12-10T17:46:15.000Z</published>
    <updated>2025-12-07T10:16:59.224Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸ä¼šæ”¾apiçš„ç”¨æ³•ï¼Œå»ºè®®å…ˆçœ‹çœ‹æ˜¯æ€ä¹ˆç”¨çš„</p></blockquote><h2 id="é¡¹ç›®æ¶æ„"><a href="#é¡¹ç›®æ¶æ„" class="headerlink" title="é¡¹ç›®æ¶æ„"></a>é¡¹ç›®æ¶æ„</h2><p>é‡‡ç”¨monorepoçš„å½¢å¼ï¼Œé¡¹ç›®ç›®å½•ä¸‹æœ‰å¤šä¸ªå­é¡¹ç›®ï¼Œä¸‹é¢æ”¾äº†èµ„æ–™é“¾æ¥å’Œå‡ å¤„ç”¨æ³•ï¼Œå…¶ä»–æœ¬æ–‡ä¸å¤šèµ˜è¿°ã€‚</p><p><a href="https://juejin.cn/post/6944877410827370504">ç°ä»£å‰ç«¯å·¥ç¨‹ä¸ºä»€ä¹ˆè¶Šæ¥è¶Šç¦»ä¸å¼€ Monorepo?</a><br><a href="https://www.codeleading.com/article/46915806308/">ä¸ºä»€ä¹ˆä½¿ç”¨pnpmå¯ä»¥å…‰é€Ÿå»ºç«‹å¥½ç”¨çš„monorepoï¼ˆæ¯”yarn&#x2F;lernaæ•ˆç‡é«˜ï¼‰</a><br><a href="https://pnpm.io/zh/workspaces">pnpm workspaceæ–‡æ¡£</a></p><span id="more"></span><p>ä¸ºäº†ä½¿æ‰€æœ‰å­é¡¹ç›®éƒ½ä½¿ç”¨åŒä¸€ä¸ªä¾èµ–ç‰ˆæœ¬ï¼Œä½¿ç”¨<a href="https://pnpm.io/zh/package_json#pnpmoverrides">pnpm.overrides</a>é…ç½®ï¼Œå¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;pnpm&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;vue-demi&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.12.1&quot;</span><span class="punctuation">,</span> <span class="comment">// åœ¨postinstallé’©å­ä¸­æ ¹æ®å½“å‰ç¯å¢ƒçš„vueç‰ˆæœ¬ï¼Œè·å–å…¼å®¹vue3å’Œvue2çš„api</span></span><br><span class="line">      <span class="attr">&quot;vite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.6.7&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>åœ¨æ­£å¸¸é…ç½®ä¸‹ï¼Œå¦‚æœç›´æ¥<code>pnpm install</code>å°†ä¼šåœ¨æ¯ä¸ªå­é¡¹ç›®çš„<code>node_modules</code>æœ‰åŒæ ·çš„ä¾èµ–ï¼Œä½†æ˜¯æ‰€æœ‰å­é¡¹ç›®ç›¸åŒçš„ä¾èµ–å…¶å®åªéœ€è¦æå–å‡ºæ¥æ”¾åœ¨æ ¹ç›®å½•çš„<code>node_modules</code>ä¸‹å³å¯ï¼Œå¯é…ç½®å¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;peerDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;@vue/composition-api&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.6.0 || ^3.2.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>è¯¦æƒ…è¯·çœ‹å¦‚ä¸‹é“¾æ¥</p><p><a href="https://www.cnblogs.com/wonyun/p/9692476.html">æ¢è®¨npmä¾èµ–ç®¡ç†ä¹‹peerDependencies</a><br><a href="https://blog.csdn.net/qq_21567385/article/details/121088506">pnpm monorepoä¹‹å¤šç»„ä»¶å®ä¾‹å’ŒpeerDependencieså›°å¢ƒå›æº¯</a><br><a href="https://pnpm.io/zh/how-peers-are-resolved">å¦‚ä½•å¤„ç† peers</a></p><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="unref-refçš„åæ“ä½œ"><a href="#unref-refçš„åæ“ä½œ" class="headerlink" title="unref - refçš„åæ“ä½œ"></a>unref - refçš„åæ“ä½œ</h3><ul><li>å¦‚æœä¼ å…¥ä¸€ä¸ªrefï¼Œè¿”å›å…¶å€¼</li><li>å¦åˆ™åŸæ ·æ”¾å›</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æºç å®ç°</span></span><br><span class="line"><span class="keyword">function</span> unref&lt;T&gt;(<span class="attr">ref</span>: T | <span class="title class_">Ref</span>&lt;T&gt;): T &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">isRef</span>(ref) ? ref.<span class="property">value</span> : ref</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¾‹å­ï¼šå®ç°ä¸€ä¸ªå“åº”å¼çš„addå‡½æ•°ï¼Œå¯ä»¥ä¼ å…¥<strong>refæˆ–å€¼</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">a</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt; | <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">b</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt; | <span class="built_in">number</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">computed</span>(<span class="function">() =&gt;</span> <span class="title function_">unref</span>(a) + <span class="title function_">unref</span>(b))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="MaybeRefç±»å‹"><a href="#MaybeRefç±»å‹" class="headerlink" title="MaybeRefç±»å‹"></a>MaybeRefç±»å‹</h3><p>vueuseå¤§é‡ä½¿ç”¨<code>MaybeRef</code>æ¥æ”¯æŒ<strong>å¯é€‰æ‹©æ€§çš„å“åº”å¼å‚æ•°</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MaybeRef</span>&lt;T&gt; = <span class="title class_">Ref</span>&lt;T&gt; | T</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„åŠ æ³•å‡½æ•°å°±å¯ä»¥ç®€å†™ä¸º</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"><span class="attr">a</span>: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">number</span>&gt;, <span class="attr">b</span>: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">number</span>&gt;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">computed</span>(<span class="function">() =&gt;</span> <span class="title function_">unref</span>(a) + <span class="title function_">unref</span>(b))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Effectä½œç”¨åŸŸAPI"><a href="#Effectä½œç”¨åŸŸAPI" class="headerlink" title="Effectä½œç”¨åŸŸAPI"></a>Effectä½œç”¨åŸŸAPI</h3><p>Vueå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://v3.cn.vuejs.org/api/effect-scope.html#effectscope">Effect ä½œç”¨åŸŸ API</a></p><p><strong>åŠ¨æœº</strong></p><p>åœ¨Vueçš„setupä¸­ï¼Œå“åº”å¼effectä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™è¢«æ”¶é›†ï¼Œåœ¨å®ä¾‹è¢«å¸è½½çš„æ—¶å€™ï¼Œå“åº”å¼effectå°±ä¼šè‡ªåŠ¨è¢«å–æ¶ˆäº†ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬åœ¨ç»„ä»¶å¤–å†™ä¸€ä¸ªç‹¬ç«‹çš„åŒ…ï¼ˆå°±å¦‚vueuseï¼‰æ—¶ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•åœæ­¢computed &amp; watchçš„å“åº”å¼ä¾èµ–å‘¢ï¼Ÿvue3.2æå‡ºäº†<code>effectScope</code></p><h4 id="effectScope"><a href="#effectScope" class="headerlink" title="effectScope"></a>effectScope</h4><p>åˆ©ç”¨<code>effectScope</code>åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸå¯¹è±¡ï¼Œå¦‚ä¸‹é¢æ¥å£å®šä¹‰æ‰€ç¤ºï¼Œ<code>run</code>æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªä½œç”¨åŸŸå¯¹è±¡ä¼šè‡ªåŠ¨æ•è·å‡½æ•°å†…éƒ¨çš„å“åº”å¼effect (ä¾‹å¦‚è®¡ç®—å±æ€§æˆ–ä¾¦å¬å™¨)</p><p><strong>ç±»å‹</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">effectScope</span>(<span class="params"><span class="attr">detached</span>?: <span class="built_in">boolean</span></span>): <span class="title class_">EffectScope</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">EffectScope</span> &#123;</span><br><span class="line">  run&lt;T&gt;(<span class="attr">fn</span>: <span class="function">() =&gt;</span> T): T | <span class="literal">undefined</span> <span class="comment">// å¦‚æœè¿™ä¸ªåŸŸä¸æ´»è·ƒåˆ™ä¸º undefined</span></span><br><span class="line">  <span class="title function_">stop</span>(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scope = <span class="title function_">effectScope</span>()</span><br><span class="line"></span><br><span class="line">scope.<span class="title function_">run</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> doubled = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> counter.<span class="property">value</span> * <span class="number">2</span>)</span><br><span class="line">  <span class="title function_">watch</span>(doubled, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(doubled.<span class="property">value</span>))</span><br><span class="line">  <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Count: &#x27;</span>, doubled.<span class="property">value</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†(dispose) è¯¥ä½œç”¨åŸŸå†…çš„æ‰€æœ‰ effect</span></span><br><span class="line">scope.<span class="title function_">stop</span>()</span><br></pre></td></tr></table></figure><h4 id="getCurrentScope"><a href="#getCurrentScope" class="headerlink" title="getCurrentScope"></a>getCurrentScope</h4><p>å¦‚æœæœ‰ï¼Œåˆ™è¿”å›å½“å‰æ´»è·ƒçš„ <a href="https://v3.cn.vuejs.org/api/effect-scope.html#effectscope">effect ä½œç”¨åŸŸ</a>ã€‚</p><p><strong>ç±»å‹</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getCurrentScope</span>(<span class="params"></span>): <span class="title class_">EffectScope</span> | <span class="literal">undefined</span> </span><br></pre></td></tr></table></figure><h4 id="onScopeDispose"><a href="#onScopeDispose" class="headerlink" title="onScopeDispose"></a>onScopeDispose</h4><p>åœ¨å½“å‰æ´»è·ƒçš„ <a href="https://v3.cn.vuejs.org/api/effect-scope.html#effectscope">effect ä½œç”¨åŸŸ</a>ä¸Šæ³¨å†Œä¸€ä¸ªå¤„ç†å›è°ƒã€‚è¯¥å›è°ƒä¼šåœ¨ç›¸å…³çš„ effect ä½œç”¨åŸŸç»“æŸä¹‹åè¢«è°ƒç”¨ï¼Œåœ¨VCAå‡½æ•°ä¸­å¯ç”¨ä½œ<code>onUnmounted</code>çš„éç»„ä»¶æ›¿ä»£å“ï¼ŒåŒºåˆ«åœ¨äºå…¶å·¥ä½œåœ¨scopeä¸­è€Œä¸æ˜¯ç»„ä»¶å®ä¾‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onScopeDispose</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, handler)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong></p><p>åœ¨vueçš„rfcä¸­<a href="https://github.com/vuejs/rfcs/blob/master/active-rfcs/0041-reactivity-effect-scope.md">reactivity-effect-scope</a>æœ‰è¿™æ ·çš„ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœæœ‰ä¸ªç›‘æ§é¼ æ ‡ä½ç½®çš„hookï¼ˆuseMouseï¼‰ï¼Œéœ€è¦ç›‘å¬<code>mousemove</code>äº‹ä»¶ï¼Œå¦‚æœåœ¨å¤šä¸ªç»„ä»¶è°ƒç”¨äº†è¿™ä¸ªhookï¼Œè€Œå†…éƒ¨æ˜¯é€šè¿‡åœ¨<code>onUnmounted</code>é’©å­æ¥ç§»é™¤<code>mousemove</code>ç›‘å¬å™¨ï¼Œ<code>onUnmounted</code>è€¦åˆåœ¨æ¯ä¸ªç»„ä»¶å®ä¾‹ï¼Œåˆ™æ— æ³•ä»¥æ›´æœ‰æ•ˆç‡çš„æ–¹å¼å…±äº«è¿™ä¸ª<code>mousemove</code>ç›‘å¬å™¨</p><p>ä¸ºäº†åšåˆ°åœ¨ç»„ä»¶é—´å…±äº«<code>useMouse</code>çš„å“åº”å¼effectå’Œç›‘å¬å™¨ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥ç®¡ç†scopeå¦‚ä¸‹ï¼ˆè¿™ä¸ªhookä¹Ÿåœ¨vueuseä¸­ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createSharedComposable</span>(<span class="params">composable</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> subscribers = <span class="number">0</span> <span class="comment">// æ¯æ¬¡è°ƒç”¨subscribers + 1</span></span><br><span class="line">  <span class="keyword">let</span> state, scope</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">dispose</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (scope &amp;&amp; --subscribers &lt;= <span class="number">0</span>) &#123; </span><br><span class="line">      scope.<span class="title function_">stop</span>()</span><br><span class="line">      state = scope = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">    subscribers++</span><br><span class="line">    <span class="keyword">if</span> (!state) &#123; <span class="comment">// åªåœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºeffectScope</span></span><br><span class="line">      scope = <span class="title function_">effectScope</span>(<span class="literal">true</span>) <span class="comment">// trueä¸ºç‹¬ç«‹çš„scopeä½œç”¨åŸŸ</span></span><br><span class="line">      state = scope.<span class="title function_">run</span>(<span class="function">() =&gt;</span> <span class="title function_">composable</span>(...args))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onScopeDispose</span>(dispose) <span class="comment">// åœ¨å½“å‰æ´»è·ƒçš„effectä½œç”¨åŸŸä¸Šæ³¨å†Œä¸€ä¸ªå›è°ƒ</span></span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°disposeå‡½æ•°çš„å«ä¹‰æ˜¯ï¼Œå½“<strong>æ²¡æœ‰ä¸€ä¸ªç»„ä»¶åœ¨ä½¿ç”¨</strong>å®ƒçš„æ—¶å€™ä¼šæ³¨é”€(dispose)åˆ›å»ºçš„<code>effectScope</code>ï¼Œæˆ‘ä»¬åªéœ€è¦å¦‚ä¸‹æ“ä½œï¼Œå³å¯å¾—åˆ°ä¸€ä¸ª<strong>åœ¨æ‰€æœ‰ç»„ä»¶å…±äº«</strong>çš„<code>useMouse</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useSharedMouse = <span class="title function_">createSharedComposable</span>(useMouse)</span><br></pre></td></tr></table></figure><p>æ›´åŠ è¯¦ç»†çš„å…³äº<code>effectScope</code>çš„è®¨è®ºåœ¨<a href="https://github.com/vuejs/rfcs/pull/212">Reactivityâ€™s <code>effectScope</code> API #212</a></p><p>æœ¬æ¥æ˜¯æ‰“ç®—å®Œå…¨æŒ‰ç…§å®˜ç½‘çš„åˆ†ç±»è¿›è¡Œè§£è¯»ï¼Œä½†æ˜¯ç”±äºVCAçš„æ€æƒ³ï¼Œhookè¢«æ‹†çš„å¾ˆç¢å†ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸èƒ½å•çº¯é åˆ†ç±»è¿›è¡Œè§£è¯»ï¼Œæ‰€ä»¥åœ¨è®²æŸä¸ªåˆ†ç±»çš„hookæ—¶ä¹Ÿä¼šå¸¦ä¸Šå…¶ä»–çš„hooksï¼Œæ¥ä¸‹æ¥æ˜¯å¯¹æˆ‘è§‰å¾— å¸¸ç”¨ æˆ–è€… æœ‰å­¦ä¹ åˆ°ä¸œè¥¿ çš„hookæºç è¿›è¡Œè§£è¯»</p><h2 id="Browser"><a href="#Browser" class="headerlink" title="Browser"></a>Browser</h2><blockquote><p>æµè§ˆå™¨ç›¸å…³çš„hookï¼ŒåŸºäºwebæš´éœ²çš„apiæ¥å®ç°</p></blockquote><h3 id="å¯é…ç½®å…¨å±€å¯¹è±¡"><a href="#å¯é…ç½®å…¨å±€å¯¹è±¡" class="headerlink" title="å¯é…ç½®å…¨å±€å¯¹è±¡"></a>å¯é…ç½®å…¨å±€å¯¹è±¡</h3><p>Browser hookçš„æºç å¼€å¤´éƒ½æœ‰æˆ–ç±»ä¼¼ä¸‹é¢è¿™ä¸€æ®µ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> defaultWindow = <span class="comment">/* #__PURE__ */</span> isClient ? <span class="variable language_">window</span> : <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> useXXX&lt;T&gt;(<span class="attr">options</span>: <span class="title class_">ConfigurableWindow</span> = &#123;&#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable language_">window</span> = defaultWindow &#125; = options</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">xxx</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨æˆ·å¯ä»¥é…ç½®å½“å‰windowå¯¹è±¡ï¼Œè¿™ç§é…ç½®æ–¹å¼å¯¹äºä½¿ç”¨<strong>iframe</strong>å’Œ<strong>æµ‹è¯•ç¯å¢ƒ</strong>ä¸åŒçš„windowå¯¹è±¡ååˆ†æœ‰ç”¨</p><h3 id="useEventListener"><a href="#useEventListener" class="headerlink" title="useEventListener"></a>useEventListener</h3><p>å…ˆä¸Šä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬çš„<code>useEventListener</code>ï¼Œåˆ©ç”¨VCAï¼Œå°†äº‹ä»¶çš„ç›‘å¬å’Œæ³¨é”€æ”¾åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å¤„ç†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useEventListener</span> (<span class="params">target, listener, options, target = <span class="variable language_">window</span></span>) &#123;</span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    target.<span class="title function_">addEventListener</span>(type, listener, options)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    target.<span class="title function_">removeEventListener</span>(type, listener, options)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œæºç è¿˜æä¾›äº†å½“<code>target</code>çš„ç±»å‹æ˜¯<code>ref</code>æ—¶çš„æƒ…å†µï¼Œä¸ºäº†å‡å°‘ç¯‡å¹…ï¼Œä¸‹é¢çš„ä»£ç åˆ å‡äº†å‚æ•°ä¸ºç©ºçš„è¾¹ç•Œæƒ…å†µ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useEventListener</span>(<span class="params">...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">target</span>: <span class="title class_">MaybeRef</span>&lt;<span class="title class_">EventTarget</span>&gt; | <span class="literal">undefined</span> = defaultWindow;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">event</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">listener</span>: <span class="built_in">any</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">options</span>: <span class="built_in">any</span></span><br><span class="line"></span><br><span class="line">  [target, event, listener, options] = args</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> cleanup = noop</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> stopWatch = <span class="title function_">watch</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">unref</span>(target),</span><br><span class="line">    <span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">cleanup</span>()</span><br><span class="line">      <span class="keyword">if</span> (!el)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      el.<span class="title function_">addEventListener</span>(event, listener, options)</span><br><span class="line"></span><br><span class="line">      cleanup = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        el.<span class="title function_">removeEventListener</span>(event, listener, options)</span><br><span class="line">        cleanup = noop</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">immediate</span>: <span class="literal">true</span>, <span class="attr">flush</span>: <span class="string">&#x27;post&#x27;</span> &#125;, <span class="comment">// ä¸ºä»€ä¹ˆflushæ˜¯postï¼Ÿä¸‹é¢ä¼šè®²è§£</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">stop</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">stopWatch</span>()</span><br><span class="line">    <span class="title function_">cleanup</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">tryOnScopeDispose</span>(stop)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> stop</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸ºä»€ä¹ˆéœ€è¦æ”¯æŒref-target"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æ”¯æŒref-target" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æ”¯æŒref target"></a>ä¸ºä»€ä¹ˆéœ€è¦æ”¯æŒref target</h4><p>ç”¨<code>unref</code>å¾—åˆ°<code>ref</code>ä¸­çš„domå…ƒç´ ï¼Œç›‘å¬domå…ƒç´ çš„æ”¹å˜ä»¥é‡æ–°ç›‘å¬äº‹ä»¶ï¼Œåº”ç”¨åœºæ™¯å°±æ”¾å®˜ç½‘ä¾‹å­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;cond&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;element&quot;</span>&gt;</span>Div1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span> <span class="attr">ref</span>=<span class="string">&quot;element&quot;</span>&gt;</span>Div2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEventListener &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> element = ref&lt;<span class="title class_">HTMLDivElement</span>&gt;()</span><br><span class="line"><span class="title function_">useEventListener</span>(element, <span class="string">&#x27;keydown&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">key</span>) &#125;)</span><br></pre></td></tr></table></figure><h4 id="ä¸ºä»€ä¹ˆéœ€è¦watchè®¾ç½®flushä¸ºpost"><a href="#ä¸ºä»€ä¹ˆéœ€è¦watchè®¾ç½®flushä¸ºpost" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦watchè®¾ç½®flushä¸ºpost"></a>ä¸ºä»€ä¹ˆéœ€è¦watchè®¾ç½®flushä¸ºpost</h4><p>è¯¦æƒ…è¯·çœ‹<a href="https://github.com/vueuse/vueuse/issues/356">#356 Bug: useEventListener doesnâ€™t work correctly with v-if</a>ï¼Œæ„æ€å°±æ˜¯<a href="https://github.com/vuejs/vue-next/issues/1706#issuecomment-666258948%5C">æ–°ç‰ˆvue</a>çš„<code>watch</code>é»˜è®¤åœ¨æ‰€æœ‰ç»„ä»¶updateå‰æ‰§è¡Œï¼Œé‚£ä¹ˆrefæ²¡æœ‰æ›´æ–°å¯¼è‡´äº‹ä»¶æ²¡æœ‰æ›´æ–°ï¼Œæ‰€ä»¥éœ€è¦åœ¨ç»„ä»¶updateå®Œæ¯•åæ›´æ–°äº‹ä»¶ã€‚</p><h4 id="tryOnScopeDisposeæ˜¯å•¥"><a href="#tryOnScopeDisposeæ˜¯å•¥" class="headerlink" title="tryOnScopeDisposeæ˜¯å•¥"></a>tryOnScopeDisposeæ˜¯å•¥</h4><p>å…ˆåˆ¤æ–­æ˜¯å¦æœ‰æ´»è·ƒçš„effectScopeï¼Œæœ‰çš„è¯ç”¨<code>onScopeDispose</code>åœ¨å…¶ä¸Šæ³¨å†Œfnå›è°ƒ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">tryOnScopeDispose</span>(<span class="params"><span class="attr">fn</span>: <span class="title class_">Fn</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">getCurrentScope</span>()) &#123;</span><br><span class="line">    <span class="title function_">onScopeDispose</span>(fn)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="useEyeDropper"><a href="#useEyeDropper" class="headerlink" title="useEyeDropper"></a>useEyeDropper</h3><p><code>new window.EyeDropper()</code>å¯ä»¥è·å–<strong>å–è‰²å™¨</strong>çš„åŠŸèƒ½</p><h3 id="useMediaQuery"><a href="#useMediaQuery" class="headerlink" title="useMediaQuery"></a>useMediaQuery</h3><p><code>window.matchMedia(query)</code>è¿”å›<code>MediaQueryList</code>ç±»å‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MediaQueryList</span> <span class="keyword">extends</span> <span class="title class_">EventTarget</span> &#123; <span class="comment">// æµè§ˆå™¨åŸç”Ÿç±»å‹</span></span><br><span class="line">    <span class="keyword">readonly</span> <span class="attr">matches</span>: <span class="built_in">boolean</span>; <span class="comment">// æ˜¯å¦åŒ¹é…</span></span><br><span class="line">    <span class="keyword">readonly</span> <span class="attr">media</span>: <span class="built_in">string</span>;    <span class="comment">// åª’ä½“æŸ¥è¯¢å€¼</span></span><br><span class="line">    <span class="attr">onchange</span>: (<span class="function">(<span class="params"><span class="attr">this</span>: <span class="title class_">MediaQueryList</span>, <span class="attr">ev</span>: <span class="title class_">MediaQueryListEvent</span></span>) =&gt;</span> <span class="built_in">any</span>) | <span class="literal">null</span>; <span class="comment">// åª’ä½“æŸ¥è¯¢æ”¹å˜å›è°ƒ</span></span><br><span class="line"><span class="comment">// äº‹ä»¶ç»‘å®šç›¸å…³...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">mql</span>: <span class="title class_">MediaQueryList</span> = <span class="variable language_">window</span>.<span class="title function_">matchMedia</span>(<span class="string">&#x27;(max-width: 600px)&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="usePermission"><a href="#usePermission" class="headerlink" title="usePermission"></a>usePermission</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/permissions">navigator.permissions</a>å¯ä»¥è·å–ç”¨æˆ·æƒé™ï¼ˆæ‘„åƒå¤´ã€éº¦å…‹é£ç­‰ï¼‰</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isSupported = <span class="title class_">Boolean</span>(navigator &amp;&amp; <span class="string">&#x27;permissions&#x27;</span> <span class="keyword">in</span> navigator)</span><br><span class="line"><span class="keyword">const</span> state = ref&lt;<span class="title class_">PermissionState</span> | <span class="literal">undefined</span>&gt;() <span class="comment">// å­˜æƒé™çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onChange</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (permissionStatus)</span><br><span class="line">        state.<span class="property">value</span> = permissionStatus.<span class="property">state</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    permissionStatus = <span class="keyword">await</span> navigator!.<span class="property">permissions</span>.<span class="title function_">query</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;camera&#x27;</span> <span class="comment">// https://w3c.github.io/permissions/#enumdef-permissionname</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">useEventListener</span>(permissionStatus, <span class="string">&#x27;change&#x27;</span>, onChange) <span class="comment">// æœ‰ä¸‰ä¸ªçŠ¶æ€ denied&quot; | &quot;granted&quot; | &quot;prompt&quot;</span></span><br><span class="line">    <span class="title function_">onChange</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    state.<span class="property">value</span> = <span class="string">&#x27;prompt&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="usePreferredLanguages"><a href="#usePreferredLanguages" class="headerlink" title="usePreferredLanguages"></a>usePreferredLanguages</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/languages">navigator.languages</a>å¯ä»¥è·å–ç”¨æˆ·çš„åå¥½è¯­è¨€ï¼Œå¯ä»¥é€šè¿‡<code>languagechange</code>äº‹ä»¶ç›‘å¬æ”¹å˜</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = ref&lt;<span class="keyword">readonly</span> <span class="built_in">string</span>[]&gt;(navigator.<span class="property">languages</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">useEventListener</span>(<span class="variable language_">window</span>, <span class="string">&#x27;languagechange&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    value.<span class="property">value</span> = navigator.<span class="property">languages</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="useShare"><a href="#useShare" class="headerlink" title="useShare"></a>useShare</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/share">navigator.share</a>å¯ä»¥è¿›è¡Œåˆ†äº«</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isSupported = navigator &amp;&amp; <span class="string">&#x27;canShare&#x27;</span> <span class="keyword">in</span> navigator</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isSupported) &#123;</span><br><span class="line">    granted = navigator.<span class="title function_">canShare</span>(&#123; <span class="comment">// åˆ¤æ–­æ˜¯å¦èƒ½è¢«åˆ†äº«</span></span><br><span class="line">        <span class="attr">title</span>?: <span class="built_in">string</span></span><br><span class="line">        <span class="attr">files</span>?: <span class="title class_">File</span>[]</span><br><span class="line">        <span class="attr">text</span>?: <span class="built_in">string</span></span><br><span class="line">        <span class="attr">url</span>?: <span class="built_in">string</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (granted)</span><br><span class="line">        <span class="keyword">return</span> navigator.<span class="property">share</span>!(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="useWakeLock"><a href="#useWakeLock" class="headerlink" title="useWakeLock"></a>useWakeLock</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API">Screen Wake Lock API</a>å¯ä»¥é˜»æ­¢è®¾å¤‡å˜æš—æˆ–é”å±</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isSupported = navigator &amp;&amp; <span class="string">&#x27;wakeLock&#x27;</span> <span class="keyword">in</span> navigator</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params"><span class="attr">type</span>: <span class="title class_">WakeLockType</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isSupported) <span class="keyword">return</span></span><br><span class="line">    wakeLock = <span class="keyword">await</span> navigator.<span class="property">wakeLock</span>.<span class="title function_">request</span>(<span class="keyword">type</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">release</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isSupported || !wakeLock) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">await</span> wakeLock.<span class="title function_">release</span>() <span class="comment">// é‡Šæ”¾WakeLockSentinel</span></span><br><span class="line">    wakeLock = <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Watch"><a href="#Watch" class="headerlink" title="Watch"></a>Watch</h2><h2 id="State"><a href="#State" class="headerlink" title="State"></a>State</h2><h3 id="createGlobalState"><a href="#createGlobalState" class="headerlink" title="createGlobalState"></a>createGlobalState</h3><blockquote><p>ç”¨æ¥åšæŒ‚ç»„ä»¶å…¬å…±çŠ¶æ€ç®¡ç†</p></blockquote><p>ç®€å•çš„å•ä¾‹æ¨¡å¼å®ç°ï¼Œ<code>effectScope</code>çš„å‚æ•°ä¸ºtrueæ—¶ï¼Œå…¶ä¸ä¼šè¢«çˆ¶scopeæ”¶é›†å’Œå›æ”¶ï¼Œç‹¬ç«‹å­˜åœ¨</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> createGlobalState&lt;T&gt;(</span><br><span class="line">  <span class="attr">stateFactory</span>: <span class="function">() =&gt;</span> T,</span><br><span class="line">): <span class="title class_">CreateGlobalStateReturn</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> initialized = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">state</span>: T</span><br><span class="line">  <span class="keyword">const</span> scope = <span class="title function_">effectScope</span>(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!initialized) &#123;</span><br><span class="line">      state = scope.<span class="title function_">run</span>(stateFactory)!</span><br><span class="line">      initialized = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="useLocalStorage"><a href="#useLocalStorage" class="headerlink" title="useLocalStorage"></a>useLocalStorage</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> useLocalStorage&lt;T <span class="title function_">extends</span>(<span class="built_in">string</span>|<span class="built_in">number</span>|<span class="built_in">boolean</span>|<span class="built_in">object</span>|<span class="literal">null</span>)&gt; (</span><br><span class="line">  <span class="attr">key</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">initialValue</span>: <span class="title class_">MaybeRef</span>&lt;T&gt;,</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">StorageOptions</span>&lt;T&gt; = &#123;&#125;,</span><br><span class="line">): <span class="title class_">RemovableRef</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable language_">window</span> = defaultWindow &#125; = options</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useStorage</span>(key, initialValue, <span class="variable language_">window</span>?.<span class="property">localStorage</span>, options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å°±æ˜¯ç”¨<code>useStorage</code>æ¥å®ç°çš„ï¼Œ<code>useSessionStorage</code>ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹<code>useStorage</code></p><h3 id="useStorage"><a href="#useStorage" class="headerlink" title="useStorage"></a>useStorage</h3><p>åœ¨æµè§ˆå™¨é»˜è®¤çš„Storageä¹‹ä¸Šåƒ<a href="https://github.com/marcuswestin/store.js">store.js</a>ä¸€æ ·å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼ˆåºåˆ—åŒ–ï¼‰ï¼Œå¦åˆ™å¦‚æœå­˜ä¸€ä¸ªå¯¹è±¡åœ¨æµè§ˆå™¨çš„Storageå­˜çš„ä¼šæ˜¯<code>xxx.toString()</code>ä¹‹åçš„å€¼ã€‚ä½†æ˜¯<code>useStorage</code>æ¯”èµ·<a href="https://github.com/marcuswestin/store.js">store.js</a>æ›´è¿›ä¸€æ­¥çš„å¢åŠ äº†å¯¹<code>Map</code>å’Œ<code>Set</code>ç±»å‹çš„æ•°æ®çš„å¤„ç†ï¼ˆ**<code>Map</code>å’Œ<code>Set</code>å­˜åœ¨é»˜è®¤çš„Storageå’Œstore.jséƒ½æ˜¯ç©ºå¯¹è±¡**ï¼‰</p><p>åˆ©ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œå¯¹æ¯ç§æ•°æ®ç±»å‹å®šä¹‰<code>read</code>ã€<code>write</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">StorageSerializers</span>: <span class="title class_">Record</span>&lt;<span class="string">&#x27;boolean&#x27;</span> | <span class="string">&#x27;object&#x27;</span> | <span class="string">&#x27;number&#x27;</span> | <span class="string">&#x27;any&#x27;</span> | <span class="string">&#x27;string&#x27;</span> | <span class="string">&#x27;map&#x27;</span> | <span class="string">&#x27;set&#x27;</span>, <span class="title class_">Serializer</span>&lt;<span class="built_in">any</span>&gt;&gt; = &#123;</span><br><span class="line">  <span class="attr">boolean</span>: &#123;</span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> v === <span class="string">&#x27;true&#x27;</span>,</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">String</span>(v),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">object</span>: &#123;</span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(v),</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(v),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">number</span>: &#123;</span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">Number</span>.<span class="built_in">parseFloat</span>(v),</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">String</span>(v),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">any</span>: &#123;</span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> v,</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">String</span>(v),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">string</span>: &#123;</span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> v,</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">String</span>(v),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">map</span>: &#123; <span class="comment">// mapåºåˆ—åŒ–</span></span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Map</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(v)),</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="title class_">Array</span>.<span class="title function_">from</span>((v <span class="keyword">as</span> <span class="title class_">Map</span>&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt;).<span class="title function_">entries</span>())),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">set</span>: &#123; <span class="comment">// setåºåˆ—åŒ–</span></span><br><span class="line">    <span class="attr">read</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Set</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(v)),</span><br><span class="line">    <span class="attr">write</span>: <span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="title class_">Array</span>.<span class="title function_">from</span>((v <span class="keyword">as</span> <span class="title class_">Set</span>&lt;<span class="built_in">any</span>&gt;).<span class="title function_">entries</span>())),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åˆ¤æ–­ç”¨æˆ·ä¼ å…¥çš„æ•°æ®ç±»å‹ï¼Œè¿›è¡Œé€‰æ‹©å¯¹åº”çš„<code>read</code>ã€<code>write</code>æ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">type</span> = rawInit == <span class="literal">null</span></span><br><span class="line">  ? <span class="string">&#x27;any&#x27;</span></span><br><span class="line">  : rawInit <span class="keyword">instanceof</span> <span class="title class_">Set</span></span><br><span class="line">    ? <span class="string">&#x27;set&#x27;</span></span><br><span class="line">    : rawInit <span class="keyword">instanceof</span> <span class="title class_">Map</span></span><br><span class="line">      ? <span class="string">&#x27;map&#x27;</span></span><br><span class="line">      : <span class="keyword">typeof</span> rawInit === <span class="string">&#x27;boolean&#x27;</span></span><br><span class="line">        ? <span class="string">&#x27;boolean&#x27;</span></span><br><span class="line">        : <span class="keyword">typeof</span> rawInit === <span class="string">&#x27;string&#x27;</span></span><br><span class="line">          ? <span class="string">&#x27;string&#x27;</span></span><br><span class="line">          : <span class="keyword">typeof</span> rawInit === <span class="string">&#x27;object&#x27;</span></span><br><span class="line">            ? <span class="string">&#x27;object&#x27;</span></span><br><span class="line">            : <span class="title class_">Array</span>.<span class="title function_">isArray</span>(rawInit) <span class="comment">// è¿™é‡Œä¸å¤ªè®¤åŒï¼Œtypeof [] === &#x27;object&#x27;ï¼Œæ²¡å¿…è¦å†åŠ è¿™ä¸ªåˆ¤æ–­äº†æŠŠ</span></span><br><span class="line">              ? <span class="string">&#x27;object&#x27;</span></span><br><span class="line">              : !<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(rawInit)</span><br><span class="line">                ? <span class="string">&#x27;number&#x27;</span></span><br><span class="line">                : <span class="string">&#x27;any&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serializer = options.<span class="property">serializer</span> ?? <span class="title class_">StorageSerializers</span>[<span class="keyword">type</span>] <span class="comment">// ç”¨æˆ·è¿˜å¯ä»¥å®šä¹‰è‡ªå·±çš„åºåˆ—åŒ–æ–¹æ³•ï¼Œä½†å¿…é¡»å…·æœ‰readå’Œwriteæ–¹æ³•</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å¯¹æ•°æ®çš„åˆå§‹åŒ–</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">rawInit</span>: T = <span class="title function_">unref</span>(initialValue) <span class="comment">// ç”¨æˆ·ä¼ å…¥çš„åˆå§‹å€¼</span></span><br><span class="line"><span class="keyword">const</span> data = (shallow ? shallowRef : ref)(initialValue) <span class="keyword">as</span> <span class="title class_">Ref</span>&lt;T&gt; <span class="comment">// ç”¨æˆ·å¯ä»¥é…ç½®æ˜¯æµ…å“åº”å¼è¿˜æ˜¯æ·±ï¼Œæœ€åä¼šè¿”å›ç»™ç”¨æˆ·</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!storage)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> rawValue = storage.<span class="title function_">getItem</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (rawValue == <span class="literal">null</span>) &#123; <span class="comment">// å¦‚æœkeyå¯¹åº”çš„å€¼ä¸ºç©ºï¼Œé‚£ä¹ˆæ˜¯é¦–æ¬¡</span></span><br><span class="line">        data.<span class="property">value</span> = rawInit <span class="comment">// åˆå§‹åŒ–å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (writeDefaults &amp;&amp; rawInit !== <span class="literal">null</span>) <span class="comment">// ç”¨æˆ·å¯é…ç½®æ˜¯å¦é¦–æ¬¡å­˜å…¥Storage</span></span><br><span class="line">            storage.<span class="title function_">setItem</span>(key, serializer.<span class="title function_">write</span>(rawInit))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        data.<span class="property">value</span> = serializer.<span class="title function_">read</span>(rawValue) <span class="comment">// å¦‚æœStorageå­˜åœ¨å¯¹åº”å€¼ï¼Œåºåˆ—åŒ–è¯»å–</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">onError</span>(e) <span class="comment">// ç”¨æˆ·ä¼ å…¥çš„é”™è¯¯å¤„ç†å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯æ ¹æ®ç›‘å¬dataçš„å˜åŒ–å­˜å…¥Storageï¼Œ<code>watchWithFilter</code>å¯ä»¥çœ‹åšæ˜¯æ–°å¢äº†<code>eventFilter</code>é€‰é¡¹çš„<code>watch</code>ï¼Œåœ¨åæ–‡ä¼šæè¿°ï¼Œä¹Ÿæ˜¯vueuseå¾ˆé‡è¦çš„ä¸€ä¸ªç‰¹æ€§</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watchWithFilter</span>(</span><br><span class="line">    data,</span><br><span class="line">    <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (data.<span class="property">value</span> == <span class="literal">null</span>)</span><br><span class="line">                storage.<span class="title function_">removeItem</span>(key)</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                storage.<span class="title function_">setItem</span>(key, serializer.<span class="title function_">write</span>(data.<span class="property">value</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="title function_">onError</span>(e)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        flush, <span class="comment">// å‡æ˜¯ç”¨æˆ·å¯é…ç½®çš„é€‰é¡¹</span></span><br><span class="line">        deep,</span><br><span class="line">        eventFilter,</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ä½†ä»æœ‰å·¨éšè”½çš„bugï¼ˆå“ˆå“ˆå“ˆ)ï¼Œä¸ºäº†æ”¯æŒå“åº”å¼çš„å­˜å–Storageï¼Œç”¨äº†refç±»å‹çš„dataï¼Œ<strong>åœ¨åŒæºä¸‹çš„å¤šä¸ªæ ‡ç­¾çš„æƒ…å†µä¸‹ï¼Œå…¶ä¸­ä¸€ä¸ªé¡µé¢å¯¹å¦ä¸€ä¸ªé¡µé¢ç”¨<code>useStorage</code>ä¿®æ”¹äº†æ•°æ®ï¼Œä½†å¦ä¸€ä¸ªé¡µé¢useStorageå†…éƒ¨çš„dataè¿˜æ˜¯åŸæ¥çš„å€¼</strong></p><p>è§£å†³æ–¹å¼ï¼šç›‘å¬<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/StorageEvent">storage</a>äº‹ä»¶ï¼ˆå½“é¡µé¢ä½¿ç”¨çš„storageè¢«å…¶ä»–é¡µé¢ä¿®æ”¹æ—¶ä¼šè§¦å‘ï¼‰</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">read</span>(<span class="params"><span class="attr">event</span>?: <span class="title class_">StorageEvent</span></span>) &#123; <span class="comment">// å°†ä¸Šé¢åˆå§‹åŒ–å€¼çš„é€»è¾‘å°è£…ä¸ºreadå‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (!storage || (event &amp;&amp; event.<span class="property">key</span> !== key))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> rawValue = event ? event.<span class="property">newValue</span> : storage.<span class="title function_">getItem</span>(key)</span><br><span class="line"><span class="comment">// è¯»å€¼çœç•¥...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="title function_">onError</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span> &amp;&amp; listenToStorageChanges) <span class="comment">// ç”¨æˆ·ä¹Ÿå¯ä»¥é…ç½®ä¸ç›‘å¬</span></span><br><span class="line">    <span class="title function_">useEventListener</span>(<span class="variable language_">window</span>, <span class="string">&#x27;storage&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">read</span>(e), <span class="number">0</span>)) <span class="comment">// é‡æ–°è¯»å–å€¼ç»™data</span></span><br></pre></td></tr></table></figure><h2 id="Sensors"><a href="#Sensors" class="headerlink" title="Sensors"></a>Sensors</h2><h3 id="onClickOutside"><a href="#onClickOutside" class="headerlink" title="onClickOutside"></a>onClickOutside</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h2><h3 id="useRafFn"><a href="#useRafFn" class="headerlink" title="useRafFn"></a>useRafFn</h3><blockquote><p>å¯ä»¥æš‚åœã€æ¢å¤ã€è·å–å½“å‰çŠ¶æ€çš„<code>requestAnimationFrame</code></p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useRafFn</span>(<span class="params"><span class="attr">fn</span>: <span class="title class_">Fn</span>, <span class="attr">options</span>: <span class="title class_">RafFnOptions</span> = &#123;&#125;</span>): <span class="title class_">Pausable</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    immediate = <span class="literal">true</span>,</span><br><span class="line">    <span class="variable language_">window</span> = defaultWindow,</span><br><span class="line">  &#125; = options</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> isActive = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isActive.<span class="property">value</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="title function_">fn</span>()</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>)</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(loop)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">resume</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isActive.<span class="property">value</span>) &#123; <span class="comment">// å¦‚æœæ˜¯éæ´»è·ƒçŠ¶æ€æ‰å¯ä»¥æ¢å¤</span></span><br><span class="line">      isActive.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">      <span class="title function_">loop</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">pause</span>(<span class="params"></span>) &#123;</span><br><span class="line">    isActive.<span class="property">value</span> = <span class="literal">false</span> <span class="comment">// æš‚åœå°±ç›´æ¥è®¾ç½®ä¸ºfalseï¼Œåœ¨loopä¸­å¦‚æœfalseåˆ™ç›´æ¥è·³è¿‡fnæ‰§è¡Œ</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (immediate)</span><br><span class="line">    <span class="title function_">resume</span>()</span><br><span class="line"></span><br><span class="line">  <span class="title function_">tryOnScopeDispose</span>(pause)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    isActive,</span><br><span class="line">    pause,</span><br><span class="line">    resume,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç•™æœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆpauseä¸­ä¸ç”¨<code>cancelAnimationFrame</code>æ¥å–æ¶ˆ<code>requestAnimationFrame</code></p><h3 id="useTransition"><a href="#useTransition" class="headerlink" title="useTransition"></a>useTransition</h3><p><strong>å¯é…ç½®é¡¹</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">CubicBezierPoints</span> = [<span class="built_in">number</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, <span class="built_in">number</span>]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">EasingFunction</span> = <span class="function">(<span class="params"><span class="attr">n</span>: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useTransition</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">source</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span> | <span class="built_in">number</span>[]&gt; | <span class="title class_">MaybeRef</span>&lt;<span class="built_in">number</span>&gt;[],</span></span><br><span class="line"><span class="params">  <span class="attr">options</span>: <span class="title class_">TransitionOptions</span> = &#123;&#125;,</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">ComputedRef</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="comment">// æ—¶é—´ç›¸å…³å•ä½å‡ä¸ºms</span></span><br><span class="line">    delay = <span class="number">0</span>,           <span class="comment">// delay åæ‰§è¡Œ</span></span><br><span class="line">    disabled = <span class="literal">false</span>,    <span class="comment">// æ˜¯å¦å…³é—­</span></span><br><span class="line">    duration = <span class="number">1000</span>,     <span class="comment">// æŒç»­æ—¶é—´</span></span><br><span class="line">    onFinished = noop,   <span class="comment">// å®Œæˆåæ‰§è¡Œ</span></span><br><span class="line">    onStarted = noop,    <span class="comment">// å¼€å§‹æ—¶æ‰§è¡Œ</span></span><br><span class="line">    transition = linear, <span class="comment">// è½¬åŒ–ç®—æ³• MaybeRef&lt;EasingFunction | CubicBezierPoints&gt;ï¼Œé»˜è®¤å€¼æ˜¯ x =&gt; x</span></span><br><span class="line">  &#125; = options</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é¢„å¤„ç†</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useTransition</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">source</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span> | <span class="built_in">number</span>[]&gt; | <span class="title class_">MaybeRef</span>&lt;<span class="built_in">number</span>&gt;[],</span></span><br><span class="line"><span class="params">  <span class="attr">options</span>: <span class="title class_">TransitionOptions</span> = &#123;&#125;,</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">ComputedRef</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="comment">// å¯é…ç½®é¡¹</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºå½“å‰çš„è¿‡æ¸¡å‡½æ•°ï¼Œå¦‚æœç”¨æˆ·è‡ªå®šä¹‰äº†è¿‡æ¸¡å‡½æ•°åˆ™ä¸åšå¤„ç†ï¼Œå¦åˆ™æ ¹æ®è´èµ›å°”æ›²çº¿å€¼åˆ›å»ºè¿‡æ¸¡å‡½æ•°</span></span><br><span class="line">  <span class="keyword">const</span> currentTransition = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> t = <span class="title function_">unref</span>(transition)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isFunction</span>(t) ? t : <span class="title function_">createEasingFunction</span>(t)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç”¨unrefå¤„ç†sourceå‚æ•°ï¼Œå¦‚æœsourceæ˜¯æ•°ç»„åˆ™ä¾æ¬¡unref</span></span><br><span class="line">  <span class="keyword">const</span> sourceValue = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> s = unref&lt;<span class="built_in">number</span> | <span class="title class_">MaybeRef</span>&lt;<span class="built_in">number</span>&gt;[]&gt;(source)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isNumber</span>(s) ? s : s.<span class="title function_">map</span>(unref) <span class="keyword">as</span> <span class="built_in">number</span>[]</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è§„æ ¼åŒ–sourceï¼Œæ•´æˆæ•°ç»„</span></span><br><span class="line">  <span class="keyword">const</span> sourceVector = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> <span class="title function_">isNumber</span>(sourceValue.<span class="property">value</span>) ? [sourceValue.<span class="property">value</span>] : sourceValue.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè¿‡æ¸¡å‡½æ•°ï¼Œçº¯æ•°å­¦</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createEasingFunction</span>(<span class="params">[p0, p1, p2, p3]: <span class="title class_">CubicBezierPoints</span></span>): <span class="title class_">EasingFunction</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">a</span> = (<span class="params"><span class="attr">a1</span>: <span class="built_in">number</span>, <span class="attr">a2</span>: <span class="built_in">number</span></span>) =&gt; <span class="number">1</span> - <span class="number">3</span> * a2 + <span class="number">3</span> * a1</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">b</span> = (<span class="params"><span class="attr">a1</span>: <span class="built_in">number</span>, <span class="attr">a2</span>: <span class="built_in">number</span></span>) =&gt; <span class="number">3</span> * a2 - <span class="number">6</span> * a1</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">c</span> = (<span class="params"><span class="attr">a1</span>: <span class="built_in">number</span></span>) =&gt; <span class="number">3</span> * a1</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">calcBezier</span> = (<span class="params"><span class="attr">t</span>: <span class="built_in">number</span>, <span class="attr">a1</span>: <span class="built_in">number</span>, <span class="attr">a2</span>: <span class="built_in">number</span></span>) =&gt; ((<span class="title function_">a</span>(a1, a2) * t + <span class="title function_">b</span>(a1, a2)) * t + <span class="title function_">c</span>(a1)) * t</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getSlope</span> = (<span class="params"><span class="attr">t</span>: <span class="built_in">number</span>, <span class="attr">a1</span>: <span class="built_in">number</span>, <span class="attr">a2</span>: <span class="built_in">number</span></span>) =&gt; <span class="number">3</span> * <span class="title function_">a</span>(a1, a2) * t * t + <span class="number">2</span> * <span class="title function_">b</span>(a1, a2) * t + <span class="title function_">c</span>(a1)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getTforX</span> = (<span class="params"><span class="attr">x</span>: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> aGuessT = x</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">      <span class="keyword">const</span> currentSlope = <span class="title function_">getSlope</span>(aGuessT, p0, p2)</span><br><span class="line">      <span class="keyword">if</span> (currentSlope === <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> aGuessT</span><br><span class="line">      <span class="keyword">const</span> currentX = <span class="title function_">calcBezier</span>(aGuessT, p0, p2) - x</span><br><span class="line">      aGuessT -= currentX / currentSlope</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> aGuessT</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params"><span class="attr">x</span>: <span class="built_in">number</span></span>) =&gt;</span> p0 === p1 &amp;&amp; p2 === p3 ? x : <span class="title function_">calcBezier</span>(<span class="title function_">getTforX</span>(x), p1, p3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æä¾›äº†å‡ ç§è¿‡æ¸¡é¢„è®¾</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">TransitionPresets</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">CubicBezierPoints</span> | <span class="title class_">EasingFunction</span>&gt; = &#123;</span><br><span class="line">  <span class="attr">easeInSine</span>: [<span class="number">0.12</span>, <span class="number">0</span>, <span class="number">0.39</span>, <span class="number">0</span>],</span><br><span class="line">  <span class="attr">easeOutSine</span>: [<span class="number">0.61</span>, <span class="number">1</span>, <span class="number">0.88</span>, <span class="number">1</span>],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¦æƒ…å¯ä»¥çœ‹ <a href="https://easings.net/cn#">ç¼“åŠ¨å‡½æ•°</a>ã€ <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/easing-function#easing_functions">MDNï¼šç¼“åŠ¨å‡½æ•°</a></p><p><strong>å…³é”®é€»è¾‘</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> outputVector = <span class="title function_">ref</span>(sourceVector.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">0</span>)) <span class="comment">// ç”¨ä»¥å­˜å‚¨è¾“å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿‡æ¸¡ä¸»æµç¨‹ï¼Œå¯ä»¥æš‚åœ</span></span><br><span class="line"><span class="keyword">const</span> &#123; resume, pause &#125; = <span class="title function_">useRafFn</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// å¯ä»¥æš‚åœã€æ¢å¤çš„ requestAnimationFrame</span></span><br><span class="line">  <span class="keyword">const</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  <span class="keyword">const</span> progress = <span class="title function_">clamp</span>(<span class="number">1</span> - ((endAt - now) / currentDuration), <span class="number">0</span>, <span class="number">1</span>) <span class="comment">// è¿‡æ¸¡è¿›åº¦ï¼Œclampå°†å€¼é™åˆ¶åœ¨0-1ä¹‹é—´</span></span><br><span class="line"></span><br><span class="line">  outputVector.<span class="property">value</span> = startVector.<span class="title function_">map</span>(<span class="function">(<span class="params">val, i</span>) =&gt;</span> val + ((diffVector[i] ?? <span class="number">0</span>) * currentTransition.<span class="title function_">value</span>(progress))) <span class="comment">// æ›´æ–°output</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (progress &gt;= <span class="number">1</span>) &#123; <span class="comment">// å®Œæˆè¿‡æ¸¡</span></span><br><span class="line">    <span class="title function_">pause</span>() <span class="comment">// æš‚åœ requestAnimationFrame</span></span><br><span class="line">    <span class="title function_">onFinished</span>() <span class="comment">// æ‰§è¡Œoptionsä¸­çš„å®Œæˆå›è°ƒ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, &#123; <span class="attr">immediate</span>: <span class="literal">false</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> timeout = <span class="title function_">useTimeoutFn</span>(start, delay, &#123; <span class="attr">immediate</span>: <span class="literal">false</span> &#125;) <span class="comment">// delayæ¯«ç§’åæ‰§è¡Œstartå‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">start</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">pause</span>() <span class="comment">// æš‚åœ è¿‡æ¸¡</span></span><br><span class="line"></span><br><span class="line">  currentDuration = <span class="title function_">unref</span>(duration)</span><br><span class="line">  diffVector = outputVector.<span class="property">value</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">n, i</span>) =&gt;</span> (sourceVector.<span class="property">value</span>[i] ?? <span class="number">0</span>) - (outputVector.<span class="property">value</span>[i] ?? <span class="number">0</span>)) <span class="comment">// åˆå§‹å€¼å’Œå½“å‰å€¼çš„diff</span></span><br><span class="line">  startVector = outputVector.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">0</span>) <span class="comment">// æ‹·è´åˆå§‹å€¼</span></span><br><span class="line">  startAt = <span class="title class_">Date</span>.<span class="title function_">now</span>() <span class="comment">// å¼€å§‹æ—¶é—´</span></span><br><span class="line">  endAt = startAt + currentDuration <span class="comment">// ç»“æŸæ—¶é—´ï¼Œç”¨åœ¨è®¡ç®—progress</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">resume</span>() <span class="comment">// å¼€å§‹è¿‡æ¸¡</span></span><br><span class="line">  <span class="title function_">onStarted</span>() <span class="comment">// æ‰§è¡Œoptionsä¸­çš„å¼€å§‹å›è°ƒ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>(sourceVector, <span class="function">() =&gt;</span> &#123; <span class="comment">// ç›‘å¬sourceVectorçš„å˜åŒ–</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">unref</span>(disabled)) &#123; <span class="comment">// å¦‚æœæš‚åœè¿‡æ¸¡ï¼Œå°†è¾“å‡ºè¿˜åŸå›åˆå§‹å€¼</span></span><br><span class="line">    outputVector.<span class="property">value</span> = sourceVector.<span class="property">value</span>.<span class="title function_">slice</span>(<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">unref</span>(delay) &lt;= <span class="number">0</span>) <span class="title function_">start</span>() <span class="comment">// å¦‚æœæ²¡æœ‰å»¶è¿Ÿï¼Œåˆ™å¼€å§‹è¿‡æ¸¡</span></span><br><span class="line">    <span class="keyword">else</span> timeout.<span class="title function_">start</span>() <span class="comment">// å¦‚æœæœ‰å»¶è¿Ÿï¼Œåˆ™å¼€å§‹ä¸Šé¢åˆ›å»ºå¥½çš„timeout</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> targetVector = <span class="title function_">unref</span>(disabled) ? sourceVector : outputVector <span class="comment">// å¦‚æœæš‚åœè¿‡æ¸¡ï¼Œå°†è¾“å‡ºè¿˜åŸå›åˆå§‹å€¼</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">isNumber</span>(sourceValue.<span class="property">value</span>) ? targetVector.<span class="property">value</span>[<span class="number">0</span>] : targetVector.<span class="property">value</span> <span class="comment">// ä¸ºå€¼è§£å¼€æ•°ç»„åŒ…è£…ï¼Œæ•°ç»„åŸæ ·è¿”å›</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä¸ä¼šæ”¾apiçš„ç”¨æ³•ï¼Œå»ºè®®å…ˆçœ‹çœ‹æ˜¯æ€ä¹ˆç”¨çš„&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;é¡¹ç›®æ¶æ„&quot;&gt;&lt;a href=&quot;#é¡¹ç›®æ¶æ„&quot; class=&quot;headerlink&quot; title=&quot;é¡¹ç›®æ¶æ„&quot;&gt;&lt;/a&gt;é¡¹ç›®æ¶æ„&lt;/h2&gt;&lt;p&gt;é‡‡ç”¨monorepoçš„å½¢å¼ï¼Œé¡¹ç›®ç›®å½•ä¸‹æœ‰å¤šä¸ªå­é¡¹ç›®ï¼Œä¸‹é¢æ”¾äº†èµ„æ–™é“¾æ¥å’Œå‡ å¤„ç”¨æ³•ï¼Œå…¶ä»–æœ¬æ–‡ä¸å¤šèµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://juejin.cn/post/6944877410827370504&quot;&gt;ç°ä»£å‰ç«¯å·¥ç¨‹ä¸ºä»€ä¹ˆè¶Šæ¥è¶Šç¦»ä¸å¼€ Monorepo?&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://www.codeleading.com/article/46915806308/&quot;&gt;ä¸ºä»€ä¹ˆä½¿ç”¨pnpmå¯ä»¥å…‰é€Ÿå»ºç«‹å¥½ç”¨çš„monorepoï¼ˆæ¯”yarn&amp;#x2F;lernaæ•ˆç‡é«˜ï¼‰&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pnpm.io/zh/workspaces&quot;&gt;pnpm workspaceæ–‡æ¡£&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="æºç è§£è¯»" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/"/>
    
    
    <category term="vue" scheme="https://liang5757.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>ã€æºç è§£è¯»ã€‘æ¨¡å—æ‡’åŠ è½½(åœ¨ä½¿ç”¨æ—¶)</title>
    <link href="https://liang5757.github.io/2021/09/23/Js/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/%E6%A8%A1%E5%9D%97%E6%87%92%E5%8A%A0%E8%BD%BD/"/>
    <id>https://liang5757.github.io/2021/09/23/Js/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/%E6%A8%A1%E5%9D%97%E6%87%92%E5%8A%A0%E8%BD%BD/</id>
    <published>2021-09-23T15:53:24.000Z</published>
    <updated>2025-12-07T10:16:59.212Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨çœ‹ä¸ºä»€ä¹ˆvueæ–‡æ¡£èƒ½åšåˆ°<strong>æ–°å†…å®¹å¯ç”¨æ›´æ–°</strong>ï¼ˆåˆ©ç”¨service workerï¼‰çš„æ—¶å€™ï¼Œé¡ºä¾¿çœ‹åˆ°äº†<a href="https://github.com/yeoman/update-notifier">update-notifier</a>ï¼ˆæç¤ºç‰ˆæœ¬æ›´æ–°çš„åº“ï¼Œå®ç°æ–¹å¼ï¼šå®šæ—¶æ£€æŸ¥npmä¸Šçš„ç‰ˆæœ¬å’Œæœ¬åœ°package.jsonçš„ç‰ˆæœ¬å¯¹æ¯”ï¼Œæœ‰å·®å¼‚å°±æç¤ºç”¨æˆ·æ›´æ–°ï¼‰ï¼Œçœ‹<code>update-notifier</code>æºç çš„æ—¶å€™å‘ç°æœ‰å¾ˆå¤š<a href="https://github.com/sindresorhus/import-lazy">lazyImport</a>ï¼Œè§‰å¾—æŒºæ–°å¥‡ï¼Œäºæ˜¯æœ‰äº†è¿™ç¯‡æ–‡ç« </p></blockquote><h2 id="æ€æƒ³"><a href="#æ€æƒ³" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h2><p>ä¸ºäº†æé«˜åº”ç”¨çš„å¯åŠ¨æ—¶é—´ï¼Œåœ¨æ²¡æœ‰ç”¨åˆ°ä»“åº“çš„é¢å¤–åŠŸèƒ½æ—¶ä¸åŠ è½½æ¨¡å—ï¼Œæ‰€ä»¥å°†æ¨¡å—åŠ è½½å»¶è¿Ÿåˆ°ä½¿ç”¨ä¹‹å‰</p><span id="more"></span><h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> importLazy = <span class="built_in">require</span>(<span class="string">&#x27;import-lazy&#x27;</span>)(<span class="built_in">require</span>);</span><br><span class="line"><span class="keyword">const</span> _ = <span class="title function_">importLazy</span>(<span class="string">&#x27;lodash&#x27;</span>);</span><br><span class="line"></span><br><span class="line">_.<span class="title function_">isNumber</span>(<span class="number">2</span>); <span class="comment">// åœ¨ä½¿ç”¨çš„æ—¶å€™æ‰è§¦å‘æ¨¡å—åŠ è½½</span></span><br></pre></td></tr></table></figure><h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><p>å®é™…ä¸Šæ˜¯ç”¨proxyä»£ç†äº†getæ“ä½œï¼Œåœ¨getçš„æ—¶å€™æ‰è§¦å‘æ¨¡å—åŠ è½½</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">lazy</span> = (<span class="params">importedModule, importFn, moduleId</span>) =&gt;</span><br><span class="line">importedModule === <span class="literal">undefined</span> ? <span class="title function_">importFn</span>(moduleId) : importedModule;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">importFn</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="params">moduleId</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> importedModule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handler = &#123;</span><br><span class="line"><span class="attr">get</span>: <span class="function">(<span class="params">target, property</span>) =&gt;</span> &#123;</span><br><span class="line">importedModule = <span class="title function_">lazy</span>(importedModule, importFn, moduleId);</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(importedModule, property);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">apply</span>: <span class="function">(<span class="params">target, thisArgument, argumentsList</span>) =&gt;</span> &#123;</span><br><span class="line">importedModule = <span class="title function_">lazy</span>(importedModule, importFn, moduleId);</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">apply</span>(importedModule, thisArgument, argumentsList);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">construct</span>: <span class="function">(<span class="params">target, argumentsList</span>) =&gt;</span> &#123;</span><br><span class="line">importedModule = <span class="title function_">lazy</span>(importedModule, importFn, moduleId);</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">construct</span>(importedModule, argumentsList);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// eslint-disable-next-line prefer-arrow-callback</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;, handler);</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿå¯¼è‡´æˆ‘ä»¬åœ¨ä½¿ç”¨import-lazyçš„æ—¶å€™ä¸èƒ½æŒ‰éœ€åŠ è½½</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;isNumber, isString&#125; = <span class="title function_">importLazy</span>(<span class="string">&#x27;lodash&#x27;</span>); <span class="comment">// ä¸æ”¯æŒ</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;åœ¨çœ‹ä¸ºä»€ä¹ˆvueæ–‡æ¡£èƒ½åšåˆ°&lt;strong&gt;æ–°å†…å®¹å¯ç”¨æ›´æ–°&lt;/strong&gt;ï¼ˆåˆ©ç”¨service workerï¼‰çš„æ—¶å€™ï¼Œé¡ºä¾¿çœ‹åˆ°äº†&lt;a href=&quot;https://github.com/yeoman/update-notifier&quot;&gt;update-notifier&lt;/a&gt;ï¼ˆæç¤ºç‰ˆæœ¬æ›´æ–°çš„åº“ï¼Œå®ç°æ–¹å¼ï¼šå®šæ—¶æ£€æŸ¥npmä¸Šçš„ç‰ˆæœ¬å’Œæœ¬åœ°package.jsonçš„ç‰ˆæœ¬å¯¹æ¯”ï¼Œæœ‰å·®å¼‚å°±æç¤ºç”¨æˆ·æ›´æ–°ï¼‰ï¼Œçœ‹&lt;code&gt;update-notifier&lt;/code&gt;æºç çš„æ—¶å€™å‘ç°æœ‰å¾ˆå¤š&lt;a href=&quot;https://github.com/sindresorhus/import-lazy&quot;&gt;lazyImport&lt;/a&gt;ï¼Œè§‰å¾—æŒºæ–°å¥‡ï¼Œäºæ˜¯æœ‰äº†è¿™ç¯‡æ–‡ç« &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;æ€æƒ³&quot;&gt;&lt;a href=&quot;#æ€æƒ³&quot; class=&quot;headerlink&quot; title=&quot;æ€æƒ³&quot;&gt;&lt;/a&gt;æ€æƒ³&lt;/h2&gt;&lt;p&gt;ä¸ºäº†æé«˜åº”ç”¨çš„å¯åŠ¨æ—¶é—´ï¼Œåœ¨æ²¡æœ‰ç”¨åˆ°ä»“åº“çš„é¢å¤–åŠŸèƒ½æ—¶ä¸åŠ è½½æ¨¡å—ï¼Œæ‰€ä»¥å°†æ¨¡å—åŠ è½½å»¶è¿Ÿåˆ°ä½¿ç”¨ä¹‹å‰&lt;/p&gt;</summary>
    
    
    
    <category term="æºç è§£è¯»" scheme="https://liang5757.github.io/categories/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/"/>
    
    
    <category term="js" scheme="https://liang5757.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>è·¨å¹³å°çš„æ‹–æ‹½</title>
    <link href="https://liang5757.github.io/2021/09/12/Js/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%8B%96%E6%8B%BD/"/>
    <id>https://liang5757.github.io/2021/09/12/Js/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%8B%96%E6%8B%BD/</id>
    <published>2021-09-12T08:46:27.000Z</published>
    <updated>2025-12-07T10:16:59.212Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://liang5757.github.io/2021/04/06/Js/crossvent%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/">crossvent</a>ï¼šå°è£…è·¨å¹³å°äº‹ä»¶ç»‘å®šçš„åº“</p></blockquote><h2 id="è·¨å¹³å°çš„è§¦æ‘¸äº‹ä»¶"><a href="#è·¨å¹³å°çš„è§¦æ‘¸äº‹ä»¶" class="headerlink" title="è·¨å¹³å°çš„è§¦æ‘¸äº‹ä»¶"></a>è·¨å¹³å°çš„è§¦æ‘¸äº‹ä»¶</h2><p>åˆ©ç”¨<code>crossvent</code>å°è£…ç»‘å®š<strong>è·¨å¹³å°æ‹–æ‹½äº‹ä»¶</strong>çš„æ–¹æ³•<code>touchy</code>ï¼Œä»¥ä¾¿æ”¯æŒç§»åŠ¨ç«¯å’Œpcç«¯</p><p>æ ¹æ®ç¯å¢ƒè·å–çš„è§¦æ‘¸äº‹ä»¶åï¼Œ<strong>ç”¨æ‡’åŠ è½½çš„æ–¹å¼æ›¿æ¢æ‰touchyå‡½æ•°ï¼Œä¹‹åç»‘å®šäº‹ä»¶ä¸éœ€è¦å†åˆ¤æ–­</strong></p><span id="more"></span><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; add <span class="keyword">as</span> addEvent &#125; <span class="keyword">from</span> <span class="string">&#x27;crossvent&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> touchy = <span class="keyword">function</span> (<span class="params">el, type, fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> touch = &#123;</span><br><span class="line">        <span class="attr">mouseup</span>: <span class="string">&#x27;touchend&#x27;</span>,</span><br><span class="line">        <span class="attr">mousedown</span>: <span class="string">&#x27;touchstart&#x27;</span>,</span><br><span class="line">        <span class="attr">mousemove</span>: <span class="string">&#x27;touchmove&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> pointers = &#123;</span><br><span class="line">        <span class="attr">mouseup</span>: <span class="string">&#x27;pointerup&#x27;</span>,</span><br><span class="line">        <span class="attr">mousedown</span>: <span class="string">&#x27;pointerdown&#x27;</span>,</span><br><span class="line">        <span class="attr">mousemove</span>: <span class="string">&#x27;pointermove&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> microsoft = &#123;</span><br><span class="line">        <span class="attr">mouseup</span>: <span class="string">&#x27;MSPointerUp&#x27;</span>,</span><br><span class="line">        <span class="attr">mousedown</span>: <span class="string">&#x27;MSPointerDown&#x27;</span>,</span><br><span class="line">        <span class="attr">mousemove</span>: <span class="string">&#x27;MSPointerMove&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="property">pointerEnabled</span>) &#123;</span><br><span class="line">        touchy = <span class="keyword">function</span> (<span class="params">el, type, fn</span>) &#123;</span><br><span class="line">            <span class="title function_">addEvent</span>(el, pointers[type], fn);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="property">msPointerEnabled</span>) &#123;</span><br><span class="line">        touchy = <span class="keyword">function</span> (<span class="params">el, type, fn</span>) &#123;</span><br><span class="line">            <span class="title function_">addEvent</span>(el, microsoft[type], fn);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        touchy = <span class="keyword">function</span> (<span class="params">el, type, fn</span>) &#123;</span><br><span class="line">            <span class="title function_">addEvent</span>(el, touch[type], fn);</span><br><span class="line">            <span class="title function_">addEvent</span>(el, type, fn);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">touchy</span>(el, type, fn);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–äº‹ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> documentElement = <span class="variable language_">document</span>.<span class="property">documentElement</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draggable</span> (<span class="params">dom</span>) &#123;</span><br><span class="line">    <span class="title function_">initEvents</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">initEvents</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">touchy</span>(dom, <span class="string">&#x27;mousedown&#x27;</span>, mousedown);</span><br><span class="line">        <span class="title function_">touchy</span>(documentElement, <span class="string">&#x27;mousemove&#x27;</span>, mousemove);</span><br><span class="line">        <span class="title function_">touchy</span>(documentElement, <span class="string">&#x27;mouseup&#x27;</span>, mouseup);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨<code>documentElement</code>ä¸Šç»‘å®š<code>mousemove</code>å’Œ<code>mouseup</code>äº‹ä»¶ï¼Œæ˜¯<strong>å› ä¸ºé¿å…æ¸²æŸ“é€Ÿåº¦ä½äºæ‹–æ‹½é€Ÿåº¦ï¼Œå¯¼è‡´é¼ æ ‡è¶…å‡ºæ‹–æ‹½èŒƒå›´è€Œæ— æ³•æ‹–æ‹½å’Œé‡Šæ”¾</strong></p><p>è¿™é‡Œæä¸€ä¸‹ç»‘å®šäº‹ä»¶æ—¶æœ‰ä¸€ä¸ª<code>passive</code>é€‰é¡¹ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener#%E4%BD%BF%E7%94%A8_passive_%E6%94%B9%E5%96%84%E7%9A%84%E6%BB%9A%E5%B1%8F%E6%80%A7%E8%83%BD">ä½¿ç”¨ passive æ”¹å–„çš„æ»šå±æ€§èƒ½</a>ï¼Œå¯ä»¥è®¾ç½®ä¸º<code>false</code>ï¼Œä½¿äº‹ä»¶å›è°ƒå¯ä»¥ä½¿ç”¨<code>e.preventDefault</code>ç¦ç”¨é»˜è®¤çš„è¡Œä¸º</p><h2 id="mousedown"><a href="#mousedown" class="headerlink" title="mousedown"></a>mousedown</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mousedown</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    active = <span class="literal">true</span>;</span><br><span class="line">    e = <span class="title function_">getEventHost</span>(e);</span><br><span class="line">    _moveX = e.<span class="property">clientX</span>;</span><br><span class="line">    _moveY = e.<span class="property">clientY</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>documentElement</code>ä¸Šç»‘å®š<code>mousemove</code>å’Œ<code>mouseup</code>äº‹ä»¶ï¼Œæ‰€ä»¥éœ€è¦æ ‡è®°æ˜¯å¦æ˜¯å¤„äºæ‹–æ‹½çŠ¶æ€ï¼Œç„¶å<code>mousemove</code>å’Œ<code>mouseup</code>ä¸­åˆ¤æ–­å¦‚æœä¸æ˜¯æ‹–æ‹½çŠ¶æ€åˆ™è·³å‡ºå‡½æ•°ã€‚</p><p>ä¸ºäº†é€‚é…ç§»åŠ¨ç«¯ï¼ˆ<code>touchEvent</code>æ²¡æœ‰<code>clientX</code>ã€<code>clientY</code>ã€<code>x</code>ã€<code>y</code>ï¼‰ï¼Œå¼•å‡ºäº†<code>getEventHost</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getEventHost</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">targetTouches</span> &amp;&amp; e.<span class="property">targetTouches</span>.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> e.<span class="property">targetTouches</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">changedTouches</span> &amp;&amp; e.<span class="property">changedTouches</span>.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> e.<span class="property">changedTouches</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹çœ‹touchã€targetTouchesã€changedTouchesçš„å®šä¹‰</p><ul><li><strong>touches: å½“å‰å±å¹•ä¸Šæ‰€æœ‰è§¦æ‘¸ç‚¹çš„åˆ—è¡¨</strong></li><li><strong>targetTouches: å½“å‰å¯¹è±¡ä¸Šæ‰€æœ‰è§¦æ‘¸ç‚¹çš„åˆ—è¡¨</strong></li><li><strong>changedTouches: æ¶‰åŠå½“å‰(å¼•å‘)äº‹ä»¶çš„è§¦æ‘¸ç‚¹çš„åˆ—è¡¨</strong></li></ul><h2 id="mousemove"><a href="#mousemove" class="headerlink" title="mousemove"></a>mousemove</h2><p>è¿™é‡Œå®ç°çš„æ˜¯å¯æ‹–æ‹½èŒƒå›´ä¸º<code>document</code>çš„å¯è§†åŒºåŸŸ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mousemove</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!active) &#123; <span class="comment">// å¦‚æœä¸æ˜¯å‡ºäºæ‹–æ‹½çŠ¶æ€ç›´æ¥æ”¾å›</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    e = <span class="title function_">getEventHost</span>(e);</span><br><span class="line">    <span class="keyword">const</span> &#123; x, y, height, width &#125; = dom.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">    <span class="keyword">const</span> curLeft = x + e.<span class="property">clientX</span> - _moveX;</span><br><span class="line">    <span class="keyword">const</span> curTop = y + e.<span class="property">clientY</span> - _moveY;</span><br><span class="line"></span><br><span class="line">    dom.<span class="property">style</span>.<span class="property">left</span> = <span class="string">`<span class="subst">$&#123;clamp(curLeft, <span class="number">0</span>, documentElement.clientWidth - width - <span class="number">1</span>)&#125;</span>px`</span>;</span><br><span class="line">    dom.<span class="property">style</span>.<span class="property">top</span> = <span class="string">`<span class="subst">$&#123;clamp(curTop, <span class="number">0</span>, documentElement.clientHeight - height)&#125;</span>px`</span>;</span><br><span class="line">    _moveX = e.<span class="property">clientX</span>;</span><br><span class="line">    _moveY = e.<span class="property">clientY</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†valueé™åˆ¶åœ¨[min, max]ä¹‹é—´</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clamp</span> (<span class="params">value, min, max</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="title class_">Math</span>.<span class="title function_">max</span>(value, min), max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="mouseup"><a href="#mouseup" class="headerlink" title="mouseup"></a>mouseup</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mouseup</span> (<span class="params"></span>) &#123;</span><br><span class="line">    active = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰mousemoveçš„è¡Œä¸ºï¼Œä½†æ•´ä½“çš„æ¡†æ¶ä¸ä¼šå˜</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://liang5757.github.io/2021/04/06/Js/crossvent%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/&quot;&gt;crossvent&lt;/a&gt;ï¼šå°è£…è·¨å¹³å°äº‹ä»¶ç»‘å®šçš„åº“&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;è·¨å¹³å°çš„è§¦æ‘¸äº‹ä»¶&quot;&gt;&lt;a href=&quot;#è·¨å¹³å°çš„è§¦æ‘¸äº‹ä»¶&quot; class=&quot;headerlink&quot; title=&quot;è·¨å¹³å°çš„è§¦æ‘¸äº‹ä»¶&quot;&gt;&lt;/a&gt;è·¨å¹³å°çš„è§¦æ‘¸äº‹ä»¶&lt;/h2&gt;&lt;p&gt;åˆ©ç”¨&lt;code&gt;crossvent&lt;/code&gt;å°è£…ç»‘å®š&lt;strong&gt;è·¨å¹³å°æ‹–æ‹½äº‹ä»¶&lt;/strong&gt;çš„æ–¹æ³•&lt;code&gt;touchy&lt;/code&gt;ï¼Œä»¥ä¾¿æ”¯æŒç§»åŠ¨ç«¯å’Œpcç«¯&lt;/p&gt;
&lt;p&gt;æ ¹æ®ç¯å¢ƒè·å–çš„è§¦æ‘¸äº‹ä»¶åï¼Œ&lt;strong&gt;ç”¨æ‡’åŠ è½½çš„æ–¹å¼æ›¿æ¢æ‰touchyå‡½æ•°ï¼Œä¹‹åç»‘å®šäº‹ä»¶ä¸éœ€è¦å†åˆ¤æ–­&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="js" scheme="https://liang5757.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>ã€æºç è§£è¯»ã€‘Axiosæºç è§£æ</title>
    <link href="https://liang5757.github.io/2021/08/25/Js/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/Axios%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://liang5757.github.io/2021/08/25/Js/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/Axios%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/</id>
    <published>2021-08-24T17:20:56.000Z</published>
    <updated>2025-12-07T10:16:59.209Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h2><h3 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">bind</span>(<span class="params">fn, thisArg</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">wrap</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="variable language_">arguments</span>.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; args.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      args[i] = <span class="variable language_">arguments</span>[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fn.<span class="title function_">apply</span>(thisArg, args);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="extend"><a href="#extend" class="headerlink" title="extend"></a>extend</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">extend</span>(<span class="params">a, b, thisArg</span>) &#123;</span><br><span class="line">  <span class="title function_">forEach</span>(b, <span class="keyword">function</span> <span class="title function_">assignValue</span>(<span class="params">val, key</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (thisArg &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      a[key] = <span class="title function_">bind</span>(val, thisArg);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      a[key] = val;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params"><span class="comment">/* obj1, obj2, obj3, ... */</span></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> result = &#123;&#125;;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">assignValue</span>(<span class="params">val, key</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(result[key]) &amp;&amp; <span class="title function_">isPlainObject</span>(val)) &#123;</span><br><span class="line">      result[key] = <span class="title function_">merge</span>(result[key], val);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val)) &#123;</span><br><span class="line">      result[key] = <span class="title function_">merge</span>(&#123;&#125;, val);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isArray</span>(val)) &#123;</span><br><span class="line">      result[key] = val.<span class="title function_">slice</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result[key] = val;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = <span class="variable language_">arguments</span>.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">    <span class="title function_">forEach</span>(<span class="variable language_">arguments</span>[i], assignValue);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä»ä½¿ç”¨æ–¹å¼çœ‹èµ·"><a href="#ä»ä½¿ç”¨æ–¹å¼çœ‹èµ·" class="headerlink" title="ä»ä½¿ç”¨æ–¹å¼çœ‹èµ·"></a>ä»ä½¿ç”¨æ–¹å¼çœ‹èµ·</h2><p>å¯¹å‡ ç§è°ƒç”¨æ–¹å¼åšäº†ç¼–å·</p><ol><li><code>axios(option)</code></li><li><code>axios(url[, option])</code></li><li><code>axios[method](url[, option])</code>ï¼ˆ<code>getã€delete</code>ç­‰æ–¹æ³•ï¼‰</li><li><code>axios[method](url[, data[, option]])</code>ï¼ˆ<code>postã€put</code>ç­‰æ–¹æ³•ï¼‰</li><li><code>axios.request(option)</code></li></ol><p>è®©æˆ‘ä»¬çœ‹çœ‹æºç ä»–æ˜¯æ€ä¹ˆåšåˆ°èƒ½å¤Ÿæ”¯æŒè¿™ä¹ˆå¤šè°ƒç”¨æ–¹å¼çš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// /lib/axios.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params">defaultConfig</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>(defaultConfig);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç­‰åŒäº Axios.prototype.request.bind(context)</span></span><br><span class="line">  <span class="comment">// requestæ–¹æ³•ä¸­å¯¹ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦ä¸º string åšäº†åˆ¤æ–­ï¼Œä½¿æ”¯æŒ1ã€2ç§è°ƒç”¨æ–¹å¼</span></span><br><span class="line">  <span class="keyword">var</span> instance = <span class="title function_">bind</span>(<span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>, context);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŠŠAxios.prototypeä¸Šçš„æ–¹æ³•æ‰©å±•åˆ°instanceå¯¹è±¡ä¸Šï¼Œ</span></span><br><span class="line">  <span class="comment">// è¿™æ · instance å°±æœ‰äº† getã€postã€putã€requestç­‰æ–¹æ³•ï¼Œä½¿æ”¯æŒ3ã€4ã€5è°ƒç”¨æ–¹å¼</span></span><br><span class="line">  <span class="comment">// å¹¶æŒ‡å®šä¸Šä¸‹æ–‡ä¸ºcontextï¼Œè¿™æ ·æ‰§è¡ŒAxiosåŸå‹é“¾ä¸Šçš„æ–¹æ³•æ—¶ï¼Œthisä¼šæŒ‡å‘context</span></span><br><span class="line">  utils.<span class="title function_">extend</span>(instance, <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>, context);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŠŠcontextå¯¹è±¡ä¸Šçš„è‡ªèº«å±æ€§å’Œæ–¹æ³•æ‰©å±•åˆ°instanceä¸Š</span></span><br><span class="line">  <span class="comment">// è¿™æ ·ï¼Œinstance å°±æœ‰äº† defaultsã€interceptors å±æ€§ã€‚ï¼ˆè¿™ä¸¤ä¸ªå±æ€§åé¢æˆ‘ä»¬ä¼šä»‹ç»ï¼‰</span></span><br><span class="line">  utils.<span class="title function_">extend</span>(instance, context);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶é»˜è®¤é…ç½®é¡¹ä½œä¸ºå‚æ•°ï¼ˆåé¢ä¼šä»‹ç»é…ç½®é¡¹ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªAxioså®ä¾‹ï¼Œæœ€ç»ˆä¼šè¢«ä½œä¸ºå¯¹è±¡å¯¼å‡º</span></span><br><span class="line"><span class="keyword">var</span> axios = <span class="title function_">createInstance</span>(defaults);</span><br></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯ä¸ºäº†èƒ½å¤Ÿåšåˆ°1ã€2ç§è°ƒç”¨æ–¹å¼ï¼Œæ‰€ä»¥æ˜¯è¿”å›requestå‡½æ•°ï¼Œå¹¶åœ¨å…¶ä¸ŠæŒ‚è½½Axioså®ä¾‹çš„æ–¹æ³•</p><p>æ¥ä¸‹æ¥çœ‹çœ‹ä¸Šè¿°ä»£ç æ“ä½œçš„ä¸»ä½“ï¼šAxiosã€Axios.prototype.request ä»¥åŠ Axios.prototypeä¸Šçš„è¯·æ±‚æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /lib/core/Axios.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Axios</span>(<span class="params">instanceConfig</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">defaults</span> = instanceConfig;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interceptors</span> = &#123;</span><br><span class="line">    <span class="attr">request</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>(),</span><br><span class="line">    <span class="attr">response</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>()</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span> = <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> config === <span class="string">&#x27;string&#x27;</span>) &#123; <span class="comment">// ä½¿æ”¯æŒ1ã€2ä¸¤ç§è°ƒç”¨æ–¹å¼</span></span><br><span class="line">    config = <span class="variable language_">arguments</span>[<span class="number">1</span>] || &#123;&#125;;</span><br><span class="line">    config.<span class="property">url</span> = <span class="variable language_">arguments</span>[<span class="number">0</span>];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    config = config || &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Provide aliases for supported request methods</span></span><br><span class="line">utils.<span class="title function_">forEach</span>([<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>, <span class="string">&#x27;options&#x27;</span>], <span class="keyword">function</span> <span class="title function_">forEachMethodNoData</span>(<span class="params">method</span>) &#123;</span><br><span class="line">  <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>[method] = <span class="keyword">function</span>(<span class="params">url, config</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="title function_">mergeConfig</span>(config || &#123;&#125;, &#123;</span><br><span class="line">      <span class="attr">method</span>: method,</span><br><span class="line">      <span class="attr">url</span>: url,</span><br><span class="line">      <span class="attr">data</span>: (config || &#123;&#125;).<span class="property">data</span></span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">utils.<span class="title function_">forEach</span>([<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>], <span class="keyword">function</span> <span class="title function_">forEachMethodWithData</span>(<span class="params">method</span>) &#123;</span><br><span class="line">  <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>[method] = <span class="keyword">function</span>(<span class="params">url, data, config</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="title function_">mergeConfig</span>(config || &#123;&#125;, &#123;</span><br><span class="line">      <span class="attr">method</span>: method,</span><br><span class="line">      <span class="attr">url</span>: url,</span><br><span class="line">      <span class="attr">data</span>: data</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç»“åˆä¸Šé¢<code>createInstance</code>çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼è°ƒç”¨axios</p><p>æˆ‘ä»¬å…ˆä¸çœ‹å…·ä½“è¯·æ±‚é€»è¾‘æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œå…ˆçœ‹çœ‹æ‹¦æˆªå™¨æ˜¯æ€ä¹ˆåšåˆ°åœ¨è¯·æ±‚å‰åé¢„å¤„ç†çš„ã€‚</p><h2 id="æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰"><a href="#æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰" class="headerlink" title="æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰"></a>æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰</h2><p>åœ¨ä¸Šæ–‡<code>Axios</code>çš„æ„é€ å™¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span> = &#123;</span><br><span class="line">  <span class="attr">request</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>(),</span><br><span class="line">  <span class="attr">response</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>()</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>InterceptorManager</code>ç±»ç”¨ä»¥ç®¡ç†æ‹¦æˆªå™¨</p><h3 id="InterceptorManagerç±»"><a href="#InterceptorManagerç±»" class="headerlink" title="InterceptorManagerç±»"></a>InterceptorManagerç±»</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">InterceptorManager</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">handlers</span> = []; <span class="comment">// å­˜å‚¨æ‹¦æˆªå™¨å‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨ä»¥æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="title class_">InterceptorManager</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">use</span> = <span class="keyword">function</span> <span class="title function_">use</span>(<span class="params">fulfilled, rejected, options</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">handlers</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">    <span class="attr">fulfilled</span>: fulfilled,</span><br><span class="line">    <span class="attr">rejected</span>: rejected,</span><br><span class="line">    <span class="attr">synchronous</span>: options ? options.<span class="property">synchronous</span> : <span class="literal">false</span>, <span class="comment">// æ˜¯å¦æ˜¯åŒæ­¥æ‰§è¡Œ</span></span><br><span class="line">    <span class="attr">runWhen</span>: options ? options.<span class="property">runWhen</span> : <span class="literal">null</span> <span class="comment">// æŒ‡å®šæ‹¦æˆªå™¨åœ¨æŸç§æƒ…å†µä¸‹æ‰§è¡Œ</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">handlers</span>.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="title class_">InterceptorManager</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eject</span> = <span class="keyword">function</span> <span class="title function_">eject</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">handlers</span>[id]) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handlers</span>[id] = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†handlerçš„æ¯ä¸€é¡¹äº¤ç”±fnå¤„ç†</span></span><br><span class="line"><span class="title class_">InterceptorManager</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">forEach</span> = <span class="keyword">function</span> <span class="title function_">forEach</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  utils.<span class="title function_">forEach</span>(<span class="variable language_">this</span>.<span class="property">handlers</span>, <span class="keyword">function</span> <span class="title function_">forEachHandler</span>(<span class="params">h</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (h !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="title function_">fn</span>(h);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="requestä¸­InterceptorManagerä½¿ç”¨æ–¹å¼"><a href="#requestä¸­InterceptorManagerä½¿ç”¨æ–¹å¼" class="headerlink" title="requestä¸­InterceptorManagerä½¿ç”¨æ–¹å¼"></a>requestä¸­InterceptorManagerä½¿ç”¨æ–¹å¼</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span> = <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œæœ‰åˆå¹¶ config çš„æ“ä½œï¼Œä¼˜å…ˆçº§æ˜¯ defaults -&gt; &#123; method: &quot;get&quot; &#125; -&gt; this.defaults -&gt; config</span></span><br><span class="line">    <span class="comment">// ä¹Ÿå°±æ˜¯ åº“é»˜è®¤çš„é…ç½® -&gt; é»˜è®¤ä¸ºgetè¯·æ±‚ -&gt; åˆ›å»ºAxioså®ä¾‹è®¾ç½®çš„é…ç½® -&gt; è¯·æ±‚çš„é…ç½®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> requestInterceptorChain = []; <span class="comment">// è¯·æ±‚æ‹¦æˆªå™¨é“¾</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> <span class="title function_">unshiftRequestInterceptors</span>(<span class="params">interceptor</span>) &#123;</span><br><span class="line">        <span class="comment">// æ— æ³•é€šè¿‡runWhenæ¡ä»¶çš„åˆ™ä¸æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> interceptor.<span class="property">runWhen</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; interceptor.<span class="title function_">runWhen</span>(config) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»¥ fulfilledã€rejected æˆå¯¹unshiftåˆ° requestInterceptorChain</span></span><br><span class="line">        requestInterceptorChain.<span class="title function_">unshift</span>(interceptor.<span class="property">fulfilled</span>, interceptor.<span class="property">rejected</span>); </span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> responseInterceptorChain = []; <span class="comment">// å“åº”æ‹¦æˆªå™¨é“¾</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> <span class="title function_">pushResponseInterceptors</span>(<span class="params">interceptor</span>) &#123;</span><br><span class="line">        <span class="comment">// ä»¥ fulfilledã€rejected æˆå¯¹unshiftåˆ° responseInterceptorChain</span></span><br><span class="line">        responseInterceptorChain.<span class="title function_">push</span>(interceptor.<span class="property">fulfilled</span>, interceptor.<span class="property">rejected</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> promise;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// dispatchRequestæ˜¯å‘é€è¯·æ±‚ï¼Œç¬¬äºŒä¸ªundefinedæ˜¯ä¸ºäº†ç¬¦åˆæå–æ–¹å¼çš„å ä½å€¼</span></span><br><span class="line">    <span class="keyword">var</span> chain = [dispatchRequest, <span class="literal">undefined</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† è¯·æ±‚æ‹¦æˆªå™¨ æ”¾ç½®åœ¨dispatchRequestå‰é¢ </span></span><br><span class="line">    <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">unshift</span>.<span class="title function_">apply</span>(chain, requestInterceptorChain);</span><br><span class="line">    <span class="comment">// å°† å“åº”æ‹¦æˆªå™¨ æ”¾ç½®åœ¨dispatchRequeståé¢</span></span><br><span class="line">    chain.<span class="title function_">concat</span>(responseInterceptorChain);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡æ­¤æ–¹å¼å°†configä¼ å…¥åˆ°è¯·æ±‚æ‹¦æˆªå™¨çš„ç¬¬ä¸€ä¸ªfulfilled</span></span><br><span class="line">    promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(config);</span><br><span class="line">    <span class="keyword">while</span> (chain.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// å› ä¸ºåœ¨chainä¸­fulfilledã€rejectedæ˜¯æˆå¯¹å­˜åœ¨çš„</span></span><br><span class="line">        <span class="comment">// è€Œ è¯·æ±‚æ‹¦æˆªå™¨ å¿…é¡»è¿”å›configï¼Œä¸‹ä¸€ä¸ª è¯·æ±‚æ‹¦æˆªå™¨ å°±ä¼šæ¥å—ä¸Šä¸€ä¸ªconfig</span></span><br><span class="line">        <span class="comment">// å“åº”æ‹¦æˆªå™¨ ä¼šæ¥å— dispatchRequest çš„å“åº”ä½“æˆ–é”™è¯¯</span></span><br><span class="line">        promise = promise.<span class="title function_">then</span>(chain.<span class="title function_">shift</span>(), chain.<span class="title function_">shift</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§è‡´æµç¨‹å°±æ˜¯å¦‚æ­¤</p><h3 id="synchronous"><a href="#synchronous" class="headerlink" title="synchronous"></a>synchronous</h3><p>ä½†æ˜¯axiosè¿˜ä¸º<strong>è¯·æ±‚æ‹¦æˆªå™¨</strong>æä¾›äº†<code>synchronous</code>é€‰é¡¹ï¼Œéœ€è¦<strong>å…¨éƒ¨</strong>è¯·æ±‚æ‹¦æˆªå™¨è®¾ç½®<code>synchronous</code>ä¸ºtrueï¼Œé‚£ä¹ˆå°±ä»¥åŒæ­¥çš„æ–¹å¼è¿è¡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span> = <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> requestInterceptorChain = [];</span><br><span class="line">  <span class="comment">// æ–°å¢ï¼šç”¨ä»¥æ ‡è®°æ˜¯å¦æ˜¯åŒæ­¥æ‰§è¡Œè¯·æ±‚æ‹¦æˆªå™¨</span></span><br><span class="line">  <span class="keyword">var</span> synchronousRequestInterceptors = <span class="literal">true</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> <span class="title function_">unshiftRequestInterceptors</span>(<span class="params">interceptor</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> interceptor.<span class="property">runWhen</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; interceptor.<span class="title function_">runWhen</span>(config) === <span class="literal">false</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// æ–°å¢ï¼šéœ€è¦ å…¨éƒ¨è¯·æ±‚æ‹¦æˆªå™¨ è®¾ç½®synchronousæˆtrueæ‰ä¼šåŒæ­¥æ‰§è¡Œ</span></span><br><span class="line">    synchronousRequestInterceptors = synchronousRequestInterceptors &amp;&amp; interceptor.<span class="property">synchronous</span>;</span><br><span class="line"></span><br><span class="line">    requestInterceptorChain.<span class="title function_">unshift</span>(interceptor.<span class="property">fulfilled</span>, interceptor.<span class="property">rejected</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> responseInterceptorChain = [];</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> <span class="title function_">pushResponseInterceptors</span>(<span class="params">interceptor</span>) &#123;</span><br><span class="line">    responseInterceptorChain.<span class="title function_">push</span>(interceptor.<span class="property">fulfilled</span>, interceptor.<span class="property">rejected</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> promise;</span><br><span class="line">  <span class="comment">// æ–°å¢ï¼šé»˜è®¤æ˜¯å¼‚æ­¥çš„æ–¹å¼æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">if</span> (!synchronousRequestInterceptors) &#123;</span><br><span class="line">    <span class="keyword">var</span> chain = [dispatchRequest, <span class="literal">undefined</span>];</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">unshift</span>.<span class="title function_">apply</span>(chain, requestInterceptorChain);</span><br><span class="line">    chain.<span class="title function_">concat</span>(responseInterceptorChain);</span><br><span class="line"></span><br><span class="line">    promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(config);</span><br><span class="line">    <span class="keyword">while</span> (chain.<span class="property">length</span>) &#123;</span><br><span class="line">      promise = promise.<span class="title function_">then</span>(chain.<span class="title function_">shift</span>(), chain.<span class="title function_">shift</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ–°å¢ï¼šåŒæ­¥çš„æ–¹å¼æ‰§è¡Œè¯·æ±‚æ‹¦æˆªå™¨</span></span><br><span class="line">  <span class="keyword">var</span> newConfig = config;</span><br><span class="line">  <span class="keyword">while</span> (requestInterceptorChain.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> onFulfilled = requestInterceptorChain.<span class="title function_">shift</span>();</span><br><span class="line">    <span class="keyword">var</span> onRejected = requestInterceptorChain.<span class="title function_">shift</span>();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      newConfig = <span class="title function_">onFulfilled</span>(newConfig);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="title function_">onRejected</span>(error);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    promise = <span class="title function_">dispatchRequest</span>(newConfig);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (responseInterceptorChain.<span class="property">length</span>) &#123;</span><br><span class="line">    promise = promise.<span class="title function_">then</span>(responseInterceptorChain.<span class="title function_">shift</span>(), responseInterceptorChain.<span class="title function_">shift</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> promise;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="å¯å‘ï¼šé“¾å¼è°ƒç”¨"><a href="#å¯å‘ï¼šé“¾å¼è°ƒç”¨" class="headerlink" title="å¯å‘ï¼šé“¾å¼è°ƒç”¨"></a>å¯å‘ï¼šé“¾å¼è°ƒç”¨</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Man</span>(<span class="string">&quot;Hank&quot;</span>).<span class="title function_">sleep</span>(<span class="number">1</span>).<span class="title function_">eat</span>(<span class="string">&quot;supper&quot;</span>).<span class="title function_">sleep</span>(<span class="number">1</span>).<span class="title function_">eat</span>(<span class="string">&quot;me&quot;</span>).<span class="title function_">sleepFirst</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœ</span></span><br><span class="line"><span class="comment">// &#x27;This is Hank&#x27; -(ç­‰å¾…2s)--&gt; &#x27;Wale up after 2&#x27; -(ç­‰å¾…1s)--&gt; &#x27;Wale up after 1&#x27; &#x27;Eat supper&#x27; -(ç­‰å¾…1s)--&gt; &#x27;Eat me&#x27;</span></span><br></pre></td></tr></table></figure><p>å†™æ³•æ”¾åœ¨æ–‡æœ«</p><h2 id="å‘èµ·è¯·æ±‚dispatchRequest"><a href="#å‘èµ·è¯·æ±‚dispatchRequest" class="headerlink" title="å‘èµ·è¯·æ±‚dispatchRequest"></a>å‘èµ·è¯·æ±‚dispatchRequest</h2><p>åœ¨æ‹¿åˆ°è¯·æ±‚æ‹¦æˆªå™¨å¤„ç†åçš„configå</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /lib/core/dispatchRequest.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dispatchRequest</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="comment">// 1.è¯·æ±‚å¦‚æœè¢«å–æ¶ˆåˆ™ throw cancel Error</span></span><br><span class="line">  <span class="title function_">throwIfCancellationRequested</span>(config);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.ç¡®ä¿headerså­˜åœ¨</span></span><br><span class="line">  config.<span class="property">headers</span> = config.<span class="property">headers</span> || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.åé¢ä¼šè®²ï¼šæ•°æ®è½¬åŒ–å™¨è½¬åŒ–è¯·æ±‚dataï¼Œä¹Ÿå¯ä»¥åœ¨configè‡ªå®šä¹‰é…ç½®transformRequest</span></span><br><span class="line">  config.<span class="property">data</span> = transformData.<span class="title function_">call</span>(</span><br><span class="line">    config,</span><br><span class="line">    config.<span class="property">data</span>,</span><br><span class="line">    config.<span class="property">headers</span>,</span><br><span class="line">    config.<span class="property">transformRequest</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4.æ‰å¹³headerè®¾ç½®ï¼Œè¿™é‡Œå¯ä»¥åˆ©ç”¨config.headers.get = &#123;&#125;è®¾ç½®æŸç§è¯·æ±‚ç±»å‹çš„headers</span></span><br><span class="line">  config.<span class="property">headers</span> = utils.<span class="title function_">merge</span>(</span><br><span class="line">    config.<span class="property">headers</span>.<span class="property">common</span> || &#123;&#125;,</span><br><span class="line">    config.<span class="property">headers</span>[config.<span class="property">method</span>] || &#123;&#125;,</span><br><span class="line">    config.<span class="property">headers</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5.åˆ é™¤æ— ç”¨headerï¼Œå› ä¸ºåœ¨ç¬¬å››æ­¥æ—¶æ‰å¹³åŒ–å®šä¹‰åœ¨headersäº†</span></span><br><span class="line">  utils.<span class="title function_">forEach</span>(</span><br><span class="line">    [<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>, <span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">cleanHeaderConfig</span>(<span class="params">method</span>) &#123;</span><br><span class="line">      <span class="keyword">delete</span> config.<span class="property">headers</span>[method];</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯ä»¥è‡ªå®šä¹‰é€‚é…å™¨ï¼Œé»˜è®¤ä¸ºXHRï¼ˆwebï¼‰æˆ–httpï¼ˆnodeï¼‰é€‚é…å™¨</span></span><br><span class="line">  <span class="keyword">var</span> adapter = config.<span class="property">adapter</span> || defaults.<span class="property">adapter</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">adapter</span>(config).<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">onAdapterResolution</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;, <span class="keyword">function</span> <span class="title function_">onAdapterRejection</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(reason);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throwIfCancellationRequested</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (config.<span class="property">cancelToken</span>) &#123;</span><br><span class="line">    config.<span class="property">cancelToken</span>.<span class="title function_">throwIfRequested</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è·¨ç«¯å®ç°ï¼ˆadapterï¼‰"><a href="#è·¨ç«¯å®ç°ï¼ˆadapterï¼‰" class="headerlink" title="è·¨ç«¯å®ç°ï¼ˆadapterï¼‰"></a>è·¨ç«¯å®ç°ï¼ˆadapterï¼‰</h2><h3 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h3><ul><li>æ˜¯å¦æœ‰<code>XMLHttpRequest</code>å¯¹è±¡æ¥åˆ¤æ–­æ˜¯å¦æ˜¯webç¯å¢ƒ</li><li>æ˜¯å¦æœ‰<code>process</code>å¯¹è±¡æ¥åˆ¤æ–­nodeç¯å¢ƒ</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /lib/defaults.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDefaultAdapter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> adapter;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">XMLHttpRequest</span> !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    adapter = <span class="built_in">require</span>(<span class="string">&#x27;./adapters/xhr&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> process !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(process) === <span class="string">&#x27;[object process]&#x27;</span>) &#123;</span><br><span class="line">    adapter = <span class="built_in">require</span>(<span class="string">&#x27;./adapters/http&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> adapter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å°è£…xhr"><a href="#å°è£…xhr" class="headerlink" title="å°è£…xhr"></a>å°è£…xhr</h3><p>è¿”å›ä¸€ä¸ªpromise</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /lib/adapters/xhr.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">xhrAdapter</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> <span class="title function_">dispatchXhrRequest</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">var</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    <span class="keyword">var</span> fullPath = <span class="title function_">buildFullPath</span>(config.<span class="property">baseURL</span>, config.<span class="property">url</span>);</span><br><span class="line">    <span class="comment">// buildURL: æ ¼å¼åŒ–url; config.paramsSerializer: åºåˆ—åŒ–æ–¹å¼ï¼›</span></span><br><span class="line">    request.<span class="title function_">open</span>(config.<span class="property">method</span>.<span class="title function_">toUpperCase</span>(), <span class="title function_">buildURL</span>(fullPath, config.<span class="property">params</span>, config.<span class="property">paramsSerializer</span>), <span class="literal">true</span>);</span><br><span class="line">    request.<span class="property">timeout</span> = config.<span class="property">timeout</span>;</span><br><span class="line">      </span><br><span class="line">    request.<span class="property">onloadend</span> = <span class="keyword">function</span> <span class="title function_">onloadend</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      <span class="title function_">settle</span>(resolve, reject, response); <span class="comment">// ä¸‹é¢æœ‰ä»£ç </span></span><br><span class="line">      request = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    request.<span class="property">onabort</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">reject</span>(<span class="comment">/**/</span>);</span><br><span class="line">      request = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">reject</span>(<span class="comment">/**/</span>);</span><br><span class="line">      request = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">reject</span>(<span class="comment">/**/</span>);</span><br><span class="line">  request = <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br><span class="line">    request.<span class="title function_">send</span>(requestData);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>éªŒè¯æœåŠ¡ç«¯çš„è¿”å›ç»“æœæ˜¯å¦é€šè¿‡éªŒè¯ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /lib/core/settle.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">settle</span>(<span class="params">resolve, reject, response</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> validateStatus = response.<span class="property">config</span>.<span class="property">validateStatus</span>; <span class="comment">// å¯ä»¥è‡ªå®šä¹‰æˆåŠŸè§„åˆ™</span></span><br><span class="line">  <span class="keyword">if</span> (!response.<span class="property">status</span> || !validateStatus || <span class="title function_">validateStatus</span>(response.<span class="property">status</span>)) &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(response);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="comment">/**/</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åŒç†å°†httpå°è£…æˆpromise</p><h2 id="å–æ¶ˆè¯·æ±‚ï¼ˆcancelTokenï¼‰"><a href="#å–æ¶ˆè¯·æ±‚ï¼ˆcancelTokenï¼‰" class="headerlink" title="å–æ¶ˆè¯·æ±‚ï¼ˆcancelTokenï¼‰"></a>å–æ¶ˆè¯·æ±‚ï¼ˆcancelTokenï¼‰</h2><h3 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸€ç§å–æ¶ˆæ–¹æ³•</span></span><br><span class="line">axios.<span class="title function_">get</span>(url, &#123;</span><br><span class="line">  <span class="attr">cancelToken</span>: <span class="keyword">new</span> axios.<span class="title class_">CancelToken</span>(<span class="function"><span class="params">cancel</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="comment">/* å–æ¶ˆæ¡ä»¶ */</span>) &#123;</span><br><span class="line">      <span class="title function_">cancel</span>(<span class="string">&#x27;å–æ¶ˆæ—¥å¿—&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç§å–æ¶ˆæ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CancelToken</span> = axios.<span class="property">CancelToken</span>;</span><br><span class="line"><span class="keyword">const</span> source = <span class="title class_">CancelToken</span>.<span class="title function_">source</span>();</span><br><span class="line">axios.<span class="title function_">get</span>(url, &#123;</span><br><span class="line">  <span class="attr">cancelToken</span>: source.<span class="property">token</span></span><br><span class="line">&#125;);</span><br><span class="line">source.<span class="title function_">cancel</span>(<span class="string">&#x27;å–æ¶ˆæ—¥å¿—&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">CancelToken</span>(<span class="params">executor</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> executor !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;executor must be a function.&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> resolvePromise;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">promise</span> = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> <span class="title function_">promiseExecutor</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">    resolvePromise = resolve;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> token = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="title function_">executor</span>(<span class="keyword">function</span> <span class="title function_">cancel</span>(<span class="params">message</span>) &#123; <span class="comment">// ç­‰åˆ°executorè°ƒç”¨cancelæ–¹æ³•ï¼Œä¸Šé¢çš„this.promiseå°±ä¼šæ‰§è¡Œä¸‹é¢çš„thenå›è°ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (token.<span class="property">reason</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    token.<span class="property">reason</span> = <span class="keyword">new</span> <span class="title class_">Cancel</span>(message);</span><br><span class="line">    <span class="title function_">resolvePromise</span>(token.<span class="property">reason</span>); </span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç§æ–¹æ³•çš„å®ç°</span></span><br><span class="line"><span class="title class_">CancelToken</span>.<span class="property">source</span> = <span class="keyword">function</span> <span class="title function_">source</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> cancel;</span><br><span class="line">  <span class="keyword">var</span> token = <span class="keyword">new</span> <span class="title class_">CancelToken</span>(<span class="keyword">function</span> <span class="title function_">executor</span>(<span class="params">c</span>) &#123;</span><br><span class="line">    cancel = c;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">token</span>: token,</span><br><span class="line">    <span class="attr">cancel</span>: cancel</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /lib/adapters/xhr.js åœ¨sendä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">if</span> (config.<span class="property">cancelToken</span>) &#123;</span><br><span class="line">  config.<span class="property">cancelToken</span>.<span class="property">promise</span>.<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">onCanceled</span>(<span class="params">cancel</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!request) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    request.<span class="title function_">abort</span>(); <span class="comment">// xhrçš„å–æ¶ˆè¯·æ±‚</span></span><br><span class="line">    <span class="title function_">reject</span>(cancel);</span><br><span class="line">    request = <span class="literal">null</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯å‘"><a href="#å¯å‘" class="headerlink" title="å¯å‘"></a>å¯å‘</h2><h3 id="é“¾å¼è°ƒç”¨"><a href="#é“¾å¼è°ƒç”¨" class="headerlink" title="é“¾å¼è°ƒç”¨"></a>é“¾å¼è°ƒç”¨</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Man</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span> (<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">arr</span> = [];</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`This is <span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">executor</span> = i =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (i &lt; <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">arr</span>[i]().<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">          <span class="title function_">executor</span>(i + <span class="number">1</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">executor</span>(<span class="number">0</span>)</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">sleep</span>(<span class="params">sec</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(<span class="string">`Wale up after <span class="subst">$&#123;sec&#125;</span>`</span>);</span><br><span class="line">        &#125;, sec * <span class="number">1000</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">eat</span>(<span class="params">food</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">`Eat <span class="subst">$&#123;food&#125;</span>`</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">sleepFirst</span>(<span class="params">sec</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">unshift</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(<span class="string">`Wale up after <span class="subst">$&#123;sec&#125;</span>`</span>);</span><br><span class="line">        &#125;, sec * <span class="number">1000</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/ronffy/axios-tutoria">Axiosæºç æ·±åº¦å‰–æ</a></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å·¥å…·ç±»&quot;&gt;&lt;a href=&quot;#å·¥å…·ç±»&quot; class=&quot;headerlink&quot; title=&quot;å·¥å…·ç±»&quot;&gt;&lt;/a&gt;å·¥å…·ç±»&lt;/h2&gt;&lt;h3 id=&quot;bind&quot;&gt;&lt;a href=&quot;#bind&quot; class=&quot;headerlink&quot; title=&quot;bind&quot;&gt;&lt;/a&gt;bind&lt;/h3&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;bind&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;fn, thisArg&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;wrap&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; args = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Array&lt;/span&gt;(&lt;span class=&quot;variable language_&quot;&gt;arguments&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;length&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; args.&lt;span class=&quot;property&quot;&gt;length&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      args[i] = &lt;span class=&quot;variable language_&quot;&gt;arguments&lt;/span&gt;[i];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; fn.&lt;span class=&quot;title function_&quot;&gt;apply&lt;/span&gt;(thisArg, args);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="æºç è§£è¯»" scheme="https://liang5757.github.io/categories/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/"/>
    
    
    <category term="js" scheme="https://liang5757.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>eggå…¥é—¨</title>
    <link href="https://liang5757.github.io/2021/07/18/node.js/egg%E5%85%A5%E9%97%A8/"/>
    <id>https://liang5757.github.io/2021/07/18/node.js/egg%E5%85%A5%E9%97%A8/</id>
    <published>2021-07-18T15:28:05.000Z</published>
    <updated>2025-12-07T10:16:59.252Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¿«é€Ÿåˆå§‹åŒ–"><a href="#å¿«é€Ÿåˆå§‹åŒ–" class="headerlink" title="å¿«é€Ÿåˆå§‹åŒ–"></a>å¿«é€Ÿåˆå§‹åŒ–</h2><p>ç”¨npm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init egg --<span class="built_in">type</span>=simple</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">egg-project</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â”œâ”€â”€ app.js (å¯é€‰) # ç”¨äºè‡ªå®šä¹‰å¯åŠ¨æ—¶çš„åˆå§‹åŒ–å·¥ä½œ</span><br><span class="line">â”œâ”€â”€ agent.js (å¯é€‰) # ç”¨äºè‡ªå®šä¹‰å¯åŠ¨æ—¶çš„åˆå§‹åŒ–å·¥ä½œ</span><br><span class="line">â”œâ”€â”€ app</span><br><span class="line">|   â”œâ”€â”€ router.js  # ç”¨äºé…ç½® URL è·¯ç”±è§„åˆ™</span><br><span class="line">â”‚   â”œâ”€â”€ controller  # ç”¨äºè§£æç”¨æˆ·çš„è¾“å…¥ï¼Œå¤„ç†åè¿”å›ç›¸åº”çš„ç»“æœ</span><br><span class="line">â”‚   |   â””â”€â”€ home.js</span><br><span class="line">â”‚   â”œâ”€â”€ service (å¯é€‰) # ç”¨äºç¼–å†™ä¸šåŠ¡é€»è¾‘å±‚</span><br><span class="line">â”‚   |   â””â”€â”€ user.js</span><br><span class="line">â”‚   â”œâ”€â”€ middleware (å¯é€‰) # ç”¨äºç¼–å†™ä¸­é—´ä»¶</span><br><span class="line">â”‚   |   â””â”€â”€ response_time.js</span><br><span class="line">â”‚   â”œâ”€â”€ schedule (å¯é€‰)# ç”¨äºå®šæ—¶ä»»åŠ¡</span><br><span class="line">â”‚   |   â””â”€â”€ my_task.js</span><br><span class="line">â”‚   â”œâ”€â”€ public (å¯é€‰) # ç”¨äºæ”¾ç½®é™æ€èµ„æº</span><br><span class="line">â”‚   |   â””â”€â”€ reset.css</span><br><span class="line">â”‚   â”œâ”€â”€ view (å¯é€‰)# ç”¨äºæ”¾ç½®æ¨¡æ¿æ–‡ä»¶</span><br><span class="line">â”‚   |   â””â”€â”€ home.tpl</span><br><span class="line">â”‚   â””â”€â”€ extend (å¯é€‰) # ç”¨äºæ¡†æ¶çš„æ‰©å±•</span><br><span class="line">â”‚       â”œâ”€â”€ helper.js (å¯é€‰)</span><br><span class="line">â”‚       â”œâ”€â”€ request.js (å¯é€‰)</span><br><span class="line">â”‚       â”œâ”€â”€ response.js (å¯é€‰)</span><br><span class="line">â”‚       â”œâ”€â”€ context.js (å¯é€‰)</span><br><span class="line">â”‚       â”œâ”€â”€ application.js (å¯é€‰)</span><br><span class="line">â”‚       â””â”€â”€ agent.js (å¯é€‰)</span><br><span class="line">â”œâ”€â”€ config # ç”¨äºç¼–å†™é…ç½®æ–‡ä»¶</span><br><span class="line">|   â”œâ”€â”€ plugin.js  # ç”¨äºé…ç½®éœ€è¦åŠ è½½çš„æ’ä»¶</span><br><span class="line">|   â”œâ”€â”€ config.default.js</span><br><span class="line">â”‚   â”œâ”€â”€ config.prod.js</span><br><span class="line">|   â”œâ”€â”€ config.test.js (å¯é€‰)</span><br><span class="line">|   â”œâ”€â”€ config.local.js (å¯é€‰)</span><br><span class="line">|   â””â”€â”€ config.unittest.js (å¯é€‰)</span><br><span class="line">â””â”€â”€ test # ç”¨äºå•å…ƒæµ‹è¯•</span><br><span class="line">    â”œâ”€â”€ middleware</span><br><span class="line">    |   â””â”€â”€ response_time.test.js</span><br><span class="line">    â””â”€â”€ controller</span><br><span class="line">        â””â”€â”€ home.test.js</span><br></pre></td></tr></table></figure><h2 id="è·¯ç”±ï¼ˆRouterï¼‰"><a href="#è·¯ç”±ï¼ˆRouterï¼‰" class="headerlink" title="è·¯ç”±ï¼ˆRouterï¼‰"></a>è·¯ç”±ï¼ˆRouterï¼‰</h2><blockquote><p>å°†ç”¨æˆ·çš„è¯·æ±‚åŸºäº method å’Œ URL åˆ†å‘åˆ°äº†å¯¹åº”çš„ Controller ä¸Šï¼Œæ„Ÿè§‰apiå’ŒKoaå·®ä¸å¤šã€‚</p></blockquote><h3 id="å‚æ•°è·å–"><a href="#å‚æ•°è·å–" class="headerlink" title="å‚æ•°è·å–"></a>å‚æ•°è·å–</h3><h4 id="query"><a href="#query" class="headerlink" title="query"></a>query</h4><p>å°±åˆ—ä¸€ä¸ªqueryå‚æ•°çš„è·å–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œapp.controller.searchä¸æ–‡ä»¶ç›¸å¯¹åº”ï¼ˆä¹Ÿå°±æ˜¯app&#x2F;controller&#x2F;search.jsï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// curl http://127.0.0.1:7001/search?name=egg</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  app.<span class="property">router</span>.<span class="title function_">get</span>(<span class="string">&#x27;/search&#x27;</span>, app.<span class="property">controller</span>.<span class="property">search</span>.<span class="property">index</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/controller/search.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">index</span> = <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.<span class="property">body</span> = <span class="string">`search: <span class="subst">$&#123;ctx.query.name&#125;</span>`</span>; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>ä¸ºäº†é¿å…ç”¨æˆ·æ¶æ„ä¼ é€’é‡å¤keyçš„queryå‚æ•°å¯¼è‡´ç³»ç»ŸæŠ¥é”™ï¼Œctx.queryåªå–ç¬¬ä¸€æ¬¡å‡ºç°çš„å€¼ï¼Œå¹¶ä¸”ä¿è¯ä¸€å®šæ˜¯å­—ç¬¦ä¸²ç±»å‹</strong></p><p>å¦‚æœå¿…é¡»è¦é‡å¤çš„keyï¼Œæ¯”å¦‚éœ€è¦ä¼ é€’æ•°ç»„ï¼šid&#x3D;1&amp;id&#x3D;2&amp;id&#x3D;3ï¼Œå¯ä»¥ç”¨<code>ctx.queries</code>ï¼Œå…¶ä¹Ÿä¿è¯äº†ä¸€å®šæ˜¯æ•°ç»„ç±»å‹</p><h4 id="body"><a href="#body" class="headerlink" title="body"></a>body</h4><p>æ¡†æ¶å†…ç½®äº† <a href="https://github.com/koajs/bodyparser">bodyParser</a> ä¸­é—´ä»¶æ¥å¯¹JSONå’ŒForm-Dataçš„è¯·æ±‚ body è§£ææˆ object æŒ‚è½½åˆ° <code>ctx.request.body</code> ä¸Šã€‚</p><p>body æœ€å¤§é•¿åº¦ä¸º <code>100kb</code>ï¼Œè¶…å‡ºé•¿åº¦413çŠ¶æ€ç ï¼Œå¯ä»¥åœ¨ <code>config/config.default.js</code> ä¸­è¦†ç›–æ¡†æ¶çš„é»˜è®¤å€¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">bodyParser</span>: &#123;</span><br><span class="line">    <span class="attr">jsonLimit</span>: <span class="string">&#x27;1mb&#x27;</span>,</span><br><span class="line">    <span class="attr">formLimit</span>: <span class="string">&#x27;1mb&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ctx.bodyæ˜¯ctx.response.bodyçš„ç®€å†™</p><h4 id="header"><a href="#header" class="headerlink" title="header"></a>header</h4><p>å¯ä»¥é€šè¿‡<code>ctx.get(name)</code>è·å–ï¼Œå…¶ä¼šè‡ªåŠ¨å¤„ç†å¤§å°å†™</p><h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><p>è·å–ã€è®¾ç½®æ–¹å¼å’ŒKoaä¸€æ ·ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">cookies</span>: &#123;</span><br><span class="line">    <span class="comment">// httpOnly: true | false,</span></span><br><span class="line">    <span class="comment">// sameSite: &#x27;none|lax|strict&#x27;,</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h4><p>æ¡†æ¶å†…ç½® <a href="https://github.com/eggjs/egg-session">Session</a> æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡<code>ctx.session</code>ï¼Œå…·ä½“é…ç½®å¯ä»¥çœ‹ <a href="https://eggjs.org/zh-cn/core/cookie-and-session.html#session">Cookie ä¸ Session</a></p><h3 id="å‚æ•°æ ¡éªŒ"><a href="#å‚æ•°æ ¡éªŒ" class="headerlink" title="å‚æ•°æ ¡éªŒ"></a>å‚æ•°æ ¡éªŒ</h3><p>å€ŸåŠ© <a href="https://github.com/eggjs/egg-validate">Validate</a> æ’ä»¶æä¾›ä¾¿æ·çš„å‚æ•°æ ¡éªŒæœºåˆ¶ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/plugin.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">validate</span> = &#123;</span><br><span class="line">  <span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">package</span>: <span class="string">&#x27;egg-validate&#x27;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ctxä¸Šæœ‰ä¸€ä¸ªvalidateæ–¹æ³•ï¼Œå¯ä»¥ä¼ å…¥æ ¡éªŒé…ç½®æ¥å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// curl -X POST http://127.0.0.1:7001/user --data &#x27;username=abc@abc.com&amp;password=111111&amp;re-password=111111&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  app.<span class="property">router</span>.<span class="title function_">post</span>(<span class="string">&#x27;/user&#x27;</span>, app.<span class="property">controller</span>.<span class="property">user</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/controller/user.js</span></span><br><span class="line"><span class="keyword">const</span> createRule = &#123;</span><br><span class="line">  <span class="attr">username</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;email&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">password</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;password&#x27;</span>,</span><br><span class="line">    <span class="attr">compare</span>: <span class="string">&#x27;re-password&#x27;</span>, <span class="comment">// ä¸re-passwordæ¯”è¾ƒï¼Œæ˜¯å¦ä¸€è‡´</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">create</span> = <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæ ¡éªŒæŠ¥é”™ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">  ctx.<span class="title function_">validate</span>(createRule);</span><br><span class="line">  ctx.<span class="property">body</span> = ctx.<span class="property">request</span>.<span class="property">body</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h3><h4 id="å†…éƒ¨é‡å®šå‘"><a href="#å†…éƒ¨é‡å®šå‘" class="headerlink" title="å†…éƒ¨é‡å®šå‘"></a>å†…éƒ¨é‡å®šå‘</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="property">router</span>.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;/home/index&#x27;</span>, <span class="number">302</span>);</span><br></pre></td></tr></table></figure><h4 id="å¤–éƒ¨é‡å®šå‘"><a href="#å¤–éƒ¨é‡å®šå‘" class="headerlink" title="å¤–éƒ¨é‡å®šå‘"></a>å¤–éƒ¨é‡å®šå‘</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">redirect</span>(<span class="string">`http://cn.bing.com`</span>);</span><br></pre></td></tr></table></figure><h3 id="resourcesç”ŸæˆCRUDè·¯ç”±ç»“æ„"><a href="#resourcesç”ŸæˆCRUDè·¯ç”±ç»“æ„" class="headerlink" title="resourcesç”ŸæˆCRUDè·¯ç”±ç»“æ„"></a>resourcesç”ŸæˆCRUDè·¯ç”±ç»“æ„</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; router, controller &#125; = app;</span><br><span class="line">    router.<span class="title function_">resources</span>(<span class="string">&#x27;posts&#x27;</span>, <span class="string">&#x27;/api/posts&#x27;</span>, controller.<span class="property">posts</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åœ¨å¯¹åº”æ–‡ä»¶ä¸‹å®ç°å¯¹åº”å‡½æ•°å°±å¯ä»¥äº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/controller/posts.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">index</span> = <span class="title function_">async</span> () =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">new</span> = <span class="title function_">async</span> () =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">create</span> = <span class="title function_">async</span> () =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">show</span> = <span class="title function_">async</span> () =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">edit</span> = <span class="title function_">async</span> () =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">update</span> = <span class="title function_">async</span> () =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">destroy</span> = <span class="title function_">async</span> () =&gt; &#123;&#125;;</span><br></pre></td></tr></table></figure><table><thead><tr><th>Method</th><th>Path</th><th>Route Name</th><th>Controller.Action</th></tr></thead><tbody><tr><td>GET</td><td>&#x2F;posts</td><td>posts</td><td>app.controllers.posts.index</td></tr><tr><td>GET</td><td>&#x2F;posts&#x2F;new</td><td>new_post</td><td>app.controllers.posts.new</td></tr><tr><td>GET</td><td>&#x2F;posts&#x2F;:id</td><td>post</td><td>app.controllers.posts.show</td></tr><tr><td>GET</td><td>&#x2F;posts&#x2F;:id&#x2F;edit</td><td>edit_post</td><td>app.controllers.posts.edit</td></tr><tr><td>POST</td><td>&#x2F;posts</td><td>posts</td><td>app.controllers.posts.create</td></tr><tr><td>PUT</td><td>&#x2F;posts&#x2F;:id</td><td>post</td><td>app.controllers.posts.update</td></tr><tr><td>DELETE</td><td>&#x2F;posts&#x2F;:id</td><td>post</td><td>app.controllers.posts.destroy</td></tr></tbody></table><h3 id="æ¨¡å—åŒ–"><a href="#æ¨¡å—åŒ–" class="headerlink" title="æ¨¡å—åŒ–"></a>æ¨¡å—åŒ–</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./router/news&#x27;</span>)(app);</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./router/admin&#x27;</span>)(app);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/router/news.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  app.<span class="property">router</span>.<span class="title function_">get</span>(<span class="string">&#x27;/news/list&#x27;</span>, app.<span class="property">controller</span>.<span class="property">news</span>.<span class="property">list</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/router/admin.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  app.<span class="property">router</span>.<span class="title function_">get</span>(<span class="string">&#x27;/admin/user&#x27;</span>, app.<span class="property">controller</span>.<span class="property">admin</span>.<span class="property">user</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="æ§åˆ¶å™¨ï¼ˆControllerï¼‰"><a href="#æ§åˆ¶å™¨ï¼ˆControllerï¼‰" class="headerlink" title="æ§åˆ¶å™¨ï¼ˆControllerï¼‰"></a>æ§åˆ¶å™¨ï¼ˆControllerï¼‰</h2><blockquote><p>è§£æç”¨æˆ·çš„è¾“å…¥ï¼Œå¤„ç†åè¿”å›ç›¸åº”çš„ç»“æœï¼Œæ¡†æ¶å»ºè®®åœ¨ controller å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œå¤„ç†ï¼ˆæ ¡éªŒã€è½¬æ¢ï¼‰ï¼Œç„¶åè°ƒç”¨å¯¹åº”çš„ service æ–¹æ³•å¤„ç†ä¸šåŠ¡</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/controller/post.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Controller</span> = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).<span class="property">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PostController</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Controller</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">create</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, service &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> createRule = &#123;</span><br><span class="line">      <span class="attr">title</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">      <span class="attr">content</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// æ ¡éªŒå‚æ•°</span></span><br><span class="line">    ctx.<span class="title function_">validate</span>(createRule);</span><br><span class="line">    <span class="comment">// ç»„è£…å‚æ•°</span></span><br><span class="line">    <span class="keyword">const</span> author = ctx.<span class="property">session</span>.<span class="property">userId</span>;</span><br><span class="line">    <span class="keyword">const</span> req = <span class="title class_">Object</span>.<span class="title function_">assign</span>(ctx.<span class="property">request</span>.<span class="property">body</span>, &#123; author &#125;);</span><br><span class="line">    <span class="comment">// è°ƒç”¨ Service è¿›è¡Œä¸šåŠ¡å¤„ç†</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> service.<span class="property">post</span>.<span class="title function_">create</span>(req);</span><br><span class="line">    <span class="comment">// è®¾ç½®å“åº”å†…å®¹å’Œå“åº”çŠ¶æ€ç </span></span><br><span class="line">    ctx.<span class="property">body</span> = &#123; <span class="attr">id</span>: res.<span class="property">id</span> &#125;;</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">201</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">PostController</span>;</span><br></pre></td></tr></table></figure><h3 id="è·å–ä¸Šä¼ çš„æ–‡ä»¶"><a href="#è·å–ä¸Šä¼ çš„æ–‡ä»¶" class="headerlink" title="è·å–ä¸Šä¼ çš„æ–‡ä»¶"></a>è·å–ä¸Šä¼ çš„æ–‡ä»¶</h3><h4 id="fileæ¨¡å¼"><a href="#fileæ¨¡å¼" class="headerlink" title="fileæ¨¡å¼"></a>fileæ¨¡å¼</h4><p>åœ¨configä¸­é…ç½®fileæ¨¡å¼</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/config.default.js</span></span><br><span class="line">exports.multipart = <span class="punctuation">&#123;</span></span><br><span class="line">  mode<span class="punctuation">:</span> &#x27;file&#x27;<span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br></pre></td></tr></table></figure><p>controllerå±‚ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/controller/upload.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Controller</span> = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).<span class="property">Controller</span>;</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;mz/fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">Controller</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">upload</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(ctx.<span class="property">request</span>.<span class="property">body</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;got %d files&#x27;</span>, ctx.<span class="property">request</span>.<span class="property">files</span>.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> ctx.<span class="property">request</span>.<span class="property">files</span>) &#123; <span class="comment">// filesè·å–ä¸Šä¼ çš„å¤šæ–‡ä»¶</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;field: &#x27;</span> + file.<span class="property">fieldname</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;filename: &#x27;</span> + file.<span class="property">filename</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;encoding: &#x27;</span> + file.<span class="property">encoding</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;mime: &#x27;</span> + file.<span class="property">mime</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;tmp filepath: &#x27;</span> + file.<span class="property">filepath</span>);</span><br><span class="line">      <span class="keyword">let</span> result;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸Šä¼ åˆ°äº‘ç«¯</span></span><br><span class="line">        result = <span class="keyword">await</span> ctx.<span class="property">oss</span>.<span class="title function_">put</span>(<span class="string">&#x27;egg-multipart-test/&#x27;</span> + file.<span class="property">filename</span>, file.<span class="property">filepath</span>);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// éœ€è¦åˆ é™¤ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">await</span> fs.<span class="title function_">unlink</span>(file.<span class="property">filepath</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="streamæ¨¡å¼"><a href="#streamæ¨¡å¼" class="headerlink" title="streamæ¨¡å¼"></a>streamæ¨¡å¼</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> sendToWormhole = <span class="built_in">require</span>(<span class="string">&#x27;stream-wormhole&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Controller</span> = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).<span class="property">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UploaderController</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Controller</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">upload</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="variable language_">this</span>.<span class="property">ctx</span>;</span><br><span class="line">    <span class="keyword">const</span> stream = <span class="keyword">await</span> ctx.<span class="title function_">getFileStream</span>();</span><br><span class="line">    <span class="keyword">const</span> name = <span class="string">&#x27;egg-multipart-test/&#x27;</span> + path.<span class="title function_">basename</span>(stream.<span class="property">filename</span>);</span><br><span class="line">    <span class="comment">// æ–‡ä»¶å¤„ç†ï¼Œä¸Šä¼ åˆ°äº‘å­˜å‚¨ç­‰ç­‰</span></span><br><span class="line">    <span class="keyword">let</span> result;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      result = <span class="keyword">await</span> ctx.<span class="property">oss</span>.<span class="title function_">put</span>(name, stream);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="comment">// å¿…é¡»å°†ä¸Šä¼ çš„æ–‡ä»¶æµæ¶ˆè´¹æ‰ï¼Œè¦ä¸ç„¶æµè§ˆå™¨å“åº”ä¼šå¡æ­»</span></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">sendToWormhole</span>(stream);</span><br><span class="line">      <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ctx.<span class="property">body</span> = &#123;</span><br><span class="line">      <span class="attr">url</span>: result.<span class="property">url</span>,</span><br><span class="line">      <span class="comment">// æ‰€æœ‰è¡¨å•å­—æ®µéƒ½èƒ½é€šè¿‡ `stream.fields` è·å–åˆ°</span></span><br><span class="line">      <span class="attr">fields</span>: stream.<span class="property">fields</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">UploaderController</span>;</span><br></pre></td></tr></table></figure><h2 id="Serviceå±‚"><a href="#Serviceå±‚" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h2><p>å…¶ä¸æ˜¯å•ä¾‹ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚æ—¶è®¿é—®<code>ctx.service.xx</code> æ—¶å»¶è¿Ÿå®ä¾‹åŒ–ï¼Œæ‰€ä»¥å¯ä»¥ç”¨<code>this.ctx</code>è·å–æ¯ä¸€æ¬¡è¯·æ±‚çš„ä¸Šä¸‹æ–‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/service/user.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Service</span> = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).<span class="property">Service</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Service</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">find</span>(<span class="params">uid</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">db</span>.<span class="title function_">query</span>(<span class="string">&#x27;select * from user where uid = ?&#x27;</span>, uid);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">UserService</span>;</span><br></pre></td></tr></table></figure><p>å‡½æ•°returnçš„å€¼ä¼šè¿”å›ç»™å‰ç«¯</p><h2 id="å®šæ—¶ä»»åŠ¡"><a href="#å®šæ—¶ä»»åŠ¡" class="headerlink" title="å®šæ—¶ä»»åŠ¡"></a>å®šæ—¶ä»»åŠ¡</h2><p>æ‰€æœ‰çš„å®šæ—¶ä»»åŠ¡éƒ½ç»Ÿä¸€å­˜æ”¾åœ¨ <code>app/schedule</code> ç›®å½•ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Subscription</span> = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).<span class="property">Subscription</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UpdateCache</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Subscription</span> &#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡ schedule å±æ€§æ¥è®¾ç½®å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œé—´éš”ç­‰é…ç½®</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">get</span> <span class="title function_">schedule</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">interval</span>: <span class="string">&#x27;1m&#x27;</span>, <span class="comment">// 1 åˆ†é’Ÿé—´éš”</span></span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;all&#x27;</span>, <span class="comment">// æŒ‡å®šæ‰€æœ‰çš„ worker éƒ½éœ€è¦æ‰§è¡Œ</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// subscribe æ˜¯çœŸæ­£å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶è¢«è¿è¡Œçš„å‡½æ•°</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">subscribe</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">curl</span>(<span class="string">&#x27;http://www.api.com/cache&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">app</span>.<span class="property">cache</span> = res.<span class="property">data</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">UpdateCache</span>;</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ç®€å†™ä¸º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">schedule</span>: &#123;</span><br><span class="line">    <span class="attr">interval</span>: <span class="string">&#x27;1m&#x27;</span>, <span class="comment">// 1 åˆ†é’Ÿé—´éš”</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;all&#x27;</span>, <span class="comment">// æŒ‡å®šæ‰€æœ‰çš„ worker éƒ½éœ€è¦æ‰§è¡Œ</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">task</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> ctx.<span class="title function_">curl</span>(<span class="string">&#x27;http://www.api.com/cache&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    ctx.<span class="property">app</span>.<span class="property">cache</span> = res.<span class="property">data</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰ç”¨è¿‡ï¼Œå…·ä½“é…ç½®çœ‹å®˜æ–¹æ–‡æ¡£ <a href="https://eggjs.org/zh-cn/basics/schedule.html">å®šæ—¶ä»»åŠ¡</a></p><h2 id="egg-mysql"><a href="#egg-mysql" class="headerlink" title="egg-mysql"></a>egg-mysql</h2><h3 id="å®‰è£…ä¸é…ç½®"><a href="#å®‰è£…ä¸é…ç½®" class="headerlink" title="å®‰è£…ä¸é…ç½®"></a>å®‰è£…ä¸é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save egg-mysql</span><br></pre></td></tr></table></figure><p>å¼€å¯æ’ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/plugin.js</span></span><br><span class="line">exports.mysql = <span class="punctuation">&#123;</span></span><br><span class="line">  enable<span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  package<span class="punctuation">:</span> &#x27;egg-mysql&#x27;<span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br></pre></td></tr></table></figure><p>æ•°æ®åº“é…ç½®</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/config.$&#123;env&#125;.js</span></span><br><span class="line">exports.mysql = <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// å•æ•°æ®åº“ä¿¡æ¯é…ç½®</span></span><br><span class="line">  clients<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// clientId, è·å–clientå®ä¾‹ï¼Œéœ€è¦é€šè¿‡ app.mysql.get(&#x27;clientId&#x27;) è·å–</span></span><br><span class="line">    db1<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      host<span class="punctuation">:</span> &#x27;mysql.com&#x27;<span class="punctuation">,</span></span><br><span class="line">      port<span class="punctuation">:</span> &#x27;<span class="number">3306</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">      user<span class="punctuation">:</span> &#x27;test_user&#x27;<span class="punctuation">,</span></span><br><span class="line">      password<span class="punctuation">:</span> &#x27;test_password&#x27;<span class="punctuation">,</span></span><br><span class="line">      database<span class="punctuation">:</span> &#x27;test&#x27;<span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    db2<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      host<span class="punctuation">:</span> &#x27;mysql2.com&#x27;<span class="punctuation">,</span></span><br><span class="line">      port<span class="punctuation">:</span> &#x27;<span class="number">3307</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">      user<span class="punctuation">:</span> &#x27;test_user&#x27;<span class="punctuation">,</span></span><br><span class="line">      password<span class="punctuation">:</span> &#x27;test_password&#x27;<span class="punctuation">,</span></span><br><span class="line">      database<span class="punctuation">:</span> &#x27;test&#x27;<span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment">// æ‰€æœ‰æ•°æ®åº“é…ç½®çš„é»˜è®¤å€¼</span></span><br><span class="line">  default<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// æ˜¯å¦åŠ è½½åˆ° app ä¸Šï¼Œé»˜è®¤å¼€å¯</span></span><br><span class="line">  app<span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// æ˜¯å¦åŠ è½½åˆ° agent ä¸Šï¼Œé»˜è®¤å…³é—­</span></span><br><span class="line">  agent<span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ–¹å¼ï¼š"><a href="#ä½¿ç”¨æ–¹å¼ï¼š" class="headerlink" title="ä½¿ç”¨æ–¹å¼ï¼š"></a>ä½¿ç”¨æ–¹å¼ï¼š</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client1 = app.<span class="property">mysql</span>.<span class="title function_">get</span>(<span class="string">&#x27;db1&#x27;</span>);</span><br><span class="line"><span class="keyword">await</span> client1.<span class="title function_">query</span>(sql, values);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client2 = app.<span class="property">mysql</span>.<span class="title function_">get</span>(<span class="string">&#x27;db2&#x27;</span>);</span><br><span class="line"><span class="keyword">await</span> client2.<span class="title function_">query</span>(sql, values);</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å¿«é€Ÿåˆå§‹åŒ–&quot;&gt;&lt;a href=&quot;#å¿«é€Ÿåˆå§‹åŒ–&quot; class=&quot;headerlink&quot; title=&quot;å¿«é€Ÿåˆå§‹åŒ–&quot;&gt;&lt;/a&gt;å¿«é€Ÿåˆå§‹åŒ–&lt;/h2&gt;&lt;p&gt;ç”¨npm&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm init egg --&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt;=simple&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="åç«¯" scheme="https://liang5757.github.io/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="egg.js" scheme="https://liang5757.github.io/tags/egg-js/"/>
    
  </entry>
  
  <entry>
    <title>reduxå…¥é—¨</title>
    <link href="https://liang5757.github.io/2021/06/15/React/redux%E5%85%A5%E9%97%A8/"/>
    <id>https://liang5757.github.io/2021/06/15/React/redux%E5%85%A5%E9%97%A8/</id>
    <published>2021-06-15T13:02:58.000Z</published>
    <updated>2025-12-07T10:16:59.222Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Redux å®˜æ–¹æ–‡æ¡£å¯¹ Redux çš„å®šä¹‰æ˜¯ï¼š<strong>ä¸€ä¸ªå¯é¢„æµ‹çš„ JavaScript åº”ç”¨çŠ¶æ€ç®¡ç†å®¹å™¨</strong></p></blockquote><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save redux</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h2><blockquote><p>Reduxåº”ç”¨åªæœ‰å•ä¸€çš„ store</p></blockquote><p>é€šè¿‡<code>createStore()</code>åˆ›å»ºä¸€ä¸ªstore</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> todoApp <span class="keyword">from</span> <span class="string">&#x27;./reducers&#x27;</span> <span class="comment">// è¿™ä¸ªåœ¨ä¸‹é¢ä¼šè®²</span></span><br><span class="line"><span class="keyword">let</span> store = <span class="title function_">createStore</span>(todoApp)</span><br></pre></td></tr></table></figure><p><code>createStore()</code>çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„, ç”¨äºè®¾ç½® state åˆå§‹çŠ¶æ€ã€‚è¿™å¯¹å¼€å‘åŒæ„åº”ç”¨æ—¶éå¸¸æœ‰ç”¨ï¼ŒæœåŠ¡å™¨ç«¯ redux åº”ç”¨çš„ state ç»“æ„å¯ä»¥ä¸å®¢æˆ·ç«¯ä¿æŒä¸€è‡´, é‚£ä¹ˆå®¢æˆ·ç«¯å¯ä»¥å°†ä»ç½‘ç»œæ¥æ”¶åˆ°çš„æœåŠ¡ç«¯ state ç›´æ¥ç”¨äºæœ¬åœ°æ•°æ®åˆå§‹åŒ–ã€‚</p><p>æä¾›å››ä¸ªå‡½æ•°</p><ul><li><code>getState()</code>æ–¹æ³•è·å– state</li><li><code>dispatch(action)</code>æ–¹æ³•åˆ†å‘ action æ›´æ–° state</li><li><code>subscribe(listener)</code>æ³¨å†Œç›‘å¬å™¨ï¼Œè¿”å›çš„å‡½æ•°æ³¨é”€ç›‘å¬å™¨</li><li><code>replaceReducer(nextReducer)</code> ä¸€èˆ¬åœ¨ Webpack Code-Splitting æŒ‰éœ€åŠ è½½çš„æ—¶å€™ç”¨</li></ul><p>reduxè§„å®šç¦æ­¢ç›´æ¥ä¿®æ”¹ stateï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„å†™æ³•</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> state = store.<span class="title function_">getState</span>()</span><br><span class="line">state.<span class="property">counter</span> = state.<span class="property">counter</span> + <span class="number">1</span> <span class="comment">// ç¦æ­¢åœ¨ä¸šåŠ¡é€»è¾‘ä¸­ç›´æ¥ä¿®æ”¹ state</span></span><br></pre></td></tr></table></figure><p>åªèƒ½é€šè¿‡ dispatch ä¸€ä¸ª action æ¥ä¿®æ”¹</p><h2 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h2><p>æ˜¯æŠŠæ•°æ®ä»åº”ç”¨ä¼ åˆ° store çš„æœ‰æ•ˆè½½è·ã€‚å®ƒæ˜¯ store æ•°æ®çš„<strong>å”¯ä¸€</strong>æ¥æºã€‚ä¸€èˆ¬æ¥è¯´ä½ ä¼šé€šè¿‡ <a href="https://cn.redux.js.org/docs/api/Store.html#dispatch"><code>store.dispatch()</code></a> å°† action ä¼ åˆ° storeã€‚</p><h3 id="1-Actionæ ¼å¼"><a href="#1-Actionæ ¼å¼" class="headerlink" title="1 Actionæ ¼å¼"></a>1 Actionæ ¼å¼</h3><p>é™¤äº†<code>type</code>å­—æ®µå¤–ï¼Œactionçš„ç»“æ„å®Œå…¨ç”±ä½ è‡ªå·±å†³å®šï¼Œä¸€èˆ¬å‚ç…§ <a href="https://github.com/acdlite/flux-standard-action">Flux æ ‡å‡† Action</a> è·å–å…³äºå¦‚ä½•æ„é€  action çš„å»ºè®®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">ADD_TODO</span> = <span class="string">&#x27;ADD_TODO&#x27;</span></span><br><span class="line"><span class="comment">// ä¸‹é¢æ˜¯å¸¸è§çš„actionæ ¼å¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="variable constant_">ADD_TODO</span>,</span><br><span class="line">  <span class="attr">text</span>: <span class="string">&#x27;Build my first Redux app&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-Actionåˆ›å»ºå‡½æ•°"><a href="#2-Actionåˆ›å»ºå‡½æ•°" class="headerlink" title="2 Actionåˆ›å»ºå‡½æ•°"></a>2 Actionåˆ›å»ºå‡½æ•°</h3><p>å°±æ˜¯ç”Ÿæˆactionçš„æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addTodo</span>(<span class="params">text</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">ADD_TODO</span>,</span><br><span class="line">        text</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-dispatch"><a href="#3-dispatch" class="headerlink" title="3 dispatch"></a>3 dispatch</h3><p>åªéœ€æŠŠ action åˆ›å»ºå‡½æ•°çš„ç»“æœä¼ ç»™ <code>dispatch()</code> æ–¹æ³•å³å¯å‘èµ·ä¸€æ¬¡ dispatch è¿‡ç¨‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">dispatch</span>(<span class="title function_">addTodo</span>(text))</span><br></pre></td></tr></table></figure><h2 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h2><p>æŒ‡å®šäº†åº”ç”¨çŠ¶æ€çš„å˜åŒ–å¦‚ä½•<strong>å“åº”</strong> actions å¹¶å‘é€çŠ¶æ€åˆ° store çš„ï¼Œè®°ä½ actions åªæ˜¯æè¿°äº†<em>æœ‰äº‹æƒ…å‘ç”Ÿäº†</em>è¿™ä¸€äº‹å®ï¼Œå¹¶æ²¡æœ‰æè¿°åº”ç”¨å¦‚ä½•æ›´æ–° stateã€‚</p><p>reducerå°±æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œ<strong>æ¥æ”¶æ—§çš„ state å’Œ actionï¼Œè¿”å›æ–°çš„ state</strong>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;<span class="function">(<span class="params">previousState, action</span>) =&gt;</span> newState</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> initState = &#123;</span><br><span class="line">    <span class="attr">counter</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">todos</span>: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">    <span class="comment">// åº”ç”¨çš„åˆå§‹çŠ¶æ€æ˜¯åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œ reducer æ—¶è®¾ç½®çš„ â€»</span></span><br><span class="line">    <span class="keyword">if</span> (!state) state = initState</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;ADD_TODO&#x27;</span>:</span><br><span class="line">            <span class="keyword">var</span> nextState = _.<span class="title function_">cloneDeep</span>(state) <span class="comment">// ç”¨åˆ°äº† lodash çš„æ·±å…‹éš†</span></span><br><span class="line">            nextState.<span class="property">todos</span>.<span class="title function_">push</span>(action.<span class="property">payload</span>) </span><br><span class="line">            <span class="keyword">return</span> nextState</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;ADD_COUNT&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, state, &#123;</span><br><span class="line">                <span class="attr">visibilityFilter</span>: action.<span class="property">filter</span></span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="comment">// ç”±äº nextState ä¼šæŠŠåŸ state æ•´ä¸ªæ›¿æ¢æ‰</span></span><br><span class="line">            <span class="comment">// è‹¥æ— ä¿®æ”¹ï¼Œå¿…é¡»è¿”å›åŸ stateï¼ˆå¦åˆ™å°±æ˜¯ undefinedï¼‰</span></span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ul><li><strong>ä¸è¦ä¿®æ”¹ <code>state</code>ã€‚</strong> ä½¿ç”¨ <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign"><code>Object.assign()</code></a> æ–°å»ºäº†ä¸€ä¸ªå‰¯æœ¬ã€‚ä¸èƒ½è¿™æ ·ä½¿ç”¨ <code>Object.assign(state, &#123; visibilityFilter: action.filter &#125;)</code>ï¼Œå› ä¸ºå®ƒä¼šæ”¹å˜ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼</li><li><strong>åœ¨ <code>default</code> æƒ…å†µä¸‹è¿”å›æ—§çš„ <code>state</code>ã€‚</strong>å¦åˆ™ state ä¼šå˜æˆ<code>undefined</code></li></ul><h2 id="æ‹†åˆ†Reducer"><a href="#æ‹†åˆ†Reducer" class="headerlink" title="æ‹†åˆ†Reducer"></a>æ‹†åˆ†Reducer</h2><p>å½“ä¸šåŠ¡é€»è¾‘å¤æ‚æ—¶ï¼Œæ‰€æœ‰çŠ¶æ€èšåˆåœ¨ä¸€ä¸ªreducerå‡½æ•°é‡Œå¤„ç†ï¼Œé€»è¾‘ä¼šå˜å¾—ç›¸å½“å¤æ‚ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æå‡ºä¸€ä¸ªä¸»reducerå‡½æ•°ï¼Œå®ƒè°ƒç”¨å¤šä¸ªå­ reducer åˆ†åˆ«å¤„ç†å­ state ä¸­çš„æ•°æ®ï¼Œç„¶åå†æŠŠè¿™äº›æ•°æ®åˆæˆä¸€ä¸ªå¤§çš„å•ä¸€å¯¹è±¡ã€‚</p><p>ä¸» reducer å¹¶ä¸éœ€è¦è®¾ç½®åˆå§‹åŒ–æ—¶å®Œæ•´çš„ stateã€‚åˆå§‹æ—¶ï¼Œå¦‚æœä¼ å…¥ <code>undefined</code>, <strong>å­ reducer å°†è´Ÿè´£è¿”å›å®ƒä»¬çš„é»˜è®¤å€¼</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">todos</span>(<span class="params">state = [], action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">ADD_TODO</span>:</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        ...state,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">text</span>: action.<span class="property">text</span>,</span><br><span class="line">          <span class="attr">completed</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">TOGGLE_TODO</span>:</span><br><span class="line">      <span class="keyword">return</span> state.<span class="title function_">map</span>(<span class="function">(<span class="params">todo, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index === action.<span class="property">index</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, todo, &#123;</span><br><span class="line">            <span class="attr">completed</span>: !todo.<span class="property">completed</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> todo</span><br><span class="line">      &#125;)</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">visibilityFilter</span>(<span class="params">state = SHOW_ALL, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">SET_VISIBILITY_FILTER</span>:</span><br><span class="line">      <span class="keyword">return</span> action.<span class="property">filter</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»reducer</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">todoApp</span>(<span class="params">state = &#123;&#125;, action</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">visibilityFilter</span>: <span class="title function_">visibilityFilter</span>(state.<span class="property">visibilityFilter</span>, action),</span><br><span class="line">    <span class="attr">todos</span>: <span class="title function_">todos</span>(state.<span class="property">todos</span>, action)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥åˆ©ç”¨<code>combineReducers()</code>æ¥ç®€åŒ–ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todoApp = <span class="title function_">combineReducers</span>(&#123;</span><br><span class="line">  visibilityFilter,</span><br><span class="line">  <span class="attr">a</span>: todos</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> todoApp</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸Šé¢çš„å†™æ³•å’Œä¸‹é¢å®Œå…¨ç­‰ä»·ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">todoApp</span>(<span class="params">state = &#123;&#125;, action</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">visibilityFilter</span>: <span class="title function_">visibilityFilter</span>(state.<span class="property">visibilityFilter</span>, action),</span><br><span class="line">    <span class="attr">todos</span>: <span class="title function_">todos</span>(state.<span class="property">todos</span>, action)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¼‚æ­¥æ•°æ®æµ"><a href="#å¼‚æ­¥æ•°æ®æµ" class="headerlink" title="å¼‚æ­¥æ•°æ®æµ"></a>å¼‚æ­¥æ•°æ®æµ</h2><p>å¦‚æœåªæ˜¯ç®€å•çš„redux storeæ˜¯ä¸æ”¯æŒç”¨dispatchå¼‚æ­¥æ›´æ–°storeï¼Œå¯ä»¥ä½¿ç”¨<code>react-thunk</code>æ¥å¢å¼º</p><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install redux-thunk</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨applyMiddlewareå¼•å…¥ä¸­é—´ä»¶"><a href="#ä½¿ç”¨applyMiddlewareå¼•å…¥ä¸­é—´ä»¶" class="headerlink" title="ä½¿ç”¨applyMiddlewareå¼•å…¥ä¸­é—´ä»¶"></a>ä½¿ç”¨applyMiddlewareå¼•å…¥ä¸­é—´ä»¶</h3><blockquote><p>ä¸Koaå’ŒExpressç±»ä¼¼ï¼Œreduxä¹Ÿæä¾›äº†æ³¨å†Œä¸­é—´ä»¶çš„æ–¹æ³•ï¼š<code>applyMiddleware</code>ï¼Œè¿™ä¸ªä¸­é—´ä»¶æ‰§è¡Œæ—¶é—´æ˜¯åœ¨<strong>dispatchä¸€ä¸ªactionä¹‹åï¼Œåˆ°è¾¾reducerä¹‹å‰</strong>ï¼Œæ‰§è¡Œé¡ºåºæ˜¯ä»ä¸Šåˆ°ä¸‹ï¼Œä¼ é€’action</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&#x27;redux-thunk&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">&#x27;./reducers&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(</span><br><span class="line">  rootReducer,</span><br><span class="line">  <span class="title function_">applyMiddleware</span>(</span><br><span class="line">    thunk, <span class="comment">// å…è®¸æˆ‘ä»¬ dispatch() å‡½æ•°</span></span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="åŠ¨æœº"><a href="#åŠ¨æœº" class="headerlink" title="åŠ¨æœº"></a>åŠ¨æœº</h3><p>å¼•å…¥å<strong>å…è®¸æˆ‘ä»¬<code>dispatch</code>ä¸€ä¸ªå‡½æ•°</strong>ï¼Œè¿™ä¸ªå‡½æ•°å†…éƒ¨å¯ä»¥<code>dispatch</code>ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯<code>dispatch</code>ï¼Œç¬¬äºŒä¸ªæ˜¯<code>getState</code>ï¼Œå‡½æ•°å†…éƒ¨å…è®¸æ”¾ä¸€äº›å¼‚æ­¥æ“ä½œï¼Œæ¥è§£å†³reduxåªèƒ½åŒæ­¥<code>dispatch(action)</code>çš„é—®é¢˜</p><h3 id="react-thunk-æºç "><a href="#react-thunk-æºç " class="headerlink" title="react-thunk æºç "></a>react-thunk æºç </h3><p>å‡ºä¹æ„æ–™çš„ç®€å•</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createThunkMiddleware</span>(<span class="params">extraArgument</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">&#123; dispatch, getState &#125;</span>) =&gt;</span> <span class="function">(<span class="params">next</span>) =&gt;</span> <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">&#x27;function&#x27;</span>) &#123; <span class="comment">// å¦‚æœæ˜¯å‡½æ•°ï¼Œå½“ä½œå‡½æ•°æ‰§è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">action</span>(dispatch, getState, extraArgument);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">next</span>(action);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> thunk = <span class="title function_">createThunkMiddleware</span>();</span><br><span class="line">thunk.<span class="property">withExtraArgument</span> = createThunkMiddleware;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> thunk;</span><br></pre></td></tr></table></figure><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨<code>redux-promise</code>è¿™ä¸ªä¸­é—´ä»¶æ¥<code>dispatch</code>ä¸€ä¸ª<code>promise</code></p><h3 id="redux-promise-æºç "><a href="#redux-promise-æºç " class="headerlink" title="redux-promise æºç "></a>redux-promise æºç </h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> isPromise <span class="keyword">from</span> <span class="string">&#x27;is-promise&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isFSA &#125; <span class="keyword">from</span> <span class="string">&#x27;flux-standard-action&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">promiseMiddleware</span>(<span class="params">&#123; dispatch &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯ flux æ ‡å‡†çš„action</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">isFSA</span>(action)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">isPromise</span>(action) ? action.<span class="title function_">then</span>(dispatch) : <span class="title function_">next</span>(action);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">isPromise</span>(action.<span class="property">payload</span>)</span><br><span class="line">            ? action.<span class="property">payload</span></span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="title function_">dispatch</span>(&#123; ...action, <span class="attr">payload</span>: result &#125;))</span><br><span class="line">            .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">dispatch</span>(&#123; ...action, <span class="attr">payload</span>: error, <span class="attr">error</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;)</span><br><span class="line">        : <span class="title function_">next</span>(action);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸reacté…åˆä½¿ç”¨"><a href="#ä¸reacté…åˆä½¿ç”¨" class="headerlink" title="ä¸reacté…åˆä½¿ç”¨"></a>ä¸reacté…åˆä½¿ç”¨</h2><h3 id="å®‰è£…-2"><a href="#å®‰è£…-2" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save react-redux</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><p>åˆ©ç”¨ Provider ç»„ä»¶åˆ†å‘storeçŠ¶æ€</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./app/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨<code>useSelector</code>ï¼Œ<code>useDispatch</code>æ¥è·å– state å’Œåˆ†å‘ action</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; decrement, increment &#125; <span class="keyword">from</span> <span class="string">&#x27;./counterSlice&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> count = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">counter</span>.<span class="property">value</span>) <span class="comment">// ä»stateä¸­è·å–countçš„å€¼</span></span><br><span class="line">    <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>() <span class="comment">// è·å–dispatchæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(increment())&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                Increment</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(decrement())&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                Decrement</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç”¨<code>connect</code>å‡½æ•°åŒ…è£¹ç»„ä»¶ï¼Œå°†stateå’Œdispatchæ˜ å°„åˆ°propsä¸­</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">connect</span>(mapStateToProps, mapDispatchToProps)(<span class="title class_">MyComponent</span>)</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">mapStateToProps</span> = (<span class="params">state</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// prop : state.xxx  | æ„æ€æ˜¯å°†stateä¸­çš„æŸä¸ªæ•°æ®æ˜ å°„åˆ°propsä¸­</span></span><br><span class="line">        <span class="attr">foo</span>: state.<span class="property">bar</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mapDispatchToProps</span> = (<span class="params">dispatch</span>) =&gt; &#123; <span class="comment">// é»˜è®¤ä¼ é€’å‚æ•°å°±æ˜¯dispatch</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">onClick</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;increatment&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>this.props.foo<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span> = <span class="string">&#123;this.props.onClick&#125;</span>&gt;</span>ç‚¹å‡»increase<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Foo</span> = <span class="title function_">connect</span>(mapStateToProps, mapDispatchToProps)(<span class="title class_">Foo</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Foo</span>;</span><br></pre></td></tr></table></figure><h2 id="åŒæ­¥react-router"><a href="#åŒæ­¥react-router" class="headerlink" title="åŒæ­¥react-router"></a>åŒæ­¥react-router</h2><h3 id="å®‰è£…-3"><a href="#å®‰è£…-3" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save connected-react-router</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>1.åˆ›å»ºä¸€ä¸ªä»¥historyä½œä¸ºå‚æ•°ï¼Œè¿”å›æ ¹reducerçš„å‡½æ•°</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reducers.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; connectRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;connected-react-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createRootReducer</span> = (<span class="params">history</span>) =&gt; <span class="title function_">combineReducers</span>(&#123;</span><br><span class="line">  <span class="attr">router</span>: <span class="title function_">connectRouter</span>(history),</span><br><span class="line">  ... <span class="comment">// rest of your reducers</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createRootReducer;</span><br></pre></td></tr></table></figure><p>2.åˆ›å»ºä¸€ä¸ªhistoryå¯¹è±¡ï¼Œå°†è¿™ä¸ªå¯¹è±¡ç»™ä¸Šè¿°çš„reducerå’Œ<code>createRootReducer</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// configureStore.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;history&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; applyMiddleware, compose, createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; routerMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;connected-react-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> createRootReducer <span class="keyword">from</span> <span class="string">&#x27;./reducers&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> history = <span class="title function_">createBrowserHistory</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">configureStore</span>(<span class="params">preloadedState</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> store = <span class="title function_">createStore</span>(</span><br><span class="line">        <span class="title function_">createRootReducer</span>(history), <span class="comment">// root reducer with router state</span></span><br><span class="line">        preloadedState,</span><br><span class="line">        <span class="title function_">compose</span>(</span><br><span class="line">            <span class="title function_">applyMiddleware</span>(</span><br><span class="line">                <span class="title function_">routerMiddleware</span>(history), <span class="comment">// for dispatching history actions</span></span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">            ),</span><br><span class="line">        ),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> store</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.åˆ©ç”¨ ConnectedRouterç»„ä»¶ï¼Œä¼ é€’ç»™ä»–historyå¯¹è±¡ä½œä¸ºpropï¼Œå¹¶å°†è¯¥ç»„ä»¶ä½œä¸º react-reduxçš„Providerç»„ä»¶çš„å­ç»„ä»¶</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Route</span>, <span class="title class_">Switch</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span> <span class="comment">// react-router v4/v5</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ConnectedRouter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;connected-react-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> configureStore, &#123; history &#125; <span class="keyword">from</span> <span class="string">&#x27;./configureStore&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">configureStore</span>(<span class="comment">/* æä¾›åˆå§‹state */</span>)</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ConnectedRouter</span> <span class="attr">history</span>=<span class="string">&#123;history&#125;</span>&gt;</span> &#123; /* place ConnectedRouter under Provider */ &#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;&gt;</span> </span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">render</span>=<span class="string">&#123;()</span> =&gt;</span> (<span class="tag">&lt;<span class="name">div</span>&gt;</span>Match<span class="tag">&lt;/<span class="name">div</span>&gt;</span>)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">render</span>=<span class="string">&#123;()</span> =&gt;</span> (<span class="tag">&lt;<span class="name">div</span>&gt;</span>Miss<span class="tag">&lt;/<span class="name">div</span>&gt;</span>)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ConnectedRouter</span>&gt;</span></span></span><br><span class="line">    &lt;/<span class="title class_">Provider</span>&gt;,</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;react-root&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="ç¼–ç¨‹å¼å¯¼èˆª"><a href="#ç¼–ç¨‹å¼å¯¼èˆª" class="headerlink" title="ç¼–ç¨‹å¼å¯¼èˆª"></a>ç¼–ç¨‹å¼å¯¼èˆª</h3><p>connect-react-routerä¹Ÿæä¾›äº†è·¯ç”±è·³è½¬çš„æ–¹æ³•ï¼Œæ¯”å¦‚ push å’Œ replaceï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•åªæ˜¯åˆ›å»ºäº†actionï¼Œéœ€è¦dispatchè¿™äº›æ–¹æ³•äº§ç”Ÿçš„action</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;push, replace&#125; <span class="keyword">from</span> <span class="string">&quot;connected-react-router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">XXX</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">push</span>(<span class="string">&quot;/page1&quot;</span>))</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.sakura-snow.com/post/react-node-6/">reactå­¦ä¹ ç¬”è®°6-redux</a><br><a href="https://juejin.cn/post/6844903846666321934">ä¸€ç¯‡æ–‡ç« æ€»ç»“reduxã€react-reduxã€redux-saga</a><br><a href="https://cn.redux.js.org/">Reduxä¸­æ–‡æ–‡æ¡£</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Redux å®˜æ–¹æ–‡æ¡£å¯¹ Redux çš„å®šä¹‰æ˜¯ï¼š&lt;strong&gt;ä¸€ä¸ªå¯é¢„æµ‹çš„ JavaScript åº”ç”¨çŠ¶æ€ç®¡ç†å®¹å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm install --save redux&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="React" scheme="https://liang5757.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>React Hook</title>
    <link href="https://liang5757.github.io/2021/06/08/React/React%20Hook/"/>
    <id>https://liang5757.github.io/2021/06/08/React/React%20Hook/</id>
    <published>2021-06-08T14:45:46.000Z</published>
    <updated>2025-12-07T10:16:59.221Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å‡½æ•°å¼ç»„ä»¶åªèƒ½ä½¿ç”¨propsï¼ŒHookèƒ½å¤Ÿåœ¨å‡½æ•°å¼ç»„ä»¶çš„æƒ…å†µä¸‹ä½¿ç”¨stateã€ç”Ÿå‘½å‘¨æœŸä»¥åŠå…¶ä»–çš„Reactç‰¹æ€§</p></blockquote><p>ä¸ºä»€ä¹ˆéœ€è¦å¼•å…¥React Hookï¼Œå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://zh-hans.reactjs.org/docs/hooks-intro.html#motivation">https://zh-hans.reactjs.org/docs/hooks-intro.html#motivation</a></p><span id="more"></span><h2 id="1-æ³¨æ„äº‹é¡¹"><a href="#1-æ³¨æ„äº‹é¡¹" class="headerlink" title="1. æ³¨æ„äº‹é¡¹"></a>1. æ³¨æ„äº‹é¡¹</h2><ul><li>åªèƒ½åœ¨å‡½æ•°å†…éƒ¨çš„æœ€å¤–å±‚è°ƒç”¨ Hookï¼Œä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­æˆ–è€…å­å‡½æ•°ä¸­è°ƒç”¨</li><li>åªèƒ½åœ¨ React çš„å‡½æ•°ç»„ä»¶æˆ–è‡ªå®šä¹‰Hookä¸­è°ƒç”¨ Hookï¼Œä¸è¦åœ¨å…¶ä»– JavaScript å‡½æ•°ä¸­è°ƒç”¨</li><li>Hook åœ¨ class å†…éƒ¨æ˜¯<strong>ä¸</strong>èµ·ä½œç”¨çš„</li></ul><h2 id="2-useState"><a href="#2-useState" class="headerlink" title="2. useState"></a>2. useState</h2><p>useStateåœ¨ç»„ä»¶å†…åˆ›å»ºçš„å†…éƒ¨stateï¼ŒReact ä¼šåœ¨é‡å¤æ¸²æŸ“æ—¶ä¿ç•™è¿™ä¸ª stateï¼Œè¯¥å‡½æ•°çš„<strong>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åˆå§‹å€¼</strong>ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œæ­¤å‡½æ•°åªåœ¨åˆå§‹æ¸²æŸ“ä¸­è¢«è°ƒç”¨ã€‚è°ƒç”¨è¯¥å‡½æ•°ä¼šè¿”å›ä¸€å¯¹å€¼ï¼š[å½“å‰çŠ¶æ€ï¼Œæ›´æ–°å½“å‰çŠ¶æ€çš„å‡½æ•°]ã€‚</p><p>è¿™ä¸ªæ›´æ–°çŠ¶æ€çš„å‡½æ•°<strong>ä¸ä¼šå¯¹stateè¿›è¡Œåˆå¹¶ï¼Œè€Œæ˜¯ç›´æ¥æ›¿æ¢</strong>ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæºå¸¦å‚æ•°æ˜¯ä¸Šä¸€æ¬¡çš„state</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>; <span class="number">2</span>:</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>); <span class="number">5</span>:</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                Click me</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†…éƒ¨ä½¿ç”¨<code>Object.js</code>ï¼ˆæµ…ï¼‰æ¥æ¯”è¾ƒæ–°&#x2F;æ—§<code>state</code>æ˜¯å¦ç›¸ç­‰ï¼Œåœ¨ä¿®æ”¹çŠ¶æ€æ—¶ï¼Œ<strong>ä¼ çš„çŠ¶æ€å€¼æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸é‡æ–°æ¸²æŸ“</strong></p><h3 id="æƒ°æ€§åˆå§‹å€¼"><a href="#æƒ°æ€§åˆå§‹å€¼" class="headerlink" title="æƒ°æ€§åˆå§‹å€¼"></a>æƒ°æ€§åˆå§‹å€¼</h3><p>ä¸‹é¢çš„ä»£ç ä¸­ï¼Œ<code>initialState</code>æ˜¯åªåœ¨åˆå§‹åŒ–æ—¶æœ‰å…¶å­˜åœ¨ä»·å€¼ï¼Œä½†æ˜¯å¦‚æœçœŸå¦‚ä¸‹é¢ä¸€æ ·å†™äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªè®¡ç®—å‡º<code>initialState</code>æ˜‚è´µçš„æ“ä½œåœ¨æ¯æ¬¡renderéƒ½ä¼šæ‰§è¡Œã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = <span class="title function_">someExpensiveComputation</span>(props); <span class="comment">// è¿™æ˜¯ä¸€ä¸ªè€—æ—¶çš„æ“ä½œ</span></span><br><span class="line"><span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(initialState);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è®©<code>someExpensiveComputation</code> è¿è¡Œåœ¨ä¸€ä¸ª<code>useState</code>åŒ¿åå‡½æ•°å‚æ•°ä¸‹ï¼Œè¯¥å‡½æ•°å½“ä¸”ä»…å½“åˆå§‹åŒ–æ—¶è¢«è°ƒç”¨ï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> initialState = <span class="title function_">someExpensiveComputation</span>(props);</span><br><span class="line">    <span class="keyword">return</span> initialState;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="2-useEffect"><a href="#2-useEffect" class="headerlink" title="2. useEffect"></a>2. useEffect</h2><p>ç”¨æ¥åœ¨å‡½æ•°å¼ç»„ä»¶å†…ä½¿ç”¨classç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå¯ä»¥ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯ç›‘å¬çš„å˜é‡æ•°ç»„ã€‚</p><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><h4 id="1-åªåœ¨ç¬¬ä¸€æ¬¡çš„componentDidMountæ‰§è¡Œ"><a href="#1-åªåœ¨ç¬¬ä¸€æ¬¡çš„componentDidMountæ‰§è¡Œ" class="headerlink" title="1.åªåœ¨ç¬¬ä¸€æ¬¡çš„componentDidMountæ‰§è¡Œ"></a>1.åªåœ¨ç¬¬ä¸€æ¬¡çš„componentDidMountæ‰§è¡Œ</h4><p>ç¬¬äºŒä¸ªå‚æ•°ä¸º []</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure><h4 id="2-åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“å’Œæ¯æ¬¡æ›´æ–°åæ‰§è¡Œ"><a href="#2-åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“å’Œæ¯æ¬¡æ›´æ–°åæ‰§è¡Œ" class="headerlink" title="2. åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“å’Œæ¯æ¬¡æ›´æ–°åæ‰§è¡Œ"></a>2. åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“å’Œæ¯æ¬¡æ›´æ–°åæ‰§è¡Œ</h4><p>ç¬¬äºŒä¸ªå‚æ•°ä¸ºç©º</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="3-ç›‘å¬å˜é‡çš„å˜åŒ–æ‰§è¡Œ"><a href="#3-ç›‘å¬å˜é‡çš„å˜åŒ–æ‰§è¡Œ" class="headerlink" title="3. ç›‘å¬å˜é‡çš„å˜åŒ–æ‰§è¡Œ"></a>3. ç›‘å¬å˜é‡çš„å˜åŒ–æ‰§è¡Œ</h4><p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå˜é‡æ•°ç»„ï¼Œåªè¦æœ‰ä¸€ä¸ªå˜é‡å˜åŒ–äº†å°±ä¼šæ‰§è¡Œ</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// countæ”¹å˜æ‰ä¼šæ‰§è¡Œ</span></span><br><span class="line">&#125;, [count])</span><br></pre></td></tr></table></figure><h4 id="4-åœ¨componentWillUnmountä¸­æ‰§è¡Œ"><a href="#4-åœ¨componentWillUnmountä¸­æ‰§è¡Œ" class="headerlink" title="4. åœ¨componentWillUnmountä¸­æ‰§è¡Œ"></a>4. åœ¨componentWillUnmountä¸­æ‰§è¡Œ</h4><p>ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°å¯ä»¥returnä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªreturnçš„å‡½æ•°ä¼šåœ¨<code>componentWillUnmount</code>è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ‰§è¡Œã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;use effect...&#x27;</span>, count)</span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> <span class="title function_">setCount</span>(count +<span class="number">1</span>), <span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(timer)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="3-useRef"><a href="#3-useRef" class="headerlink" title="3. useRef"></a>3. useRef</h2><p><code>useRef</code> è¿”å›ä¸€ä¸ªå¯å˜çš„ ref å¯¹è±¡ï¼Œå…¶ <code>.current</code> å±æ€§è¢«åˆå§‹åŒ–ä¸ºä¼ å…¥çš„å‚æ•°ï¼ˆ<code>initialValue</code>ï¼‰ã€‚è¿”å›çš„ ref å¯¹è±¡åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜ã€‚</p><p>å½“ ref å¯¹è±¡å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>useRef</code> å¹¶<em>ä¸ä¼š</em>é€šçŸ¥ä½ ã€‚å˜æ›´ <code>.current</code> å±æ€§ä¸ä¼šå¼•å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚</p><p><strong>å’ŒcreateRefçš„åŒºåˆ«</strong>ï¼šcreateRef æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¼•ç”¨ï¼Œè€Œ useRef æ¯æ¬¡éƒ½ä¼šè¿”å›ç›¸åŒçš„å¼•ç”¨ï¼ˆå¯ä»¥è§£å†³æ¯æ¬¡æ¸²æŸ“å¼•ç”¨ä¸åŒçš„useStateï¼Œå¯¼è‡´çŠ¶æ€å¼‚å¸¸çš„bugï¼‰</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [renderIndex, setRenderIndex] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> refFromUseRef = <span class="title function_">useRef</span>();</span><br><span class="line">    <span class="keyword">const</span> refFromCreateRef = <span class="title function_">createRef</span>();</span><br><span class="line">    <span class="keyword">if</span> (!refFromUseRef.<span class="property">current</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;useRef&quot;</span>)</span><br><span class="line">        refFromUseRef.<span class="property">current</span> = renderIndex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!refFromCreateRef.<span class="property">current</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;createRef&quot;</span>)</span><br><span class="line">        refFromCreateRef.<span class="property">current</span> = renderIndex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Current render index: &#123;renderIndex&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>refFromUseRef value: &#123;refFromUseRef.current&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>refFromCreateRef value: &#123;refFromCreateRef.current&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setRenderIndex(prev =&gt; prev + 1)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                Cause re-render</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>![image-20210606235123989](D:\OneDrive - mail2.gdut.edu.cn\typora_img\React Hook\image-20210606235123989.png)</p><h2 id="4-useImperativeHandle"><a href="#4-useImperativeHandle" class="headerlink" title="4. useImperativeHandle"></a>4. useImperativeHandle</h2><p><code>useImperativeHandle</code>å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ ref æ—¶ï¼Œè‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ï¼Œä¸èƒ½è®©çˆ¶ç»„ä»¶æƒ³å¹²å˜›å°±å¹²å˜›</p><p><code>useImperativeHandle</code> åº”å½“ä¸ <a href="https://zh-hans.reactjs.org/docs/react-api.html#reactforwardref"><code>forwardRef</code></a> ä¸€èµ·ä½¿ç”¨ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span> (<span class="params">props, parentRef</span>) &#123;</span><br><span class="line">    <span class="comment">// å­ç»„ä»¶å†…éƒ¨è‡ªå·±åˆ›å»º ref</span></span><br><span class="line">    <span class="keyword">let</span> focusRef = <span class="title function_">useRef</span>();</span><br><span class="line">    <span class="keyword">let</span> inputRef = <span class="title function_">useRef</span>();</span><br><span class="line">    <span class="title function_">useImperativeHandle</span>(parentRef, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">        <span class="comment">// è¯¥å¯¹è±¡ä¼šä½œä¸ºçˆ¶ç»„ä»¶ current å±æ€§çš„å€¼</span></span><br><span class="line">        <span class="comment">// é€šè¿‡è¿™ç§æ–¹å¼ï¼Œçˆ¶ç»„ä»¶å¯ä»¥ä½¿ç”¨æ“ä½œå­ç»„ä»¶ä¸­çš„å¤šä¸ª ref</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            focusRef,</span><br><span class="line">            inputRef,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;è®¡æ•°å™¨&#x27;</span>,</span><br><span class="line">            <span class="title function_">focus</span> () &#123;</span><br><span class="line">                focusRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">changeText</span> (text) &#123;</span><br><span class="line">                inputRef.<span class="property">current</span>.<span class="property">value</span> = text;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;focusRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Child</span> = <span class="title function_">forwardRef</span>(<span class="title class_">Child</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> parentRef = <span class="title function_">useRef</span>();<span class="comment">//&#123;current:&#x27;&#x27;&#125;</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getFocus</span> (<span class="params"></span>) &#123;</span><br><span class="line">        parentRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">        <span class="comment">// å› ä¸ºå­ç»„ä»¶ä¸­æ²¡æœ‰å®šä¹‰è¿™ä¸ªå±æ€§ï¼Œå®ç°äº†ä¿æŠ¤ï¼Œæ‰€ä»¥è¿™é‡Œçš„ä»£ç æ— æ•ˆ</span></span><br><span class="line">        <span class="comment">// parentRef.current.addNumber(666);</span></span><br><span class="line">        parentRef.<span class="property">current</span>.<span class="title function_">changeText</span>(<span class="string">&#x27;777&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(parentRef.<span class="property">current</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Child</span> <span class="attr">ref</span>=<span class="string">&#123;parentRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;getFocus&#125;</span>&gt;</span>è·å¾—ç„¦ç‚¹<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-useMemo"><a href="#5-useMemo" class="headerlink" title="5.useMemo"></a>5.useMemo</h2><blockquote><p>çˆ¶ç»„ä»¶çš„stateæ”¹å˜ï¼Œå­ç»„ä»¶ä¹Ÿä¼šéšä¹‹é‡æ–°renderï¼Œå³ä½¿å­ç»„ä»¶å†…éƒ¨stateæ²¡æœ‰æ”¹å˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨useMemoæ¥è¿›è¡Œæ€§èƒ½ä¼˜åŒ–</p></blockquote><p>å‚æ•°åˆ—è¡¨</p><ul><li>å›è°ƒå‡½æ•°ï¼Œreturnå‡ºæ¥çš„å€¼ä½œä¸ºuseMemoçš„è¿”å›å€¼</li><li>ä¾èµ–é¡¹æ•°ç»„ï¼Œåªè¦æœ‰ä¸€ä¸ªå˜é‡æ”¹å˜ï¼Œå°±ä¼šé‡æ–°æ‰§è¡Œå›è°ƒï¼Œä½†ä¸ä¼šè§¦å‘æ¸²æŸ“ï¼Œå¦‚æœ<strong>æ²¡æœ‰æä¾›ä¾èµ–æ•°ç»„ï¼Œåˆ™<code>useMemo</code> åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè®¡ç®—æ–°çš„å€¼</strong></li></ul><p><code>useMemo</code>è¿”å›ä¸€ä¸ª <a href="https://en.wikipedia.org/wiki/Memoization">memoized</a> å€¼ï¼Œå®ƒä»…ä¼šåœ¨ä¼šåœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰é‡æ–°è®¡ç®— memoized å€¼ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title function_">memo</span>(<span class="function">(<span class="params">&#123;data&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child render...&#x27;</span>, data.<span class="property">name</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>child<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Hook</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hook render...&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> [name, setName] = <span class="title function_">useState</span>(<span class="string">&#x27;rose&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            name</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [name])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;update count <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Child</span> <span class="attr">data</span>=<span class="string">&#123;data&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-useCallback"><a href="#6-useCallback" class="headerlink" title="6. useCallback"></a>6. useCallback</h2><blockquote><p><code>useCallback</code>ä¸<code>useMemo</code>çš„å·®åˆ«æ˜¯ï¼Œå‰è€…æ˜¯ç¼“å­˜å‡½æ•°ï¼Œåè€…æ˜¯ç¼“å­˜å€¼</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onChange = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setText</span>(e.<span class="property">target</span>.<span class="property">value</span>)</span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure><p><code>useCallback(fn, deps)</code>ç›¸å½“äº<code>useMemo(() =&gt; fn, deps)</code></p><h2 id="7-useContext"><a href="#7-useContext" class="headerlink" title="7. useContext"></a>7. useContext</h2><p>æ¥æ”¶ä¸€ä¸ª context å¯¹è±¡ï¼ˆç”±<code>React.createContext</code> æ‰€åˆ›å»ºï¼‰å¹¶è¿”å›è¯¥ context çš„å½“å‰å€¼ï¼Œå½“å‰çš„ context å€¼ç”±ä¸Šå±‚ç»„ä»¶ä¸­è·ç¦»å½“å‰ç»„ä»¶æœ€è¿‘çš„ <code>&lt;MyContext.Provider&gt;</code> çš„ <code>value</code> prop å†³å®š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">TextContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">TextContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;666&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Toolbar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">TextContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Toolbar</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">xxxButton</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">xxxButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> text = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> <span class="attr">text</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      I am styled by theme context!</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç»„ä»¶ä¸Šå±‚æœ€è¿‘çš„ <code>&lt;MyContext.Provider&gt;</code> æ›´æ–°æ—¶ï¼Œè¯¥ Hook ä¼šè§¦å‘é‡æ¸²æŸ“ï¼Œå¹¶ä½¿ç”¨æœ€æ–°ä¼ é€’ç»™ <code>MyContext</code> provider çš„ context <code>value</code> å€¼ã€‚å³ä½¿ç¥–å…ˆä½¿ç”¨ <a href="https://zh-hans.reactjs.org/docs/react-api.html#reactmemo"><code>React.memo</code></a> æˆ– <a href="https://zh-hans.reactjs.org/docs/react-component.html#shouldcomponentupdate"><code>shouldComponentUpdate</code></a>ï¼Œä¹Ÿä¼šåœ¨ç»„ä»¶æœ¬èº«ä½¿ç”¨ <code>useContext</code> æ—¶é‡æ–°æ¸²æŸ“</p><h2 id="8-useLayoutEffect"><a href="#8-useLayoutEffect" class="headerlink" title="8. useLayoutEffect"></a>8. useLayoutEffect</h2><ul><li><p><code>useLayoutEffect</code>ä¼šåœ¨æµè§ˆå™¨ layout ä¹‹åï¼Œpainting ä¹‹å‰æ‰§è¡Œ</p></li><li><p>å…¶å‡½æ•°ç­¾åä¸ useEffect ç›¸åŒï¼Œä½†å®ƒä¼šåœ¨æ‰€æœ‰çš„ DOM å˜æ›´ä¹‹å<strong>åŒæ­¥</strong>è°ƒç”¨ effect</p></li><li><p><strong>å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å– DOM å¸ƒå±€å¹¶åŒæ­¥è§¦å‘é‡æ¸²æŸ“</strong></p></li><li><p><strong>å°½å¯èƒ½ä½¿ç”¨æ ‡å‡†çš„ useEffect ä»¥é¿å…é˜»å¡è§†å›¾æ›´æ–°</strong></p></li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">LayoutEffect</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [color, setColor] = <span class="title function_">useState</span>(<span class="string">&#x27;red&#x27;</span>);</span><br><span class="line">    <span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>(color);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;color&#x27;</span>, color);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;myDiv&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">background:</span> <span class="attr">color</span> &#125;&#125;&gt;</span>é¢œè‰²<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setColor(&#x27;red&#x27;)&#125;&gt;çº¢<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setColor(&#x27;yellow&#x27;)&#125;&gt;é»„<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setColor(&#x27;blue&#x27;)&#125;&gt;è“<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> å…ˆalertå‡ºredï¼Œå†æ¸²æŸ“å‡ºé¡µé¢ï¼Œé˜»å¡æ¸²æŸ“</p><h2 id="9-è‡ªå®šä¹‰Hook"><a href="#9-è‡ªå®šä¹‰Hook" class="headerlink" title="9. è‡ªå®šä¹‰Hook"></a>9. è‡ªå®šä¹‰Hook</h2><p>å…¶å®å°±æ˜¯å†™ä¸€ä¸ªå‡½æ•°å†…éƒ¨è°ƒç”¨å…¶ä»–Hookï¼Œæ¯æ¬¡ä½¿ç”¨è‡ªå®šä¹‰Hookæ—¶ï¼Œæ‰€æœ‰çš„stateå’Œå‰¯ä½œç”¨éƒ½æ˜¯å®Œå…¨éš”ç¦»çš„</p><p>ä¾‹å¦‚ï¼šæˆ‘ä»¬å¯ä»¥å¯¹useRefå°è£…æˆè‡ªå®šä¹‰Hookæ¥è·å–ä¸Šä¸€æ¬¡çš„å€¼</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">usePrevious</span> = state =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> ref = <span class="title function_">useRef</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        ref.<span class="property">current</span> = state;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ref.<span class="property">current</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> prevCount = <span class="title function_">usePrevious</span>(count);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                Cause re-render</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span> &#123;count&#125; &#123;prevCount&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡ç‚¹å‡»buttonï¼ŒprevCountéƒ½æ˜¯ä¸Šä¸€æ¬¡countçš„å€¼</p><h2 id="æ˜“é”™ç‚¹"><a href="#æ˜“é”™ç‚¹" class="headerlink" title="æ˜“é”™ç‚¹"></a>æ˜“é”™ç‚¹</h2><h3 id="1-ä¸ºä»€ä¹ˆæˆ‘çš„countæ²¡æœ‰æ›´æ–°"><a href="#1-ä¸ºä»€ä¹ˆæˆ‘çš„countæ²¡æœ‰æ›´æ–°" class="headerlink" title="1. ä¸ºä»€ä¹ˆæˆ‘çš„countæ²¡æœ‰æ›´æ–°"></a>1. ä¸ºä»€ä¹ˆæˆ‘çš„countæ²¡æœ‰æ›´æ–°</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ErrorDemo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> dom = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        dom.<span class="property">current</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> <span class="title function_">setCount</span>(count + <span class="number">1</span>));</span><br><span class="line">    &#125;, []);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;dom&#125;</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç ï¼Œç”¨æˆ·ç‚¹å‡»divï¼Œcountåªä¼šåŠ åˆ°1ï¼Œåé¢å°±ä¸ä¼šå†åŠ äº†ã€‚</p><p>åŸå› æ˜¯ï¼šæ¯æ¬¡ <code>count</code> éƒ½æ˜¯é‡æ–°å£°æ˜çš„å˜é‡ï¼ŒæŒ‡å‘ä¸€ä¸ªå…¨æ–°çš„æ•°æ®ï¼›æ¯æ¬¡çš„ <code>setCount</code> è™½ç„¶æ˜¯é‡æ–°å£°æ˜çš„ï¼Œä½†æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¼•ç”¨ã€‚</p><h3 id="è§£å†³æ–¹å¼ä¸€ï¼šå‡½æ•°å¼æ›´æ–°"><a href="#è§£å†³æ–¹å¼ä¸€ï¼šå‡½æ•°å¼æ›´æ–°" class="headerlink" title="è§£å†³æ–¹å¼ä¸€ï¼šå‡½æ•°å¼æ›´æ–°"></a>è§£å†³æ–¹å¼ä¸€ï¼šå‡½æ•°å¼æ›´æ–°</h3><p>ç”¨å›è°ƒå‡½æ•°çš„å½¢å¼ï¼Œ<code>() =&gt; setCount(prevCount =&gt; ++prevCount)</code>ï¼Œæ¥æ¶ˆé™¤å¯¹å¤–éƒ¨countçš„å¼•ç”¨ã€‚</p><h3 id="è§£å†³æ–¹å¼äºŒï¼šé‡æ–°ç»‘å®šäº‹ä»¶"><a href="#è§£å†³æ–¹å¼äºŒï¼šé‡æ–°ç»‘å®šäº‹ä»¶" class="headerlink" title="è§£å†³æ–¹å¼äºŒï¼šé‡æ–°ç»‘å®šäº‹ä»¶"></a>è§£å†³æ–¹å¼äºŒï¼šé‡æ–°ç»‘å®šäº‹ä»¶</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    dom.<span class="property">current</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> <span class="title function_">setCount</span>(count + <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> dom.<span class="property">current</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> <span class="title function_">setCount</span>(count + <span class="number">1</span>));</span><br><span class="line">&#125;, [count]); <span class="comment">// åœ¨è¿™é‡Œå¯¹countè¿›è¡Œç›‘å¬ï¼Œæ¯æ¬¡æ”¹å˜éƒ½ä¼šé‡æ–°ç»‘å®šäº‹ä»¶</span></span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹å¼ä¸‰ï¼šç”¨refé‡æ–°è·å–å¼•ç”¨"><a href="#è§£å†³æ–¹å¼ä¸‰ï¼šç”¨refé‡æ–°è·å–å¼•ç”¨" class="headerlink" title="è§£å†³æ–¹å¼ä¸‰ï¼šç”¨refé‡æ–°è·å–å¼•ç”¨"></a>è§£å†³æ–¹å¼ä¸‰ï¼šç”¨refé‡æ–°è·å–å¼•ç”¨</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dom = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">const</span> countRef = <span class="title function_">useRef</span>(count);</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    dom.<span class="property">current</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        countRef.<span class="property">current</span>++;</span><br><span class="line">        <span class="title function_">setCount</span>(countRef.<span class="property">current</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://juejin.cn/post/6844904090032406536">å†™React Hookså‰å¿…è¯»</a><br><a href="https://juejin.cn/post/6844904072168865800">ç»ˆäºææ‡‚ React Hooksäº†ï¼ï¼ï¼ï¼ï¼</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å‡½æ•°å¼ç»„ä»¶åªèƒ½ä½¿ç”¨propsï¼ŒHookèƒ½å¤Ÿåœ¨å‡½æ•°å¼ç»„ä»¶çš„æƒ…å†µä¸‹ä½¿ç”¨stateã€ç”Ÿå‘½å‘¨æœŸä»¥åŠå…¶ä»–çš„Reactç‰¹æ€§&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆéœ€è¦å¼•å…¥React Hookï¼Œå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š&lt;a href=&quot;https://zh-hans.reactjs.org/docs/hooks-intro.html#motivation&quot;&gt;https://zh-hans.reactjs.org/docs/hooks-intro.html#motivation&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="React" scheme="https://liang5757.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>React Router</title>
    <link href="https://liang5757.github.io/2021/05/28/React/React%20Router/"/>
    <id>https://liang5757.github.io/2021/05/28/React/React%20Router/</id>
    <published>2021-05-28T12:13:21.000Z</published>
    <updated>2025-12-07T10:16:59.221Z</updated>
    
    <content type="html"><![CDATA[<ul><li>react-routerï¼šè·¯ç”±æ ¸å¿ƒåº“ï¼ŒåŒ…å«è¯¸å¤šå’Œè·¯ç”±åŠŸèƒ½ç›¸å…³çš„æ ¸å¿ƒä»£ç </li><li>react-router-domï¼šåˆ©ç”¨è·¯ç”±æ ¸å¿ƒåº“ï¼Œç»“åˆå®é™…çš„é¡µé¢ï¼Œå®ç°è·Ÿé¡µé¢è·¯ç”±å¯†åˆ‡ç›¸å…³çš„åŠŸèƒ½</li></ul><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># react-router-domä¾èµ–react-router</span></span><br><span class="line"><span class="comment"># å®‰è£…çš„æ—¶å€™ä¼šæŠŠreact-routerä¸€èµ·å®‰è£…äº†</span></span><br><span class="line">npm install react-router-dom -S</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="1-ä¸¤ç§è·¯ç”±æ¨¡å¼-Hashã€History"><a href="#1-ä¸¤ç§è·¯ç”±æ¨¡å¼-Hashã€History" class="headerlink" title="1.ä¸¤ç§è·¯ç”±æ¨¡å¼ Hashã€History"></a>1.ä¸¤ç§è·¯ç”±æ¨¡å¼ Hashã€History</h2><ul><li><code>HashRouter</code>ï¼šä½¿ç”¨ hash æ¨¡å¼åŒ¹é…</li><li><code>BrowserRouter</code>ï¼šä½¿ç”¨ BrowserHistory æ¨¡å¼åŒ¹é…</li></ul><p>ä¸¤è€…åŒºåˆ«<br>1.åº•å±‚åŸç†ä¸ä¸€æ ·ï¼š<br>    BrowserRouterä½¿ç”¨çš„æ˜¯H5çš„history APIï¼Œä¸å…¼å®¹IE9åŠä»¥ä¸‹ç‰ˆæœ¬ã€‚<br>    HashRouterä½¿ç”¨çš„æ˜¯URLçš„å“ˆå¸Œå€¼ã€‚<br>2.pathè¡¨ç°å½¢å¼ä¸ä¸€æ ·<br>    BrowserRouterçš„è·¯å¾„ä¸­æ²¡æœ‰#ï¼Œä¾‹å¦‚ï¼šlocalhost:3000&#x2F;demo&#x2F;test<br>    HashRouterçš„è·¯å¾„åŒ…å«#,ä¾‹å¦‚ï¼šlocalhost:3000&#x2F;#&#x2F;demo&#x2F;test<br>3.åˆ·æ–°åå¯¹è·¯ç”±stateå‚æ•°çš„å½±å“<br>    BrowserRouteræ²¡æœ‰ä»»ä½•å½±å“ï¼Œå› ä¸ºstateä¿å­˜åœ¨historyå¯¹è±¡ä¸­ã€‚<br>    HashRouteråˆ·æ–°åä¼šå¯¼è‡´è·¯ç”±stateå‚æ•°çš„ä¸¢å¤±ï¼ï¼ï¼<br>4.å¤‡æ³¨ï¼šHashRouterå¯ä»¥ç”¨äºè§£å†³ä¸€äº›è·¯å¾„é”™è¯¯ç›¸å…³çš„é—®é¢˜ã€‚</p><h2 id="2-è·³è½¬ç»„ä»¶-Linkå’ŒNavLink"><a href="#2-è·³è½¬ç»„ä»¶-Linkå’ŒNavLink" class="headerlink" title="2. è·³è½¬ç»„ä»¶ Linkå’ŒNavLink"></a>2. è·³è½¬ç»„ä»¶ Linkå’ŒNavLink</h2><p>Linkç»„ä»¶</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Link</span> to=<span class="string">&quot;/xxxxx&quot;</span>&gt;<span class="title class_">Demo</span>&lt;/<span class="title class_">Link</span>&gt;</span><br></pre></td></tr></table></figure><p>Linkç»„ä»¶é…ç½®æ–¹å¼</p><ul><li><p>toï¼šè¦è·³è½¬çš„é“¾æ¥ï¼ˆString | Object  | Functionï¼‰</p></li><li><p>replaceï¼šè®¾ç½®ä¸ºtrueï¼Œåˆ™è·³è½¬æ›¿æ¢è·¯ç”±æ ˆé¡¶</p></li><li><p>innerRefï¼šå¯ä»¥å°†å†…éƒ¨çš„aå…ƒç´ çš„refé™„ç€åœ¨ä¼ é€’çš„å¯¹è±¡æˆ–å‡½æ•°å‚æ•°ä¸Šï¼ˆFunction | RefObjectï¼‰</p></li><li><p>componentï¼šå¯ä»¥è®¾ç½®è‡ªå®šä¹‰çš„å¯¼èˆªç»„ä»¶</p>  <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">FancyLink</span> = <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> &#123;<span class="attr">...props</span>&#125;&gt;</span>ğŸ’… &#123;props.children&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">))</span><br><span class="line"></span><br><span class="line">&lt;<span class="title class_">Link</span> to=<span class="string">&quot;/&quot;</span> component=&#123;<span class="title class_">FancyLink</span>&#125; /&gt;</span><br></pre></td></tr></table></figure></li></ul><p><strong>NavLink</strong>å¯ä»¥å®ç°è·¯ç”±é“¾æ¥çš„é«˜äº®ï¼Œé€šè¿‡<code>activeClassName</code>æŒ‡å®šæ ·å¼ç±»å</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">NavLink</span> to=<span class="string">&quot;/xxxxx&quot;</span>&gt;<span class="title class_">Demo</span>&lt;/<span class="title class_">NavLink</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="3-routeç»„ä»¶"><a href="#3-routeç»„ä»¶" class="headerlink" title="3. routeç»„ä»¶"></a>3. routeç»„ä»¶</h2><p>é…ç½®æ–¹å¼</p><ul><li>pathï¼šåŒ¹é…çš„è·¯å¾„<ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œå¯ä»¥è®¾ç½®sensitiveå±æ€§ä¸ºtrueï¼Œæ¥åŒºåˆ†å¤§å°å†™</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒåªåŒ¹é…åˆå§‹ç›®å½•ï¼Œå¦‚æœè¦ç²¾ç¡®åŒ¹é…ï¼Œé…ç½®exactå±æ€§ä¸ºtrue</li><li>å¦‚æœä¸å†™pathï¼Œåˆ™ä¼šåŒ¹é…ä»»æ„è·¯å¾„</li></ul></li><li>componentï¼šåŒ¹é…æˆåŠŸåè¦æ˜¾ç¤ºçš„ç»„ä»¶</li><li>children<ul><li>ä¼ é€’Reactå…ƒç´ ï¼Œæ— è®ºæ˜¯å¦åŒ¹é…ï¼Œä¸€å®šä¼šæ˜¾ç¤ºchildrenï¼Œå¹¶ä¸”ä¼šå¿½ç•¥componentå±æ€§</li><li>ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æœ‰å¤šä¸ªå‚æ•°ï¼Œè¿™äº›å‚æ•°æ¥è‡ªäºä¸Šä¸‹æ–‡ï¼Œè¯¥å‡½æ•°è¿”å›reactå…ƒç´ ï¼Œåˆ™ä¸€å®šä¼šæ˜¾ç¤ºè¿”å›çš„å…ƒç´ ï¼Œå¹¶ä¸”å¿½ç•¥componentå±æ€§</li></ul></li><li>renderï¼šåŒ¹é…æˆåŠŸæ¸²æŸ“çš„ç»„ä»¶ï¼Œå†…è”ä¹¦å†™renderï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªReactå…ƒç´ </li><li>sensitiveï¼štrueåˆ™å¯¹pahtçš„å¤§å°å†™æ•æ„Ÿ</li><li>exactï¼šç²¾ç¡®åŒ¹é…</li></ul><h3 id="routeåµŒå¥—"><a href="#routeåµŒå¥—" class="headerlink" title="routeåµŒå¥—"></a>routeåµŒå¥—</h3><p>ä¸‹è¿°ä»£ç ä¸­ï¼Œç”¨æˆ·è®¿é—®<code>/repos</code>æ—¶ï¼Œä¼šå…ˆåŠ è½½<code>App</code>ç»„ä»¶ï¼Œç„¶ååœ¨å®ƒçš„å†…éƒ¨å†åŠ è½½<code>Repos</code>ç»„ä»¶ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">BrowserRouter</span> history=&#123;hashHistory&#125;&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;App&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/repos&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Repos&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">BrowserRouter</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="åŒ¹é…è§„åˆ™"><a href="#åŒ¹é…è§„åˆ™" class="headerlink" title="åŒ¹é…è§„åˆ™"></a>åŒ¹é…è§„åˆ™</h3><ol><li>:paramName</li></ol><p><code>:paramName</code>åŒ¹é…URLçš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª<code>/</code>ã€<code>?</code>ã€<code>#</code>ä¸ºæ­¢ã€‚è¿™ä¸ªè·¯å¾„å‚æ•°å¯ä»¥é€šè¿‡<code>this.props.params.paramName</code>å–å‡ºã€‚</p><ol start="2"><li>()</li></ol><p><code>()</code>è¡¨ç¤ºURLçš„è¿™ä¸ªéƒ¨åˆ†æ˜¯å¯é€‰çš„ã€‚</p><ol start="3"><li>*</li></ol><p><code>*</code>åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œç›´åˆ°æ¨¡å¼é‡Œé¢çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸ºæ­¢ã€‚åŒ¹é…æ–¹å¼æ˜¯éè´ªå©ªæ¨¡å¼ã€‚</p><ol start="4"><li>**</li></ol><p><code>**</code> åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª<code>/</code>ã€<code>?</code>ã€<code>#</code>ä¸ºæ­¢ã€‚åŒ¹é…æ–¹å¼æ˜¯è´ªå©ªæ¨¡å¼ã€‚</p><p>æ­¤å¤–ï¼ŒURLçš„æŸ¥è¯¢å­—ç¬¦ä¸²<code>/foo?bar=baz</code>ï¼Œå¯ä»¥ç”¨<code>this.props.location.query.bar</code>è·å–ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span>, <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/a&quot;</span> <span class="attr">component</span>=<span class="string">&#123;A&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/a/d&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;D&#125;/</span>&gt;</span>  // ç²¾ç¡®åŒ¹é…</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">component</span>=<span class="string">&#123;C&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/abc&#x27;</span> <span class="attr">children</span>=<span class="string">&#123;E&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">BrowserRouter</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>  ä¸Šè¿°ä»£ç ï¼Œå¦‚æœè·¯ç”±æ˜¯ <strong>&#x2F;a&#x2F;dï¼Œåˆ™ä¼šæ¸²æŸ“ Aã€Dã€Cã€E</strong>ï¼Œreact routeræ˜¯ä¼šä»ä¸Šè‡³ä¸‹å®Œå…¨åŒ¹é…ä¸€éï¼Œè€Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†Switchç»„ä»¶ã€‚</p><h2 id="4-Switchç»„ä»¶"><a href="#4-Switchç»„ä»¶" class="headerlink" title="4. Switchç»„ä»¶"></a>4. Switchç»„ä»¶</h2><p>ä¼š<strong>å¾ªç¯æ‰€æœ‰å­å…ƒç´ </strong>ï¼Œå½“åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªRouteåï¼Œä¼šç«‹å³åœæ­¢åŒ¹é…å¹¶æ¸²æŸ“ï¼Œå› æ­¤ä¸èƒ½åœ¨Switchç»„ä»¶çš„å­å…ƒç´ ä¸­ä½¿ç”¨é™¤Routeå¤–çš„å…¶ä»–ç»„ä»¶</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Router</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/a&quot;</span> <span class="attr">component</span>=<span class="string">&#123;A&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/a/b&quot;</span> <span class="attr">component</span>=<span class="string">&#123;B&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">component</span>=<span class="string">&#123;C&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Router</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="5-Redirectç»„ä»¶"><a href="#5-Redirectç»„ä»¶" class="headerlink" title="5. Redirectç»„ä»¶"></a>5. Redirectç»„ä»¶</h2><p>ä¸€èˆ¬å†™åœ¨æ‰€æœ‰è·¯ç”±æ³¨å†Œçš„æœ€ä¸‹æ–¹ï¼Œå½“æ‰€æœ‰è·¯ç”±éƒ½æ— æ³•åŒ¹é…æ—¶ï¼Œè·³è½¬åˆ°RedirectæŒ‡å®šçš„è·¯ç”±</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Redirect</span> to=<span class="string">&quot;/about/&quot;</span> /&gt;</span><br></pre></td></tr></table></figure><h2 id="6-è·¯ç”±ä¿¡æ¯"><a href="#6-è·¯ç”±ä¿¡æ¯" class="headerlink" title="6. è·¯ç”±ä¿¡æ¯"></a>6. è·¯ç”±ä¿¡æ¯</h2><p>Routerç»„ä»¶ä¼šåˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”å‘ä¸Šä¸‹æ–‡ä¸­æ³¨å…¥ä¸€äº›ä¿¡æ¯ï¼Œè¯¥ä¸Šä¸‹æ–‡å¯¹å¼€å‘è€…æ˜¯éšè—çš„ï¼ŒRouteç»„ä»¶è‹¥åŒ¹é…åˆ°äº†åœ°å€ï¼Œåˆ™ä¼šå°†è¿™äº›ä¸Šä¸‹æ–‡ä¸­çš„ä¿¡æ¯ä½œä¸ºå±æ€§ä¼ å…¥å¯¹åº”çš„ç»„ä»¶</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Route</span>, <span class="title class_">Switch</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(props)</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>ç»„ä»¶A<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/a&quot;</span> <span class="attr">component</span>=<span class="string">&#123;A&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°ä¸€ä¸‹props</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">history</span>:</span><br><span class="line">go: Æ’ go(n)</span><br><span class="line">goBack: Æ’ goBack()</span><br><span class="line">goForward: Æ’ goForward()</span><br><span class="line">push: Æ’ push(path, state)</span><br><span class="line">replace: Æ’ replace(path, state)</span><br><span class="line">location:</span><br><span class="line">    <span class="built_in">hash</span>ï¼šé¡µé¢<span class="built_in">hash</span></span><br><span class="line">    pathnameï¼šé¡µé¢çš„path</span><br><span class="line">    stateï¼špushæ—¶ä¼ å…¥çš„æ•°æ®</span><br><span class="line">    searchï¼šä¼ å…¥çš„å‚æ•°</span><br><span class="line">match:</span><br><span class="line">isExactï¼šäº‹å®ä¸Šï¼Œå½“å‰çš„è·¯å¾„å’Œè·¯ç”±é…ç½®çš„è·¯å¾„æ˜¯å¦æ˜¯ç²¾ç¡®åŒ¹é…çš„</span><br><span class="line">paramsï¼šè·å–è·¯å¾„ä¸­å¯¹åº”çš„æ•°æ®</span><br><span class="line">pathï¼šè·¯å¾„è§„åˆ™</span><br><span class="line">urlï¼šé¡µé¢è·¯å¾„</span><br></pre></td></tr></table></figure><h2 id="7-è·¯ç”±ä¼ å‚"><a href="#7-è·¯ç”±ä¼ å‚" class="headerlink" title="7.è·¯ç”±ä¼ å‚"></a>7.è·¯ç”±ä¼ å‚</h2><h3 id="5-1-params-å‚æ•°"><a href="#5-1-params-å‚æ•°" class="headerlink" title="5.1 params å‚æ•°"></a>5.1 params å‚æ•°</h3><p>è·¯ç”±é“¾æ¥(æºå¸¦å‚æ•°)ï¼š<code>&lt;Link to=&#39;/demo/test/tom/18&#39;&#125;&gt;è¯¦æƒ…&lt;/Link&gt;</code><br>æ³¨å†Œè·¯ç”±(å£°æ˜æ¥æ”¶)ï¼š<code>&lt;Route path=&quot;/demo/test/:name/:age&quot; component=&#123;Test&#125;/&gt;</code><br>æ¥æ”¶å‚æ•°ï¼šthis.props.match.params</p><h3 id="5-2-searchå‚æ•°"><a href="#5-2-searchå‚æ•°" class="headerlink" title="5.2 searchå‚æ•°"></a>5.2 searchå‚æ•°</h3><p>è·¯ç”±é“¾æ¥(æºå¸¦å‚æ•°)ï¼š<code>&lt;Link to=&#39;/demo/test?name=tom&amp;age=18&#39;&#125;&gt;è¯¦æƒ…&lt;/Link&gt;</code><br>æ³¨å†Œè·¯ç”±(æ— éœ€å£°æ˜ï¼Œæ­£å¸¸æ³¨å†Œå³å¯)ï¼š<code>&lt;Route path=&quot;/demo/test&quot; component=&#123;Test&#125;/&gt;</code><br>æ¥æ”¶å‚æ•°ï¼š<code>this.props.location.search</code><br>å¤‡æ³¨ï¼šè·å–åˆ°çš„searchæ˜¯urlencodedç¼–ç å­—ç¬¦ä¸²ï¼Œéœ€è¦å€ŸåŠ©querystringè§£æ</p><h3 id="5-3-stateå‚æ•°"><a href="#5-3-stateå‚æ•°" class="headerlink" title="5.3 stateå‚æ•°"></a>5.3 stateå‚æ•°</h3><p>è·¯ç”±é“¾æ¥(æºå¸¦å‚æ•°)ï¼š<code>&lt;Link to=&#123;&#123;pathname:'/demo/test',state:&#123;name:'tom',age:18&#125;&#125;&#125;&gt;è¯¦æƒ…&lt;/Link&gt;</code><br>æ³¨å†Œè·¯ç”±(æ— éœ€å£°æ˜ï¼Œæ­£å¸¸æ³¨å†Œå³å¯)ï¼š<code>&lt;Route path=&quot;/demo/test&quot; component=&#123;Test&#125;/&gt;</code><br>æ¥æ”¶å‚æ•°ï¼š<code>this.props.location.state</code><br>å¤‡æ³¨ï¼šåˆ·æ–°ä¹Ÿå¯ä»¥ä¿ç•™ä½å‚æ•°</p><h2 id="8-ç¼–ç¨‹å¼å¯¼èˆª"><a href="#8-ç¼–ç¨‹å¼å¯¼èˆª" class="headerlink" title="8. ç¼–ç¨‹å¼å¯¼èˆª"></a>8. ç¼–ç¨‹å¼å¯¼èˆª</h2><p>å€ŸåŠ©<code>this.props.history</code>ä¸Šçš„æ–¹æ³•ï¼ŒåŸºæœ¬å’ŒH5çš„historyä¸€è‡´ï¼Œå°±åªæ˜¯åˆ—ä¸€ä¸‹äº†</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">push</span>()</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">replace</span>()</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">goBack</span>()</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">goForward</span>()</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">go</span>()</span><br></pre></td></tr></table></figure><h2 id="9-withRouter"><a href="#9-withRouter" class="headerlink" title="9. withRouter"></a>9. withRouter</h2><blockquote><p>ç”±äº<strong>åªèƒ½åœ¨è·³è½¬çš„ç»„ä»¶ä¸­è·å–è·¯ç”±ä¿¡æ¯</strong>ï¼Œæ‰€ä»¥æå‡º<code>withRouter</code>ï¼Œç”¨withRouteråŒ…è£¹çš„ç»„ä»¶èƒ½è·å–è·¯ç”±ä¿¡æ¯</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ButtonContainer</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> history = props.<span class="property">history</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>&quot;<span class="attr">container</span>&quot;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;history.push(&quot;/a?key=a&quot;, &quot;AçŠ¶æ€æ•°æ®&quot;)&#125;&#125;&gt;A<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;history.push(&quot;/a/b?key=b&quot;, &quot;BçŠ¶æ€æ•°æ®&quot;)&#125;&#125;&gt;B<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;history.push(&quot;/a/c?key=c&quot;, &quot;CçŠ¶æ€æ•°æ®&quot;)&#125;&#125;&gt;C<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;history.push(&quot;/a/d?key=d&quot;, &quot;DçŠ¶æ€æ•°æ®&quot;)&#125;&#125;&gt;D<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;history.push(&quot;/a/news/2020/12/21&quot;)&#125;&#125;&gt;News<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WithRouterButtonContainer</span> = <span class="title function_">withRouter</span>(<span class="title class_">ButtonContainer</span>)</span><br></pre></td></tr></table></figure><p>å…¶è¿”å›å€¼æ˜¯ä¸€ä¸ªæ–°ç»„ä»¶</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.sakura-snow.com/post/react-node-5/">reactå­¦ä¹ ç¬”è®°5-React Router</a><br>[React Router ä½¿ç”¨æ•™ç¨‹](</p>]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;react-routerï¼šè·¯ç”±æ ¸å¿ƒåº“ï¼ŒåŒ…å«è¯¸å¤šå’Œè·¯ç”±åŠŸèƒ½ç›¸å…³çš„æ ¸å¿ƒä»£ç &lt;/li&gt;
&lt;li&gt;react-router-domï¼šåˆ©ç”¨è·¯ç”±æ ¸å¿ƒåº“ï¼Œç»“åˆå®é™…çš„é¡µé¢ï¼Œå®ç°è·Ÿé¡µé¢è·¯ç”±å¯†åˆ‡ç›¸å…³çš„åŠŸèƒ½&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# react-router-domä¾èµ–react-router&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å®‰è£…çš„æ—¶å€™ä¼šæŠŠreact-routerä¸€èµ·å®‰è£…äº†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;npm install react-router-dom -S&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="React" scheme="https://liang5757.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>Reactä»å…¥é—¨åˆ°çœŸé¦™</title>
    <link href="https://liang5757.github.io/2021/05/27/React/React%E5%85%A5%E9%97%A8/"/>
    <id>https://liang5757.github.io/2021/05/27/React/React%E5%85%A5%E9%97%A8/</id>
    <published>2021-05-27T15:41:33.000Z</published>
    <updated>2025-12-07T10:16:59.222Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-è®¾è®¡æ€æƒ³"><a href="#1-è®¾è®¡æ€æƒ³" class="headerlink" title="1. è®¾è®¡æ€æƒ³"></a>1. è®¾è®¡æ€æƒ³</h2><ol><li><a href="https://github.com/react-guide/react-basic">React è®¾è®¡æ€æƒ³</a></li><li><a href="http://www.infoq.com/cn/articles/react-art-of-simplity/">Reactçš„è®¾è®¡å“²å­¦ - ç®€å•ä¹‹ç¾</a></li><li><a href="http://www.infoq.com/cn/articles/subversion-front-end-ui-development-framework-react/">é¢ è¦†å¼å‰ç«¯UIå¼€å‘æ¡†æ¶:React</a><span id="more"></span></li></ol><h2 id="2-å®‰è£…"><a href="#2-å®‰è£…" class="headerlink" title="2. å®‰è£…"></a>2. å®‰è£…</h2><h3 id="2-1-CDNçš„æ–¹å¼å¼•å…¥"><a href="#2-1-CDNçš„æ–¹å¼å¼•å…¥" class="headerlink" title="2.1 CDNçš„æ–¹å¼å¼•å…¥"></a>2.1 CDNçš„æ–¹å¼å¼•å…¥</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react@17/umd/react.development.js&quot;</span> <span class="attr">crossorigin</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react-dom@17/umd/react-dom.development.js&quot;</span> <span class="attr">crossorigin</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/babel-standalone@6/babel.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>react.jsï¼šReactæ ¸å¿ƒåº“</li><li>react-dom.jsï¼šæä¾›æ“ä½œ DOM çš„ react æ‰©å±•åº“</li><li>babel.min.jsï¼šè§£æ JSX è¯­æ³•ä»£ç è½¬ä¸º JS ä»£ç çš„åº“</li></ul><h3 id="2-2-create-react-app"><a href="#2-2-create-react-app" class="headerlink" title="2.2 create-react-app"></a>2.2 create-react-app</h3><p>å®‰è£…<code>create-react-app</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm isntall -g create-react-app</span><br></pre></td></tr></table></figure><p>åˆ›å»ºé¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create-react-app my-app</span><br></pre></td></tr></table></figure><h2 id="3-JSX"><a href="#3-JSX" class="headerlink" title="3. JSX"></a>3. JSX</h2><p>jsx å…è®¸åœ¨æ¨¡æ¿ä¸­ç”¨<code>&#123;&#125;</code>æ’å…¥JavaScriptè¡¨è¾¾å¼ï¼Œå¦‚æœ<code>&#123;&#125;</code>ä¸­çš„å˜é‡æ˜¯æ•°ç»„ï¼Œåˆ™ä¼šå±•å¼€è¿™ä¸ªæ•°ç»„çš„æ‰€æœ‰æˆå‘˜</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>,</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>React is awesome<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>,</span><br><span class="line">];</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;arr&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;example&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> names = [<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Emily&#x27;</span>, <span class="string">&#x27;Kate&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  &#123;</span></span><br><span class="line"><span class="language-xml">    names.map(function (name) &#123; // åˆ—è¡¨æ¸²æŸ“</span></span><br><span class="line"><span class="language-xml">      return <span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello, &#123;name&#125;!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#125;)</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;example2&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><code>ReactDOM.render</code>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¸²æŸ“çš„ç»„ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‚è½½å®ä¾‹çš„ä½ç½®ã€‚</p><ul><li>classNameæ›¿æ¢class</li><li>å†…è”æ ·å¼â€”â€”style&#x3D;</li><li>åªèƒ½å«æœ‰ä¸€ä¸ªæœ€å¤–å±‚æ ‡ç­¾</li></ul><p>å¯¹äºæœ€åä¸€ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨React.Fragmentç»„ä»¶ï¼Œå®ƒèƒ½å¤Ÿåœ¨ä¸é¢å¤–åˆ›å»º DOM å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œè®©renderè¿”å›å¤šä¸ªå…ƒç´ </p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      Some text.</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>A heading<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-ç»„ä»¶"><a href="#4-ç»„ä»¶" class="headerlink" title="4.ç»„ä»¶"></a>4.ç»„ä»¶</h2><h3 id="4-1-ç±»ç»„ä»¶ï¼ˆæœ‰çŠ¶æ€ï¼‰"><a href="#4-1-ç±»ç»„ä»¶ï¼ˆæœ‰çŠ¶æ€ï¼‰" class="headerlink" title="4.1 ç±»ç»„ä»¶ï¼ˆæœ‰çŠ¶æ€ï¼‰"></a>4.1 ç±»ç»„ä»¶ï¼ˆæœ‰çŠ¶æ€ï¼‰</h3><blockquote><p>ç»„ä»¶ç±»çš„ç¬¬ä¸€ä¸ªåå­—å¿…é¡»å¤§å†™</p></blockquote><p>é€šè¿‡ç»§æ‰¿React.Componentæ¥å®ç°ç±»ç»„ä»¶ï¼Œéœ€è¦å®ç°ä¸€ä¸ªrenderæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ¨¡æ¿</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Clock</span> <span class="title class_">React</span>.<span class="property">Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.clickFunc.bind(this)&#125;</span>&gt;</span> // å°†clickFuncå†…éƒ¨thisæŒ‡å‘ç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>It is &#123;this.props.date.toLocaleTimeString()&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> é€šè¿‡React.createClassç”Ÿæˆä¸€ä¸ªç»„ä»¶ç±»</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Clock</span> = <span class="title class_">React</span>.<span class="title function_">createClass</span>(&#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>It is &#123;this.props.date.toLocaleTimeString()&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸¤ç§æ–¹å¼çš„åŒºåˆ«æ˜¯ï¼Œå‰è€…ä¸ä¼šè‡ªåŠ¨ç»‘å®šthis</p><h3 id="4-2-å‡½æ•°å¼ç»„ä»¶ï¼ˆæ— çŠ¶æ€ï¼‰"><a href="#4-2-å‡½æ•°å¼ç»„ä»¶ï¼ˆæ— çŠ¶æ€ï¼‰" class="headerlink" title="4.2 å‡½æ•°å¼ç»„ä»¶ï¼ˆæ— çŠ¶æ€ï¼‰"></a>4.2 å‡½æ•°å¼ç»„ä»¶ï¼ˆæ— çŠ¶æ€ï¼‰</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span> (<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;name, age, sex&#125; = props;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>å§“åï¼š&#123;name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ€§åˆ«ï¼š&#123;sex&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>å¹´é¾„ï¼š&#123;age&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-State"><a href="#5-State" class="headerlink" title="5. State"></a>5. State</h2><h3 id="5-1-stateåˆå§‹åŒ–"><a href="#5-1-stateåˆå§‹åŒ–" class="headerlink" title="5.1 stateåˆå§‹åŒ–"></a>5.1 stateåˆå§‹åŒ–</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Clock</span> <span class="title class_">React</span>.<span class="property">Component</span> &#123;</span><br><span class="line">  <span class="comment">// ç¬¬ä¸€ç§ ç›´æ¥åœ¨å®ä¾‹ä¸Šå®šä¹‰stateå±æ€§</span></span><br><span class="line">  state = &#123;</span><br><span class="line">      <span class="attr">value</span>: <span class="number">6</span>,</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// ç¬¬äºŒç§ åœ¨æ„é€ å™¨ä¸­è®¾ç½®state</span></span><br><span class="line">  <span class="title function_">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">          <span class="attr">value</span>: <span class="number">6</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-stateä¿®æ”¹"><a href="#5-2-stateä¿®æ”¹" class="headerlink" title="5.2 stateä¿®æ”¹"></a>5.2 stateä¿®æ”¹</h3><p><strong>ç›´æ¥ä¿®æ”¹æ•°æ®æ˜¯ä¸ä¼šè§¦å‘è§†å›¾æ›´æ–°</strong>çš„ï¼Œåªæœ‰ä½¿ç”¨<code>setState</code>æ¥ä¿®æ”¹æ•°æ®ï¼Œä¼šé‡æ–°è§¦å‘ç»„ä»¶çš„renderå‡½æ•°</p><p>setStateç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ä¿®æ”¹åçš„stateå¯¹è±¡ï¼Œå¯ä»¥ä¿®æ”¹æŸä¸€ä¸ªå€¼ï¼Œ<strong>setStateæ˜¯æµ…åˆå¹¶</strong>ã€‚</p><p>å¦‚æœsetStateçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡è€Œæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨æ‰§è¡Œæ—¶ä¼šé€šè¿‡å‚æ•°è¢«ä¼ å…¥prevStateï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰çš„çŠ¶æ€ï¼Œè€Œè¿”å›å€¼å°±ä¼šå’Œstateè¿›è¡Œåˆå¹¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function">(<span class="params">prevState : any</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        num : prevState.<span class="property">num</span> + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">num</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯setStateæœ‰ä¸¤ä¸ªé—®é¢˜</p><ul><li>setStateå¯¹çŠ¶æ€çš„ä¿®æ”¹ï¼Œå¯èƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼ˆå¦‚æœæ”¹å˜çŠ¶æ€çš„ä»£ç å¤„äºæŸä¸ªHTMLå…ƒç´ çš„äº‹ä»¶ä¸­ï¼Œåˆ™å…¶æ˜¯å¼‚æ­¥çš„ï¼Œå¦åˆ™æ˜¯åŒæ­¥ï¼‰</li><li>Reactä¼šå¯¹å¼‚æ­¥çš„setStateè¿›è¡Œä¼˜åŒ–ï¼Œå°†å¤šæ¬¡setStateè¿›è¡Œåˆå¹¶ï¼ˆå°†å¤šæ¬¡çŠ¶æ€æ”¹å˜å®Œæˆåï¼Œå†ç»Ÿä¸€å¯¹stateè¿›è¡Œæ”¹å˜ï¼Œç„¶åè§¦å‘renderï¼‰</li></ul><p>ä¸‹é¢ç»™å‡ºç¬¬ä¸€ä¸ªé—®é¢˜çš„ä¾‹å­</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Comp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">num</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">num</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">num</span> + <span class="number">1</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">num</span>) <span class="comment">// ç¬¬ä¸€ä¸‹ç‚¹å‡»è¾“å‡º 0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;this.state.num&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>ç‚¹æˆ‘<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¬¬ä¸€ä¸‹ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ï¼Œconsole.logè¾“å‡º 0ï¼Œè¯´æ˜setStateåœ¨DOMäº‹ä»¶ä¸­æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚</p><p><strong>è§£å†³æ–¹å¼</strong>ï¼šsetStateæœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ¥æ”¾ç½®renderæ‰§è¡Œåæ¥ç€æ‰§è¡Œçš„å›è°ƒå‡½æ•°</p><h2 id="6-Props"><a href="#6-Props" class="headerlink" title="6. Props"></a>6. Props</h2><h3 id="6-1-ä¼ é€’å‚æ•°"><a href="#6-1-ä¼ é€’å‚æ•°" class="headerlink" title="6.1 ä¼ é€’å‚æ•°"></a>6.1 ä¼ é€’å‚æ•°</h3><p>çˆ¶ç»„ä»¶åœ¨ä½¿ç”¨å­ç»„ä»¶çš„æ—¶å€™ï¼Œé€šè¿‡ç»™å­ç»„ä»¶å…ƒç´ è®¾ç½®å±æ€§çš„æ–¹å¼ä¼ é€’å‚æ•°ç»™å­ç»„ä»¶</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çˆ¶ç»„ä»¶è®¾ç½®å±æ€§ç»™å­ç»„ä»¶ä¼ å‚ï¼Œè¿™é‡Œå±æ€§åç”¨value2ç”¨ä½œåŒºåˆ†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Board</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Square</span> <span class="attr">value2</span>=<span class="string">&#123;0&#125;/</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»ç»„ä»¶ é€šè¿‡ this.props.[å±æ€§] æ¥è·å–å‚æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;square&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;this.props.value2&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°å¼ç»„ä»¶é€šè¿‡ props.[å±æ€§] æ¥è·å–å‚æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Square</span> (<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;square&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;props.value2&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-propsä¼ é€’äº‹ä»¶"><a href="#6-2-propsä¼ é€’äº‹ä»¶" class="headerlink" title="6.2 propsä¼ é€’äº‹ä»¶"></a>6.2 propsä¼ é€’äº‹ä»¶</h3><p>é€šè¿‡this.props.[äº‹ä»¶å]è°ƒç”¨</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Board</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Square</span> <span class="attr">click</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;alert(&quot;click event&quot;)&#125;&#125;/&gt;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.props.click&#125;</span> <span class="attr">className</span>=<span class="string">&quot;square&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              button</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-3-propsæ ¡éªŒ"><a href="#6-3-propsæ ¡éªŒ" class="headerlink" title="6.3 propsæ ¡éªŒ"></a>6.3 propsæ ¡éªŒ</h3><p>1.éœ€è¦å¼•å…¥ä¸€ä¸ªåº“prop-types.js</p><ul><li>cdn</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/prop-types@15.6/prop-types.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>npm</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save prop-types </span><br></pre></td></tr></table></figure><p>2.ä½¿ç”¨æ–¹å¼</p><p>åœ¨ç»„ä»¶ä¸Šå®šä¹‰ PropTypeså¯¹è±¡ï¼Œé”®å°±æ˜¯propsçš„åï¼Œå€¼å°±æ˜¯é™åˆ¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// ... do things with the props</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–¹å¼ä¸€</span></span><br><span class="line">    <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">        <span class="attr">value1</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>.<span class="property">isRequired</span>,</span><br><span class="line">        <span class="attr">value2</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®špropsé»˜è®¤å€¼</span></span><br><span class="line"><span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">        <span class="attr">value1</span>: <span class="number">666</span>,</span><br><span class="line">        <span class="attr">value2</span>: <span class="string">&quot;6&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼äºŒ</span></span><br><span class="line"><span class="title class_">Square</span>.<span class="property">propTypes</span> = &#123;</span><br><span class="line">    <span class="attr">value1</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>.<span class="property">isRequired</span>,</span><br><span class="line">    <span class="attr">value2</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´å¤šä½¿ç”¨æ–¹å¼å‚è€ƒï¼š<a href="https://github.com/facebook/prop-types">https://github.com/facebook/prop-types</a></p><h3 id="6-4-this-props-children"><a href="#6-4-this-props-children" class="headerlink" title="6.4 this.props.children"></a>6.4 this.props.children</h3><blockquote><p>è·å–ç»„ä»¶æ‰€æœ‰å­èŠ‚ç‚¹</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NotesList</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;</span></span><br><span class="line"><span class="language-xml">                    React.Children.map(this.props.children, function (child) &#123;</span></span><br><span class="line"><span class="language-xml">                        return <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;child&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span>;</span></span><br><span class="line"><span class="language-xml">                    &#125;)</span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">NotesList</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">NotesList</span>&gt;</span></span>,</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;example&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul><li>æ²¡æœ‰å­èŠ‚ç‚¹ï¼šundefined</li><li>ä¸€ä¸ªå­èŠ‚ç‚¹ï¼šobject</li><li>å¤šä¸ªå­èŠ‚ç‚¹ï¼šarray</li></ul><p>å¯ä»¥ç”¨<code>React.Children.map</code>æ¥éå†å­èŠ‚ç‚¹ï¼Œåˆ™ä¸éœ€è¦æ‹…å¿ƒå­å…ƒç´ ä¸ªæ•°</p><h3 id="6-5-propsä¼ é€’ç»„ä»¶"><a href="#6-5-propsä¼ é€’ç»„ä»¶" class="headerlink" title="6.5 propsä¼ é€’ç»„ä»¶"></a>6.5 propsä¼ é€’ç»„ä»¶</h3><p>Reactç»„ä»¶æœ¬è´¨å°±æ˜¯å¯¹è±¡ï¼Œå½“ä½œpropsåƒå…¶ä»–æ•°æ®ä¸€æ ·ä¼ é€’ä¹Ÿæ˜¯å¯ä»¥çš„</p><h2 id="7-Reactç”Ÿå‘½å‘¨æœŸ"><a href="#7-Reactç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="7. Reactç”Ÿå‘½å‘¨æœŸ"></a>7. Reactç”Ÿå‘½å‘¨æœŸ</h2><blockquote><p>æ„Ÿè§‰å’Œvueå·®ä¸å¤šï¼Œç›´æ¥ç®€å•å¸¦è¿‡æŠŠ</p></blockquote><h4 id="componentWillMount"><a href="#componentWillMount" class="headerlink" title="componentWillMount()"></a>componentWillMount()</h4><p>ç»„ä»¶å³å°†è¢«æ¸²æŸ“åˆ°é¡µé¢ä¹‹å‰è§¦å‘ï¼Œæ­¤æ—¶å¯ä»¥è¿›è¡Œå¼€å¯å®šæ—¶å™¨ã€å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ç­‰æ“ä½œ</p><h4 id="componentDidMount"><a href="#componentDidMount" class="headerlink" title="componentDidMount()"></a>componentDidMount()</h4><p>ç»„ä»¶å·²ç»è¢«æ¸²æŸ“åˆ°é¡µé¢ä¸­åè§¦å‘ï¼Œå¯ä»¥é€šè¿‡<code>this.getDOMNode()</code>æ¥è¿›è¡Œè®¿é—®DOMã€‚</p><h4 id="componentWillReceiveProps"><a href="#componentWillReceiveProps" class="headerlink" title="componentWillReceiveProps()"></a>componentWillReceiveProps()</h4><p>åœ¨ç»„ä»¶æ¥æ”¶åˆ°ä¸€ä¸ªæ–°çš„ prop (æ›´æ–°å)æ—¶è¢«è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•åœ¨åˆå§‹åŒ–<code>render</code>æ—¶ä¸ä¼šè¢«è°ƒç”¨ã€‚</p><h4 id="shouldComponentUpdate"><a href="#shouldComponentUpdate" class="headerlink" title="shouldComponentUpdate()"></a>shouldComponentUpdate()</h4><p>è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚åœ¨ç»„ä»¶æ¥æ”¶åˆ°æ–°çš„<code>props</code>æˆ–è€…<code>state</code>æ—¶è¢«è°ƒç”¨ã€‚åœ¨åˆå§‹åŒ–æ—¶æˆ–è€…ä½¿ç”¨<code>forceUpdate</code>æ—¶ä¸è¢«è°ƒç”¨ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯¥é’©å­å‡½æ•°å¯ä»¥æ¥æ”¶åˆ°ä¸¤ä¸ªå‚æ•°ï¼Œæ–°çš„å±æ€§å’ŒçŠ¶æ€ï¼Œè¿”å›true/falseæ¥æ§åˆ¶ç»„ä»¶æ˜¯å¦éœ€è¦æ›´æ–°ã€‚</span></span><br><span class="line"><span class="title function_">shouldComponentUpdate</span>(<span class="params">newProps, newState</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (newProps.<span class="property">number</span> &lt; <span class="number">5</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸€ä¸ªReacté¡¹ç›®éœ€è¦æ›´æ–°ä¸€ä¸ªå°ç»„ä»¶æ—¶ï¼Œå¾ˆå¯èƒ½éœ€è¦çˆ¶ç»„ä»¶æ›´æ–°è‡ªå·±çš„çŠ¶æ€ã€‚è€Œä¸€ä¸ª<strong>çˆ¶ç»„ä»¶çš„é‡æ–°æ›´æ–°ä¼šé€ æˆå®ƒæ——ä¸‹æ‰€æœ‰çš„å­ç»„ä»¶é‡æ–°æ‰§è¡Œrender()æ–¹æ³•ï¼ˆå³ä½¿æ²¡æœ‰ä½¿ç”¨çˆ¶ç»„ä»¶çš„stateï¼‰</strong>ï¼Œå½¢æˆæ–°çš„è™šæ‹ŸDOMï¼Œå†ç”¨diffç®—æ³•å¯¹æ–°æ—§è™šæ‹ŸDOMè¿›è¡Œç»“æ„å’Œå±æ€§çš„æ¯”è¾ƒï¼Œå†³å®šç»„ä»¶æ˜¯å¦éœ€è¦é‡æ–°æ¸²æŸ“ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢è¯´äº†PureComponent</p></blockquote><h4 id="componentWillUpdate"><a href="#componentWillUpdate" class="headerlink" title="componentWillUpdate()"></a>componentWillUpdate()</h4><p>åœ¨ç»„ä»¶æ¥æ”¶åˆ°æ–°çš„<code>props</code>æˆ–è€…<code>state</code>ä½†è¿˜æ²¡æœ‰<code>render</code>æ—¶è¢«è°ƒç”¨ã€‚åœ¨åˆå§‹åŒ–æ—¶ä¸ä¼šè¢«è°ƒç”¨ã€‚</p><h4 id="componentDidUpdate"><a href="#componentDidUpdate" class="headerlink" title="componentDidUpdate()"></a>componentDidUpdate()</h4><p>åœ¨ç»„ä»¶å®Œæˆæ›´æ–°åç«‹å³è°ƒç”¨ã€‚åœ¨åˆå§‹åŒ–æ—¶ä¸ä¼šè¢«è°ƒç”¨ã€‚</p><h4 id="componentWillUnMount"><a href="#componentWillUnMount" class="headerlink" title="componentWillUnMount()"></a>componentWillUnMount()</h4><p>ç»„ä»¶è¢«é”€æ¯æ—¶è§¦å‘ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€äº›æ¸…ç†æ“ä½œï¼Œä¾‹å¦‚æ¸…ç†å®šæ—¶å™¨ï¼Œå–æ¶ˆReduxçš„è®¢é˜…äº‹ä»¶ç­‰ç­‰ã€‚</p><h4 id="getDerivedStateFromError"><a href="#getDerivedStateFromError" class="headerlink" title="getDerivedStateFromError()"></a>getDerivedStateFromError()</h4><p>è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•åœ¨<strong>ErrorBoundary</strong>ç±»ä¸­ä½¿ç”¨ã€‚å®é™…ä¸Šï¼Œå¦‚æœä½¿ç”¨è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä»»ä½•ç±»éƒ½ä¼šå˜æˆ<code>ErrorBoundary</code>ã€‚è¿™ç”¨äºåœ¨ç»„ä»¶æ ‘ä¸­å‡ºç°é”™è¯¯æ—¶å‘ˆç°å›é€€UIï¼Œè€Œä¸æ˜¯åœ¨å±å¹•ä¸Šæ˜¾ç¤ºä¸€äº›å¥‡æ€ªçš„é”™è¯¯ã€‚</p><h4 id="componentDidCatch"><a href="#componentDidCatch" class="headerlink" title="componentDidCatch()"></a>componentDidCatch()</h4><p>è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•åœ¨<strong>ErrorBoundary</strong>ç±»ä¸­ä½¿ç”¨ã€‚å®é™…ä¸Šï¼Œå¦‚æœä½¿ç”¨è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä»»ä½•ç±»éƒ½ä¼šå˜æˆ<code>ErrorBoundary</code>ã€‚è¿™ç”¨äºåœ¨ç»„ä»¶æ ‘ä¸­å‡ºç°é”™è¯¯æ—¶è®°å½•é”™è¯¯ã€‚</p><h2 id="8-Ref"><a href="#8-Ref" class="headerlink" title="8. Ref"></a>8. Ref</h2><p>ç”¨æ¥è®¿é—®DOMå…ƒç´ æˆ–renderä¸­çš„reactå…ƒç´ ï¼ŒRefçš„ä½¿ç”¨è§„åˆ™å¦‚ä¸‹</p><ol><li>refä½œç”¨äºå†…ç½®çš„htmlç»„ä»¶æ—¶ï¼Œå¾—åˆ°çš„å°†æ˜¯çœŸå®çš„domå¯¹è±¡</li><li>refä½œç”¨äºç±»ç»„ä»¶æ—¶ï¼Œå¾—åˆ°çš„å°†æ˜¯ç±»çš„å®ä¾‹</li><li>refä¸èƒ½ä½œç”¨äºå‡½æ•°ç»„ä»¶ï¼ˆå› ä¸ºæ²¡æœ‰å®ä¾‹ï¼‰ï¼Œä½†æ˜¯å‡½æ•°ç»„ä»¶å†…éƒ¨å¯ä»¥</li></ol><h3 id="8-1-åˆ›å»ºref"><a href="#8-1-åˆ›å»ºref" class="headerlink" title="8.1 åˆ›å»ºref"></a>8.1 åˆ›å»ºref</h3><p>refçš„å¯é€‰å€¼ä¸º</p><ol><li><p>å­—ç¬¦ä¸²ï¼ˆä¸å»ºè®®ï¼‰</p><p> åŸå› ï¼š<a href="http://www.qiutianaimeili.com/html/page/2020/04/20204277uz3udr631a.html">react refæ³¨æ„äº‹é¡¹</a></p></li><li><p>å›è°ƒå‡½æ•°</p><p> è§¦å‘æ—¶æœºï¼šrefä¸­çš„å›è°ƒå‡½æ•°ä¼šåœ¨å¯¹åº”çš„<strong>æ™®é€š</strong>ç»„ä»¶ï¼ˆæˆ–å…ƒç´ ï¼‰<code>componentDidMount</code>ï¼Œ<code>ComponentDidUpdate</code>ä¹‹å‰ï¼Œæˆ–è€…<code>componentWillUnmount</code>ä¹‹åæ‰§è¡Œ</p><p> <strong>æ³¨æ„ï¼š</strong>å¦‚æœ <code>ref</code> å›è°ƒå‡½æ•°æ˜¯ä»¥<strong>å†…è”å‡½æ•°çš„æ–¹å¼å®šä¹‰</strong>çš„ï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­å®ƒä¼šè¢«<strong>æ‰§è¡Œä¸¤æ¬¡</strong>ï¼Œç¬¬ä¸€æ¬¡ä¼ å…¥å‚æ•° <code>null</code>ï¼Œç„¶åç¬¬äºŒæ¬¡ä¼šä¼ å…¥å‚æ•° DOM å…ƒç´ ã€‚è¿™æ˜¯å› ä¸ºåœ¨<strong>æ¯æ¬¡æ¸²æŸ“æ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°å®ä¾‹</strong>ï¼Œæ‰€ä»¥ React æ¸…ç©ºæ—§çš„ ref å¹¶ä¸”è®¾ç½®æ–°çš„</p></li><li><p>createRef</p></li></ol><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">textInput</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">focusTextInput</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼šæˆ‘ä»¬é€šè¿‡ &quot;current&quot; æ¥è®¿é—® DOM èŠ‚ç‚¹</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">textInput</span>.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;this.textInput&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Focus the text input&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.focusTextInput.bind(this)&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-2-è½¬å‘ref"><a href="#8-2-è½¬å‘ref" class="headerlink" title="8.2 è½¬å‘ref"></a>8.2 è½¬å‘ref</h3><blockquote><p>ç”¨äºè·å–ç»„ä»¶å†…éƒ¨çš„æŸä¸ªå…ƒç´ ï¼Œæœ‰äº›é«˜åº¦å¤ç”¨çš„åŸºç¡€ç»„ä»¶ä¸å¯é¿å…çš„éœ€è¦åœ¨çˆ¶ç»„ä»¶è·å–ï¼Œç”¨ä»¥ç®¡ç†ç„¦ç‚¹ç­‰</p></blockquote><p><code>React.forwardRef</code>ç”¨ä»¥è·å–ä¼ é€’ç»™å®ƒçš„<code>ref</code>ï¼Œç„¶åè½¬å‘åˆ°æ¸²æŸ“å®ƒçš„DOMã€‚</p><p>å¯¹äº<strong>å‡½æ•°å¼ç»„ä»¶</strong>ï¼Œ<code>React.forwardRef</code>ç›´æ¥åŒ…è£¹å‡½æ•°å°±å¯ä»¥æ¥æ”¶åˆ°ref</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">FancyButton</span> = <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> <span class="attr">className</span>=<span class="string">&quot;FancyButton&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;props.children&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ å¯ä»¥ç›´æ¥è·å– DOM button çš„ refï¼š</span></span><br><span class="line"><span class="keyword">const</span> ref = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">FancyButton</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span>&gt;</span>Click me!<span class="tag">&lt;/<span class="name">FancyButton</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>FancyButton</code> çš„ç»„ä»¶å¯ä»¥è·å–åº•å±‚ DOM èŠ‚ç‚¹ <code>button</code> çš„ ref </p><p>è€Œå¯¹äº<strong>ç±»ç»„ä»¶</strong>ï¼Œéœ€è¦ä½¿ç”¨HOCçš„å½¢å¼ï¼Œç”¨<code>React.forwardRef</code>åŒ…è£¹è¿”å›çš„å‡½æ•°å¼ç»„ä»¶</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">logProps</span>(<span class="params">Component</span>) &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">LogProps</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123;forwardedRef, ...rest&#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å°†è‡ªå®šä¹‰çš„ prop å±æ€§ â€œforwardedRefâ€ å®šä¹‰ä¸º ref</span></span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;forwardedRef&#125;</span> &#123;<span class="attr">...rest</span>&#125; /&gt;</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨æ„ React.forwardRef å›è°ƒçš„ç¬¬äºŒä¸ªå‚æ•° â€œrefâ€ã€‚</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å¯ä»¥å°†å…¶ä½œä¸ºå¸¸è§„ prop å±æ€§ä¼ é€’ç»™ LogPropsï¼Œä¾‹å¦‚ â€œforwardedRefâ€</span></span><br><span class="line">    <span class="comment">// ç„¶åå®ƒå°±å¯ä»¥è¢«æŒ‚è½½åˆ°è¢« LogProps åŒ…è£¹çš„å­ç»„ä»¶ä¸Šã€‚</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">LogProps</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">forwardedRef</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨<code>React.forwardRef</code>åŒ…è£¹çš„ç»„ä»¶åœ¨**DevToolsä¸­æ˜¾ç¤ºä¸ºâ€ForwardRefâ€<strong>ï¼Œå¯ä»¥æŠŠåŒ…è£¹çš„å‡½æ•°ç”¨æ™®é€šå‡½æ•°çš„å½¢å¼å‘½åï¼ŒDevToolsä¹Ÿå°†åŒ…å«å…¶åç§°ï¼ˆä¾‹å¦‚ â€œ*ForwardRef(myFunction)*â€ï¼‰ï¼Œä¹Ÿå¯ä»¥**è®¾ç½®å‡½æ•°çš„displayNameå±æ€§</strong>æ¥è®¾ç½®DevToolsä¸­æ˜¾ç¤ºçš„åå­—</p><h2 id="9-Context"><a href="#9-Context" class="headerlink" title="9.Context"></a>9.Context</h2><blockquote><p>è·¨ç»„ä»¶çš„é€šä¿¡æ–¹å¼ï¼Œç­‰åŒVueçš„provideã€inject</p></blockquote><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>1.åˆ›å»ºContextå®¹å™¨å¯¹è±¡</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åªæœ‰å½“ç»„ä»¶æ‰€å¤„çš„æ ‘ä¸­æ²¡æœ‰åŒ¹é…åˆ° Provider æ—¶ï¼Œå…¶ defaultValue å‚æ•°æ‰ä¼šç”Ÿæ•ˆ</span></span><br><span class="line"><span class="keyword">const</span> xxxContext = <span class="title class_">React</span>.<span class="title function_">createContext</span>(defaultValue) </span><br></pre></td></tr></table></figure><p>2.æ¸²æŸ“å­ç»„æ—¶ï¼Œå¤–é¢åŒ…è£¹xxxContext.Providerï¼Œé€šè¿‡valueå±æ€§ç»™åä»£ç»„ä»¶ä¼ é€’æ•°æ®</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;xxxContext.<span class="property">Provider</span> value=&#123;æ•°æ®&#125;&gt;</span><br><span class="line">    &lt;å­ç»„ä»¶&gt;&lt;/å­ç»„ä»¶&gt;</span><br><span class="line">&lt;/xxxContext.<span class="property">Provider</span>&gt;</span><br></pre></td></tr></table></figure><p>psï¼šå¦‚æœè¦ä¼ å¤šä¸ªæ•°æ®ï¼Œéœ€è¦å¥—å¤šå±‚</p><p>3.åä»£ç»„ä»¶è·å–æ•°æ®</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ç§ï¼šä»…é€‚ç”¨äºç±»ç»„ä»¶</span></span><br><span class="line"><span class="keyword">static</span> contextType = xxxContext <span class="comment">// å£°æ˜æ¥å—context</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">context</span>; <span class="comment">// è¯»å–contextä¸­çš„valueæ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç§ï¼šå‡½æ•°ç»„ä»¶ä¸ç±»ç»„ä»¶éƒ½å¯ä»¥</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">xxxContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;value&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">xxxContext.Consumer</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>ä¸å»ºè®®ä½¿ç”¨è¯¥apiï¼Œä»–æé«˜äº†ç»„ä»¶å¤ç”¨çš„éš¾åº¦</strong></p><h2 id="10-PureComponent"><a href="#10-PureComponent" class="headerlink" title="10.PureComponent"></a>10.PureComponent</h2><blockquote><p>çˆ¶ç»„ä»¶setStateä¼šè§¦å‘å­ç»„ä»¶renderï¼ŒPureComponenté€šè¿‡propå’Œstateçš„<strong>æµ…æ¯”è¾ƒ</strong>æ¥å®ç°shouldComponentUpdateï¼Œç®—æ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œå¸®æˆ‘ä»¬åº”è¯¥åœ¨shouldComponentUpdateä¸­åº”è¯¥æ‰‹åŠ¨æ¯”è¾ƒçš„ç»™åšäº†</p></blockquote><p>å¦‚æœæ˜¯æµ…å±‚stateæˆ–propæ²¡æ”¹å˜ï¼Œé‚£ä¹ˆä¸ä¼šè§¦å‘è§†å›¾æ›´æ–°ï¼Œä¹¦å†™æ–¹å¼å¦‚ä¸‹</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">IndexPage</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç”±äºæ˜¯æµ…æ¯”è¾ƒï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹å¯¹è±¡å†…éƒ¨çš„å€¼æ˜¯æ— æ³•æ›´æ–°è§†å›¾çš„</strong></p><p>åœ¨å‡½æ•°å¼ç»„ä»¶åˆ™æ˜¯ç”¨<code>React.memo</code>åŒ…è£¹å‡½æ•°å¼ç»„ä»¶æ¥åšåˆ°PureComponentçš„æ•ˆæœ</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/tsrot/study-notes/blob/master/React%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90%E6%B1%87%E6%80%BB.md">Reactå­¦ä¹ èµ„æºæ±‡æ€»</a><br><a href="http://www.ruanyifeng.com/blog/2015/03/react.html">React å…¥é—¨å®ä¾‹æ•™ç¨‹</a><br><a href="https://blog.sakura-snow.com/post/react-node-2/">reactå­¦ä¹ ç¬”è®°2-reactåŸºæœ¬ä½¿ç”¨</a><br><a href="https://blog.sakura-snow.com/post/react-node-3/">reactå­¦ä¹ ç¬”è®°3-reactå…¶ä»–ä½¿ç”¨æŠ€å·§</a><br><a href="https://juejin.cn/post/6844903510538977287">å›¾è§£ES6ä¸­çš„Reactç”Ÿå‘½å‘¨æœŸ</a><br><a href="https://juejin.cn/post/6844903857135304718#heading-25">ä½ è¦çš„ React é¢è¯•çŸ¥è¯†ç‚¹ï¼Œéƒ½åœ¨è¿™äº†</a></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-è®¾è®¡æ€æƒ³&quot;&gt;&lt;a href=&quot;#1-è®¾è®¡æ€æƒ³&quot; class=&quot;headerlink&quot; title=&quot;1. è®¾è®¡æ€æƒ³&quot;&gt;&lt;/a&gt;1. è®¾è®¡æ€æƒ³&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/react-guide/react-basic&quot;&gt;React è®¾è®¡æ€æƒ³&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.infoq.com/cn/articles/react-art-of-simplity/&quot;&gt;Reactçš„è®¾è®¡å“²å­¦ - ç®€å•ä¹‹ç¾&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.infoq.com/cn/articles/subversion-front-end-ui-development-framework-react/&quot;&gt;é¢ è¦†å¼å‰ç«¯UIå¼€å‘æ¡†æ¶:React&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="React" scheme="https://liang5757.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>jså‡†ç¡®å€’è®¡æ—¶</title>
    <link href="https://liang5757.github.io/2021/05/25/Js/js%E5%87%86%E7%A1%AE%E5%80%92%E8%AE%A1%E6%97%B6/"/>
    <id>https://liang5757.github.io/2021/05/25/Js/js%E5%87%86%E7%A1%AE%E5%80%92%E8%AE%A1%E6%97%B6/</id>
    <published>2021-05-24T16:03:51.000Z</published>
    <updated>2025-12-07T10:16:59.204Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h2><p>å¦‚æœç”¨æœ€åˆå§‹çš„<code>setTimeout</code>é€’å½’å®ç°å®šæ—¶å™¨ï¼Œä¸€ç§’æ‰§è¡Œä¸€æ¬¡å›è°ƒï¼Œåˆ™ä»£ç å¦‚ä¸‹</p><span id="more"></span><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿæ‰§è¡Œå¤§é‡ä»£ç </span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (i++ &lt; <span class="number">100000000</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">countDown</span> (<span class="params">fn, time</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> startTime = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>(), count = <span class="number">0</span>, second = <span class="number">1000</span>;</span><br><span class="line">  <span class="keyword">let</span> timeCounter = <span class="literal">null</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">interFunc</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> offset = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() - (startTime + count * second);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¯¯å·®ï¼š&quot;</span> + offset + <span class="string">&quot;msï¼Œä¸‹ä¸€æ¬¡æ‰§è¡Œï¼š&quot;</span> + <span class="number">1000</span> + <span class="string">&quot;msåï¼Œç¦»æ´»åŠ¨å¼€å§‹è¿˜æœ‰ï¼š&quot;</span> + time + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    time -= second;</span><br><span class="line">    count++;</span><br><span class="line">    <span class="keyword">if</span> (time &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timeCounter);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      timeCounter = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">        <span class="title function_">interFunc</span>();</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">countDown</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;, <span class="number">10000</span>)(); <span class="comment">// æµ‹è¯•ä»£ç </span></span><br></pre></td></tr></table></figure><p><img src="/2021/05/25/Js/js%E5%87%86%E7%A1%AE%E5%80%92%E8%AE%A1%E6%97%B6/image-20210524235731030.png" alt="image-20210524235731030"></p><p>å¯ä»¥çœ‹åˆ°è¯¯å·®æ˜¯ä¼šè¶Šæ¥è¶Šå¤šçš„ã€‚</p><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>æ ¸å¿ƒæ€æƒ³å°±æ˜¯é€šè¿‡è®¡ç®— <strong>å½“å‰æ—¶é—´ - åº”è¯¥åˆ°çš„æ—¶é—´</strong> è®¡ç®—å‡º<strong>æ—¶é—´åç§»é‡</strong>ï¼Œ<strong>ä¸‹ä¸€æ¬¡å»¶è¿Ÿæ—¶é—´å°±æ˜¯ 1s - åç§»é‡</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿæ‰§è¡Œå¤§é‡ä»£ç </span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (i++ &lt; <span class="number">100000000</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å€’è®¡æ—¶</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">countDown</span> (<span class="params">fn, time</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> startTime = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>(), count = <span class="number">0</span>, second = <span class="number">1000</span>;</span><br><span class="line">  <span class="keyword">let</span> timeCounter = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">interFunc</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> offset = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() - (startTime + count * second);</span><br><span class="line">    <span class="keyword">let</span> nextTime = second - offset;</span><br><span class="line">    <span class="keyword">if</span> (nextTime &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      nextTime = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¯¯å·®ï¼š&quot;</span> + offset + <span class="string">&quot;msï¼Œä¸‹ä¸€æ¬¡æ‰§è¡Œï¼š&quot;</span> + nextTime + <span class="string">&quot;msåï¼Œç¦»æ´»åŠ¨å¼€å§‹è¿˜æœ‰ï¼š&quot;</span> + time + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    time -= second;</span><br><span class="line">    count++;</span><br><span class="line">    <span class="keyword">if</span> (time &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timeCounter);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      timeCounter = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">        <span class="title function_">interFunc</span>();</span><br><span class="line">      &#125;, nextTime);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">countDown</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;, <span class="number">10000</span>)(); <span class="comment">// æµ‹è¯•ä»£ç </span></span><br></pre></td></tr></table></figure><p><img src="/2021/05/25/Js/js%E5%87%86%E7%A1%AE%E5%80%92%E8%AE%A1%E6%97%B6/image-20210525000118726.png" alt="image-20210525000118726"></p><p>å¯ä»¥çœ‹åˆ°è™½ç„¶ä»æœ‰è¯¯å·®ï¼Œä½†ä¸ä¼šéšç€æ—¶é—´å¢å¤§</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å¼•å…¥&quot;&gt;&lt;a href=&quot;#å¼•å…¥&quot; class=&quot;headerlink&quot; title=&quot;å¼•å…¥&quot;&gt;&lt;/a&gt;å¼•å…¥&lt;/h2&gt;&lt;p&gt;å¦‚æœç”¨æœ€åˆå§‹çš„&lt;code&gt;setTimeout&lt;/code&gt;é€’å½’å®ç°å®šæ—¶å™¨ï¼Œä¸€ç§’æ‰§è¡Œä¸€æ¬¡å›è°ƒï¼Œåˆ™ä»£ç å¦‚ä¸‹&lt;/p&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="js" scheme="https://liang5757.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ç»™å¯¹è±¡è®¾ç½®é»˜è®¤å€¼</title>
    <link href="https://liang5757.github.io/2021/05/06/Js/%E5%A6%82%E4%BD%95%E7%BB%99%E5%AF%B9%E8%B1%A1%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%80%BC/"/>
    <id>https://liang5757.github.io/2021/05/06/Js/%E5%A6%82%E4%BD%95%E7%BB%99%E5%AF%B9%E8%B1%A1%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%80%BC/</id>
    <published>2021-05-05T17:06:29.000Z</published>
    <updated>2025-12-07T10:16:59.207Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ç”¨-â€¦-è§£æ„è®¾ç½®"><a href="#1-ç”¨-â€¦-è§£æ„è®¾ç½®" class="headerlink" title="1.ç”¨ â€¦ è§£æ„è®¾ç½®"></a>1.ç”¨ â€¦ è§£æ„è®¾ç½®</h2><p>åœ¨çœ‹compressor.jsçš„æ—¶å€™ï¼Œä»–ç”¨ä¸€ä¸ªæ–‡ä»¶æ¥å­˜é»˜è®¤å€¼ï¼Œç„¶åå¯¼å‡ºï¼Œæœ€åç”¨è§£æ„çš„æ–¹å¼ï¼Œåé¢çš„å€¼è¦†ç›–å‰é¢çš„æ–¹å¼è®¾ç½®é»˜è®¤å€¼ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç”¨<code>Object.assign</code>éƒ½æ˜¯ä¸€æ ·çš„</p><span id="more"></span><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// defaults.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">maxWidth</span>: <span class="title class_">Infinity</span>,</span><br><span class="line">    <span class="attr">maxHeight</span>: <span class="title class_">Infinity</span>,</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="variable constant_">DEFAULTS</span> <span class="keyword">from</span> <span class="string">&#x27;./defaults&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Compressor</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span> (<span class="params">option</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">option</span> = &#123;</span><br><span class="line">            ...<span class="variable constant_">DEFAULTS</span>,</span><br><span class="line">            ...option,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•çœ‹ç€æŒºæ–¹ä¾¿çš„ï¼Œä½†æ˜¯è¿˜æœ‰ç¼ºé™·ï¼Œè§£å†³ä¸äº†ä¸‹é¢çš„é—®é¢˜</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="string">&quot;a1&quot;</span>,</span><br><span class="line">  <span class="attr">b</span>: &#123;</span><br><span class="line">    <span class="attr">c</span>: <span class="string">&quot;c1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> defaults = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="string">&quot;a2&quot;</span>,</span><br><span class="line">  <span class="attr">b</span>: &#123;</span><br><span class="line">    <span class="attr">c</span>: <span class="string">&quot;c2&quot;</span>,</span><br><span class="line">    <span class="attr">d</span>: <span class="string">&quot;d1&quot;</span> <span class="comment">// ä¸¢å¤±äº†</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> option = &#123;</span><br><span class="line">  ...defaults,</span><br><span class="line">  ...user</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(option) <span class="comment">// &#123; a: &#x27;a1&#x27;, b: &#123; c: &#x27;c1&#x27; &#125; &#125;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é»˜è®¤é…ç½®ä¸­ <strong>dä¸¢å¤±äº†</strong>ï¼Œä¸‹é¢çš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</p><h2 id="2-extendæ–¹æ³•"><a href="#2-extendæ–¹æ³•" class="headerlink" title="2.extendæ–¹æ³•"></a>2.extendæ–¹æ³•</h2><p>Mescroll.jså®ç°çš„æ–¹æ³•ï¼Œé€‚åˆå¤šä¸ªæ–¹æ³•éƒ½éœ€è¦é»˜è®¤å€¼çš„æ—¶å€™ï¼Œå¹¶ä¸”<strong>å¯ä»¥æ·±åº¦åŒ¹é…é»˜è®¤å€¼</strong>ï¼Œé»˜è®¤å€¼ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">MeScroll</span>.<span class="property">extend</span> = <span class="keyword">function</span> (<span class="params">userOption, defaultOption</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!userOption) <span class="keyword">return</span> defaultOption;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> defaultOption) &#123;</span><br><span class="line">        <span class="keyword">if</span> (userOption[key] == <span class="literal">null</span>) &#123; <span class="comment">// å¦‚æœç”¨æˆ·æ²¡è®¾ç½®ï¼Œåˆ™ç”¨é»˜è®¤å€¼</span></span><br><span class="line">            userOption[key] = defaultOption[key]; </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> userOption[key] === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">            <span class="title class_">MeScroll</span>.<span class="title function_">extend</span>(userOption[key], defaultOption[key]); <span class="comment">// æ·±åº¦åŒ¹é…</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> userOption;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æœ‰äº›åœºæ™¯æˆ‘ä»¬æ˜¯éœ€è¦æœ‰<strong>å¤šä¸ªé…ç½®è¿›è¡Œåˆå¹¶</strong>ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒjqueryçš„<code>extend</code>å®ç°æ–¹å¼</p><h2 id="3-extend"><a href="#3-extend" class="headerlink" title="3.$.extend"></a>3.$.extend</h2><p><code>$.extend([deep,] [target,] object1 [,objectN])</code></p><blockquote><p><strong>deep</strong>: Boolenç±»å‹ï¼Œå¯é€‰ï¼Œè¡¨ç¤ºæ˜¯å¦è¿›è¡Œé€’å½’åˆå¹¶ï¼ˆæ·±&#x2F;æµ…å¤åˆ¶ï¼‰ï¼Œä¸ºtrueæ˜¯ä¸ºæ·±å¤åˆ¶ï¼›é»˜è®¤å€¼ä¸ºfalseï¼Œæµ…å¤åˆ¶ã€‚<br><strong>target</strong>:æ‰©å±•å¯¹è±¡ï¼Œå¯é€‰ï¼Œå°†æ¥æ”¶æ–°çš„å±æ€§ã€‚<br><strong>objectN</strong>:ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«é¢å¤–çš„å±æ€§ï¼Œæ‰©å±•åˆ°ç›®æ ‡å¯¹è±¡ï¼ˆæ‰©å±•å¯¹è±¡ï¼‰ã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥ç æ‰ä¸€ä¸ªæ²¡å¿…è¦çš„åŠŸèƒ½ï¼Œå°±æ˜¯<code>$.extend</code>å¦‚æœå‚æ•°ä¸­åªæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™æ‰©å±•jqueryå¯¹è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­¤æ–¹æ³•ä¼šæ”¹å˜åŸå¯¹è±¡</span></span><br><span class="line">jQuery.<span class="property">extend</span> = jQuery.<span class="property">fn</span>.<span class="property">extend</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> options, name, src, copy, copyIsArray, clone,</span><br><span class="line">    target = <span class="variable language_">arguments</span>[<span class="number">0</span>] || &#123;&#125;,</span><br><span class="line">    i = <span class="number">1</span>,    <span class="comment">// iè¡¨ç¤ºä»ç¬¬å‡ ä¸ªå‚æ•°å¼€å§‹å‘ç›®æ ‡å‚æ•°è¿›è¡Œåˆå¹¶ï¼Œé»˜è®¤ä»ç¬¬2ä¸ªå‚æ•°å¼€å§‹å‘ç¬¬1ä¸ªå‚æ•°è¿›è¡Œåˆå¹¶</span></span><br><span class="line">    length = <span class="variable language_">arguments</span>.<span class="property">length</span>,</span><br><span class="line">    deep = <span class="literal">false</span>;  <span class="comment">// é»˜è®¤ä¸ºæµ…åº¦æ‹·è´</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥è®¾ç½®deepçš„booleanå€¼ï¼Œåˆ™å°†targetè®¾ç½®ä¸ºä¸‹ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target === <span class="string">&quot;boolean&quot;</span>) &#123;</span><br><span class="line">    deep = target;</span><br><span class="line">    </span><br><span class="line">    target = <span class="variable language_">arguments</span>[i] || &#123;&#125;;</span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//  åˆ¤æ–­ç›®æ ‡å‚æ•°çš„ç±»å‹ï¼Œè‹¥ç›®æ ‡å‚æ•°æ—¢ä¸æ˜¯objectç±»å‹ï¼Œä¹Ÿä¸æ˜¯functionç±»å‹ï¼Œåˆ™ä¸ºç›®æ ‡å‚æ•°é‡æ–°èµ‹å€¼</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> target !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    target = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä»ç¬¬iä¸ªå‚æ•°å¼€å§‹</span></span><br><span class="line">  <span class="keyword">for</span> (; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="comment">// è·å–ç¬¬iä¸ªä¸ä¸ºnullæˆ–undefinedçš„å‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> ((options = <span class="variable language_">arguments</span>[i]) != <span class="literal">null</span>) &#123;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">for</span> (name <span class="keyword">in</span> options) &#123;</span><br><span class="line">        src = target[name];</span><br><span class="line">        copy = options[name];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é˜²æ­¢å¾ªç¯å¼•ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (name === <span class="string">&quot;__proto__&quot;</span> || target === copy) &#123;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è‹¥deepä¸ºtrueï¼Œä¸”å½“å‰å‚æ•°ä¸­nameå­—æ®µçš„å€¼å­˜åœ¨ä¸”ä¸ºobjectç±»å‹æˆ–Arrayç±»å‹ï¼Œåˆ™è¿›è¡Œæ·±åˆå¹¶</span></span><br><span class="line">        <span class="keyword">if</span> (deep &amp;&amp; copy &amp;&amp; (<span class="title function_">isPlainObject</span>(copy) || (copyIsArray = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(copy)))) &#123;</span><br><span class="line">          <span class="comment">// å¦‚æœcopyæ˜¯æ•°ç»„ç±»å‹ï¼Œåˆ™åˆ¤æ–­ç›®æ ‡å‚æ•°ä¸­nameå­—æ®µçš„å€¼æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨åˆ™ä½¿ç”¨åŸæ¥çš„ï¼Œå¦åˆ™è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">          <span class="keyword">if</span> (copyIsArray &amp;&amp; !<span class="title class_">Array</span>.<span class="title function_">isArray</span>(src)) &#123;</span><br><span class="line">            clone = [];</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!copyIsArray &amp;&amp; !<span class="title function_">isPlainObject</span>(src)) &#123;</span><br><span class="line">            clone = &#123;&#125;;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            clone = src;</span><br><span class="line">          &#125;</span><br><span class="line">          copyIsArray = <span class="literal">false</span>;</span><br><span class="line">          </span><br><span class="line">          target[name] = <span class="title function_">merge</span>(deep, clone, copy);</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// deepä¸ºfalseï¼Œè¡¨ç¤ºæµ…æ‹·è´ï¼Œç›´æ¥è¿›è¡Œèµ‹å€¼</span></span><br><span class="line">          <span class="comment">// æˆ–è€…copyä¸ä¸ºObjectå¯¹è±¡ã€æ•°ç»„ï¼Œåˆ™ç›´æ¥èµ‹å€¼</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (copy !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">          <span class="comment">// è‹¥åŸå¯¹è±¡å­˜åœ¨nameå±æ€§ï¼Œåˆ™ç›´æ¥è¦†ç›–æ‰ï¼›è‹¥ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°çš„å±æ€§</span></span><br><span class="line">          target[name] = copy;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è¿”å›ä¿®æ”¹åçš„ç›®æ ‡å‚æ•°</span></span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="é™„1ï¼šjqueryé‡æ„äº†çš„ä¸€æ®µä»£ç "><a href="#é™„1ï¼šjqueryé‡æ„äº†çš„ä¸€æ®µä»£ç " class="headerlink" title="é™„1ï¼šjqueryé‡æ„äº†çš„ä¸€æ®µä»£ç "></a>é™„1ï¼šjqueryé‡æ„äº†çš„ä¸€æ®µä»£ç </h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (deep &amp;&amp; copy &amp;&amp; (jQuery.<span class="title function_">isPlainObject</span>(copy) || (copyIsArray = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(copy)))) &#123;</span><br><span class="line">    <span class="keyword">if</span> (copyIsArray) &#123;</span><br><span class="line">        copyIsArray = <span class="literal">false</span>;</span><br><span class="line">        clone = src &amp;&amp; <span class="title class_">Array</span>.<span class="title function_">isArray</span>(src) ? src : [];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        clone = src &amp;&amp; jQuery.<span class="title function_">isPlainObject</span>(src) ? src : &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    target[name] = jQuery.<span class="title function_">extend</span>(deep, clone, copy);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( copy !== <span class="literal">undefined</span> ) &#123;</span><br><span class="line">    target[name] = copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (deep &amp;&amp; copy &amp;&amp; (<span class="title function_">isPlainObject</span>(copy) || (copyIsArray = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(copy)))) &#123;</span><br><span class="line">    <span class="keyword">if</span> (copyIsArray &amp;&amp; !<span class="title class_">Array</span>.<span class="title function_">isArray</span>(src)) &#123;</span><br><span class="line">        clone = [];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!copyIsArray &amp;&amp; !<span class="title function_">isPlainObject</span>(src)) &#123;</span><br><span class="line">        clone = &#123;&#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        clone = src;</span><br><span class="line">    &#125;</span><br><span class="line">    copyIsArray = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    target[name] = <span class="title function_">merge</span>(deep, clone, copy);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (copy !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    target[name] = copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç æ˜æ˜¾ä¸‹é¢å¥½çœ‹äº†è®¸å¤šï¼Œå¯ä»¥å­¦ä¹ ä¸€ä¸‹è¿™ç§é‡æ„æ–¹å¼</p><h2 id="é™„2ï¼šisEmptyObjectã€isPlainObject"><a href="#é™„2ï¼šisEmptyObjectã€isPlainObject" class="headerlink" title="é™„2ï¼šisEmptyObjectã€isPlainObject"></a>é™„2ï¼šisEmptyObjectã€isPlainObject</h2><h4 id="1-isEmptyObject"><a href="#1-isEmptyObject" class="headerlink" title="1.isEmptyObject"></a>1.isEmptyObject</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">isEmptyObject</span>: <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (name <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿˜å¯ä»¥åˆ©ç”¨JSON.stringify</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj) == <span class="string">&quot;&#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure><h4 id="2-isPlainObject"><a href="#2-isPlainObject" class="headerlink" title="2.isPlainObject"></a>2.isPlainObject</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isPlainObject</span> (<span class="params">target</span>) &#123;</span><br><span class="line">    <span class="comment">// 1.å…ˆæ’é™¤æ˜æ˜¾ä¸æ˜¯Objectçš„</span></span><br><span class="line">    <span class="keyword">if</span> (!target || <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(target) !== <span class="string">&quot;[object Object]&quot;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­æ˜¯å¦æœ‰åŸå‹ï¼Œæ²¡æœ‰åŸå‹çš„æ˜¯ç®€å•å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">const</span> proto = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (!proto) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.åˆ¤æ–­å…¶æ„é€ å‡½æ•°æ˜¯å¦ä¸º Object</span></span><br><span class="line">    <span class="keyword">const</span> ctor = proto.<span class="property">constructor</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> ctor === <span class="string">&quot;function&quot;</span> &amp;&amp; ctor === <span class="title class_">Object</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.csdn.net/weixin_33694172/article/details/89369987">https://blog.csdn.net/weixin_33694172/article/details/89369987</a></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-ç”¨-â€¦-è§£æ„è®¾ç½®&quot;&gt;&lt;a href=&quot;#1-ç”¨-â€¦-è§£æ„è®¾ç½®&quot; class=&quot;headerlink&quot; title=&quot;1.ç”¨ â€¦ è§£æ„è®¾ç½®&quot;&gt;&lt;/a&gt;1.ç”¨ â€¦ è§£æ„è®¾ç½®&lt;/h2&gt;&lt;p&gt;åœ¨çœ‹compressor.jsçš„æ—¶å€™ï¼Œä»–ç”¨ä¸€ä¸ªæ–‡ä»¶æ¥å­˜é»˜è®¤å€¼ï¼Œç„¶åå¯¼å‡ºï¼Œæœ€åç”¨è§£æ„çš„æ–¹å¼ï¼Œåé¢çš„å€¼è¦†ç›–å‰é¢çš„æ–¹å¼è®¾ç½®é»˜è®¤å€¼ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç”¨&lt;code&gt;Object.assign&lt;/code&gt;éƒ½æ˜¯ä¸€æ ·çš„&lt;/p&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://liang5757.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="js" scheme="https://liang5757.github.io/tags/js/"/>
    
  </entry>
  
</feed>
